(self.webpackChunkrecognition=self.webpackChunkrecognition||[]).push([[179],{989:(Wl,Vg,Ra)=>{"use strict";function He(n){return"function"==typeof n}function Hg(n){const e=n(r=>{Error.call(r),r.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const Ul=Hg(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function zl(n,t){if(n){const e=n.indexOf(t);0<=e&&n.splice(e,1)}}class ur{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const i of e)i.remove(this);else e.remove(this);const{initialTeardown:r}=this;if(He(r))try{r()}catch(i){t=i instanceof Ul?i.errors:[i]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const i of o)try{Ug(i)}catch(a){t=t??[],a instanceof Ul?t=[...t,...a.errors]:t.push(a)}}if(t)throw new Ul(t)}}add(t){var e;if(t&&t!==this)if(this.closed)Ug(t);else{if(t instanceof ur){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(t)}}_hasParent(t){const{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){const{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&zl(e,t)}remove(t){const{_finalizers:e}=this;e&&zl(e,t),t instanceof ur&&t._removeParent(this)}}ur.EMPTY=(()=>{const n=new ur;return n.closed=!0,n})();const jg=ur.EMPTY;function Wg(n){return n instanceof ur||n&&"closed"in n&&He(n.remove)&&He(n.add)&&He(n.unsubscribe)}function Ug(n){He(n)?n():n.unsubscribe()}const Vo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},cu={setTimeout(n,t,...e){const{delegate:r}=cu;return r?.setTimeout?r.setTimeout(n,t,...e):setTimeout(n,t,...e)},clearTimeout(n){const{delegate:t}=cu;return(t?.clearTimeout||clearTimeout)(n)},delegate:void 0};function zg(n){cu.setTimeout(()=>{const{onUnhandledError:t}=Vo;if(!t)throw n;t(n)})}function Gg(){}const gI=Gl("C",void 0,void 0);function Gl(n,t,e){return{kind:n,value:t,error:e}}let Ho=null;function lu(n){if(Vo.useDeprecatedSynchronousErrorHandling){const t=!Ho;if(t&&(Ho={errorThrown:!1,error:null}),n(),t){const{errorThrown:e,error:r}=Ho;if(Ho=null,e)throw r}}else n()}class ql extends ur{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Wg(t)&&t.add(this)):this.destination=DI}static create(t,e,r){return new Na(t,e,r)}next(t){this.isStopped?Kl(function yI(n){return Gl("N",n,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Kl(function mI(n){return Gl("E",void 0,n)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Kl(gI,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const wI=Function.prototype.bind;function $l(n,t){return wI.call(n,t)}class xI{constructor(t){this.partialObserver=t}next(t){const{partialObserver:e}=this;if(e.next)try{e.next(t)}catch(r){du(r)}}error(t){const{partialObserver:e}=this;if(e.error)try{e.error(t)}catch(r){du(r)}else du(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(e){du(e)}}}class Na extends ql{constructor(t,e,r){let o;if(super(),He(t)||!t)o={next:t??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&Vo.useDeprecatedNextContext?(i=Object.create(t),i.unsubscribe=()=>this.unsubscribe(),o={next:t.next&&$l(t.next,i),error:t.error&&$l(t.error,i),complete:t.complete&&$l(t.complete,i)}):o=t}this.destination=new xI(o)}}function du(n){Vo.useDeprecatedSynchronousErrorHandling?function bI(n){Vo.useDeprecatedSynchronousErrorHandling&&Ho&&(Ho.errorThrown=!0,Ho.error=n)}(n):zg(n)}function Kl(n,t){const{onStoppedNotification:e}=Vo;e&&cu.setTimeout(()=>e(n,t))}const DI={closed:!0,next:Gg,error:function _I(n){throw n},complete:Gg},Xl="function"==typeof Symbol&&Symbol.observable||"@@observable";function Yl(n){return n}let Pt=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){const r=new n;return r.source=this,r.operator=e,r}subscribe(e,r,o){const i=function EI(n){return n&&n instanceof ql||function CI(n){return n&&He(n.next)&&He(n.error)&&He(n.complete)}(n)&&Wg(n)}(e)?e:new Na(e,r,o);return lu(()=>{const{operator:a,source:s}=this;i.add(a?a.call(i,s):s?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return new(r=$g(r))((o,i)=>{const a=new Na({next:s=>{try{e(s)}catch(u){i(u),a.unsubscribe()}},error:i,complete:o});this.subscribe(a)})}_subscribe(e){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(e)}[Xl](){return this}pipe(...e){return function qg(n){return 0===n.length?Yl:1===n.length?n[0]:function(e){return n.reduce((r,o)=>o(r),e)}}(e)(this)}toPromise(e){return new(e=$g(e))((r,o)=>{let i;this.subscribe(a=>i=a,a=>o(a),()=>r(i))})}}return n.create=t=>new n(t),n})();function $g(n){var t;return null!==(t=n??Vo.Promise)&&void 0!==t?t:Promise}const II=Hg(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let fu=(()=>{class n extends Pt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const r=new Kg(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new II}next(e){lu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(e)}})}error(e){lu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){lu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:r,isStopped:o,observers:i}=this;return r||o?jg:(this.currentObservers=null,i.push(e),new ur(()=>{this.currentObservers=null,zl(i,e)}))}_checkFinalizedStatuses(e){const{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){const e=new Pt;return e.source=this,e}}return n.create=(t,e)=>new Kg(t,e),n})();class Kg extends fu{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,t)}error(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,t)}complete(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)}_subscribe(t){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==r?r:jg}}function co(n){return t=>{if(function SI(n){return He(n?.lift)}(t))return t.lift(function(e){try{return n(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function lo(n,t,e,r,o){return new TI(n,t,e,r,o)}class TI extends ql{constructor(t,e,r,o,i,a){super(t),this.onFinalize=i,this.shouldUnsubscribe=a,this._next=e?function(s){try{e(s)}catch(u){t.error(u)}}:super._next,this._error=o?function(s){try{o(s)}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(s){t.error(s)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function yi(n,t){return co((e,r)=>{let o=0;e.subscribe(lo(r,i=>{r.next(n.call(t,i,o++))}))})}function jo(n){return this instanceof jo?(this.v=n,this):new jo(n)}function RI(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=e.apply(n,t||[]),i=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(f){r[f]&&(o[f]=function(h){return new Promise(function(p,v){i.push([f,h,p,v])>1||s(f,h)})})}function s(f,h){try{!function u(f){f.value instanceof jo?Promise.resolve(f.value.v).then(c,l):d(i[0][2],f)}(r[f](h))}catch(p){d(i[0][3],p)}}function c(f){s("next",f)}function l(f){s("throw",f)}function d(f,h){f(h),i.shift(),i.length&&s(i[0][0],i[0][1])}}function NI(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=n[Symbol.asyncIterator];return t?t.call(n):(n=function Qg(n){var t="function"==typeof Symbol&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=n[i]&&function(a){return new Promise(function(s,u){!function o(i,a,s,u){Promise.resolve(u).then(function(c){i({value:c,done:s})},a)}(s,u,(a=n[i](a)).done,a.value)})}}}const Jl=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Jg(n){return He(n?.then)}function Zg(n){return He(n[Xl])}function em(n){return Symbol.asyncIterator&&He(n?.[Symbol.asyncIterator])}function tm(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const nm=function kI(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function rm(n){return He(n?.[nm])}function om(n){return RI(this,arguments,function*(){const e=n.getReader();try{for(;;){const{value:r,done:o}=yield jo(e.read());if(o)return yield jo(void 0);yield yield jo(r)}}finally{e.releaseLock()}})}function im(n){return He(n?.getReader)}function cr(n){if(n instanceof Pt)return n;if(null!=n){if(Zg(n))return function PI(n){return new Pt(t=>{const e=n[Xl]();if(He(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Jl(n))return function OI(n){return new Pt(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}(n);if(Jg(n))return function LI(n){return new Pt(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,zg)})}(n);if(em(n))return am(n);if(rm(n))return function BI(n){return new Pt(t=>{for(const e of n)if(t.next(e),t.closed)return;t.complete()})}(n);if(im(n))return function VI(n){return am(om(n))}(n)}throw tm(n)}function am(n){return new Pt(t=>{(function HI(n,t){var e,r,o,i;return function MI(n,t,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(n,t||[])).next())})}(this,void 0,void 0,function*(){try{for(e=NI(n);!(r=yield e.next()).done;)if(t.next(r.value),t.closed)return}catch(a){o={error:a}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}t.complete()})})(n,t).catch(e=>t.error(e))})}function fo(n,t,e,r=0,o=!1){const i=t.schedule(function(){e(),o?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(i),!o)return i}function Fa(n,t,e=1/0){return He(t)?Fa((r,o)=>yi((i,a)=>t(r,i,o,a))(cr(n(r,o))),e):("number"==typeof t&&(e=t),co((r,o)=>function jI(n,t,e,r,o,i,a,s){const u=[];let c=0,l=0,d=!1;const f=()=>{d&&!u.length&&!c&&t.complete()},h=v=>c<r?p(v):u.push(v),p=v=>{i&&t.next(v),c++;let g=!1;cr(e(v,l++)).subscribe(lo(t,m=>{o?.(m),i?h(m):t.next(m)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;u.length&&c<r;){const m=u.shift();a?fo(t,a,()=>p(m)):p(m)}f()}catch(m){t.error(m)}}))};return n.subscribe(lo(t,h,()=>{d=!0,f()})),()=>{s?.()}}(r,o,n,e)))}const sm=new Pt(n=>n.complete());function Zl(n){return n[n.length-1]}function um(n){return function zI(n){return n&&He(n.schedule)}(Zl(n))?n.pop():void 0}function cm(n,t=0){return co((e,r)=>{e.subscribe(lo(r,o=>fo(r,n,()=>r.next(o),t),()=>fo(r,n,()=>r.complete(),t),o=>fo(r,n,()=>r.error(o),t)))})}function lm(n,t=0){return co((e,r)=>{r.add(n.schedule(()=>e.subscribe(r),t))})}function dm(n,t){if(!n)throw new Error("Iterable cannot be null");return new Pt(e=>{fo(e,t,()=>{const r=n[Symbol.asyncIterator]();fo(e,t,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function fm(n,t){return t?function QI(n,t){if(null!=n){if(Zg(n))return function qI(n,t){return cr(n).pipe(lm(t),cm(t))}(n,t);if(Jl(n))return function KI(n,t){return new Pt(e=>{let r=0;return t.schedule(function(){r===n.length?e.complete():(e.next(n[r++]),e.closed||this.schedule())})})}(n,t);if(Jg(n))return function $I(n,t){return cr(n).pipe(lm(t),cm(t))}(n,t);if(em(n))return dm(n,t);if(rm(n))return function XI(n,t){return new Pt(e=>{let r;return fo(e,t,()=>{r=n[nm](),fo(e,t,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(a){return void e.error(a)}i?e.complete():e.next(o)},0,!0)}),()=>He(r?.return)&&r.return()})}(n,t);if(im(n))return function YI(n,t){return dm(om(n),t)}(n,t)}throw tm(n)}(n,t):cr(n)}function ed(n,t,...e){if(!0===t)return void n();if(!1===t)return;const r=new Na({next:()=>{r.unsubscribe(),n()}});return t(...e).subscribe(r)}function qe(n){for(let t in n)if(n[t]===qe)return t;throw Error("Could not find renamed property on target object.")}function $e(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map($e).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const t=n.toString();if(null==t)return""+t;const e=t.indexOf("\n");return-1===e?t:t.substring(0,e)}function nd(n,t){return null==n||""===n?null===t?"":t:null==t||""===t?n:n+" "+t}const e2=qe({__forward_ref__:qe});function rd(n){return n.__forward_ref__=rd,n.toString=function(){return $e(this())},n}function se(n){return function od(n){return"function"==typeof n&&n.hasOwnProperty(e2)&&n.__forward_ref__===rd}(n)?n():n}class ue extends Error{constructor(t,e){super(function hu(n,t){return`NG0${Math.abs(n)}${t?": "+t.trim():""}`}(t,e)),this.code=t}}function Le(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():function he(n){return"string"==typeof n?n:null==n?"":String(n)}(n)}function pu(n,t){throw new ue(-201,!1)}function vn(n,t){null==n&&function je(n,t,e,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${e} ${r} ${t} <=Actual]`))}(t,n,null,"!=")}function We(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function ho(n){return{providers:n.providers||[],imports:n.imports||[]}}function id(n){return hm(n,vu)||hm(n,vm)}function hm(n,t){return n.hasOwnProperty(t)?n[t]:null}function pm(n){return n&&(n.hasOwnProperty(ad)||n.hasOwnProperty(u2))?n[ad]:null}const vu=qe({\u0275prov:qe}),ad=qe({\u0275inj:qe}),vm=qe({ngInjectableDef:qe}),u2=qe({ngInjectorDef:qe});var ce=(()=>((ce=ce||{})[ce.Default=0]="Default",ce[ce.Host=1]="Host",ce[ce.Self=2]="Self",ce[ce.SkipSelf=4]="SkipSelf",ce[ce.Optional=8]="Optional",ce))();let sd;function lr(n){const t=sd;return sd=n,t}function gm(n,t,e){const r=id(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:e&ce.Optional?null:void 0!==t?t:void pu($e(n))}function po(n){return{toString:n}.toString()}var Hn=(()=>((Hn=Hn||{})[Hn.OnPush=0]="OnPush",Hn[Hn.Default=1]="Default",Hn))(),dr=(()=>{return(n=dr||(dr={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",dr;var n})();const ze=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),bi={},Be=[],gu=qe({\u0275cmp:qe}),ud=qe({\u0275dir:qe}),cd=qe({\u0275pipe:qe}),mm=qe({\u0275mod:qe}),Or=qe({\u0275fac:qe}),ka=qe({__NG_ELEMENT_ID__:qe});let l2=0;function ld(n){return po(()=>{const e=!0===n.standalone,r={},o={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Hn.OnPush,directiveDefs:null,pipeDefs:null,standalone:e,dependencies:e&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||Be,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||dr.Emulated,id:"c"+l2++,styles:n.styles||Be,_:null,setInput:null,schemas:n.schemas||null,tView:null},i=n.dependencies,a=n.features;return o.inputs=wm(n.inputs,r),o.outputs=wm(n.outputs),a&&a.forEach(s=>s(o)),o.directiveDefs=i?()=>("function"==typeof i?i():i).map(ym).filter(bm):null,o.pipeDefs=i?()=>("function"==typeof i?i():i).map(Qt).filter(bm):null,o})}function ym(n){return Xe(n)||Yt(n)}function bm(n){return null!==n}const f2={};function Wo(n){return po(()=>{const t={type:n.type,bootstrap:n.bootstrap||Be,declarations:n.declarations||Be,imports:n.imports||Be,exports:n.exports||Be,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(f2[n.id]=n.type),t})}function wm(n,t){if(null==n)return bi;const e={};for(const r in n)if(n.hasOwnProperty(r)){let o=n[r],i=o;Array.isArray(o)&&(i=o[1],o=o[0]),e[o]=r,t&&(t[o]=i)}return e}function Xe(n){return n[gu]||null}function Yt(n){return n[ud]||null}function Qt(n){return n[cd]||null}function sn(n){return Array.isArray(n)&&"object"==typeof n[1]}function Wn(n){return Array.isArray(n)&&!0===n[1]}function hd(n){return 0!=(8&n.flags)}function wu(n){return 2==(2&n.flags)}function Un(n){return null!==n.template}function m2(n){return 0!=(256&n[2])}function $o(n,t){return n.hasOwnProperty(Or)?n[Or]:null}class w2{constructor(t,e,r){this.previousValue=t,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}}function Dm(n){return n.type.prototype.ngOnChanges&&(n.setInput=_2),x2}function x2(){const n=Em(this),t=n?.current;if(t){const e=n.previous;if(e===bi)n.previous=t;else for(let r in t)e[r]=t[r];n.current=null,this.ngOnChanges(t)}}function _2(n,t,e,r){const o=Em(n)||function D2(n,t){return n[Cm]=t}(n,{previous:bi,current:null}),i=o.current||(o.current={}),a=o.previous,s=this.declaredInputs[e],u=a[s];i[s]=new w2(u&&u.currentValue,t,a===bi),n[r]=t}const Cm="__ngSimpleChanges__";function Em(n){return n[Cm]||null}function pt(n){for(;Array.isArray(n);)n=n[0];return n}function Fn(n,t){return pt(t[n.index])}function yd(n,t){return n.data[t]}function yn(n,t){const e=t[n];return sn(e)?e:e[0]}function Im(n){return 4==(4&n[2])}function bd(n){return 64==(64&n[2])}function vo(n,t){return null==t?null:n[t]}function Sm(n){n[18]=0}function wd(n,t){n[5]+=t;let e=n,r=n[3];for(;null!==r&&(1===t&&1===e[5]||-1===t&&0===e[5]);)r[5]+=t,e=r,r=r[3]}const de={lFrame:Om(null),bindingsEnabled:!0};function Mm(){return de.bindingsEnabled}function U(){return de.lFrame.lView}function Ne(){return de.lFrame.tView}function Dt(){let n=Am();for(;null!==n&&64===n.type;)n=n.parent;return n}function Am(){return de.lFrame.currentTNode}function fr(n,t){const e=de.lFrame;e.currentTNode=n,e.isParent=t}function xd(){return de.lFrame.isParent}function V2(n,t){const e=de.lFrame;e.bindingIndex=e.bindingRootIndex=n,Dd(t)}function Dd(n){de.lFrame.currentDirectiveIndex=n}function Fm(){return de.lFrame.currentQueryIndex}function Ed(n){de.lFrame.currentQueryIndex=n}function j2(n){const t=n[1];return 2===t.type?t.declTNode:1===t.type?n[6]:null}function km(n,t,e){if(e&ce.SkipSelf){let o=t,i=n;for(;!(o=o.parent,null!==o||e&ce.Host||(o=j2(i),null===o||(i=i[15],10&o.type))););if(null===o)return!1;t=o,n=i}const r=de.lFrame=Pm();return r.currentTNode=t,r.lView=n,!0}function Id(n){const t=Pm(),e=n[1];de.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function Pm(){const n=de.lFrame,t=null===n?null:n.child;return null===t?Om(n):t}function Om(n){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=t),t}function Lm(){const n=de.lFrame;return de.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const Bm=Lm;function Sd(){const n=Lm();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Zt(){return de.lFrame.selectedIndex}function go(n){de.lFrame.selectedIndex=n}function Eu(n,t){for(let e=t.directiveStart,r=t.directiveEnd;e<r;e++){const i=n.data[e].type.prototype,{ngAfterContentInit:a,ngAfterContentChecked:s,ngAfterViewInit:u,ngAfterViewChecked:c,ngOnDestroy:l}=i;a&&(n.contentHooks||(n.contentHooks=[])).push(-e,a),s&&((n.contentHooks||(n.contentHooks=[])).push(e,s),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(e,s)),u&&(n.viewHooks||(n.viewHooks=[])).push(-e,u),c&&((n.viewHooks||(n.viewHooks=[])).push(e,c),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(e,c)),null!=l&&(n.destroyHooks||(n.destroyHooks=[])).push(e,l)}}function Iu(n,t,e){Vm(n,t,3,e)}function Su(n,t,e,r){(3&n[2])===e&&Vm(n,t,e,r)}function Td(n,t){let e=n[2];(3&e)===t&&(e&=2047,e+=1,n[2]=e)}function Vm(n,t,e,r){const i=r??-1,a=t.length-1;let s=0;for(let u=void 0!==r?65535&n[18]:0;u<a;u++)if("number"==typeof t[u+1]){if(s=t[u],null!=r&&s>=r)break}else t[u]<0&&(n[18]+=65536),(s<i||-1==i)&&(Y2(n,e,t,u),n[18]=(4294901760&n[18])+u+2),u++}function Y2(n,t,e,r){const o=e[r]<0,i=e[r+1],s=n[o?-e[r]:e[r]];if(o){if(n[2]>>11<n[18]>>16&&(3&n[2])===t){n[2]+=2048;try{i.call(s)}finally{}}}else try{i.call(s)}finally{}}class Va{constructor(t,e,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=r}}function Tu(n,t,e){let r=0;for(;r<e.length;){const o=e[r];if("number"==typeof o){if(0!==o)break;r++;const i=e[r++],a=e[r++],s=e[r++];n.setAttribute(t,a,s,i)}else{const i=o,a=e[++r];jm(i)?n.setProperty(t,i,a):n.setAttribute(t,i,a),r++}}return r}function Hm(n){return 3===n||4===n||6===n}function jm(n){return 64===n.charCodeAt(0)}function Mu(n,t){if(null!==t&&0!==t.length)if(null===n||0===n.length)n=t.slice();else{let e=-1;for(let r=0;r<t.length;r++){const o=t[r];"number"==typeof o?e=o:0===e||Wm(n,e,o,null,-1===e||2===e?t[++r]:null)}}return n}function Wm(n,t,e,r,o){let i=0,a=n.length;if(-1===t)a=-1;else for(;i<n.length;){const s=n[i++];if("number"==typeof s){if(s===t){a=-1;break}if(s>t){a=i-1;break}}}for(;i<n.length;){const s=n[i];if("number"==typeof s)break;if(s===e){if(null===r)return void(null!==o&&(n[i+1]=o));if(r===n[i+1])return void(n[i+2]=o)}i++,null!==r&&i++,null!==o&&i++}-1!==a&&(n.splice(a,0,t),i=a+1),n.splice(i++,0,e),null!==r&&n.splice(i++,0,r),null!==o&&n.splice(i++,0,o)}function Um(n){return-1!==n}function Ii(n){return 32767&n}function Si(n,t){let e=function tS(n){return n>>16}(n),r=t;for(;e>0;)r=r[15],e--;return r}let Ad=!0;function Au(n){const t=Ad;return Ad=n,t}let nS=0;const hr={};function ja(n,t){const e=Nd(n,t);if(-1!==e)return e;const r=t[1];r.firstCreatePass&&(n.injectorIndex=t.length,Rd(r.data,n),Rd(t,null),Rd(r.blueprint,null));const o=Ru(n,t),i=n.injectorIndex;if(Um(o)){const a=Ii(o),s=Si(o,t),u=s[1].data;for(let c=0;c<8;c++)t[i+c]=s[a+c]|u[a+c]}return t[i+8]=o,i}function Rd(n,t){n.push(0,0,0,0,0,0,0,0,t)}function Nd(n,t){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===t[n.injectorIndex+8]?-1:n.injectorIndex}function Ru(n,t){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let e=0,r=null,o=t;for(;null!==o;){if(r=Jm(o),null===r)return-1;if(e++,o=o[15],-1!==r.injectorIndex)return r.injectorIndex|e<<16}return-1}function Nu(n,t,e){!function rS(n,t,e){let r;"string"==typeof e?r=e.charCodeAt(0)||0:e.hasOwnProperty(ka)&&(r=e[ka]),null==r&&(r=e[ka]=nS++);const o=255&r;t.data[n+(o>>5)]|=1<<o}(n,t,e)}function qm(n,t,e){if(e&ce.Optional)return n;pu()}function $m(n,t,e,r){if(e&ce.Optional&&void 0===r&&(r=null),0==(e&(ce.Self|ce.Host))){const o=n[9],i=lr(void 0);try{return o?o.get(t,r,e&ce.Optional):gm(t,r,e&ce.Optional)}finally{lr(i)}}return qm(r,0,e)}function Km(n,t,e,r=ce.Default,o){if(null!==n){if(1024&t[2]){const a=function cS(n,t,e,r,o){let i=n,a=t;for(;null!==i&&null!==a&&1024&a[2]&&!(256&a[2]);){const s=Xm(i,a,e,r|ce.Self,hr);if(s!==hr)return s;let u=i.parent;if(!u){const c=a[21];if(c){const l=c.get(e,hr,r);if(l!==hr)return l}u=Jm(a),a=a[15]}i=u}return o}(n,t,e,r,hr);if(a!==hr)return a}const i=Xm(n,t,e,r,hr);if(i!==hr)return i}return $m(t,e,r,o)}function Xm(n,t,e,r,o){const i=function aS(n){if("string"==typeof n)return n.charCodeAt(0)||0;const t=n.hasOwnProperty(ka)?n[ka]:void 0;return"number"==typeof t?t>=0?255&t:sS:t}(e);if("function"==typeof i){if(!km(t,n,r))return r&ce.Host?qm(o,0,r):$m(t,e,r,o);try{const a=i(r);if(null!=a||r&ce.Optional)return a;pu()}finally{Bm()}}else if("number"==typeof i){let a=null,s=Nd(n,t),u=-1,c=r&ce.Host?t[16][6]:null;for((-1===s||r&ce.SkipSelf)&&(u=-1===s?Ru(n,t):t[s+8],-1!==u&&Qm(r,!1)?(a=t[1],s=Ii(u),t=Si(u,t)):s=-1);-1!==s;){const l=t[1];if(Ym(i,s,l.data)){const d=iS(s,t,e,a,r,c);if(d!==hr)return d}u=t[s+8],-1!==u&&Qm(r,t[1].data[s+8]===c)&&Ym(i,s,t)?(a=l,s=Ii(u),t=Si(u,t)):s=-1}}return o}function iS(n,t,e,r,o,i){const a=t[1],s=a.data[n+8],l=Fu(s,a,e,null==r?wu(s)&&Ad:r!=a&&0!=(3&s.type),o&ce.Host&&i===s);return null!==l?Wa(t,a,l,s):hr}function Fu(n,t,e,r,o){const i=n.providerIndexes,a=t.data,s=1048575&i,u=n.directiveStart,l=i>>20,f=o?s+l:n.directiveEnd;for(let h=r?s:s+l;h<f;h++){const p=a[h];if(h<u&&e===p||h>=u&&p.type===e)return h}if(o){const h=a[u];if(h&&Un(h)&&h.type===e)return u}return null}function Wa(n,t,e,r){let o=n[e];const i=t.data;if(function Q2(n){return n instanceof Va}(o)){const a=o;a.resolving&&function t2(n,t){const e=t?`. Dependency path: ${t.join(" > ")} > ${n}`:"";throw new ue(-200,`Circular dependency in DI detected for ${n}${e}`)}(Le(i[e]));const s=Au(a.canSeeViewProviders);a.resolving=!0;const u=a.injectImpl?lr(a.injectImpl):null;km(n,r,ce.Default);try{o=n[e]=a.factory(void 0,i,n,r),t.firstCreatePass&&e>=r.directiveStart&&function X2(n,t,e){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=t.type.prototype;if(r){const a=Dm(t);(e.preOrderHooks||(e.preOrderHooks=[])).push(n,a),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,a)}o&&(e.preOrderHooks||(e.preOrderHooks=[])).push(0-n,o),i&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n,i),(e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n,i))}(e,i[e],t)}finally{null!==u&&lr(u),Au(s),a.resolving=!1,Bm()}}return o}function Ym(n,t,e){return!!(e[t+(n>>5)]&1<<n)}function Qm(n,t){return!(n&ce.Self||n&ce.Host&&t)}class Ti{constructor(t,e){this._tNode=t,this._lView=e}get(t,e,r){return Km(this._tNode,this._lView,t,r,e)}}function sS(){return new Ti(Dt(),U())}function Jm(n){const t=n[1],e=t.type;return 2===e?t.declTNode:1===e?n[6]:null}class Ce{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=We({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function bn(n,t){void 0===t&&(t=n);for(let e=0;e<n.length;e++){let r=n[e];Array.isArray(r)?(t===n&&(t=n.slice(0,e)),bn(r,t)):t!==n&&t.push(r)}return t}function Vr(n,t){n.forEach(e=>Array.isArray(e)?Vr(e,t):t(e))}function ey(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function ku(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}const qa={},Ou="ngTempTokenPath",xS=/\n/gm,oy="__source";let $a,Wd;function Lu(n){const t=$a;return $a=n,t}function DS(n,t=ce.Default){if(void 0===$a)throw new ue(-203,!1);return null===$a?gm(n,void 0,t):$a.get(n,t&ce.Optional?null:void 0,t)}function we(n,t=ce.Default){return(function c2(){return sd}()||DS)(se(n),t)}function Hd(n){const t=[];for(let e=0;e<n.length;e++){const r=se(n[e]);if(Array.isArray(r)){if(0===r.length)throw new ue(900,!1);let o,i=ce.Default;for(let a=0;a<r.length;a++){const s=r[a],u=ES(s);"number"==typeof u?-1===u?o=s.token:i|=u:o=s}t.push(we(o,i))}else t.push(we(r))}return t}function ES(n){return n.__NG_DI_FLAG__}function Yd(n){return n.ngOriginalError}class Oi{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t);this._console.error("ERROR",t),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(t){let e=t&&Yd(t);for(;e&&Yd(e);)e=Yd(e);return e||null}}const Qd=new Map;let yT=0;const Zd="__ngContext__";function Ut(n,t){sn(t)?(n[Zd]=t[20],function wT(n){Qd.set(n[20],n)}(t)):n[Zd]=t}function es(n){const t=n[Zd];return"number"==typeof t?function Ty(n){return Qd.get(n)||null}(t):t||null}function ef(n){const t=es(n);return t?sn(t)?t:t.lView:null}const MT=(()=>(typeof requestAnimationFrame<"u"&&requestAnimationFrame||setTimeout).bind(ze))();var un=(()=>((un=un||{})[un.Important=1]="Important",un[un.DashCase=2]="DashCase",un))();function nf(n,t){return undefined(n,t)}function ts(n){const t=n[3];return Wn(t)?t[3]:t}function rf(n){return Oy(n[13])}function of(n){return Oy(n[4])}function Oy(n){for(;null!==n&&!Wn(n);)n=n[4];return n}function Bi(n,t,e,r,o){if(null!=r){let i,a=!1;Wn(r)?i=r:sn(r)&&(a=!0,r=r[0]);const s=pt(r);0===n&&null!==e?null==o?Wy(t,e,s):Ko(t,e,s,o||null,!0):1===n&&null!==e?Ko(t,e,s,o||null,!0):2===n?function Xy(n,t,e){const r=qu(n,t);r&&function qT(n,t,e,r){n.removeChild(t,e,r)}(n,r,t,e)}(t,s,a):3===n&&t.destroyNode(s),null!=i&&function XT(n,t,e,r,o){const i=e[7];i!==pt(e)&&Bi(t,n,r,i,o);for(let s=10;s<e.length;s++){const u=e[s];ns(u[1],u,n,t,r,i)}}(t,n,i,e,o)}}function sf(n,t,e){return n.createElement(t,e)}function By(n,t){const e=n[9],r=e.indexOf(t),o=t[3];512&t[2]&&(t[2]&=-513,wd(o,-1)),e.splice(r,1)}function uf(n,t){if(n.length<=10)return;const e=10+t,r=n[e];if(r){const o=r[17];null!==o&&o!==n&&By(o,r),t>0&&(n[e-1][4]=r[4]);const i=ku(n,10+t);!function BT(n,t){ns(n,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const a=i[19];null!==a&&a.detachView(i[1]),r[3]=null,r[4]=null,r[2]&=-65}return r}function Vy(n,t){if(!(128&t[2])){const e=t[11];e.destroyNode&&ns(n,t,e,3,null,null),function jT(n){let t=n[13];if(!t)return cf(n[1],n);for(;t;){let e=null;if(sn(t))e=t[13];else{const r=t[10];r&&(e=r)}if(!e){for(;t&&!t[4]&&t!==n;)sn(t)&&cf(t[1],t),t=t[3];null===t&&(t=n),sn(t)&&cf(t[1],t),e=t&&t[4]}t=e}}(t)}}function cf(n,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function GT(n,t){let e;if(null!=n&&null!=(e=n.destroyHooks))for(let r=0;r<e.length;r+=2){const o=t[e[r]];if(!(o instanceof Va)){const i=e[r+1];if(Array.isArray(i))for(let a=0;a<i.length;a+=2){const s=o[i[a]],u=i[a+1];try{u.call(s)}finally{}}else try{i.call(o)}finally{}}}}(n,t),function zT(n,t){const e=n.cleanup,r=t[7];let o=-1;if(null!==e)for(let i=0;i<e.length-1;i+=2)if("string"==typeof e[i]){const a=e[i+1],s="function"==typeof a?a(t):pt(t[a]),u=r[o=e[i+2]],c=e[i+3];"boolean"==typeof c?s.removeEventListener(e[i],u,c):c>=0?r[o=c]():r[o=-c].unsubscribe(),i+=2}else{const a=r[o=e[i+1]];e[i].call(a)}if(null!==r){for(let i=o+1;i<r.length;i++)r[i]();t[7]=null}}(n,t),1===t[1].type&&t[11].destroy();const e=t[17];if(null!==e&&Wn(t[3])){e!==t[3]&&By(e,t);const r=t[19];null!==r&&r.detachView(n)}!function xT(n){Qd.delete(n[20])}(t)}}function Hy(n,t,e){return function jy(n,t,e){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return e[0];if(2&r.flags){const o=n.data[r.directiveStart].encapsulation;if(o===dr.None||o===dr.Emulated)return null}return Fn(r,e)}(n,t.parent,e)}function Ko(n,t,e,r,o){n.insertBefore(t,e,r,o)}function Wy(n,t,e){n.appendChild(t,e)}function Uy(n,t,e,r,o){null!==r?Ko(n,t,e,r,o):Wy(n,t,e)}function qu(n,t){return n.parentNode(t)}let qy=function Gy(n,t,e){return 40&n.type?Fn(n,e):null};function $u(n,t,e,r){const o=Hy(n,r,t),i=t[11],s=function zy(n,t,e){return qy(n,t,e)}(r.parent||t[6],r,t);if(null!=o)if(Array.isArray(e))for(let u=0;u<e.length;u++)Uy(i,o,e[u],s,!1);else Uy(i,o,e,s,!1)}function Ku(n,t){if(null!==t){const e=t.type;if(3&e)return Fn(t,n);if(4&e)return df(-1,n[t.index]);if(8&e){const r=t.child;if(null!==r)return Ku(n,r);{const o=n[t.index];return Wn(o)?df(-1,o):pt(o)}}if(32&e)return nf(t,n)()||pt(n[t.index]);{const r=Ky(n,t);return null!==r?Array.isArray(r)?r[0]:Ku(ts(n[16]),r):Ku(n,t.next)}}return null}function Ky(n,t){return null!==t?n[16][6].projection[t.projection]:null}function df(n,t){const e=10+n+1;if(e<t.length){const r=t[e],o=r[1].firstChild;if(null!==o)return Ku(r,o)}return t[7]}function ff(n,t,e,r,o,i,a){for(;null!=e;){const s=r[e.index],u=e.type;if(a&&0===t&&(s&&Ut(pt(s),r),e.flags|=4),64!=(64&e.flags))if(8&u)ff(n,t,e.child,r,o,i,!1),Bi(t,n,o,s,i);else if(32&u){const c=nf(e,r);let l;for(;l=c();)Bi(t,n,o,l,i);Bi(t,n,o,s,i)}else 16&u?Yy(n,t,r,e,o,i):Bi(t,n,o,s,i);e=a?e.projectionNext:e.next}}function ns(n,t,e,r,o,i){ff(e,r,n.firstChild,t,o,i,!1)}function Yy(n,t,e,r,o,i){const a=e[16],u=a[6].projection[r.projection];if(Array.isArray(u))for(let c=0;c<u.length;c++)Bi(t,n,o,u[c],i);else ff(n,t,u,a[3],o,i,!0)}function Qy(n,t,e){n.setAttribute(t,"style",e)}function hf(n,t,e){""===e?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function Jy(n,t,e){let r=n.length;for(;;){const o=n.indexOf(t,e);if(-1===o)return o;if(0===o||n.charCodeAt(o-1)<=32){const i=t.length;if(o+i===r||n.charCodeAt(o+i)<=32)return o}e=o+1}}const Zy="ng-template";function QT(n,t,e){let r=0;for(;r<n.length;){let o=n[r++];if(e&&"class"===o){if(o=n[r],-1!==Jy(o.toLowerCase(),t,0))return!0}else if(1===o){for(;r<n.length&&"string"==typeof(o=n[r++]);)if(o.toLowerCase()===t)return!0;return!1}}return!1}function e0(n){return 4===n.type&&n.value!==Zy}function JT(n,t,e){return t===(4!==n.type||e?n.value:Zy)}function ZT(n,t,e){let r=4;const o=n.attrs||[],i=function nM(n){for(let t=0;t<n.length;t++)if(Hm(n[t]))return t;return n.length}(o);let a=!1;for(let s=0;s<t.length;s++){const u=t[s];if("number"!=typeof u){if(!a)if(4&r){if(r=2|1&r,""!==u&&!JT(n,u,e)||""===u&&1===t.length){if(zn(r))return!1;a=!0}}else{const c=8&r?u:t[++s];if(8&r&&null!==n.attrs){if(!QT(n.attrs,c,e)){if(zn(r))return!1;a=!0}continue}const d=eM(8&r?"class":u,o,e0(n),e);if(-1===d){if(zn(r))return!1;a=!0;continue}if(""!==c){let f;f=d>i?"":o[d+1].toLowerCase();const h=8&r?f:null;if(h&&-1!==Jy(h,c,0)||2&r&&c!==f){if(zn(r))return!1;a=!0}}}}else{if(!a&&!zn(r)&&!zn(u))return!1;if(a&&zn(u))continue;a=!1,r=u|1&r}}return zn(r)||a}function zn(n){return 0==(1&n)}function eM(n,t,e,r){if(null===t)return-1;let o=0;if(r||!e){let i=!1;for(;o<t.length;){const a=t[o];if(a===n)return o;if(3===a||6===a)i=!0;else{if(1===a||2===a){let s=t[++o];for(;"string"==typeof s;)s=t[++o];continue}if(4===a)break;if(0===a){o+=4;continue}}o+=i?1:2}return-1}return function rM(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){const r=n[e];if("number"==typeof r)return-1;if(r===t)return e;e++}return-1}(t,n)}function t0(n,t,e=!1){for(let r=0;r<t.length;r++)if(ZT(n,t[r],e))return!0;return!1}function n0(n,t){return n?":not("+t.trim()+")":t}function iM(n){let t=n[0],e=1,r=2,o="",i=!1;for(;e<n.length;){let a=n[e];if("string"==typeof a)if(2&r){const s=n[++e];o+="["+a+(s.length>0?'="'+s+'"':"")+"]"}else 8&r?o+="."+a:4&r&&(o+=" "+a);else""!==o&&!zn(a)&&(t+=n0(i,o),o=""),r=a,i=i||!zn(r);e++}return""!==o&&(t+=n0(i,o)),t}const pe={};function o0(n,t,e,r){if(!r)if(3==(3&t[2])){const i=n.preOrderCheckHooks;null!==i&&Iu(t,i,e)}else{const i=n.preOrderHooks;null!==i&&Su(t,i,0,e)}go(e)}const c0=new Ce("ENVIRONMENT_INITIALIZER"),l0=new Ce("INJECTOR_DEF_TYPES");function hM(...n){return{\u0275providers:d0(0,n)}}function d0(n,...t){const e=[],r=new Set;let o;return Vr(t,i=>{const a=i;pf(a,e,[],r)&&(o||(o=[]),o.push(a))}),void 0!==o&&f0(o,e),e}function f0(n,t){for(let e=0;e<n.length;e++){const{providers:o}=n[e];Vr(o,i=>{t.push(i)})}}function pf(n,t,e,r){if(!(n=se(n)))return!1;let o=null,i=pm(n);const a=!i&&Xe(n);if(i||a){if(a&&!a.standalone)return!1;o=n}else{const u=n.ngModule;if(i=pm(u),!i)return!1;o=u}const s=r.has(o);if(a){if(s)return!1;if(r.add(o),a.dependencies){const u="function"==typeof a.dependencies?a.dependencies():a.dependencies;for(const c of u)pf(c,t,e,r)}}else{if(!i)return!1;{if(null!=i.imports&&!s){let c;r.add(o);try{Vr(i.imports,l=>{pf(l,t,e,r)&&(c||(c=[]),c.push(l))})}finally{}void 0!==c&&f0(c,t)}if(!s){const c=$o(o)||(()=>new o);t.push({provide:o,useFactory:c,deps:Be},{provide:l0,useValue:o,multi:!0},{provide:c0,useValue:()=>we(o),multi:!0})}const u=i.providers;null==u||s||Vr(u,l=>{t.push(l)})}}return o!==n&&void 0!==n.providers}const pM=qe({provide:String,useValue:qe});function vf(n){return null!==n&&"object"==typeof n&&pM in n}function Xo(n){return"function"==typeof n}const gf=new Ce("INJECTOR",-1);class v0{get(t,e=qa){if(e===qa){const r=new Error(`NullInjectorError: No provider for ${$e(t)}!`);throw r.name="NullInjectorError",r}return e}}const mf=new Ce("Set Injector scope."),Xu={},gM={};let yf;function bf(){return void 0===yf&&(yf=new v0),yf}class rs{}class g0 extends rs{constructor(t,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,xf(t,a=>this.processProvider(a)),this.records.set(gf,Vi(void 0,this)),o.has("environment")&&this.records.set(rs,Vi(void 0,this));const i=this.records.get(mf);null!=i&&"string"==typeof i.value&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(l0.multi,Be,ce.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}get(t,e=qa,r=ce.Default){this.assertNotDestroyed();const o=Lu(this),i=lr(void 0);try{if(!(r&ce.SkipSelf)){let s=this.records.get(t);if(void 0===s){const u=function xM(n){return"function"==typeof n||"object"==typeof n&&n instanceof Ce}(t)&&id(t);s=u&&this.injectableDefInScope(u)?Vi(wf(t),Xu):null,this.records.set(t,s)}if(null!=s)return this.hydrate(t,s)}return(r&ce.Self?bf():this.parent).get(t,e=r&ce.Optional&&e===qa?null:e)}catch(a){if("NullInjectorError"===a.name){if((a[Ou]=a[Ou]||[]).unshift($e(t)),o)throw a;return function IS(n,t,e,r){const o=n[Ou];throw t[oy]&&o.unshift(t[oy]),n.message=function SS(n,t,e,r=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let o=$e(t);if(Array.isArray(t))o=t.map($e).join(" -> ");else if("object"==typeof t){let i=[];for(let a in t)if(t.hasOwnProperty(a)){let s=t[a];i.push(a+":"+("string"==typeof s?JSON.stringify(s):$e(s)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${n.replace(xS,"\n  ")}`}("\n"+n.message,o,e,r),n.ngTokenPath=o,n[Ou]=null,n}(a,t,"R3InjectorError",this.source)}throw a}finally{lr(i),Lu(o)}}resolveInjectorInitializers(){const t=Lu(this),e=lr(void 0);try{const r=this.get(c0.multi,Be,ce.Self);for(const o of r)o()}finally{Lu(t),lr(e)}}toString(){const t=[],e=this.records;for(const r of e.keys())t.push($e(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ue(205,!1)}processProvider(t){let e=Xo(t=se(t))?t:se(t&&t.provide);const r=function yM(n){return vf(n)?Vi(void 0,n.useValue):Vi(function m0(n,t,e){let r;if(Xo(n)){const o=se(n);return $o(o)||wf(o)}if(vf(n))r=()=>se(n.useValue);else if(function p0(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...Hd(n.deps||[]));else if(function h0(n){return!(!n||!n.useExisting)}(n))r=()=>we(se(n.useExisting));else{const o=se(n&&(n.useClass||n.provide));if(!function bM(n){return!!n.deps}(n))return $o(o)||wf(o);r=()=>new o(...Hd(n.deps))}return r}(n),Xu)}(t);if(Xo(t)||!0!==t.multi)this.records.get(e);else{let o=this.records.get(e);o||(o=Vi(void 0,Xu,!0),o.factory=()=>Hd(o.multi),this.records.set(e,o)),e=t,o.multi.push(t)}this.records.set(e,r)}hydrate(t,e){return e.value===Xu&&(e.value=gM,e.value=e.factory()),"object"==typeof e.value&&e.value&&function wM(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(t){if(!t.providedIn)return!1;const e=se(t.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function wf(n){const t=id(n),e=null!==t?t.factory:$o(n);if(null!==e)return e;if(n instanceof Ce)throw new ue(204,!1);if(n instanceof Function)return function mM(n){const t=n.length;if(t>0)throw function Ga(n,t){const e=[];for(let r=0;r<n;r++)e.push(t);return e}(t,"?"),new ue(204,!1);const e=function a2(n){const t=n&&(n[vu]||n[vm]);if(t){const e=function s2(n){if(n.hasOwnProperty("name"))return n.name;const t=(""+n).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${e}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${e}" class.`),t}return null}(n);return null!==e?()=>e.factory(n):()=>new n}(n);throw new ue(204,!1)}function Vi(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function _M(n){return!!n.\u0275providers}function xf(n,t){for(const e of n)Array.isArray(e)?xf(e,t):_M(e)?xf(e.\u0275providers,t):t(e)}function y0(n,t=null,e=null,r){const o=b0(n,t,e,r);return o.resolveInjectorInitializers(),o}function b0(n,t=null,e=null,r,o=new Set){const i=[e||Be,hM(n)];return r=r||("object"==typeof n?void 0:$e(n)),new g0(i,t||bf(),r||null,o)}let Gn=(()=>{class n{static create(e,r){if(Array.isArray(e))return y0({name:""},r,e,"");{const o=e.name??"";return y0({name:o},e.parent,e.providers,o)}}}return n.THROW_IF_NOT_FOUND=qa,n.NULL=new v0,n.\u0275prov=We({token:n,providedIn:"any",factory:()=>we(gf)}),n.__NG_ELEMENT_ID__=-1,n})();function xe(n,t=ce.Default){const e=U();return null===e?we(n,t):Km(Dt(),e,se(n),t)}function V0(n,t){const e=n.contentQueries;if(null!==e)for(let r=0;r<e.length;r+=2){const o=e[r],i=e[r+1];if(-1!==i){const a=n.data[i];Ed(o),a.contentQueries(2,t[i],i)}}}function ec(n,t,e,r,o,i,a,s,u,c,l){const d=t.blueprint.slice();return d[0]=o,d[2]=76|r,(null!==l||n&&1024&n[2])&&(d[2]|=1024),Sm(d),d[3]=d[15]=n,d[8]=e,d[10]=a||n&&n[10],d[11]=s||n&&n[11],d[12]=u||n&&n[12]||null,d[9]=c||n&&n[9]||null,d[6]=i,d[20]=function bT(){return yT++}(),d[21]=l,d[16]=2==t.type?n[16]:d,d}function ji(n,t,e,r,o){let i=n.data[t];if(null===i)i=function Hf(n,t,e,r,o){const i=Am(),a=xd(),u=n.data[t]=function nA(n,t,e,r,o,i){return{type:e,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,a?i:i&&i.parent,e,t,r,o);return null===n.firstChild&&(n.firstChild=u),null!==i&&(a?null==i.child&&null!==u.parent&&(i.child=u):null===i.next&&(i.next=u)),u}(n,t,e,r,o),function B2(){return de.lFrame.inI18n}()&&(i.flags|=64);else if(64&i.type){i.type=e,i.value=r,i.attrs=o;const a=function Ba(){const n=de.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}();i.injectorIndex=null===a?-1:a.injectorIndex}return fr(i,!0),i}function Wi(n,t,e,r){if(0===e)return-1;const o=t.length;for(let i=0;i<e;i++)t.push(r),n.blueprint.push(r),n.data.push(null);return o}function tc(n,t,e){Id(t);try{const r=n.viewQuery;null!==r&&Xf(1,r,e);const o=n.template;null!==o&&H0(n,t,o,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&V0(n,t),n.staticViewQueries&&Xf(2,n.viewQuery,e);const i=n.components;null!==i&&function JM(n,t){for(let e=0;e<t.length;e++)wA(n,t[e])}(t,i)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{t[2]&=-5,Sd()}}function os(n,t,e,r){const o=t[2];if(128!=(128&o)){Id(t);try{Sm(t),function Rm(n){return de.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==e&&H0(n,t,e,2,r);const a=3==(3&o);if(a){const c=n.preOrderCheckHooks;null!==c&&Iu(t,c,null)}else{const c=n.preOrderHooks;null!==c&&Su(t,c,0,null),Td(t,0)}if(function yA(n){for(let t=rf(n);null!==t;t=of(t)){if(!t[2])continue;const e=t[9];for(let r=0;r<e.length;r++){const o=e[r],i=o[3];0==(512&o[2])&&wd(i,1),o[2]|=512}}}(t),function mA(n){for(let t=rf(n);null!==t;t=of(t))for(let e=10;e<t.length;e++){const r=t[e],o=r[1];bd(r)&&os(o,r,o.template,r[8])}}(t),null!==n.contentQueries&&V0(n,t),a){const c=n.contentCheckHooks;null!==c&&Iu(t,c)}else{const c=n.contentHooks;null!==c&&Su(t,c,1),Td(t,1)}!function YM(n,t){const e=n.hostBindingOpCodes;if(null!==e)try{for(let r=0;r<e.length;r++){const o=e[r];if(o<0)go(~o);else{const i=o,a=e[++r],s=e[++r];V2(a,i),s(2,t[i])}}}finally{go(-1)}}(n,t);const s=n.components;null!==s&&function QM(n,t){for(let e=0;e<t.length;e++)bA(n,t[e])}(t,s);const u=n.viewQuery;if(null!==u&&Xf(2,u,r),a){const c=n.viewCheckHooks;null!==c&&Iu(t,c)}else{const c=n.viewHooks;null!==c&&Su(t,c,2),Td(t,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,wd(t[3],-1))}finally{Sd()}}}function ZM(n,t,e,r){const o=t[10],a=Im(t);try{!a&&o.begin&&o.begin(),a&&tc(n,t,r),os(n,t,e,r)}finally{!a&&o.end&&o.end()}}function H0(n,t,e,r,o){const i=Zt(),a=2&r;try{go(-1),a&&t.length>22&&o0(n,t,22,!1),e(r,o)}finally{go(i)}}function W0(n){const t=n.tView;return null===t||t.incompleteFirstPass?n.tView=Uf(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):t}function Uf(n,t,e,r,o,i,a,s,u,c){const l=22+r,d=l+o,f=function eA(n,t){const e=[];for(let r=0;r<t;r++)e.push(r<n?null:pe);return e}(l,d),h="function"==typeof c?c():c;return f[1]={type:n,blueprint:f,template:e,queries:null,viewQuery:s,declTNode:t,data:f.slice().fill(null,l),bindingStartIndex:l,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:u,consts:h,incompleteFirstPass:!1}}function U0(n,t,e,r){const o=function Z0(n){return n[7]||(n[7]=[])}(t);null===e?o.push(r):(o.push(e),n.firstCreatePass&&function eb(n){return n.cleanup||(n.cleanup=[])}(n).push(r,o.length-1))}function z0(n,t,e){for(let r in n)if(n.hasOwnProperty(r)){const o=n[r];(e=null===e?{}:e).hasOwnProperty(r)?e[r].push(t,o):e[r]=[t,o]}return e}function G0(n,t,e,r,o,i){const a=i.hostBindings;if(a){let s=n.hostBindingOpCodes;null===s&&(s=n.hostBindingOpCodes=[]);const u=~t.index;(function uA(n){let t=n.length;for(;t>0;){const e=n[--t];if("number"==typeof e&&e<0)return e}return 0})(s)!=u&&s.push(u),s.push(r,o,a)}}function q0(n,t){null!==n.hostBindings&&n.hostBindings(1,t)}function $0(n,t){t.flags|=2,(n.components||(n.components=[])).push(t.index)}function hA(n,t,e){if(e){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)e[t.exportAs[r]]=n;Un(t)&&(e[""]=n)}}function K0(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function X0(n,t,e,r,o){n.data[r]=o;const i=o.factory||(o.factory=$o(o.type)),a=new Va(i,Un(o),xe);n.blueprint[r]=a,e[r]=a,G0(n,t,0,r,Wi(n,e,o.hostVars,pe),o)}function pA(n,t,e){const r=Fn(t,n),o=W0(e),i=n[10],a=nc(n,ec(n,o,null,e.onPush?32:16,r,t,i,i.createRenderer(r,e),null,null,null));n[t.index]=a}function vA(n,t,e,r,o,i){const a=i[t];if(null!==a){const s=r.setInput;for(let u=0;u<a.length;){const c=a[u++],l=a[u++],d=a[u++];null!==s?r.setInput(e,d,c,l):e[l]=d}}}function gA(n,t){let e=null,r=0;for(;r<t.length;){const o=t[r];if(0!==o)if(5!==o){if("number"==typeof o)break;n.hasOwnProperty(o)&&(null===e&&(e=[]),e.push(o,n[o],t[r+1])),r+=2}else r+=2;else r+=4}return e}function bA(n,t){const e=yn(t,n);if(bd(e)){const r=e[1];48&e[2]?os(r,e,r.template,e[8]):e[5]>0&&qf(e)}}function qf(n){for(let r=rf(n);null!==r;r=of(r))for(let o=10;o<r.length;o++){const i=r[o];if(512&i[2]){const a=i[1];os(a,i,a.template,i[8])}else i[5]>0&&qf(i)}const e=n[1].components;if(null!==e)for(let r=0;r<e.length;r++){const o=yn(e[r],n);bd(o)&&o[5]>0&&qf(o)}}function wA(n,t){const e=yn(t,n),r=e[1];(function xA(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])})(r,e),tc(r,e,e[8])}function nc(n,t){return n[13]?n[14][4]=t:n[13]=t,n[14]=t,t}function Kf(n,t,e){const r=t[10];r.begin&&r.begin();try{os(n,t,n.template,e)}catch(o){throw function nb(n,t){const e=n[9],r=e?e.get(Oi,null):null;r&&r.handleError(t)}(t,o),o}finally{r.end&&r.end()}}function J0(n){!function Q0(n){for(let t=0;t<n.components.length;t++){const e=n.components[t],r=ef(e);if(null!==r){const o=r[1];ZM(o,r,o.template,e)}}}(n[8])}function Xf(n,t,e){Ed(0),t(n,e)}const DA=(()=>Promise.resolve(null))();function rb(n,t,e,r,o){for(let i=0;i<e.length;){const a=e[i++],s=e[i++],u=t[a],c=n.data[a];null!==c.setInput?c.setInput(u,o,r,s):u[s]=o}}function rc(n,t,e){let r=e?n.styles:null,o=e?n.classes:null,i=0;if(null!==t)for(let a=0;a<t.length;a++){const s=t[a];"number"==typeof s?i=s:1==i?o=nd(o,s):2==i&&(r=nd(r,s+": "+t[++a]+";"))}e?n.styles=r:n.stylesWithoutHost=r,e?n.classes=o:n.classesWithoutHost=o}function SA(){const n=Dt();Eu(U()[1],n)}let oc=null;function Yo(){if(!oc){const n=ze.Symbol;if(n&&n.iterator)oc=n.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const r=t[e];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(oc=r)}}}return oc}function Jf(n,t,e){const r=U();return function zt(n,t,e){return!Object.is(n[t],e)&&(n[t]=e,!0)}(r,function Ei(){return de.lFrame.bindingIndex++}(),t)&&function xn(n,t,e,r,o,i,a,s){const u=Fn(t,e);let l,c=t.inputs;!s&&null!=c&&(l=c[r])?(rb(n,e,l,r,o),wu(t)&&function iA(n,t){const e=yn(t,n);16&e[2]||(e[2]|=32)}(e,t.index)):3&t.type&&(r=function oA(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),o=null!=a?a(o,t.value||"",r):o,i.setProperty(u,r,o))}(Ne(),function ut(){const n=de.lFrame;return yd(n.tView,n.selectedIndex)}(),r,n,t,r[11],e,!1),Jf}function Zf(n,t,e,r,o){const a=o?"class":"style";rb(n,e,t.inputs[a],a,r)}function ac(n,t,e,r){const o=U(),i=Ne(),a=22+n,s=o[11],u=o[a]=sf(s,t,function K2(){return de.lFrame.currentNamespace}()),c=i.firstCreatePass?function zA(n,t,e,r,o,i,a){const s=t.consts,c=ji(t,n,2,o,vo(s,i));return function zf(n,t,e,r){let o=!1;if(Mm()){const i=function dA(n,t,e){const r=n.directiveRegistry;let o=null;if(r)for(let i=0;i<r.length;i++){const a=r[i];t0(e,a.selectors,!1)&&(o||(o=[]),Nu(ja(e,t),n,a.type),Un(a)?($0(n,e),o.unshift(a)):o.push(a))}return o}(n,t,e),a=null===r?null:{"":-1};if(null!==i){o=!0,K0(e,n.data.length,i.length);for(let l=0;l<i.length;l++){const d=i[l];d.providersResolver&&d.providersResolver(d)}let s=!1,u=!1,c=Wi(n,t,i.length,null);for(let l=0;l<i.length;l++){const d=i[l];e.mergedAttrs=Mu(e.mergedAttrs,d.hostAttrs),X0(n,e,t,c,d),hA(c,d,a),null!==d.contentQueries&&(e.flags|=8),(null!==d.hostBindings||null!==d.hostAttrs||0!==d.hostVars)&&(e.flags|=128);const f=d.type.prototype;!s&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e.index),s=!0),!u&&(f.ngOnChanges||f.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e.index),u=!0),c++}!function rA(n,t){const r=t.directiveEnd,o=n.data,i=t.attrs,a=[];let s=null,u=null;for(let c=t.directiveStart;c<r;c++){const l=o[c],d=l.inputs,f=null===i||e0(t)?null:gA(d,i);a.push(f),s=z0(d,c,s),u=z0(l.outputs,c,u)}null!==s&&(s.hasOwnProperty("class")&&(t.flags|=16),s.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=a,t.inputs=s,t.outputs=u}(n,e)}a&&function fA(n,t,e){if(t){const r=n.localNames=[];for(let o=0;o<t.length;o+=2){const i=e[t[o+1]];if(null==i)throw new ue(-301,!1);r.push(t[o],i)}}}(e,r,a)}return e.mergedAttrs=Mu(e.mergedAttrs,e.attrs),o}(t,e,c,vo(s,a)),null!==c.attrs&&rc(c,c.attrs,!1),null!==c.mergedAttrs&&rc(c,c.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,c),c}(a,i,o,0,t,e,r):i.data[a];fr(c,!0);const l=c.mergedAttrs;null!==l&&Tu(s,u,l);const d=c.classes;null!==d&&hf(s,u,d);const f=c.styles;return null!==f&&Qy(s,u,f),64!=(64&c.flags)&&$u(i,o,u,c),0===function A2(){return de.lFrame.elementDepthCount}()&&Ut(u,o),function R2(){de.lFrame.elementDepthCount++}(),function xu(n){return 1==(1&n.flags)}(c)&&(function jf(n,t,e){!Mm()||(function cA(n,t,e,r){const o=e.directiveStart,i=e.directiveEnd;n.firstCreatePass||ja(e,t),Ut(r,t);const a=e.initialInputs;for(let s=o;s<i;s++){const u=n.data[s],c=Un(u);c&&pA(t,e,u);const l=Wa(t,n,s,e);Ut(l,t),null!==a&&vA(0,s-o,l,u,0,a),c&&(yn(e.index,t)[8]=l)}}(n,t,e,Fn(e,t)),128==(128&e.flags)&&function lA(n,t,e){const r=e.directiveStart,o=e.directiveEnd,i=e.index,a=function H2(){return de.lFrame.currentDirectiveIndex}();try{go(i);for(let s=r;s<o;s++){const u=n.data[s],c=t[s];Dd(s),(null!==u.hostBindings||0!==u.hostVars||null!==u.hostAttrs)&&q0(u,c)}}finally{go(-1),Dd(a)}}(n,t,e))}(i,o,c),function j0(n,t,e){if(hd(t)){const o=t.directiveEnd;for(let i=t.directiveStart;i<o;i++){const a=n.data[i];a.contentQueries&&a.contentQueries(1,e[i],i)}}}(i,c,o)),null!==r&&function Wf(n,t,e=Fn){const r=t.localNames;if(null!==r){let o=t.index+1;for(let i=0;i<r.length;i+=2){const a=r[i+1],s=-1===a?e(t,n):n[a];n[o++]=s}}}(o,c),ac}function sc(){let n=Dt();xd()?function _d(){de.lFrame.isParent=!1}():(n=n.parent,fr(n,!1));const t=n;!function N2(){de.lFrame.elementDepthCount--}();const e=Ne();return e.firstCreatePass&&(Eu(e,n),hd(n)&&e.queries.elementEnd(n)),null!=t.classesWithoutHost&&function Z2(n){return 0!=(16&n.flags)}(t)&&Zf(e,t,U(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function eS(n){return 0!=(32&n.flags)}(t)&&Zf(e,t,U(),t.stylesWithoutHost,!1),sc}function eh(n,t,e,r){return ac(n,t,e,r),sc(),eh}function rh(n){return!!n&&"function"==typeof n.then}const $A=function mb(n){return!!n&&"function"==typeof n.subscribe},ea="en-US";let vw=ea;class BN{resolveComponentFactory(t){throw function LN(n){const t=Error(`No component factory found for ${$e(n)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=n,t}(t)}}let hc=(()=>{class n{}return n.NULL=new BN,n})();class Zo{}class Ww{}function jN(){return na(Dt(),U())}function na(n,t){return new ra(Fn(n,t))}let ra=(()=>{class n{constructor(e){this.nativeElement=e}}return n.__NG_ELEMENT_ID__=jN,n})();function WN(n){return n instanceof ra?n.nativeElement:n}class Uw{}let zN=(()=>{class n{}return n.\u0275prov=We({token:n,providedIn:"root",factory:()=>null}),n})();class hh{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const GN=new hh("14.0.6"),ph={};function pc(n,t,e,r,o=!1){for(;null!==e;){const i=t[e.index];if(null!==i&&r.push(pt(i)),Wn(i))for(let s=10;s<i.length;s++){const u=i[s],c=u[1].firstChild;null!==c&&pc(u[1],u,c,r)}const a=e.type;if(8&a)pc(n,t,e.child,r);else if(32&a){const s=nf(e,t);let u;for(;u=s();)r.push(u)}else if(16&a){const s=Ky(t,e);if(Array.isArray(s))r.push(...s);else{const u=ts(t[16]);pc(u[1],u,s,r,!0)}}e=o?e.projectionNext:e.next}return r}class fs{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return pc(e,t,e.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(Wn(t)){const e=t[8],r=e?e.indexOf(this):-1;r>-1&&(uf(t,r),ku(e,r))}this._attachedToViewContainer=!1}Vy(this._lView[1],this._lView)}onDestroy(t){U0(this._lView[1],this._lView,null,t)}markForCheck(){!function $f(n){for(;n;){n[2]|=32;const t=ts(n);if(m2(n)&&!t)return n;n=t}return null}(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){Kf(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ue(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function HT(n,t){ns(n,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new ue(902,!1);this._appRef=t}}class qN extends fs{constructor(t){super(t),this._view=t}detectChanges(){J0(this._view)}checkNoChanges(){}get context(){return null}}class vh extends hc{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=Xe(t);return new gh(e,this.ngModule)}}function Gw(n){const t=[];for(let e in n)n.hasOwnProperty(e)&&t.push({propName:n[e],templateName:e});return t}class KN{constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,r){const o=this.injector.get(t,ph,r);return o!==ph||e===ph?o:this.parentInjector.get(t,e,r)}}class gh extends Ww{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=function aM(n){return n.map(iM).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return Gw(this.componentDef.inputs)}get outputs(){return Gw(this.componentDef.outputs)}create(t,e,r,o){let i=(o=o||this.ngModule)instanceof rs?o:o?.injector;i&&null!==this.componentDef.getStandaloneInjector&&(i=this.componentDef.getStandaloneInjector(i)||i);const a=i?new KN(t,i):t,s=a.get(Uw,null);if(null===s)throw new ue(407,!1);const u=a.get(zN,null),c=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",d=r?function tA(n,t,e){return n.selectRootElement(t,e===dr.ShadowDom)}(c,r,this.componentDef.encapsulation):sf(s.createRenderer(null,this.componentDef),l,function $N(n){const t=n.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(l)),f=this.componentDef.onPush?288:272,h=function IA(n,t){return{components:[],scheduler:n||MT,clean:DA,playerHandler:t||null,flags:0}}(),p=Uf(0,null,null,1,0,null,null,null,null,null),v=ec(null,p,h,f,null,null,s,c,u,a,null);let g,m;Id(v);try{const w=function CA(n,t,e,r,o,i){const a=e[1];e[22]=n;const u=ji(a,22,2,"#host",null),c=u.mergedAttrs=t.hostAttrs;null!==c&&(rc(u,c,!0),null!==n&&(Tu(o,n,c),null!==u.classes&&hf(o,n,u.classes),null!==u.styles&&Qy(o,n,u.styles)));const l=r.createRenderer(n,t),d=ec(e,W0(t),null,t.onPush?32:16,e[22],u,r,l,i||null,null,null);return a.firstCreatePass&&(Nu(ja(u,e),a,t.type),$0(a,u),K0(u,e.length,1)),nc(e,d),e[22]=d}(d,this.componentDef,v,s,c);if(d)if(r)Tu(c,d,["ng-version",GN.full]);else{const{attrs:y,classes:b}=function sM(n){const t=[],e=[];let r=1,o=2;for(;r<n.length;){let i=n[r];if("string"==typeof i)2===o?""!==i&&t.push(i,n[++r]):8===o&&e.push(i);else{if(!zn(o))break;o=i}r++}return{attrs:t,classes:e}}(this.componentDef.selectors[0]);y&&Tu(c,d,y),b&&b.length>0&&hf(c,d,b.join(" "))}if(m=yd(p,22),void 0!==e){const y=m.projection=[];for(let b=0;b<this.ngContentSelectors.length;b++){const x=e[b];y.push(null!=x?Array.from(x):null)}}g=function EA(n,t,e,r,o){const i=e[1],a=function sA(n,t,e){const r=Dt();n.firstCreatePass&&(e.providersResolver&&e.providersResolver(e),X0(n,r,t,Wi(n,t,1,null),e));const o=Wa(t,n,r.directiveStart,r);Ut(o,t);const i=Fn(r,t);return i&&Ut(i,t),o}(i,e,t);if(r.components.push(a),n[8]=a,null!==o)for(const u of o)u(a,t);if(t.contentQueries){const u=Dt();t.contentQueries(1,a,u.directiveStart)}const s=Dt();return!i.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(go(s.index),G0(e[1],s,0,s.directiveStart,s.directiveEnd,t),q0(t,a)),a}(w,this.componentDef,v,h,[SA]),tc(p,v,null)}finally{Sd()}return new YN(this.componentType,g,na(m,v),v,m)}}class YN extends class HN{}{constructor(t,e,r,o,i){super(),this.location=r,this._rootLView=o,this._tNode=i,this.instance=e,this.hostView=this.changeDetectorRef=new qN(o),this.componentType=t}get injector(){return new Ti(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class qw extends Zo{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new vh(this);const r=function gn(n,t){const e=n[mm]||null;if(!e&&!0===t)throw new Error(`Type ${$e(n)} does not have '\u0275mod' property.`);return e}(t);this._bootstrapComponents=function Hr(n){return n instanceof Function?n():n}(r.bootstrap),this._r3Injector=b0(t,e,[{provide:Zo,useValue:this},{provide:hc,useValue:this.componentFactoryResolver}],$e(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this.get(t)}get(t,e=Gn.THROW_IF_NOT_FOUND,r=ce.Default){return t===Gn||t===Zo||t===gf?this:this._r3Injector.get(t,e,r)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class mh extends class VN{}{constructor(t){super(),this.moduleType=t}create(t){return new qw(this.moduleType,t)}}function bh(n){return t=>{setTimeout(n,void 0,t)}}const Ur=class IF extends fu{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,r){let o=t,i=e||(()=>null),a=r;if(t&&"object"==typeof t){const u=t;o=u.next?.bind(u),i=u.error?.bind(u),a=u.complete?.bind(u)}this.__isAsync&&(i=bh(i),o&&(o=bh(o)),a&&(a=bh(a)));const s=super.subscribe({next:o,error:i,complete:a});return t instanceof ur&&t.add(s),s}};function SF(){return this._results[Yo()]()}class wh{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=Yo(),r=wh.prototype;r[e]||(r[e]=SF)}get changes(){return this._changes||(this._changes=new Ur)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const r=this;r.dirty=!1;const o=bn(t);(this._changesDetected=!function dS(n,t,e){if(n.length!==t.length)return!1;for(let r=0;r<n.length;r++){let o=n[r],i=t[r];if(e&&(o=e(o),i=e(i)),i!==o)return!1}return!0}(r._results,o,e))&&(r._results=o,r.length=o.length,r.last=o[this.length-1],r.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let zr=(()=>{class n{}return n.__NG_ELEMENT_ID__=AF,n})();const TF=zr,MF=class extends TF{constructor(t,e,r){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=r}createEmbeddedView(t,e){const r=this._declarationTContainer.tViews,o=ec(this._declarationLView,r,t,16,null,r.declTNode,null,null,null,null,e||null);o[17]=this._declarationLView[this._declarationTContainer.index];const a=this._declarationLView[19];return null!==a&&(o[19]=a.createEmbeddedView(r)),tc(r,o,t),new fs(o)}};function AF(){return vc(Dt(),U())}function vc(n,t){return 4&n.type?new MF(t,n,na(n,t)):null}let br=(()=>{class n{}return n.__NG_ELEMENT_ID__=RF,n})();function RF(){return sx(Dt(),U())}const NF=br,ix=class extends NF{constructor(t,e,r){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=r}get element(){return na(this._hostTNode,this._hostLView)}get injector(){return new Ti(this._hostTNode,this._hostLView)}get parentInjector(){const t=Ru(this._hostTNode,this._hostLView);if(Um(t)){const e=Si(t,this._hostLView),r=Ii(t);return new Ti(e[1].data[r+8],e)}return new Ti(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=ax(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,e,r){let o,i;"number"==typeof r?o=r:null!=r&&(o=r.index,i=r.injector);const a=t.createEmbeddedView(e||{},i);return this.insert(a,o),a}createComponent(t,e,r,o,i){const a=t&&!function za(n){return"function"==typeof n}(t);let s;if(a)s=e;else{const d=e||{};s=d.index,r=d.injector,o=d.projectableNodes,i=d.environmentInjector||d.ngModuleRef}const u=a?t:new gh(Xe(t)),c=r||this.parentInjector;if(!i&&null==u.ngModule){const f=(a?c:this.parentInjector).get(rs,null);f&&(i=f)}const l=u.create(c,o,void 0,i);return this.insert(l.hostView,s),l}insert(t,e){const r=t._lView,o=r[1];if(function M2(n){return Wn(n[3])}(r)){const l=this.indexOf(t);if(-1!==l)this.detach(l);else{const d=r[3],f=new ix(d,d[6],d[3]);f.detach(f.indexOf(t))}}const i=this._adjustIndex(e),a=this._lContainer;!function WT(n,t,e,r){const o=10+r,i=e.length;r>0&&(e[o-1][4]=t),r<i-10?(t[4]=e[o],ey(e,10+r,t)):(e.push(t),t[4]=null),t[3]=e;const a=t[17];null!==a&&e!==a&&function UT(n,t){const e=n[9];t[16]!==t[3][3][16]&&(n[2]=!0),null===e?n[9]=[t]:e.push(t)}(a,t);const s=t[19];null!==s&&s.insertView(n),t[2]|=64}(o,r,a,i);const s=df(i,a),u=r[11],c=qu(u,a[7]);return null!==c&&function VT(n,t,e,r,o,i){r[0]=o,r[6]=t,ns(n,r,e,1,o,i)}(o,a[6],u,r,c,s),t.attachToViewContainerRef(),ey(xh(a),i,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=ax(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),r=uf(this._lContainer,e);r&&(ku(xh(this._lContainer),e),Vy(r[1],r))}detach(t){const e=this._adjustIndex(t,-1),r=uf(this._lContainer,e);return r&&null!=ku(xh(this._lContainer),e)?new fs(r):null}_adjustIndex(t,e=0){return t??this.length+e}};function ax(n){return n[8]}function xh(n){return n[8]||(n[8]=[])}function sx(n,t){let e;const r=t[n.index];if(Wn(r))e=r;else{let o;if(8&n.type)o=pt(r);else{const i=t[11];o=i.createComment("");const a=Fn(n,t);Ko(i,qu(i,a),o,function $T(n,t){return n.nextSibling(t)}(i,a),!1)}t[n.index]=e=function Y0(n,t,e,r){return new Array(n,!0,!1,t,null,0,r,e,null,null)}(r,t,o,n),nc(t,e)}return new ix(e,n,t)}class _h{constructor(t){this.queryList=t,this.matches=null}clone(){return new _h(this.queryList)}setDirty(){this.queryList.setDirty()}}class Dh{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const r=null!==t.contentQueries?t.contentQueries[0]:e.length,o=[];for(let i=0;i<r;i++){const a=e.getByIndex(i);o.push(this.queries[a.indexInDeclarationView].clone())}return new Dh(o)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==fx(t,e).matches&&this.queries[e].setDirty()}}class ux{constructor(t,e,r=null){this.predicate=t,this.flags=e,this.read=r}}class Ch{constructor(t=[]){this.queries=t}elementStart(t,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let r=0;r<this.length;r++){const o=null!==e?e.length:0,i=this.getByIndex(r).embeddedTView(t,o);i&&(i.indexInDeclarationView=r,null!==e?e.push(i):e=[i])}return null!==e?new Ch(e):null}template(t,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class Eh{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new Eh(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let r=t.parent;for(;null!==r&&8&r.type&&r.index!==e;)r=r.parent;return e===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){const i=r[o];this.matchTNodeWithReadOption(t,e,PF(e,i)),this.matchTNodeWithReadOption(t,e,Fu(e,t,i,!1,!1))}else r===zr?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Fu(e,t,r,!1,!1))}matchTNodeWithReadOption(t,e,r){if(null!==r){const o=this.metadata.read;if(null!==o)if(o===ra||o===br||o===zr&&4&e.type)this.addMatch(e.index,-2);else{const i=Fu(e,t,o,!1,!1);null!==i&&this.addMatch(e.index,i)}else this.addMatch(e.index,r)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function PF(n,t){const e=n.localNames;if(null!==e)for(let r=0;r<e.length;r+=2)if(e[r]===t)return e[r+1];return null}function LF(n,t,e,r){return-1===e?function OF(n,t){return 11&n.type?na(n,t):4&n.type?vc(n,t):null}(t,n):-2===e?function BF(n,t,e){return e===ra?na(t,n):e===zr?vc(t,n):e===br?sx(t,n):void 0}(n,t,r):Wa(n,n[1],e,t)}function cx(n,t,e,r){const o=t[19].queries[r];if(null===o.matches){const i=n.data,a=e.matches,s=[];for(let u=0;u<a.length;u+=2){const c=a[u];s.push(c<0?null:LF(t,i[c],a[u+1],e.metadata.read))}o.matches=s}return o.matches}function Ih(n,t,e,r){const o=n.queries.getByIndex(e),i=o.matches;if(null!==i){const a=cx(n,t,o,e);for(let s=0;s<i.length;s+=2){const u=i[s];if(u>0)r.push(a[s/2]);else{const c=i[s+1],l=t[-u];for(let d=10;d<l.length;d++){const f=l[d];f[17]===f[3]&&Ih(f[1],f,c,r)}if(null!==l[9]){const d=l[9];for(let f=0;f<d.length;f++){const h=d[f];Ih(h[1],h,c,r)}}}}}return r}function Sh(n){const t=U(),e=Ne(),r=Fm();Ed(r+1);const o=fx(e,r);if(n.dirty&&Im(t)===(2==(2&o.metadata.flags))){if(null===o.matches)n.reset([]);else{const i=o.crossesNgTemplate?Ih(e,t,r,[]):cx(e,t,o,r);n.reset(i,WN),n.notifyOnChanges()}return!0}return!1}function Th(n,t,e){const r=Ne();r.firstCreatePass&&(function dx(n,t,e){null===n.queries&&(n.queries=new Ch),n.queries.track(new Eh(t,e))}(r,new ux(n,t,e),-1),2==(2&t)&&(r.staticViewQueries=!0)),function lx(n,t,e){const r=new wh(4==(4&e));U0(n,t,r,r.destroy),null===t[19]&&(t[19]=new Dh),t[19].queries.push(new _h(r))}(r,U(),t)}function Mh(){return function HF(n,t){return n[19].queries[t].queryList}(U(),Fm())}function fx(n,t){return n.queries.getByIndex(t)}function mc(...n){}const Rx=new Ce("Application Initializer");let yc=(()=>{class n{constructor(e){this.appInits=e,this.resolve=mc,this.reject=mc,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}runInitializers(){if(this.initialized)return;const e=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const i=this.appInits[o]();if(rh(i))e.push(i);else if($A(i)){const a=new Promise((s,u)=>{i.subscribe({complete:s,error:u})});e.push(a)}}Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),0===e.length&&r(),this.initialized=!0}}return n.\u0275fac=function(e){return new(e||n)(we(Rx,8))},n.\u0275prov=We({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const ms=new Ce("AppId",{providedIn:"root",factory:function Nx(){return`${kh()}${kh()}${kh()}`}});function kh(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Fx=new Ce("Platform Initializer"),Ph=new Ce("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),uk=new Ce("appBootstrapListener"),Gr=new Ce("LocaleId",{providedIn:"root",factory:()=>function CS(n,t=ce.Default){return we(n,t)}(Gr,ce.Optional|ce.SkipSelf)||function ck(){return typeof $localize<"u"&&$localize.locale||ea}()}),pk=(()=>Promise.resolve(0))();function Oh(n){typeof Zone>"u"?pk.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Ot{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ur(!1),this.onMicrotaskEmpty=new Ur(!1),this.onStable=new Ur(!1),this.onError=new Ur(!1),typeof Zone>"u")throw new ue(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&e,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function vk(){let n=ze.requestAnimationFrame,t=ze.cancelAnimationFrame;if(typeof Zone<"u"&&n&&t){const e=n[Zone.__symbol__("OriginalDelegate")];e&&(n=e);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function yk(n){const t=()=>{!function mk(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(ze,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Bh(n),n.isCheckStableRunning=!0,Lh(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Bh(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,r,o,i,a,s)=>{try{return Ox(n),e.invokeTask(o,i,a,s)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===i.type||n.shouldCoalesceRunChangeDetection)&&t(),Lx(n)}},onInvoke:(e,r,o,i,a,s,u)=>{try{return Ox(n),e.invoke(o,i,a,s,u)}finally{n.shouldCoalesceRunChangeDetection&&t(),Lx(n)}},onHasTask:(e,r,o,i)=>{e.hasTask(o,i),r===o&&("microTask"==i.change?(n._hasPendingMicrotasks=i.microTask,Bh(n),Lh(n)):"macroTask"==i.change&&(n.hasPendingMacrotasks=i.macroTask))},onHandleError:(e,r,o,i)=>(e.handleError(o,i),n.runOutsideAngular(()=>n.onError.emit(i)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ot.isInAngularZone())throw new ue(909,!1)}static assertNotInAngularZone(){if(Ot.isInAngularZone())throw new ue(909,!1)}run(t,e,r){return this._inner.run(t,e,r)}runTask(t,e,r,o){const i=this._inner,a=i.scheduleEventTask("NgZoneEvent: "+o,t,gk,mc,mc);try{return i.runTask(a,e,r)}finally{i.cancelTask(a)}}runGuarded(t,e,r){return this._inner.runGuarded(t,e,r)}runOutsideAngular(t){return this._outer.run(t)}}const gk={};function Lh(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Bh(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function Ox(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function Lx(n){n._nesting--,Lh(n)}class bk{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ur,this.onMicrotaskEmpty=new Ur,this.onStable=new Ur,this.onError=new Ur}run(t,e,r){return t.apply(e,r)}runGuarded(t,e,r){return t.apply(e,r)}runOutsideAngular(t){return t()}runTask(t,e,r,o){return t.apply(e,r)}}const Bx=new Ce(""),bc=new Ce("");let jh,Vh=(()=>{class n{constructor(e,r,o){this._ngZone=e,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,jh||(function wk(n){jh=n}(o),o.addToWindow(r)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ot.assertNotInAngularZone(),Oh(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Oh(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(e)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,r,o){let i=-1;r&&r>0&&(i=setTimeout(()=>{this._callbacks=this._callbacks.filter(a=>a.timeoutId!==i),e(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:e,timeoutId:i,updateCb:o})}whenStable(e,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,r,o){return[]}}return n.\u0275fac=function(e){return new(e||n)(we(Ot),we(Hh),we(bc))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})(),Hh=(()=>{class n{constructor(){this._applications=new Map}registerApplication(e,r){this._applications.set(e,r)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,r=!0){return jh?.findTestabilityInTree(this,e,r)??null}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=We({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),xo=null;const Vx=new Ce("AllowMultipleToken"),Wh=new Ce("PlatformDestroyListeners");function jx(n,t,e=[]){const r=`Platform: ${t}`,o=new Ce(r);return(i=[])=>{let a=Uh();if(!a||a.injector.get(Vx,!1)){const s=[...e,...i,{provide:o,useValue:!0}];n?n(s):function Dk(n){if(xo&&!xo.get(Vx,!1))throw new ue(400,!1);xo=n;const t=n.get(Ux);(function Hx(n){const t=n.get(Fx,null);t&&t.forEach(e=>e())})(n)}(function Wx(n=[],t){return Gn.create({name:t,providers:[{provide:mf,useValue:"platform"},{provide:Wh,useValue:new Set([()=>xo=null])},...n]})}(s,r))}return function Ek(n){const t=Uh();if(!t)throw new ue(401,!1);return t}()}}function Uh(){return xo?.get(Ux)??null}let Ux=(()=>{class n{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,r){const o=function Ik(n,t){let e;return e="noop"===n?new bk:("zone.js"===n?void 0:n)||new Ot(t),e}(r?.ngZone,function zx(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(r)),i=[{provide:Ot,useValue:o}];return o.run(()=>{const a=Gn.create({providers:i,parent:this.injector,name:e.moduleType.name}),s=e.create(a),u=s.injector.get(Oi,null);if(!u)throw new ue(402,!1);return o.runOutsideAngular(()=>{const c=o.onError.subscribe({next:l=>{u.handleError(l)}});s.onDestroy(()=>{wc(this._modules,s),c.unsubscribe()})}),function Gx(n,t,e){try{const r=e();return rh(r)?r.catch(o=>{throw t.runOutsideAngular(()=>n.handleError(o)),o}):r}catch(r){throw t.runOutsideAngular(()=>n.handleError(r)),r}}(u,o,()=>{const c=s.injector.get(yc);return c.runInitializers(),c.donePromise.then(()=>(function gw(n){vn(n,"Expected localeId to be defined"),"string"==typeof n&&(vw=n.toLowerCase().replace(/_/g,"-"))}(s.injector.get(Gr,ea)||ea),this._moduleDoBootstrap(s),s))})})}bootstrapModule(e,r=[]){const o=qx({},r);return function xk(n,t,e){const r=new mh(e);return Promise.resolve(r)}(0,0,e).then(i=>this.bootstrapModuleFactory(i,o))}_moduleDoBootstrap(e){const r=e.injector.get(zh);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!e.instance.ngDoBootstrap)throw new ue(403,!1);e.instance.ngDoBootstrap(r)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ue(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const e=this._injector.get(Wh,null);e&&(e.forEach(r=>r()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(e){return new(e||n)(we(Gn))},n.\u0275prov=We({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function qx(n,t){return Array.isArray(t)?t.reduce(qx,n):{...n,...t}}let zh=(()=>{class n{constructor(e,r,o){this._zone=e,this._injector=r,this._exceptionHandler=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const i=new Pt(s=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{s.next(this._stable),s.complete()})}),a=new Pt(s=>{let u;this._zone.runOutsideAngular(()=>{u=this._zone.onStable.subscribe(()=>{Ot.assertNotInAngularZone(),Oh(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,s.next(!0))})})});const c=this._zone.onUnstable.subscribe(()=>{Ot.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{s.next(!1)}))});return()=>{u.unsubscribe(),c.unsubscribe()}});this.isStable=function JI(...n){const t=um(n),e=function GI(n,t){return"number"==typeof Zl(n)?n.pop():t}(n,1/0),r=n;return r.length?1===r.length?cr(r[0]):function WI(n=1/0){return Fa(Yl,n)}(e)(fm(r,t)):sm}(i,a.pipe(function ZI(n={}){const{connector:t=(()=>new fu),resetOnError:e=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=n;return i=>{let a,s,u,c=0,l=!1,d=!1;const f=()=>{s?.unsubscribe(),s=void 0},h=()=>{f(),a=u=void 0,l=d=!1},p=()=>{const v=a;h(),v?.unsubscribe()};return co((v,g)=>{c++,!d&&!l&&f();const m=u=u??t();g.add(()=>{c--,0===c&&!d&&!l&&(s=ed(p,o))}),m.subscribe(g),!a&&c>0&&(a=new Na({next:w=>m.next(w),error:w=>{d=!0,f(),s=ed(h,e,w),m.error(w)},complete:()=>{l=!0,f(),s=ed(h,r),m.complete()}}),cr(v).subscribe(a))})(i)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(e,r){const o=e instanceof Ww;if(!this._injector.get(yc).done)throw!o&&function gs(n){const t=Xe(n)||Yt(n)||Qt(n);return null!==t&&t.standalone}(e),new ue(405,false);let a;a=o?e:this._injector.get(hc).resolveComponentFactory(e),this.componentTypes.push(a.componentType);const s=function _k(n){return n.isBoundToModule}(a)?void 0:this._injector.get(Zo),c=a.create(Gn.NULL,[],r||a.selector,s),l=c.location.nativeElement,d=c.injector.get(Bx,null);return d?.registerApplication(l),c.onDestroy(()=>{this.detachView(c.hostView),wc(this.components,c),d?.unregisterApplication(l)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new ue(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){const r=e;wc(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(uk,[]).concat(this._bootstrapListeners).forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>wc(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new ue(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(e){return new(e||n)(we(Ot),we(Gn),we(Oi))},n.\u0275prov=We({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function wc(n,t){const e=n.indexOf(t);e>-1&&n.splice(e,1)}let Kx=!0;const zk=jx(null,"core",[]);let Gk=(()=>{class n{constructor(e){}}return n.\u0275fac=function(e){return new(e||n)(we(zh))},n.\u0275mod=Wo({type:n}),n.\u0275inj=ho({}),n})(),Cc=null;function bs(){return Cc}const Yn=new Ce("DocumentToken");function p1(n,t){t=encodeURIComponent(t);for(const e of n.split(";")){const r=e.indexOf("="),[o,i]=-1==r?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===t)return decodeURIComponent(i)}return null}let pO=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Wo({type:n}),n.\u0275inj=ho({}),n})();class D1{}class up extends class bO extends class Kk{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function $k(n){Cc||(Cc=n)}(new up)}onAndCancel(t,e,r){return t.addEventListener(e,r,!1),()=>{t.removeEventListener(e,r,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getBaseHref(t){const e=function wO(){return _s=_s||document.querySelector("base"),_s?_s.getAttribute("href"):null}();return null==e?null:function xO(n){kc=kc||document.createElement("a"),kc.setAttribute("href",n);const t=kc.pathname;return"/"===t.charAt(0)?t:`/${t}`}(e)}resetBaseElement(){_s=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return p1(document.cookie,t)}}let kc,_s=null;const C1=new Ce("TRANSITION_ID"),DO=[{provide:Rx,useFactory:function _O(n,t,e){return()=>{e.get(yc).donePromise.then(()=>{const r=bs(),o=t.querySelectorAll(`style[ng-transition="${n}"]`);for(let i=0;i<o.length;i++)r.remove(o[i])})}},deps:[C1,Yn,Gn],multi:!0}];let EO=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})();const Pc=new Ce("EventManagerPlugins");let Oc=(()=>{class n{constructor(e,r){this._zone=r,this._eventNameToPlugin=new Map,e.forEach(o=>o.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,r,o){return this._findPluginFor(r).addEventListener(e,r,o)}addGlobalEventListener(e,r,o){return this._findPluginFor(r).addGlobalEventListener(e,r,o)}getZone(){return this._zone}_findPluginFor(e){const r=this._eventNameToPlugin.get(e);if(r)return r;const o=this._plugins;for(let i=0;i<o.length;i++){const a=o[i];if(a.supports(e))return this._eventNameToPlugin.set(e,a),a}throw new Error(`No event manager plugin found for event ${e}`)}}return n.\u0275fac=function(e){return new(e||n)(we(Pc),we(Ot))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})();class E1{constructor(t){this._doc=t}addGlobalEventListener(t,e,r){const o=bs().getGlobalEventTarget(this._doc,t);if(!o)throw new Error(`Unsupported event target ${o} for event ${e}`);return this.addEventListener(o,e,r)}}let I1=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(e){const r=new Set;e.forEach(o=>{this._stylesSet.has(o)||(this._stylesSet.add(o),r.add(o))}),this.onStylesAdded(r)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})(),Ds=(()=>{class n extends I1{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,r,o){e.forEach(i=>{const a=this._doc.createElement("style");a.textContent=i,o.push(r.appendChild(a))})}addHost(e){const r=[];this._addStylesToHost(this._stylesSet,e,r),this._hostNodes.set(e,r)}removeHost(e){const r=this._hostNodes.get(e);r&&r.forEach(S1),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((r,o)=>{this._addStylesToHost(e,o,r)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(S1))}}return n.\u0275fac=function(e){return new(e||n)(we(Yn))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})();function S1(n){bs().remove(n)}const cp={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},lp=/%COMP%/g;function Lc(n,t,e){for(let r=0;r<t.length;r++){let o=t[r];Array.isArray(o)?Lc(n,o,e):(o=o.replace(lp,n),e.push(o))}return e}function A1(n){return t=>{if("__ngUnwrap__"===t)return n;!1===n(t)&&(t.preventDefault(),t.returnValue=!1)}}let dp=(()=>{class n{constructor(e,r,o){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.rendererByCompId=new Map,this.defaultRenderer=new fp(e)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;switch(r.encapsulation){case dr.Emulated:{let o=this.rendererByCompId.get(r.id);return o||(o=new RO(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,o)),o.applyToHost(e),o}case 1:case dr.ShadowDom:return new NO(this.eventManager,this.sharedStylesHost,e,r);default:if(!this.rendererByCompId.has(r.id)){const o=Lc(r.id,r.styles,[]);this.sharedStylesHost.addStyles(o),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(e){return new(e||n)(we(Oc),we(Ds),we(ms))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})();class fp{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,e){return e?document.createElementNS(cp[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){(N1(t)?t.content:t).appendChild(e)}insertBefore(t,e,r){t&&(N1(t)?t.content:t).insertBefore(e,r)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return e||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,r,o){if(o){e=o+":"+e;const i=cp[o];i?t.setAttributeNS(i,e,r):t.setAttribute(e,r)}else t.setAttribute(e,r)}removeAttribute(t,e,r){if(r){const o=cp[r];o?t.removeAttributeNS(o,e):t.removeAttribute(`${r}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,r,o){o&(un.DashCase|un.Important)?t.style.setProperty(e,r,o&un.Important?"important":""):t.style[e]=r}removeStyle(t,e,r){r&un.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,r){t[e]=r}setValue(t,e){t.nodeValue=e}listen(t,e,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,A1(r)):this.eventManager.addEventListener(t,e,A1(r))}}function N1(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class RO extends fp{constructor(t,e,r,o){super(t),this.component=r;const i=Lc(o+"-"+r.id,r.styles,[]);e.addStyles(i),this.contentAttr=function TO(n){return"_ngcontent-%COMP%".replace(lp,n)}(o+"-"+r.id),this.hostAttr=function MO(n){return"_nghost-%COMP%".replace(lp,n)}(o+"-"+r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const r=super.createElement(t,e);return super.setAttribute(r,this.contentAttr,""),r}}class NO extends fp{constructor(t,e,r,o){super(t),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=Lc(o.id,o.styles,[]);for(let a=0;a<i.length;a++){const s=document.createElement("style");s.textContent=i[a],this.shadowRoot.appendChild(s)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,r){return super.insertBefore(this.nodeOrShadowRoot(t),e,r)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let FO=(()=>{class n extends E1{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o){return e.addEventListener(r,o,!1),()=>this.removeEventListener(e,r,o)}removeEventListener(e,r,o){return e.removeEventListener(r,o)}}return n.\u0275fac=function(e){return new(e||n)(we(Yn))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})();const F1=["alt","control","meta","shift"],PO={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},k1={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},OO={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let LO=(()=>{class n extends E1{constructor(e){super(e)}supports(e){return null!=n.parseEventName(e)}addEventListener(e,r,o){const i=n.parseEventName(r),a=n.eventCallback(i.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>bs().onAndCancel(e,i.domEventName,a))}static parseEventName(e){const r=e.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const i=n._normalizeKey(r.pop());let a="";if(F1.forEach(u=>{const c=r.indexOf(u);c>-1&&(r.splice(c,1),a+=u+".")}),a+=i,0!=r.length||0===i.length)return null;const s={};return s.domEventName=o,s.fullKey=a,s}static getEventFullKey(e){let r="",o=function BO(n){let t=n.key;if(null==t){if(t=n.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===n.location&&k1.hasOwnProperty(t)&&(t=k1[t]))}return PO[t]||t}(e);return o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),F1.forEach(i=>{i!=o&&OO[i](e)&&(r+=i+".")}),r+=o,r}static eventCallback(e,r,o){return i=>{n.getEventFullKey(i)===e&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return n.\u0275fac=function(e){return new(e||n)(we(Yn))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})();const P1=[{provide:Ph,useValue:"browser"},{provide:Fx,useValue:function VO(){up.makeCurrent()},multi:!0},{provide:Yn,useFactory:function jO(){return function LS(n){Wd=n}(document),document},deps:[]}],WO=jx(zk,"browser",P1),O1=new Ce(""),L1=[{provide:bc,useClass:class CO{addToWindow(t){ze.getAngularTestability=(r,o=!0)=>{const i=t.findTestabilityInTree(r,o);if(null==i)throw new Error("Could not find testability for element.");return i},ze.getAllAngularTestabilities=()=>t.getAllTestabilities(),ze.getAllAngularRootElements=()=>t.getAllRootElements(),ze.frameworkStabilizers||(ze.frameworkStabilizers=[]),ze.frameworkStabilizers.push(r=>{const o=ze.getAllAngularTestabilities();let i=o.length,a=!1;const s=function(u){a=a||u,i--,0==i&&r(a)};o.forEach(function(u){u.whenStable(s)})})}findTestabilityInTree(t,e,r){return null==e?null:t.getTestability(e)??(r?bs().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null)}},deps:[]},{provide:Bx,useClass:Vh,deps:[Ot,Hh,bc]},{provide:Vh,useClass:Vh,deps:[Ot,Hh,bc]}],B1=[{provide:mf,useValue:"root"},{provide:Oi,useFactory:function HO(){return new Oi},deps:[]},{provide:Pc,useClass:FO,multi:!0,deps:[Yn,Ot,Ph]},{provide:Pc,useClass:LO,multi:!0,deps:[Yn]},{provide:dp,useClass:dp,deps:[Oc,Ds,ms]},{provide:Uw,useExisting:dp},{provide:I1,useExisting:Ds},{provide:Ds,useClass:Ds,deps:[Yn]},{provide:Oc,useClass:Oc,deps:[Pc,Ot]},{provide:D1,useClass:EO,deps:[]},[]];let UO=(()=>{class n{constructor(e){}static withServerTransition(e){return{ngModule:n,providers:[{provide:ms,useValue:e.appId},{provide:C1,useExisting:ms},DO]}}}return n.\u0275fac=function(e){return new(e||n)(we(O1,12))},n.\u0275mod=Wo({type:n}),n.\u0275inj=ho({providers:[...B1,...L1],imports:[pO,Gk]}),n})();typeof window<"u"&&window;class j1{}class W1{}class Kr{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(e=>{const r=e.indexOf(":");if(r>0){const o=e.slice(0,r),i=o.toLowerCase(),a=e.slice(r+1).trim();this.maybeSetNormalizedName(o,i),this.headers.has(i)?this.headers.get(i).push(a):this.headers.set(i,[a])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let r=t[e];const o=e.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(o,r),this.maybeSetNormalizedName(e,o))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof Kr?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new Kr;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof Kr?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let r=t.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(t.name,e);const o=("a"===t.op?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":const i=t.value;if(i){let a=this.headers.get(e);if(!a)return;a=a.filter(s=>-1===i.indexOf(s)),0===a.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,a)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class rL{encodeKey(t){return U1(t)}encodeValue(t){return U1(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const iL=/%(\d[a-f0-9])/gi,aL={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function U1(n){return encodeURIComponent(n).replace(iL,(t,e)=>aL[e]??t)}function Bc(n){return`${n}`}class Do{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new rL,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function oL(n,t){const e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(o=>{const i=o.indexOf("="),[a,s]=-1==i?[t.decodeKey(o),""]:[t.decodeKey(o.slice(0,i)),t.decodeValue(o.slice(i+1))],u=e.get(a)||[];u.push(s),e.set(a,u)}),e}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const r=t.fromObject[e],o=Array.isArray(r)?r.map(Bc):[Bc(r)];this.map.set(e,o)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){const e=[];return Object.keys(t).forEach(r=>{const o=t[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const e=new Do({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(Bc(t.value)),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let r=this.map.get(t.param)||[];const o=r.indexOf(Bc(t.value));-1!==o&&r.splice(o,1),r.length>0?this.map.set(t.param,r):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class sL{constructor(){this.map=new Map}set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function z1(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function G1(n){return typeof Blob<"u"&&n instanceof Blob}function q1(n){return typeof FormData<"u"&&n instanceof FormData}class Cs{constructor(t,e,r,o){let i;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function uL(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==r?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Kr),this.context||(this.context=new sL),this.params){const a=this.params.toString();if(0===a.length)this.urlWithParams=e;else{const s=e.indexOf("?");this.urlWithParams=e+(-1===s?"?":s<e.length-1?"&":"")+a}}else this.params=new Do,this.urlWithParams=e}serializeBody(){return null===this.body?null:z1(this.body)||G1(this.body)||q1(this.body)||function cL(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Do?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||q1(this.body)?null:G1(this.body)?this.body.type||null:z1(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Do?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const e=t.method||this.method,r=t.url||this.url,o=t.responseType||this.responseType,i=void 0!==t.body?t.body:this.body,a=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,s=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let u=t.headers||this.headers,c=t.params||this.params;const l=t.context??this.context;return void 0!==t.setHeaders&&(u=Object.keys(t.setHeaders).reduce((d,f)=>d.set(f,t.setHeaders[f]),u)),t.setParams&&(c=Object.keys(t.setParams).reduce((d,f)=>d.set(f,t.setParams[f]),c)),new Cs(e,r,i,{params:c,headers:u,context:l,reportProgress:s,responseType:o,withCredentials:a})}}var yt=(()=>((yt=yt||{})[yt.Sent=0]="Sent",yt[yt.UploadProgress=1]="UploadProgress",yt[yt.ResponseHeader=2]="ResponseHeader",yt[yt.DownloadProgress=3]="DownloadProgress",yt[yt.Response=4]="Response",yt[yt.User=5]="User",yt))();class vp{constructor(t,e=200,r="OK"){this.headers=t.headers||new Kr,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class gp extends vp{constructor(t={}){super(t),this.type=yt.ResponseHeader}clone(t={}){return new gp({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Vc extends vp{constructor(t={}){super(t),this.type=yt.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Vc({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class $1 extends vp{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function mp(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let K1=(()=>{class n{constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof Cs)i=e;else{let u,c;u=o.headers instanceof Kr?o.headers:new Kr(o.headers),o.params&&(c=o.params instanceof Do?o.params:new Do({fromObject:o.params})),i=new Cs(e,r,void 0!==o.body?o.body:null,{headers:u,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials})}const a=function eL(...n){return fm(n,um(n))}(i).pipe(function tL(n,t){return He(t)?Fa(n,t,1):Fa(n,1)}(u=>this.handler.handle(u)));if(e instanceof Cs||"events"===o.observe)return a;const s=a.pipe(function nL(n,t){return co((e,r)=>{let o=0;e.subscribe(lo(r,i=>n.call(t,i,o++)&&r.next(i)))})}(u=>u instanceof Vc));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return s.pipe(yi(u=>{if(null!==u.body&&!(u.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return u.body}));case"blob":return s.pipe(yi(u=>{if(null!==u.body&&!(u.body instanceof Blob))throw new Error("Response is not a Blob.");return u.body}));case"text":return s.pipe(yi(u=>{if(null!==u.body&&"string"!=typeof u.body)throw new Error("Response is not a string.");return u.body}));default:return s.pipe(yi(u=>u.body))}case"response":return s;default:throw new Error(`Unreachable: unhandled observe type ${o.observe}}`)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:(new Do).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,mp(o,r))}post(e,r,o={}){return this.request("POST",e,mp(o,r))}put(e,r,o={}){return this.request("PUT",e,mp(o,r))}}return n.\u0275fac=function(e){return new(e||n)(we(j1))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})();class X1{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const Y1=new Ce("HTTP_INTERCEPTORS");let lL=(()=>{class n{intercept(e,r){return r.handle(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})();const dL=/^\)\]\}',?\n/;let Q1=(()=>{class n{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Pt(r=>{const o=this.xhrFactory.build();if(o.open(e.method,e.urlWithParams),e.withCredentials&&(o.withCredentials=!0),e.headers.forEach((h,p)=>o.setRequestHeader(h,p.join(","))),e.headers.has("Accept")||o.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const h=e.detectContentTypeHeader();null!==h&&o.setRequestHeader("Content-Type",h)}if(e.responseType){const h=e.responseType.toLowerCase();o.responseType="json"!==h?h:"text"}const i=e.serializeBody();let a=null;const s=()=>{if(null!==a)return a;const h=o.statusText||"OK",p=new Kr(o.getAllResponseHeaders()),v=function fL(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(o)||e.url;return a=new gp({headers:p,status:o.status,statusText:h,url:v}),a},u=()=>{let{headers:h,status:p,statusText:v,url:g}=s(),m=null;204!==p&&(m=typeof o.response>"u"?o.responseText:o.response),0===p&&(p=m?200:0);let w=p>=200&&p<300;if("json"===e.responseType&&"string"==typeof m){const y=m;m=m.replace(dL,"");try{m=""!==m?JSON.parse(m):null}catch(b){m=y,w&&(w=!1,m={error:b,text:m})}}w?(r.next(new Vc({body:m,headers:h,status:p,statusText:v,url:g||void 0})),r.complete()):r.error(new $1({error:m,headers:h,status:p,statusText:v,url:g||void 0}))},c=h=>{const{url:p}=s(),v=new $1({error:h,status:o.status||0,statusText:o.statusText||"Unknown Error",url:p||void 0});r.error(v)};let l=!1;const d=h=>{l||(r.next(s()),l=!0);let p={type:yt.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),"text"===e.responseType&&!!o.responseText&&(p.partialText=o.responseText),r.next(p)},f=h=>{let p={type:yt.UploadProgress,loaded:h.loaded};h.lengthComputable&&(p.total=h.total),r.next(p)};return o.addEventListener("load",u),o.addEventListener("error",c),o.addEventListener("timeout",c),o.addEventListener("abort",c),e.reportProgress&&(o.addEventListener("progress",d),null!==i&&o.upload&&o.upload.addEventListener("progress",f)),o.send(i),r.next({type:yt.Sent}),()=>{o.removeEventListener("error",c),o.removeEventListener("abort",c),o.removeEventListener("load",u),o.removeEventListener("timeout",c),e.reportProgress&&(o.removeEventListener("progress",d),null!==i&&o.upload&&o.upload.removeEventListener("progress",f)),o.readyState!==o.DONE&&o.abort()}})}}return n.\u0275fac=function(e){return new(e||n)(we(D1))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})();const yp=new Ce("XSRF_COOKIE_NAME"),bp=new Ce("XSRF_HEADER_NAME");class J1{}let hL=(()=>{class n{constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=p1(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return n.\u0275fac=function(e){return new(e||n)(we(Yn),we(Ph),we(yp))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})(),wp=(()=>{class n{constructor(e,r){this.tokenService=e,this.headerName=r}intercept(e,r){const o=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||o.startsWith("http://")||o.startsWith("https://"))return r.handle(e);const i=this.tokenService.getToken();return null!==i&&!e.headers.has(this.headerName)&&(e=e.clone({headers:e.headers.set(this.headerName,i)})),r.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(we(J1),we(bp))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})(),pL=(()=>{class n{constructor(e,r){this.backend=e,this.injector=r,this.chain=null}handle(e){if(null===this.chain){const r=this.injector.get(Y1,[]);this.chain=r.reduceRight((o,i)=>new X1(o,i),this.backend)}return this.chain.handle(e)}}return n.\u0275fac=function(e){return new(e||n)(we(W1),we(Gn))},n.\u0275prov=We({token:n,factory:n.\u0275fac}),n})(),vL=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:wp,useClass:lL}]}}static withOptions(e={}){return{ngModule:n,providers:[e.cookieName?{provide:yp,useValue:e.cookieName}:[],e.headerName?{provide:bp,useValue:e.headerName}:[]]}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Wo({type:n}),n.\u0275inj=ho({providers:[wp,{provide:Y1,useExisting:wp,multi:!0},{provide:J1,useClass:hL},{provide:yp,useValue:"XSRF-TOKEN"},{provide:bp,useValue:"X-XSRF-TOKEN"}]}),n})(),gL=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Wo({type:n}),n.\u0275inj=ho({providers:[K1,{provide:j1,useClass:pL},Q1,{provide:W1,useExisting:Q1}],imports:[vL.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})();function Z1(n,t,e,r,o,i,a){try{var s=n[i](a),u=s.value}catch(c){return void e(c)}s.done?t(u):Promise.resolve(u).then(r,o)}function Es(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var i=n.apply(t,e);function a(u){Z1(i,r,o,a,s,"next",u)}function s(u){Z1(i,r,o,a,s,"throw",u)}a(void 0)})}}const e_={now:()=>(e_.delegate||Date).now(),delegate:void 0};class mL extends fu{constructor(t=1/0,e=1/0,r=e_){super(),this._bufferSize=t,this._windowTime=e,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,e)}next(t){const{isStopped:e,_buffer:r,_infiniteTimeWindow:o,_timestampProvider:i,_windowTime:a}=this;e||(r.push(t),!o&&r.push(i.now()+a)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const e=this._innerSubscribe(t),{_infiniteTimeWindow:r,_buffer:o}=this,i=o.slice();for(let a=0;a<i.length&&!t.closed;a+=r?1:2)t.next(i[a]);return this._checkFinalizedStatuses(t),e}_trimBuffer(){const{_bufferSize:t,_timestampProvider:e,_buffer:r,_infiniteTimeWindow:o}=this,i=(o?1:2)*t;if(t<1/0&&i<r.length&&r.splice(0,r.length-i),!o){const a=e.now();let s=0;for(let u=1;u<r.length&&r[u]<=a;u+=2)s=u;s&&r.splice(0,s+1)}}}function xp(n){return new Pt(t=>{cr(n()).subscribe(t)})}const{isArray:yL}=Array;const xL=["addListener","removeListener"],_L=["addEventListener","removeEventListener"],DL=["on","off"];function _p(n,t,e,r){if(He(e)&&(r=e,e=void 0),r)return _p(n,t,e).pipe(function wL(n){return yi(t=>function bL(n,t){return yL(t)?n(...t):n(t)}(n,t))}(r));const[o,i]=function IL(n){return He(n.addEventListener)&&He(n.removeEventListener)}(n)?_L.map(a=>s=>n[a](t,s,e)):function CL(n){return He(n.addListener)&&He(n.removeListener)}(n)?xL.map(t_(n,t)):function EL(n){return He(n.on)&&He(n.off)}(n)?DL.map(t_(n,t)):[];if(!o&&Jl(n))return Fa(a=>_p(a,t,e))(cr(n));if(!o)throw new TypeError("Invalid event target");return new Pt(a=>{const s=(...u)=>a.next(1<u.length?u:u[0]);return o(s),()=>i(s)})}function t_(n,t){return e=>r=>n[e](t,r)}var n_=function(n,t){return(n_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(n,t)};function Zn(n,t){function e(){this.constructor=n}n_(n,t),n.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}function J(n,t,e,r){return new(e||(e=Promise))(function(o,i){function a(c){try{u(r.next(c))}catch(l){i(l)}}function s(c){try{u(r.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new e(function(l){l(c.value)}).then(a,s)}u((r=r.apply(n,t||[])).next())})}function Z(n,t){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(n,a)}catch(d){l=[6,d],r=0}finally{e=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}var ML=function(){function n(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},n.prototype.registerFlag=function(t,e,r){if(this.flagRegistry[t]={evaluationFn:e,setHook:r},null!=this.urlFlags[t]){var o=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+o+"."),this.set(t,o)}},n.prototype.get=function(t){return t in this.flags||(this.flags[t]=this.evaluateFlag(t)),this.flags[t]},n.prototype.getNumber=function(t){return this.get(t)},n.prototype.getBool=function(t){return this.get(t)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},n.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},n.prototype.setFlags=function(t){this.flags=Object.assign({},t)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var r,o=(r={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return AL(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach(function(i){var a=i.split(":"),s=a[0];t.urlFlags[s]=function(c,l){if("true"===(l=l.toLowerCase())||"false"===l)return"true"===l;if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")}(s,a[1])})}},n}();function AL(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function P(){return r_}var r_=null,aa=new Map,Is=new Map;function o_(n,t){var e=Dp(n,t);return aa.get(e)}function i_(n){for(var t=aa.entries(),e=[];;){var r=t.next(),i=r.value;if(r.done)break;var s=i[1];i[0].split("_")[0]===n&&e.push(s)}return e}function a_(n){var t=n.kernelName,e=n.backendName,r=Dp(t,e);if(aa.has(r))throw new Error("The kernel '"+t+"' for backend '"+e+"' is already registered");aa.set(r,n)}function NL(n){var t=n.kernelName;Is.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),Is.set(t,n)}function Dp(n,t){return t+"_"+n}function s_(n){for(var t=n.length,e=0,r=0;t>0;)r=Math.random()*t|0,e=n[--t],n[t]=n[r],n[r]=e}function Hc(n,t,e){return Math.max(n,Math.min(t,e))}function Cp(n){return n%2==0?n:n+1}function u_(n){for(var t=0,e=0;e<n.length;e++)t+=n[e];return t}function C(n,t){if(!n)throw new Error("string"==typeof t?t:t())}function Fe(n,t,e){void 0===e&&(e=""),C(bt(n,t),function(){return e+" Shapes "+n+" and "+t+" must match"})}function ti(n){C(null!=n,function(){return"The input to the tensor constructor must be a non-null value."})}function Xr(n,t,e){if(void 0===t&&(t=[]),void 0===e&&(e=!1),null==t&&(t=[]),Array.isArray(n)||Lt(n)&&!e)for(var r=0;r<n.length;++r)Xr(n[r],t,e);else t.push(n);return t}function ee(n){if(0===n.length)return 1;for(var t=n[0],e=1;e<n.length;e++)t*=n[e];return t}function bt(n,t){if(n===t)return!0;if(null==n||null==t||n.length!==t.length)return!1;for(var e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function rt(n){return n%1==0}function c_(n){if(null!=Math.tanh)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var t=Math.exp(2*n);return(t-1)/(t+1)}function jc(n){var t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function ni(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function Ep(n,t,e){return void 0===t&&(t=function(r){return 0}),new Promise(function(r,o){var i=0,a=function(){if(n())r();else{i++;var s=t(i);null!=e&&i>=e?o():setTimeout(a,s)}};a()})}function l_(n,t){for(var e=1,r=-1,o=0;o<n.length;++o)if(n[o]>=0)e*=n[o];else if(-1===n[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(n[o]<0)throw Error("Shapes can not be < 0. Found "+n[o]+" at dim "+o);if(-1===r){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+n);return n}if(0===e)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var i=n.slice();return i[r]=t/e,i}function wt(n,t){var e=t.length;return C((n=null==n?t.map(function(r,o){return o}):[].concat(n)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+n}),C(n.every(function(r){return rt(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?e+r:r})}function Co(n,t){for(var e=[],r=[],o=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||o?null:wt(t,n).sort(),a=0,s=0;s<n.length;++s){if(null!=i){if(i[a]===s&&1!==n[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+n[s]+"' is not 1");(null==i[a]||i[a]>s)&&1===n[s]&&(e.push(n[s]),r.push(s)),i[a]<=s&&a++}1!==n[s]&&(e.push(n[s]),r.push(s))}return{newShape:e,keptDims:r}}function sa(n,t){var e=null;if(null==n||"float32"===n)e=new Float32Array(t);else if("int32"===n)e=new Int32Array(t);else{if("bool"!==n)throw new Error("Unknown data type "+n);e=new Uint8Array(t)}return e}function Ss(n,t){var e=null;if(null==n||"float32"===n)e=new Float32Array(t);else if("int32"===n)e=new Int32Array(t);else if("bool"===n)e=new Uint8Array(t);else{if("string"!==n)throw new Error("Unknown data type "+n);e=new Array(t)}return e}function d_(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function f_(n){return"bool"===n||"complex64"===n||"float32"===n||"int32"===n||"string"===n}function h_(n,t){return!("complex64"===t||"float32"===t&&"complex64"!==n||"int32"===t&&"float32"!==n&&"complex64"!==n||"bool"===t&&"bool"===n)}function Lt(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function Ip(n){if("float32"===n||"int32"===n)return 4;if("complex64"===n)return 8;if("bool"===n)return 1;throw new Error("Unknown dtype "+n)}function p_(n){if(null==n)return 0;var t=0;return n.forEach(function(e){return t+=e.length}),t}function Eo(n){return"string"==typeof n||n instanceof String}function v_(n){return"boolean"==typeof n}function g_(n){return"number"==typeof n}function ua(n){return Array.isArray(n)?ua(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":g_(n)?"float32":Eo(n)?"string":v_(n)?"bool":"float32"}function Io(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Wc(n,t){for(var e=t;e<n;++e)if(n%e==0)return e;return n}function er(n){var t=n.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=n[t-1];for(var r=t-3;r>=0;--r)e[r]=e[r+1]*n[r+1];return e}function Sp(n,t,e){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Xr(n)),e&&d_(n,t),a=t,(i=n)instanceof Float32Array&&"float32"===a||i instanceof Int32Array&&"int32"===a||i instanceof Uint8Array&&"bool"===a)return n;var i,a;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(n);if("int32"===t)return new Int32Array(n);if("bool"===t){for(var r=new Uint8Array(n.length),o=0;o<r.length;++o)0!==Math.round(n[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+t)}function Tp(n,t){if(0===n.length)return t[0];var e=n.reduce(function(r,o){return r*o});if(0===e)return[];if(e!==t.length)throw new Error("["+n+"] does not match the input size.");return function r(o,i,a){var s=new Array;if(1===i.length)for(var u=i[0],c=0;c<u;c++)s[c]=a[o+c];else{u=i[0];var l=i.slice(1),d=l.reduce(function(f,h){return f*h});for(c=0;c<u;c++)s[c]=r(o+c*d,l,a)}return s}(0,n,t)}function Mp(n,t){for(var e=ca(n,t),r=0;r<e.length;r++)e[r]=1;return e}function ca(n,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(n);if("int32"===t)return new Int32Array(n);if("bool"===t)return new Uint8Array(n);throw new Error("Unknown data type "+t)}function tr(){return P().platform.now()}function Ap(n){n.forEach(function(t){C(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function m_(n,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",P().platform.encode(n,t)}function Ts(n,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",P().platform.decode(n,t)}function Rp(n,t,e){if(0===t)return 0;if(1===t)return n[0];for(var r=n[n.length-1],o=0;o<n.length-1;++o)r+=e[o]*n[o];return r}function y_(n,t,e){if(0===t)return[];if(1===t)return[n];for(var r=new Array(t),o=0;o<r.length-1;++o)r[o]=Math.floor(n/e[o]),n-=r[o]*e[o];return r[r.length-1]=n,r}Object.freeze({shuffle:s_,clamp:Hc,nearestLargerEven:Cp,sum:u_,randUniform:function(n,t){var e=Math.random();return t*e+(1-e)*n},distSquared:function(n,t){for(var e=0,r=0;r<n.length;r++){var o=Number(n[r])-Number(t[r]);e+=o*o}return e},assert:C,assertShapesMatch:Fe,assertNonNull:ti,flatten:Xr,sizeFromShape:ee,isScalarShape:function(n){return 0===n.length},arraysEqual:bt,isInt:rt,tanh:c_,sizeToSquarishShape:jc,createShuffledIndices:function(n){for(var t=new Uint32Array(n),e=0;e<n;++e)t[e]=e;return s_(t),t},rightPad:ni,repeatedTry:Ep,inferFromImplicitShape:l_,parseAxisParam:wt,squeezeShape:Co,getTypedArrayFromDType:sa,getArrayFromDType:Ss,checkConversionForErrors:d_,isValidDtype:f_,hasEncodingLoss:h_,isTypedArray:Lt,bytesPerElement:Ip,bytesFromStringArray:p_,isString:Eo,isBoolean:v_,isNumber:g_,inferDtype:ua,isFunction:Io,nearestDivisor:Wc,computeStrides:er,toTypedArray:Sp,toNestedArray:Tp,makeOnesTypedArray:Mp,makeZerosTypedArray:ca,now:tr,assertNonNegativeIntegerDimensions:Ap,fetch:function(n,t){return P().platform.fetch(n,t)},encodeString:m_,decodeString:Ts,locToIndex:Rp,indexToLoc:y_});var FL=function(){function n(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new kL)}return n.prototype.profileKernel=function(t,e,r){var o,i=this,a=this.backendTimer.time(function(){o=r()});return o.forEach(function(s){s.data().then(function(u){(function(c,l,d){if("float32"!==l)return!1;for(var f=0;f<c.length;f++){var h=c[f];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+d+"'"),!0}})(u,s.dtype,t),a.then(function(c){var l="";null!=c.getExtraProfileInfo&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(t,s,u,c.kernelMs,e,l)})})}),o},n}(),kL=function(){function n(){}return n.prototype.logKernelProfile=function(t,e,r,o,i,a){var s="number"==typeof o?ni(o+"ms",9):o.error,u=ni(t,25),c=e.rank,l=e.size,d=ni(e.shape.toString(),14),f="";for(var h in i){var p=i[h].shape||e.shape,v=p.length;f+=h+": "+v+"D "+(v>0?p:"")+" "}console.log("%c"+u+"\t%c"+s+"\t%c"+c+"D "+d+"\t%c"+l+"\t%c"+f+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function As(n,t,e){return ni(Array.isArray(n)?parseFloat(n[0].toFixed(7))+" + "+parseFloat(n[1].toFixed(7))+"j":Eo(n)?"'"+n+"'":"bool"===e?w_(n):parseFloat(n.toFixed(7)).toString(),t)}function w_(n){return 0===n?"false":"true"}function Rs(n){for(var t=[],e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}var Ns=function(){function n(t,e,r){var o=this;if(this.dtype=e,this.shape=t.slice(),this.size=ee(t),null!=r){var i=r.length;C(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ss(e,this.size),this.strides=er(t)}return n.prototype.set=function(t){for(var e=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];0===r.length&&(r=[0]),C(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(r);this.values[i]=t},n.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var r=0,o=0,i=t;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]},n.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e},n.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return wr().makeTensor(this.values,this.shape,this.dtype)},n}(),wr=null,k=null,x_=null,Ke=function(){function n(t,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=ee(t),this.strides=er(t),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),C(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},n.prototype.as3D=function(t,e,r){return this.throwIfDisposed(),this.reshape([t,e,r])},n.prototype.as4D=function(t,e,r,o){return this.throwIfDisposed(),this.reshape([t,e,r,o])},n.prototype.as5D=function(t,e,r,o,i){return this.throwIfDisposed(),this.reshape([t,e,r,o,i])},n.prototype.asType=function(t){return this.throwIfDisposed(),k.cast(this,t)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return J(this,void 0,void 0,function(){var t;return Z(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,k.buffer(this.shape,this.dtype,t)]}})})},n.prototype.bufferSync=function(){return k.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return J(this,void 0,void 0,function(){var t;return Z(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Tp(this.shape,t)]}})})},n.prototype.arraySync=function(){return Tp(this.shape,this.dataSync())},n.prototype.data=function(){return J(this,void 0,void 0,function(){var t,e;return Z(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=wr().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=r.sent();try{return[2,e.map(function(o){return Ts(o)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var t=wr().readSync(this.dataId);if("string"===this.dtype)try{return t.map(function(e){return Ts(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},n.prototype.bytes=function(){return J(this,void 0,void 0,function(){var t;return Z(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,wr().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(wr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(t){return void 0===t&&(t=!1),k.print(this,t)},n.prototype.reshape=function(t){return this.throwIfDisposed(),k.reshape(this,t)},n.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},n.prototype.expandDims=function(t){return void 0===t&&(t=0),k.expandDims(this,t)},n.prototype.cumsum=function(t,e,r){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===r&&(r=!1),k.cumsum(this,t,e,r)},n.prototype.squeeze=function(t){return this.throwIfDisposed(),k.squeeze(this,t)},n.prototype.clone=function(){return this.throwIfDisposed(),k.clone(this)},n.prototype.oneHot=function(t,e,r){return this.throwIfDisposed(),k.oneHot(this,t,e,r)},n.prototype.toString=function(t){return void 0===t&&(t=!1),function PL(n,t,e,r){var o=er(t),i=function(c,l,d,f){var h=ee(l),p=f[f.length-1],v=new Array(p).fill(0),g=l.length,m="complex64"===d?Rs(c):c;if(g>1)for(var w=0;w<h/p;w++)for(var y=w*p,b=0;b<p;b++)v[b]=Math.max(v[b],As(m[y+b],0,d).length);return v}(n,t,e,o),a=t.length,s=function c(l,d,f,h,p,v){void 0===v&&(v=!0);var g="complex64"===f?2:1,m=d[0],w=d.length;if(0===w)return"complex64"===f?[As(Rs(l)[0],0,f)]:"bool"===f?[w_(l[0])]:[l[0].toString()];if(1===w){if(m>20){var b=Array.from(l.slice(0,3*g)),x=Array.from(l.slice((m-3)*g,m*g));return"complex64"===f&&(b=Rs(b),x=Rs(x)),["["+b.map(function(L,H){return As(L,p[H],f)}).join(", ")+", ..., "+x.map(function(L,H){return As(L,p[m-3+H],f)}).join(", ")+"]"]}return["["+("complex64"===f?Rs(l):Array.from(l)).map(function(L,H){return As(L,p[H],f)}).join(", ")+"]"]}var _=d.slice(1),T=h.slice(1),S=h[0]*g,E=[];if(m>20){for(var I=0;I<3;I++){var N=(R=I*S)+S;E.push.apply(E,c(l.slice(R,N),_,f,T,p,!1))}for(E.push("..."),I=m-3;I<m;I++)N=(R=I*S)+S,E.push.apply(E,c(l.slice(R,N),_,f,T,p,I===m-1))}else for(I=0;I<m;I++){var R;N=(R=I*S)+S,E.push.apply(E,c(l.slice(R,N),_,f,T,p,I===m-1))}var B=2===w?",":"";for(E[0]="["+E[0]+B,I=1;I<E.length-1;I++)E[I]=" "+E[I]+B;var O=",\n";for(I=2;I<w;I++)O+="\n";return E[E.length-1]=" "+E[E.length-1]+"]"+(v?"":O),E}(n,t,e,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+a),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},n.prototype.tile=function(t){return this.throwIfDisposed(),k.tile(this,t)},n.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),k.gather(this,t,e)},n.prototype.matMul=function(t,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!1),this.throwIfDisposed(),k.matMul(this,t,e,r)},n.prototype.dot=function(t){return this.throwIfDisposed(),k.dot(this,t)},n.prototype.norm=function(t,e,r){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1),this.throwIfDisposed(),k.norm(this,t,e,r)},n.prototype.slice=function(t,e){return this.throwIfDisposed(),k.slice(this,t,e)},n.prototype.reverse=function(t){return this.throwIfDisposed(),k.reverse(this,t)},n.prototype.concat=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),t instanceof n&&(t=[t]),k.concat([this].concat(t),e)},n.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),k.split(this,t,e)},n.prototype.stack=function(t,e){return void 0===e&&(e=0),k.stack([this,t],e)},n.prototype.unstack=function(t){return void 0===t&&(t=0),k.unstack(this,t)},n.prototype.pad=function(t,e){return void 0===e&&(e=0),k.pad(this,t,e)},n.prototype.batchNormalization=function(t,e,r,o,i){return void 0===r&&(r=.001),x_("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,i,o,r)},n.prototype.batchNorm=function(t,e,r,o,i){return void 0===i&&(i=.001),this.throwIfDisposed(),k.batchNorm(this,t,e,r,o,i)},n.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.all(this,t,e)},n.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.any(this,t,e)},n.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.logSumExp(this,t,e)},n.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.sum(this,t,e)},n.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.prod(this,t,e)},n.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.mean(this,t,e)},n.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.min(this,t,e)},n.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),k.max(this,t,e)},n.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),k.argMin(this,t)},n.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),k.argMax(this,t)},n.prototype.cast=function(t){return this.throwIfDisposed(),k.cast(this,t)},n.prototype.add=function(t){return this.throwIfDisposed(),k.add(this,t)},n.prototype.addStrict=function(t){return this.throwIfDisposed(),k.addStrict(this,t)},n.prototype.atan2=function(t){return this.throwIfDisposed(),k.atan2(this,t)},n.prototype.sub=function(t){return this.throwIfDisposed(),k.sub(this,t)},n.prototype.subStrict=function(t){return this.throwIfDisposed(),k.subStrict(this,t)},n.prototype.pow=function(t){return this.throwIfDisposed(),k.pow(this,t)},n.prototype.powStrict=function(t){return this.throwIfDisposed(),k.powStrict(this,t)},n.prototype.mul=function(t){return this.throwIfDisposed(),k.mul(this,t)},n.prototype.mulStrict=function(t){return this.throwIfDisposed(),k.mulStrict(this,t)},n.prototype.div=function(t){return this.throwIfDisposed(),k.div(this,t)},n.prototype.divNoNan=function(t){return this.throwIfDisposed(),k.divNoNan(this,t)},n.prototype.floorDiv=function(t){return this.throwIfDisposed(),k.floorDiv(this,t)},n.prototype.divStrict=function(t){return this.throwIfDisposed(),k.divStrict(this,t)},n.prototype.minimum=function(t){return this.throwIfDisposed(),k.minimum(this,t)},n.prototype.minimumStrict=function(t){return this.throwIfDisposed(),k.minimumStrict(this,t)},n.prototype.maximum=function(t){return this.throwIfDisposed(),k.maximum(this,t)},n.prototype.maximumStrict=function(t){return this.throwIfDisposed(),k.maximumStrict(this,t)},n.prototype.mod=function(t){return this.throwIfDisposed(),k.mod(this,t)},n.prototype.modStrict=function(t){return this.throwIfDisposed(),k.modStrict(this,t)},n.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),k.squaredDifferenceStrict(this,t)},n.prototype.transpose=function(t){return this.throwIfDisposed(),k.transpose(this,t)},n.prototype.notEqual=function(t){return this.throwIfDisposed(),k.notEqual(this,t)},n.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),k.notEqualStrict(this,t)},n.prototype.less=function(t){return this.throwIfDisposed(),k.less(this,t)},n.prototype.lessStrict=function(t){return this.throwIfDisposed(),k.lessStrict(this,t)},n.prototype.equal=function(t){return this.throwIfDisposed(),k.equal(this,t)},n.prototype.equalStrict=function(t){return this.throwIfDisposed(),k.equalStrict(this,t)},n.prototype.lessEqual=function(t){return this.throwIfDisposed(),k.lessEqual(this,t)},n.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),k.lessEqualStrict(this,t)},n.prototype.greater=function(t){return this.throwIfDisposed(),k.greater(this,t)},n.prototype.greaterStrict=function(t){return this.throwIfDisposed(),k.greaterStrict(this,t)},n.prototype.greaterEqual=function(t){return this.throwIfDisposed(),k.greaterEqual(this,t)},n.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),k.greaterEqualStrict(this,t)},n.prototype.logicalAnd=function(t){return this.throwIfDisposed(),k.logicalAnd(this,t)},n.prototype.logicalOr=function(t){return this.throwIfDisposed(),k.logicalOr(this,t)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),k.logicalNot(this)},n.prototype.logicalXor=function(t){return this.throwIfDisposed(),k.logicalXor(this,t)},n.prototype.where=function(t,e){return this.throwIfDisposed(),k.where(t,this,e)},n.prototype.neg=function(){return this.throwIfDisposed(),k.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),k.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),k.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),k.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),k.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),k.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),k.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),k.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),k.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),k.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),k.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),k.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),k.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),k.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),k.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),k.abs(this)},n.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),k.clipByValue(this,t,e)},n.prototype.relu=function(){return this.throwIfDisposed(),k.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),k.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),k.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),k.selu(this)},n.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),k.leakyRelu(this,t)},n.prototype.prelu=function(t){return this.throwIfDisposed(),k.prelu(this,t)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),k.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),k.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),k.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),k.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),k.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),k.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),k.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),k.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),k.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),k.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),k.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),k.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),k.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),k.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),k.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),k.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),k.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),k.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),k.round(this)},n.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),k.step(this,t)},n.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),k.softmax(this,t)},n.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),k.logSoftmax(this,t)},n.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),k.image.resizeBilinear(this,t,e)},n.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),k.image.resizeNearestNeighbor(this,t,e)},n.prototype.conv1d=function(t,e,r,o,i,a){return void 0===o&&(o="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),k.conv1d(this,t,e,r,o,i,a)},n.prototype.conv2d=function(t,e,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),k.conv2d(this,t,e,r,o,i,a)},n.prototype.conv2dTranspose=function(t,e,r,o,i){return this.throwIfDisposed(),k.conv2dTranspose(this,t,e,r,o,i)},n.prototype.depthwiseConv2D=function(t,e,r,o,i,a){return void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),k.depthwiseConv2d(this,t,e,r,o,i,a)},n.prototype.separableConv2d=function(t,e,r,o,i,a){return void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),k.separableConv2d(this,t,e,r,o,i,a)},n.prototype.avgPool=function(t,e,r,o){return this.throwIfDisposed(),k.avgPool(this,t,e,r,o)},n.prototype.maxPool=function(t,e,r,o){return this.throwIfDisposed(),k.maxPool(this,t,e,r,o)},n.prototype.localResponseNormalization=function(t,e,r,o){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===o&&(o=.5),k.localResponseNormalization(this,t,e,r,o)},n.prototype.pool=function(t,e,r,o,i){return this.throwIfDisposed(),k.pool(this,t,e,r,o,i)},n.prototype.variable=function(t,e,r){return void 0===t&&(t=!0),this.throwIfDisposed(),wr().makeVariable(this,t,e,r)},n.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),k.unsortedSegmentSum(this,t,e)},n.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),k.batchToSpaceND(this,t,e)},n.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),k.spaceToBatchND(this,t,e)},n.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),k.topk(this,t,e)},n.prototype.stridedSlice=function(t,e,r,o,i,a,s,u){return void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),this.throwIfDisposed(),k.stridedSlice(this,t,e,r,o,i,a,s,u)},n.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),k.depthToSpace(this,t,e)},n.prototype.fft=function(){return this.throwIfDisposed(),k.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),k.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),k.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),k.spectral.irfft(this)},n}();Object.defineProperty(Ke,Symbol.hasInstance,{value:function(n){return!!n&&null!=n.dataId&&null!=n.shape&&null!=n.dtype}});var __,Fp,kp,Pp,Op,n,la=function(n){function t(e,r,o,i){var a=n.call(this,e.shape,e.dtype,e.dataId,i)||this;return a.trainable=r,a.name=o,a}return Zn(t,n),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!bt(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");wr().disposeTensor(this),this.dataId=e.dataId,wr().incRef(this,null)},t.prototype.dispose=function(){wr().disposeVariable(this),this.isDisposedInternal=!0},t}(Ke);Object.defineProperty(la,Symbol.hasInstance,{value:function(n){return n instanceof Ke&&null!=n.assign&&n.assign instanceof Function}}),(n=__||(__={})).R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6",function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(Fp||(Fp={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(kp||(kp={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(Pp||(Pp={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(Op||(Op={}));var OL={float32:Pp,int32:Fp,bool:kp,complex64:Op};function Nt(n,t){if("string"===n||"string"===t){if("string"===n&&"string"===t)return"string";throw new Error("Can not upcast "+n+" with "+t)}return OL[n][t]}function Lp(n){return Nt(n,"int32")}function tt(n,t){if(n.dtype===t.dtype)return[n,t];var e=Nt(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function D_(n,t){C(n.dtype===t.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+t.dtype+") input must match"})}function Bp(n){var t=[];return function e(r,o,i){if(null!=r){if(r instanceof Ke)return void o.push(r);if(a=r,Array.isArray(a)||"object"==typeof a){var a,s=r;for(var u in s){var c=s[u];i.has(c)||(i.add(c),e(c,o,i))}}}}(n,t,new Set),t}Object.freeze({makeTypesMatch:tt,assertTypesMatch:D_,isTensorInList:function(n,t){return t.some(function(e){return e.id===n.id})},getTensorsInContainer:Bp});var Vp,C_=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},n}(),LL=function(){function n(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new C_}return n.prototype.ready=function(){return J(this,void 0,void 0,function(){var t,e,r;return Z(this,function(o){switch(o.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,o.label=1;case 1:return e<t.length?[4,this.initializeBackend(r=t[e]).success]:[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(t){return t in this.registry||t in this.registryFactory&&!this.initializeBackend(t).asyncInit?this.registry[t]:null},n.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},n.prototype.registerBackend=function(t,e,r){return void 0===r&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:r},!0)},n.prototype.setBackend=function(t){return J(this,void 0,void 0,function(){var e,r,o;return Z(this,function(i){switch(i.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new FL(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var t=this;i_(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)})},n.prototype.disposeRegisteredKernels=function(t){var e=this;i_(t).forEach(function(r){null!=r.disposeFunc&&r.disposeFunc(e.registry[t])})},n.prototype.initializeBackend=function(t){var e=this,r=this.registryFactory[t];if(null==r)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then(function(s){return!(i<e.pendingBackendInitId||(e.registry[t]=s,e.pendingBackendInit=null,0))}).catch(function(s){return!(i<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),1))});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[t]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return t.registryFactory[r].priority-t.registryFactory[e].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var r=t[e],o=this.initializeBackend(r),a=o.asyncInit;if(a||o.success)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(t,e){var r=this.state.tensorInfo.get(e),o=r.backend,i=this.readSync(e);o.disposeData(e),r.backend=t,t.move(e,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(t,e){var r,o=this,i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return o.startScope(i)},function(){return o.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(t,e,r){t();try{var o=r();return e(),o}catch(i){throw e(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype);return this.addTapeNode(this.state.activeScope.name,{x:t},[e],function(o){return{x:function(){return o.toFloat()}}},[]),e},n.prototype.runKernel=function(t,e,r,o,i){return this.runKernelFunc(null,e,null,t,r,o,i)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(t,e,r){var o=this.backend.numDataIds(),i=0;r.forEach(function(u){i+="complex64"===u.dtype?3:1});var s=o-e-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+t+"'")},n.prototype.runKernelFunc=function(t,e,r,o,i,a,s){var u,c=this;void 0===a&&(a=[]),void 0===s&&(s=[]);var l=[],d=this.isTapeOn();null==o&&(o=null!=this.state.activeScope?this.state.activeScope.name:"");var f,h=function(w){d&&(l=w.map(function(y){return c.keep(c.clone(y))}))},p=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,m=o_(o,this.backendName);return f=null!=m?function(){var w=c.backend.numDataIds();g=m.kernelFunc({inputs:e,attrs:i,backend:c.backend});var y=Array.isArray(g)?g:[g];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,w,y);var b=y.map(function(_){return c.makeTensorFromDataId(_.dataId,_.shape,_.dtype)}),x=b.filter(function(_,T){return s[T]});return h((a||[]).slice().concat(x)),b}:function(){var w=c.backend.numDataIds();g=c.tidy(function(){return t(c.backend,h)});var y=Array.isArray(g)?g:[g];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,w,y),y},this.scopedRun(function(){return c.state.kernelDepth++},function(){return c.state.kernelDepth--},function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,e,function(){return f()}):f()}),d&&this.addTapeNode(o,e,u,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(w){return e[w].shape}),outputShapes:u.map(function(w){return w.shape})}),Array.isArray(g)?u:u[0]},n.prototype.makeTensor=function(t,e,r,o){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");o=o||this.backend;var i=t;"string"===(r=r||"float32")&&Eo(t[0])&&(i=t.map(function(l){return m_(l)}));var a=o.write(i,e,r),s=new Ke(e,r,a,this.nextTensorId());if(this.incRef(s,o),"string"===r){var u=this.state.tensorInfo.get(a),c=p_(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(t,e,r,o){var i=new Ke(e,r=r||"float32",t,this.nextTensorId());return this.incRef(i,o),i},n.prototype.makeVariable=function(t,e,r,o){void 0===e&&(e=!0),r=r||this.nextVariableId().toString(),null!=o&&o!==t.dtype&&(t=t.asType(o));var i=new la(t,e,r,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.incRef=function(t,e){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===r){this.state.numDataBuffers++;var o=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(o=t.size*Ip(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof la||this.track(t)},n.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[t])},n.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},n.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},n.prototype.profile=function(t){return J(this,void 0,void 0,function(){var e,r;return Z(this,function(o){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(i){return i.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},n.prototype.addTapeNode=function(t,e,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:r,saved:i},u=function RL(n){return Is.get(n)}(t);null!=u&&(o=u.gradFunc),null!=o&&(s.gradient=function(c){return c=c.map(function(l,d){if(null==l){var f=r[d],h=ca(f.size,f.dtype);return a.makeTensor(h,f.shape,f.dtype)}return l}),o(c.length>1?c:c[0],i)}),this.state.activeTape.push(s)},n.prototype.keep=function(t){return t.kept=!0,t},n.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},n.prototype.endScope=function(t){for(var e=this,r=Bp(t),o=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},n.prototype.gradients=function(t,e,r,o){var i=this;if(void 0===o&&(o=!1),C(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=r&&"float32"!==r.dtype)throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",t)});C(a instanceof Ke,function(){return"The result y returned by f() must be a tensor."});var s=function(u,c,l){for(var d={},f={},h=0;h<c.length;h++)d[c[h].id]=!0;for(h=0;h<u.length;h++){var p=(_=u[h]).inputs;for(var v in p){for(var g=p[v],m=!1,w=0;w<c.length;w++)if(d[g.id]){_.outputs.forEach(function(I){return d[I.id]=!0}),m=!0,f[_.id]=!0;break}if(m)break}}var y={};y[l.id]=!0;var b={};for(h=u.length-1;h>=0;h--)for(p=(_=u[h]).inputs,w=0;w<_.outputs.length;w++)if(y[_.outputs[w].id]){for(var v in p)y[p[v].id]=!0,b[_.id]=!0;break}var x=[];for(h=0;h<u.length;h++){var _;if(f[(_=u[h]).id]&&b[_.id]){var T={};for(var v in _.inputs){var S=_.inputs[v];d[S.id]&&(T[v]=S)}var E=Object.assign({},_);E.inputs=T,E.outputs=_.outputs,x.push(E)}}return x}(this.state.activeTape,e,a);if(!o&&0===s.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,c,l={};l[a.id]=r??(c=Mp(ee(u=a.shape),"float32"),M.makeTensor(c,u,"float32")),function(f,h,p){for(var v=function(m){var w=h[m],y=[];if(w.outputs.forEach(function(T){var S=f[T.id];y.push(null!=S?S:null)}),null==w.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+w.kernelName+".");var b=w.gradient(y),x=function(T){if(!(T in b))throw new Error("Cannot backprop through input "+T+". Available gradients found: "+Object.keys(b)+".");var S=i.tidy(function(){return b[T]()});if("float32"!==S.dtype)throw new Error("Error in gradient for op "+w.kernelName+". The gradient of input "+T+" must have 'float32' dtype, but has '"+S.dtype+"'");var E=w.inputs[T];if(!bt(S.shape,E.shape))throw new Error("Error in gradient for op "+w.kernelName+". The gradient of input '"+T+"' has shape '"+S.shape+"', which does not match the shape of the input '"+E.shape+"'");if(null==f[E.id])f[E.id]=S;else{var I=f[E.id];f[E.id]=I.add(S),I.dispose()}};for(var _ in w.inputs)x(_)},g=h.length-1;g>=0;g--)v(g)}(l,s);var d=e.map(function(f){return l[f.id]});return 0===i.state.gradientDepth&&(i.state.activeTape.forEach(function(f){for(var h=0,p=f.saved;h<p.length;h++)p[h].dispose()}),i.state.activeTape=null),{value:a,grads:d}})},n.prototype.customGrad=function(t){var e=this;return C(Io(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];C(o.every(function(s){return s instanceof Ke}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return o.forEach(function(s,u){a[u]=s}),e.runKernelFunc(function(s,u){return C((r=t.apply(void 0,o.concat([u]))).value instanceof Ke,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),C(Io(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];C(l.length===o.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),C(l.every(function(f){return f instanceof Ke}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(f,h){d[h]=function(){return f}}),d})}},n.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},n.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},n.prototype.time=function(t){return J(this,void 0,void 0,function(){var e,r;return Z(this,function(o){switch(o.label){case 0:return e=tr(),[4,this.backend.time(t)];case 1:return(r=o.sent()).wallMs=tr()-e,[2,r]}})})},n.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new C_,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),M=function(){var n=function(){if(null==Vp){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}Vp=e}return Vp}();if(null==n._tfengine){var t=new ML(n);n._tfengine=new LL(t)}return r_=n._tfengine.ENV,wr=function(){return n._tfengine},n._tfengine}();function E_(){return typeof window<"u"&&null!=window.document||typeof WorkerGlobalScope<"u"}var Yr=P();Yr.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Yr.registerFlag("IS_BROWSER",function(){return E_()}),Yr.registerFlag("IS_NODE",function(){return typeof process<"u"&&void 0!==process.versions&&void 0!==process.versions.node}),Yr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Yr.registerFlag("PROD",function(){return!1}),Yr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Yr.getBool("DEBUG")}),Yr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Yr.registerFlag("IS_TEST",function(){return!1});var Fs,_n,Dn,ri={},Hp={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function I_(n,t){ri[n]=t}function xr(n){n in ri||(ri[n]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(o){if(typeof OffscreenCanvas<"u"&&2===o)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(o){o.preventDefault(),delete ri[e]},!1),1===e?r.getContext("webgl",Hp)||r.getContext("experimental-webgl",Hp):r.getContext("webgl2",Hp)}(n));var t=ri[n];return t.isContextLost()?(delete ri[n],xr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),ri[n])}function Uc(n,t){return[t,n]}function ks(n){var t=ee(n);return jc(Math.ceil(t/4))}function Ps(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function jp(n,t){var e,r,o,i,a,s,u,c,l,d=n;return 2===P().getNumber("WEBGL_VERSION")?(e=d.R32F,r=d.R16F,o=d.RGBA16F,i=d.RGBA32F,a=d.RED,s=4,u=1,c=d.HALF_FLOAT,l=d.FLOAT):(e=n.RGBA,r=n.RGBA,o=n.RGBA,i=d.RGBA,a=n.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=n.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function Q(n,t,e){var r=e();return t&&function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+T_(o,i))}(n),r}function S_(n){return!!(P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===n||5.96e-8<Math.abs(n)&&Math.abs(n)<65504)}function T_(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Os(n,t,e){return Qr(n,t,function(){return n.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function M_(n,t,e){var r=Qr(n,t,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Q(n,t,function(){return n.shaderSource(r,e)}),Q(n,t,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function A_(n,t,e){var r=Qr(n,t,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Q(n,t,function(){return n.shaderSource(r,e)}),Q(n,t,function(){return n.compileShader(r)}),!1===n.getShaderParameter(r,n.COMPILE_STATUS))throw function(o,i){var a=HL.exec(i);if(null==a)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split("\n"),c=u.length.toString().length+2,l=u.map(function(g,m){return ni((m+1).toString(),c)+g}),d=0,f=0;f<l.length;f++)d=Math.max(l[f].length,d);var h=l.slice(0,s-1),p=l.slice(s-1,s),v=l.slice(s);console.log(h.join("\n")),console.log(i.split("\n")[0]),console.log("%c "+ni(p[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join("\n"))}(e,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(Fs||(Fs={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(_n||(_n={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Dn||(Dn={}));var zc,Gc,HL=/ERROR: [0-9]+:([0-9]+):/g;function R_(n,t){return Qr(n,t,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function N_(n,t,e){if(Q(n,t,function(){return n.linkProgram(e)}),!1===n.getProgramParameter(e,n.LINK_STATUS))throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function qc(n,t,e){if(Q(n,t,function(){return n.validateProgram(e)}),!1===n.getProgramParameter(e,n.VALIDATE_STATUS))throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function F_(n,t,e){var r=Qr(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Q(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Q(n,t,function(){return n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function k_(n,t,e){var r=Qr(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Q(n,t,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),Q(n,t,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function P_(n,t){return Qr(n,t,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function O_(n,t){var e=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){var r="["+n+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>e||t>e)throw r="["+n+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+e+"x"+e+"].")}function L_(n,t){return Qr(n,t,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Wp(n,t,e,r,o,i,a,s){var u=n.getAttribLocation(e,r);return-1!==u&&(Q(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,o)}),Q(n,t,function(){return n.vertexAttribPointer(u,i,n.FLOAT,!1,a,s)}),Q(n,t,function(){return n.enableVertexAttribArray(u)}),!0)}function B_(n,t,e,r){U_(n,r),Q(n,t,function(){return n.activeTexture(n.TEXTURE0+r)}),Q(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)})}function V_(n,t,e,r){return Qr(n,t,function(){return n.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function H_(n,t,e){return n.getUniformLocation(t,e)}function j_(n,t,e,r,o,i){Q(n,t,function(){return B_(n,t,r,i)}),Q(n,t,function(){return n.uniform1i(o,i)})}function $c(n,t,e,r){Q(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),Q(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)})}function Up(n,t,e){Q(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)}),Q(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function Ls(n){var t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+W_(n,t))}function W_(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function Qr(n,t,e,r){var o=Q(n,t,function(){return e()});if(null==o)throw new Error(r);return o}function U_(n,t){var e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+n.TEXTURE0;if(r<n.TEXTURE0||r>e)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+e+"].")}function Bs(n,t){return void 0===t&&(t=2),ee(n.slice(0,n.length-t))}function Vs(n){if(0===n.length)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Kc(n){var t=[1,1,1];return 0===n.length||1===n.length&&1===n[0]||(t=[Bs(n)].concat(Vs(n))),t}function z_(n,t){var e;void 0===t&&(t=!1);var r=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(n=n.map(function(c,l){return l>=n.length-2?Cp(n[l]):n[l]})).length&&(n=[2,n[0]])),2!==n.length){var o=Co(n);n=o.newShape}var i=ee(n);if(n.length<=1&&i<=r)return[1,i];if(2===n.length&&n[0]<=r&&n[1]<=r)return n;if(3===n.length&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(3===n.length&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(4===n.length&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(4===n.length&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(t){var a=Bs(n),s=2,u=2;return n.length&&(s=(e=Vs(n))[0],u=e[1]),jc(i=a*(s/2)*(u/2)).map(function(c){return 2*c})}return jc(i)}function Xc(n){return n%2==0}function Hs(n,t){if(bt(n=n.slice(-2),t=t.slice(-2))||!n.length||!t.length||0===n[0]||0===n[1]||0===t[0]||0===t[1])return!0;if(n.length!==t.length){var e=n.slice(-1)[0],r=t.slice(-1)[0];if(e===r||Xc(e)&&Xc(r)&&(1===n[0]||1===t[0]))return!0}return n[1]===t[1]&&Xc(n[0])&&Xc(t[0])}function G_(n){if(null==zc){var t=xr(n);zc=t.getParameter(t.MAX_TEXTURE_SIZE)}return zc}function q_(n){if(null==Gc){var t=xr(n);Gc=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Gc)}function $_(n){if(0===n)return 0;var t=xr(n);return Cn(t,"EXT_disjoint_timer_query_webgl2")&&2===n?2:Cn(t,"EXT_disjoint_timer_query")?1:0}function Cn(n,t){return null!=n.getExtension(t)}function zp(n){try{if(null!=xr(n))return!0}catch{return!1}return!1}function K_(n){if(0===n)return!1;var t=xr(n);if(1===n){if(!Cn(t,"OES_texture_float"))return!1}else if(!Cn(t,"EXT_color_buffer_float"))return!1;return Gp(t)}function X_(n){if(0===n)return!1;var t=xr(n);if(1!==n){if(Cn(t,"EXT_color_buffer_float"))return Gp(t);if(Cn(t,"EXT_color_buffer_half_float")){var e=t.getExtension("EXT_color_buffer_half_float");return function(r,o){var i=jp(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(t,e)}return!1}return!!Cn(t,"OES_texture_float")&&!!Cn(t,"WEBGL_color_buffer_float")&&Gp(t)}function Gp(n){var t=jp(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(r),o}function Y_(n){return 2===n&&null!=xr(n).fenceSync}var jL=Object.freeze({callAndCheck:Q,canBeRepresented:S_,getWebGLErrorMessage:T_,getExtensionOrThrow:Os,createVertexShader:M_,createFragmentShader:A_,createProgram:R_,linkProgram:N_,validateProgram:qc,createStaticVertexBuffer:F_,createStaticIndexBuffer:k_,getNumChannels:function(){return 2===P().getNumber("WEBGL_VERSION")?1:4},createTexture:P_,validateTextureSize:O_,createFramebuffer:L_,bindVertexBufferToProgramAttribute:Wp,bindTextureUnit:B_,unbindTextureUnit:function(n,t,e){U_(n,e),Q(n,t,function(){return n.activeTexture(n.TEXTURE0+e)}),Q(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:V_,getProgramUniformLocation:H_,bindTextureToProgramUniformSampler:j_,bindCanvasToFramebuffer:function(n,t){Q(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),Q(n,t,function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)}),Q(n,t,function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)})},bindColorTextureToFramebuffer:$c,unbindColorTextureFromFramebuffer:Up,validateFramebuffer:Ls,getFramebufferErrorMessage:W_,getBatchDim:Bs,getRowsCols:Vs,getShapeAs3D:Kc,getTextureShapeFromLogicalShape:z_,isReshapeFree:Hs,getWebGLMaxTextureSize:G_,resetMaxTextureSize:function(){zc=null},resetMaxTexturesInShader:function(){Gc=null},getMaxTexturesInShader:q_,getWebGLDisjointQueryTimerVersion:$_,hasExtension:Cn,isWebGLVersionEnabled:zp,isCapableOfRenderingToFloatTexture:K_,isDownloadFloatTextureEnabled:X_,isWebGLFenceEnabled:Y_}),le=P();function Q_(n){P().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Y(n,t){return M.tidy(n,t)}function ln(n){Bp(n).forEach(function(t){return t.dispose()})}function Yc(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];P().getBool("IS_TEST")||console.warn.apply(console,n)}function _r(n,t){var e=n;if(Lt(n))return"string"===t?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(e)||Lt(e)&&"string"!==t;)r.push(e.length),e=e[0];return Array.isArray(n)&&P().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function o(i,a,s){if(s=s||[],Array.isArray(i)||Lt(i)){C(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),C(i.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"});for(var u=a.slice(1),c=0;c<i.length;++c)o(i[c],u,s.concat(c))}else C(0===a.length,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"})}(n,r,[]),r}function J_(n,t,e,r){if(null!=n&&("numeric"!==n&&n!==t||"numeric"===n&&"string"===t))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+n+" tensor, but got "+t+" tensor")}function D(n,t,e,r){if(void 0===r&&(r="numeric"),n instanceof Ke)return J_(r,n.dtype,t,e),n;var o=ua(n);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),J_(r,o,t,e),null==n||!Lt(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+(null==n?"null":n.constructor.name)+"'");var a=_r(n,o);Lt(n)||Array.isArray(n)||(n=[n]);var s="string"!==o?Sp(n,o,P().getBool("DEBUG")):Xr(n,[],!0);return M.makeTensor(s,a,o)}function js(n,t,e,r){if(void 0===r&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(o,i){return D(o,t+"["+i+"]",e)},r)}function qp(n,t){for(var e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function Z_(n,t,e){for(var r=n.length+t.length,o=[],i=0,a=0,s=0;s<r;s++)-1===e.indexOf(s)?o.push(n[i++]):o.push(t[a++]);return o}function Bt(n,t){for(var e=[],r=n.length,o=0;o<r;o++)-1===t.indexOf(o)&&e.push(n[o]);return[e,t.map(function(i){return n[i]})]}function rn(n,t){return Z_(n,t.map(function(e){return 1}),t)}function dn(n,t,e){C(qp(t,e),function(){return n+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."})}function nr(n,t){if(qp(n,t))return null;for(var e=[],r=0;r<t;++r)-1===n.indexOf(r)&&e.push(r);return n.forEach(function(o){return e.push(o)}),e}function Qc(n){return n.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function rr(n,t){for(var e=[],r=t-n;r<t;++r)e.push(r);return e}function eD(n,t){var e=n[0].length;n.forEach(function(o,i){C(o.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+e+")"})}),C(t>=0&&t<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=n[0];n.forEach(function(o,i){for(var a=0;a<e;a++)C(a===t||o[a]===r[a],function(){return"Error in concat"+e+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}function oi(n,t){for(var e=n[0].slice(),r=1;r<n.length;r++)e[t]+=n[r][t];return e}function A(n){var t=Object.keys(n);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],r=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];M.startScope(e);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),M.endScope(s),s}catch(u){throw M.endScope(null),u}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}le.registerFlag("HAS_WEBGL",function(){return le.getNumber("WEBGL_VERSION")>0}),le.registerFlag("WEBGL_VERSION",function(){return zp(2)?2:zp(1)?1:0}),le.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===le.get("WEBGL_VERSION")}),le.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),le.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),le.registerFlag("WEBGL_PACK",function(){return le.getBool("HAS_WEBGL")}),le.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_CLIP",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),le.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_PACK_REDUCE",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_LAZILY_UNPACK",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_CONV_IM2COL",function(){return le.getBool("WEBGL_PACK")}),le.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return G_(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return q_(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=le.getNumber("WEBGL_VERSION");return 0===n?0:$_(n)}),le.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return le.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),le.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return K_(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!le.getBool("WEBGL_FORCE_F16_TEXTURES")&&le.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),le.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return X_(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Y_(le.getNumber("WEBGL_VERSION"))}),le.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return le.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),x_=Q_;var Vt=A({complex_:function(n,t){var e=D(n,"real","complex"),r=D(t,"imag","complex");return Fe(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),M.runKernelFunc(function(o){return o.complex(e,r)},{$real:e,$imag:r})}}),Ln=A({real_:function(n){var t=D(n,"input","real");return M.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),Dr=A({imag_:function(n){var t=D(n,"input","imag");return M.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function Ht(n,t,e){return So(n,t,_r(n,e),e)}function So(n,t,e,r){if(null==r&&(r=ua(n)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Lt(n)&&!Array.isArray(n)&&"number"!=typeof n&&"boolean"!=typeof n&&"string"!=typeof n)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Ap(t);var o=ee(t),i=ee(e);C(o===i,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<e.length;++a){var u=a!==e.length-1||e[a]!==ee(t.slice(a));C(e[a]===t[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+t+"). "})}}return Lt(n)||Array.isArray(n)||(n=[n]),t=t||e,n="string"!==r?Sp(n,r,P().getBool("DEBUG")):Xr(n,[],!0),M.makeTensor(n,t,r)}function q(n,t){if((Lt(n)&&"string"!==t||Array.isArray(n))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Lt(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return So(n,[],[],t)}function xt(n,t){ti(n);var e=_r(n,t);if(1!==e.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return So(n,null,e,t)}function To(n,t,e){if(ti(n),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=_r(n,e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return So(n,t,r,e)}function $p(n,t,e){if(ti(n),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=_r(n,e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return So(n,t,r,e)}function fn(n,t,e){if(ti(n),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=_r(n,e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return So(n,t,r,e)}function da(n,t){if(void 0===t&&(t="float32"),"complex64"===t){var e=da(n,"float32"),r=Ze(n,"float32");return Vt(e,r)}var o=Mp(ee(n),t);return M.makeTensor(o,n,t)}function Ze(n,t){if(void 0===t&&(t="float32"),"complex64"===t){var e=Ze(n,"float32"),r=Ze(n,"float32");return Vt(e,r)}var o=ca(ee(n),t);return M.makeTensor(o,n,t)}function Cr(n,t,e){return M.runKernelFunc(function(r){return r.fill(n,t,e)},{})}function Jc(n,t,e,r){if(void 0===e&&(e=1),void 0===r&&(r="float32"),0===e)throw new Error("Cannot have a step of zero");if(n===t||n<t&&e<0||t<n&&e>1)return Ze([0],r);var o=ca(Math.abs(Math.ceil((t-n)/e)),r);t<n&&1===e&&(e=-1),o[0]=n;for(var i=1;i<o.length;i++)o[i]=o[i-1]+e;return xt(o,r)}var tD=A({onesLike_:function(n){var t=D(n,"x","onesLike");if("complex64"===t.dtype){var e=tD(Ln(t)),r=ke(Dr(t));return Vt(e,r)}return M.runKernelFunc(function(o){return o.onesLike(t)},{$x:t},function(o,i){return{$x:function(){return ke(o)}}})}}),ke=A({zerosLike_:function(n){var t=D(n,"x","zerosLike");return M.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,r){return{$x:function(){return ke(e)}}})}}),St=A({concat_:function(n,t){void 0===t&&(t=0),C(n.length>=1,function(){return"Pass at least one tensor to concat"});var e=js(n,"tensors","concat");"complex64"===e[0].dtype&&e.forEach(function(s){if("complex64"!==s.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+s.dtype+". ")}),t=wt(t,e[0].shape)[0];var r=oi(e.map(function(s){return s.shape}),t);if(0===ee(r))return Ht([],r);if(1===(e=e.filter(function(s){return s.size>0})).length)return e[0];var o=e.map(function(s){return s.shape});return eD(o,t),M.runKernelFunc(function(s){return s.concat(e,t)},e,function(s){var u=o.map(function(c){return c[t]});return Kp(s,u,t).map(function(c){return function(){return c}})},"Concat",{axis:t})}}),$L=A({concat1d_:function(n){return St(n,0)}}),KL=A({concat2d_:function(n,t){return St(n,t)}}),XL=A({concat3d_:function(n,t){return St(n,t)}}),YL=A({concat4d_:function(n,t){return St(n,t)}}),Kp=A({split_:function(n,t,e){void 0===e&&(e=0);var r,o=D(n,"x","split");return e=wt(e,o.shape)[0],"number"==typeof t?(C(o.shape[e]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(o.shape[e]/t)):(C(o.shape[e]===t.reduce(function(i,a){return i+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),M.runKernelFunc(function(i){return i.split(o,r,e)},{$x:o},function(i){return{$x:function(){return St(i,e)}}})}});function ii(n,t){return n(t={exports:{}},t.exports),t.exports}typeof globalThis<"u"||typeof window<"u"||typeof global<"u"&&global;var QL=ii(function(n){!function(t,e,r){function o(s){var u,c=this,l=(u=4022871197,function(d){d=d.toString();for(var f=0;f<d.length;f++){var h=.02519603282416938*(u+=d.charCodeAt(f));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 2.3283064365386963e-10*(u>>>0)});c.next=function(){var d=2091639*c.s0+2.3283064365386963e-10*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=0|d)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new o(s),l=u&&u.state,d=c.next;return d.int32=function(){return 4294967296*c.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.alea=a}(0,n)}),JL=ii(function(n){!function(t,e,r){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xor128=a}(0,n)}),ZL=ii(function(n){!function(t,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xorwow=a}(0,n)}),eB=ii(function(n){!function(t,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.x,f=u.i;return c=d[f],l=(c^=c>>>7)^c<<24,l^=(c=d[f+1&7])^c>>>10,l^=(c=d[f+3&7])^c>>>3,l^=(c=d[f+4&7])^c<<7,c=d[f+7&7],l^=(c^=c<<13)^c<<9,d[f]=l,u.i=f+1&7,l},function(c,l){var d,f=[];if(l===(0|l))f[0]=l;else for(l=""+l,d=0;d<l.length;++d)f[7&d]=f[7&d]<<15^l.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&0===f[d];++d);for(8==d&&(f[7]=-1),c.x=f,c.i=0,d=256;d>0;--d)c.next()}(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.x&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xorshift7=a}(0,n)}),tB=ii(function(n){!function(t,e,r){function o(s){var u=this;u.next=function(){var c,l,d=u.w,f=u.X,h=u.i;return u.w=d=d+1640531527|0,l=f[h+34&127],c=f[h=h+1&127],l^=l<<13,c^=c<<17,l=f[h]=(l^=l>>>15)^(c^=c>>>12),u.i=h,l+(d^d>>>16)|0},function(c,l){var d,f,h,p,v,g=[],m=128;for(l===(0|l)?(f=l,l=null):(l+="\0",f=0,m=Math.max(m,l.length)),h=0,p=-32;p<m;++p)l&&(f^=l.charCodeAt((p+32)%l.length)),0===p&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(h=0==(d=g[127&p]^=f+(v=v+1640531527|0))?h+1:0);for(h>=128&&(g[127&(l&&l.length||0)]=-1),h=127,p=512;p>0;--p)f=g[h+34&127],d=g[h=h+1&127],f^=f<<13,d^=d<<17,g[h]=(f^=f>>>15)^(d^=d>>>12);c.w=v,c.X=g,c.i=h}(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){null==s&&(s=+new Date);var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&(l.X&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.xor4096=a}(0,n)}),nB=ii(function(n){!function(t,e,r){function o(s){var u=this,c="";u.next=function(){var d=u.b,f=u.c,h=u.d,p=u.a;return d=d<<25^d>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-d|0,u.b=d=d<<20^d>>>12^f,u.c=f=f-h|0,u.d=h<<16^f>>>16^p,u.a=p-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do{var f=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152}while(0===f);return f},d.int32=c.next,d.quick=d,l&&("object"==typeof l&&i(l,c),d.state=function(){return i(c,{})}),d}e&&e.exports?e.exports=a:this.tychei=a}(0,n)}),ai=ii(function(n){!function(t,e){var r,o=this,i=256,s="random",u=e.pow(i,6),c=e.pow(2,52),l=2*c,d=255;function f(m,w,y){var b=[],x=v(function S(E,I){var N,R=[],B=typeof E;if(I&&"object"==B)for(N in E)try{R.push(S(E[N],I-1))}catch{}return R.length?R:"string"==B?E:E+"\0"}((w=1==w?{entropy:!0}:w||{}).entropy?[m,g(t)]:m??function(){try{var S;return r&&(S=r.randomBytes)?S=S(i):(S=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(S)),g(S)}catch{var E=o.navigator,I=E&&E.plugins;return[+new Date,o,I,o.screen,g(t)]}}(),3),b),_=new h(b),T=function(){for(var S=_.g(6),E=u,I=0;S<c;)S=(S+I)*i,E*=i,I=_.g(1);for(;S>=l;)S/=2,E/=2,I>>>=1;return(S+I)/E};return T.int32=function(){return 0|_.g(4)},T.quick=function(){return _.g(4)/4294967296},T.double=T,v(g(_.S),t),(w.pass||y||function(S,E,I,N){return N&&(N.S&&p(N,_),S.state=function(){return p(_,{})}),I?(e[s]=S,E):S})(T,x,"global"in w?w.global:this==e,w.state)}function h(m){var w,y=m.length,b=this,x=0,_=b.i=b.j=0,T=b.S=[];for(y||(m=[y++]);x<i;)T[x]=x++;for(x=0;x<i;x++)T[x]=T[_=d&_+m[x%y]+(w=T[x])],T[_]=w;(b.g=function(S){for(var E,I=0,N=b.i,R=b.j,B=b.S;S--;)E=B[N=d&N+1],I=I*i+B[d&(B[N]=B[R=d&R+E])+(B[R]=E)];return b.i=N,b.j=R,I})(i)}function p(m,w){return w.i=m.i,w.j=m.j,w.S=m.S.slice(),w}function v(m,w){for(var y,b=m+"",x=0;x<b.length;)w[d&x]=d&(y^=19*w[d&x])+b.charCodeAt(x++);return g(w)}function g(m){return String.fromCharCode.apply(0,m)}if(e["seed"+s]=f,v(e.random(),t),n.exports){n.exports=f;try{r=Ra(902)}catch{}}}([],Math)});ai.alea=QL,ai.xor128=JL,ai.xorwow=ZL,ai.xorshift7=eB,ai.xor4096=tB,ai.tychei=nB;var Zc=ai.alea,Xp=function(){function n(t,e,r,o,i){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Zc(a.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do{s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a}while(s>=1||0===s);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(e)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},n.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},n.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},n}(),rB=function(){function n(t,e,r,o){this.alpha=t,this.beta=1/e,this.dtype=r;var i=o||Math.random();this.randu=Zc(i.toString()),this.randn=new Xp(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var t,e,r,o,i,a;;){do{o=this.randn.nextValue(),a=1+this.c*o}while(a<=0);if(e=1-.331*(t=o*o)*t,r=.5*t+this.d*(1-(a*=a*a)+Math.log(a)),(i=this.randu())<e||Math.log(i)<r)break}return a*=1/this.beta*this.d,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},n.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},n}(),oB=function(){function n(t,e,r,o){var i=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=t,this.range=e-t,this.dtype=r,null==o&&(o=Math.random()),"number"==typeof o&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Zc(o)}return n.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function ve(n,t,e){return void 0===t&&(t="float32"),t=t||"float32",Ap(n),new Ns(n,t,e)}var nD=A({batchToSpaceND_:function(n,t,e){var r=D(n,"x","batchToSpaceND"),o=t.reduce(function(i,a){return i*a});return C(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),C(e.length===t.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length}),C(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+o}),M.runKernelFunc(function(i){return i.batchToSpaceND(r,t,e)},{$x:r},function(i){return{$x:function(){return i.spaceToBatchND(t,e)}}})}}),aB=A({broadcastTo_:function(n,t){var e=D(n,"broadcastTo","x"),r=e.shape;if(t.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<e.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+e.rank+".");if(t.length>e.rank){for(var o=e.shape.slice();o.length<t.length;)o.unshift(1);e=e.reshape(o)}for(var i=Array.from(t),a=t.length-1;a>=0;a--)if(e.shape[a]===t[a])i[a]=1;else if(1!==e.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=i.map(function(u,c){return u>1?c:-1}).filter(function(u){return u>=0});return 0===s.length?e.clone():M.runKernelFunc(function(u){return u.tile(e,i)},{input:e},function(u){return{input:function(){return u.sum(s,!0)}}})}}),sB=A({cast_:function(n,t){var e=D(n,"x","cast");if(!f_(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==e.dtype||"string"!==t&&"string"===e.dtype)throw new Error("Only strings can be casted to strings");return M.runKernelFunc(function(o){return o.cast(e,t)},{x:e},function(o){return{x:function(){return o.clone()}}},"Cast",{dtype:t})}}),uB=A({clone_:function(n){var t=D(n,"x","clone",null);return M.runKernelFunc(function(){return M.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),cB=A({cumsum_:function(n,t,e,r){void 0===t&&(t=0),void 0===e&&(e=!1),void 0===r&&(r=!1);var o=D(n,"x","cumsum"),i=nr([t|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=rr(1,o.rank)[0],u=M.runKernelFunc(function(c){return c.cumsum(a,s,e,r)},{permutedX:a},function(c){return{permutedX:function(){return c.cumsum(t,e,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),lB=A({depthToSpace_:function(n,t,e){void 0===e&&(e="NHWC");var r=D(n,"x","depthToSpace"),o="NHWC"===e?r.shape[1]:r.shape[2],i="NHWC"===e?r.shape[2]:r.shape[3],a="NHWC"===e?r.shape[3]:r.shape[1];return C(o*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+"  for depthToSpace with input shape\n      "+r.shape}),C(i*t>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+" for depthToSpace with input shape\n          "+r.shape}),C(a%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+a+" for depthToSpace with input shape "+r.shape}),M.runKernelFunc(function(s){return s.depthToSpace(r,t,e)},{$x:r})}}),Bn=A({expandDims_:function(n,t){void 0===t&&(t=0);var e=D(n,"x","expandDims",null);C(t<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return t<0&&(C(-(e.rank+1)<=t,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),t=e.rank+t+1),r.splice(t,0,1),or(e,r)}}),rD=A({eye_:function(n,t,e,r){void 0===r&&(r="float32"),null==t&&(t=n);for(var o=ve([n,t],r),i=n<=t?n:t,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(n,t);if(null==e)return s;if(1===e.length)return fa(Bn(s,0),[e[0],1,1]);if(2===e.length)return fa(Bn(Bn(s,0),0),[e[0],e[1],1,1]);if(3===e.length)return fa(Bn(Bn(Bn(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),dB=A({multinomial_:function(n,t,e,r){void 0===r&&(r=!1);var o=D(n,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);e=e||Math.random();var s=1===a?o.as2D(1,-1):o,u=M.runKernelFunc(function(c){return c.multinomial(s,r,t,e)},{logits2D:s});return 1===a?u.as1D():u}}),Yp=A({oneHot_:function(n,t,e,r){if(void 0===e&&(e=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var o=D(n,"indices","oneHot","int32"),i=o.shape.concat([t]);return o=o.flatten(),M.runKernelFunc(function(a){return a.oneHot(o,t,e,r)},{$indices:o},function(a){return{$indices:function(){return Ze(o.shape,"float32")}}}).reshape(i)}}),si=A({pad_:function(n,t,e){void 0===e&&(e=0);var r=D(n,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return M.runKernelFunc(function(i){return i.pad(r,t,e)},{x:r},function(i){var a=t.map(function(s){return s[0]});return{x:function(){return i.slice(a,r.shape)}}},"PadV2",{paddings:t,constantValue:e})}}),fB=A({pad1d_:function(n,t,e){return void 0===e&&(e=0),C(2===t.length,function(){return"Invalid number of paddings. Must be length of 2."}),si(n,[t],e)}}),hB=A({pad2d_:function(n,t,e){return void 0===e&&(e=0),C(2===t.length&&2===t[0].length&&2===t[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),si(n,t,e)}}),pB=A({pad3d_:function(n,t,e){return void 0===e&&(e=0),C(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),si(n,t,e)}}),vB=A({pad4d_:function(n,t,e){return void 0===e&&(e=0),C(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),si(n,t,e)}}),gB=A({rand_:function(n,t,e){var r=ee(n),o=null;if(null==e||"float32"===e)o=new Float32Array(r);else if("int32"===e)o=new Int32Array(r);else{if("bool"!==e)throw new Error("Unknown data type "+e);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=t();return M.makeTensor(o,n,e)}}),mB=A({randomNormal_:function(n,t,e,r,o){if(void 0===t&&(t=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Xp(t,e,r,!1,o),a=ve(n,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),yB=A({randomGamma_:function(n,t,e,r,o){if(void 0===e&&(e=1),void 0===r&&(r="float32"),null==e&&(e=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new rB(t,e,r,o),a=ve(n,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),oD=A({randomUniform_:function(n,t,e,r,o){void 0===t&&(t=0),void 0===e&&(e=1),void 0===r&&(r="float32");for(var i=ve(n,r),a=new oB(t,e,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),or=A({reshape_:function(n,t){var e=D(n,"x","reshape",null);return t=l_(t,e.size),C(e.size===ee(t),function(){return"new shape and old shape must have the same number of elements."}),M.runKernelFunc(function(o){return o.reshape(e,t)},{x:e},function(o){return{x:function(){return o.reshape(e.shape)}}},"Reshape",{shape:t})}}),iD=A({spaceToBatchND_:function(n,t,e){var r=D(n,"x","spaceToBatchND");return C(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),C(e.length===t.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length}),C(r.shape.reduce(function(o,i,a){return a>0&&a<=t.length?o&&(i+e[a-1][0]+e[a-1][1])%t[a-1]==0:o},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()}),M.runKernelFunc(function(o){return o.spaceToBatchND(r,t,e)},{$x:r},function(o){return{$x:function(){return o.batchToSpaceND(t,e)}}})}}),aD=A({squeeze_:function(n,t){var e=D(n,"x","squeeze");return or(e,Co(e.shape,t).newShape)}}),En=A({stack_:function(n,t){void 0===t&&(t=0);var e=js(n,"tensors","stack");if(C(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===e.length)return e[0].expandDims(t);var o=e[0].shape,i=e[0].dtype;C(t<=e[0].rank,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){Fe(o,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){C(i===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=e.map(function(s){return s.expandDims(t)});return St(a,t)}}),fa=A({tile_:function(n,t){var e=D(n,"x","tile",null);return C(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."}),M.runKernelFunc(function(i,a){var s=i.tile(e,t);return a([e]),s},{x:e},function(i,a){var s=a[0];return{x:function(){var u=ke(s);if(1===s.rank)for(var c=0;c<t[0];++c)u=u.add(i.slice([c*s.shape[0]],[s.shape[0]]));else if(2===s.rank)for(c=0;c<t[0];++c)for(var l=0;l<t[1];++l)u=u.add(i.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(3===s.rank)for(c=0;c<t[0];++c)for(l=0;l<t[1];++l)for(var d=0;d<t[2];++d)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(4!==s.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<t[0];++c)for(l=0;l<t[1];++l)for(d=0;d<t[2];++d)for(var f=0;f<t[3];++f)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],d*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",{reps:t},[e])}}),bB=A({truncatedNormal_:function(n,t,e,r,o){if(void 0===t&&(t=0),void 0===e&&(e=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Xp(t,e,r,!0,o),a=ve(n,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Tt=A({unstack_:function(n,t){void 0===t&&(t=0),t=t||0;var e=D(n,"x","unstack");return C(t>=-e.shape.length&&t<e.shape.length,function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),t<0&&(t+=e.shape.length),M.runKernelFunc(function(o){return o.unstack(e,t)},{x:e},function(o){return{x:function(){return En(o,t)}}},"Unpack",{axis:t})}});function el(n,t,e,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(t.slice(0))).push(n[0]/e),o=o.concat(n.slice(1));else{o=o.concat(n[0]);for(var i=t.length,a=0;a<i;++a)o=o.concat([n[a+1]/t[a],t[a]]);o=o.concat(n.slice(i+1))}return o}function tl(n,t,e){void 0===e&&(e=!0);var r=[];if(e){r.push(t);for(var o=t+1;o<n;++o)o<=2*t?(r.push(o),r.push(o-(t+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<n;++o)o>=2*t+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function nl(n,t,e,r){void 0===r&&(r=!0);var o=[];o.push(r?n[0]/e:n[0]*e);for(var i=1;i<n.length;++i)o.push(i<=t.length?r?t[i-1]*n[i]:n[i]/t[i-1]:n[i]);return o}function sD(n,t){for(var e=[0],r=0;r<t;++r)e.push(n[r][0]);return e}function uD(n,t,e){for(var r=n.slice(0,1),o=0;o<e;++o)r.push(n[o+1]-t[o][0]-t[o][1]);return r}function Qp(n,t){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+n.rank);if(0===n.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var e=t.shape,r=e[e.length-1],o=1,i=0;i<e.length-1;++i)o*=e[i];var a=n.shape,s=e.slice();s.pop();var u=1;for(i=r;i<n.rank;++i)u*=a[i],s.push(a[i]);var c=er(n.shape).map(function(l){return l/u}).concat([1]).slice(0,r);return[s,o,u,c]}function rl(n){return n<=30?n:Wc(n,Math.floor(Math.sqrt(n)))}function cD(n,t,e){var r=t.rank>1?t.shape[t.rank-1]:1,o=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+t.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+o+".";if(e.rank<o)throw new Error(i+" update.rank < "+o+". ");if(n.length<r+(e.rank-o))throw new Error(i+" Output shape length < "+(r+(e.rank-o)));if(e.rank!==o+n.length-r)throw new Error(i+" update.rank != "+(o+n.length-r));for(var a=0;a<o;++a)if(e.shape[a]!==t.shape[a])throw new Error(i+" updates.shape["+a+"] ("+e.shape[a]+") != indices.shape["+a+"] ("+t.shape[a]+").");for(a=0;a<e.rank-o;++a)if(e.shape[a+o]!==n[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+e.shape[a+o]+") != shape["+(a+o)+"] ("+n[a+o]+")")}function lD(n,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(0===e.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===n.size)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}cD(e,t,n)}function Ws(n,t,e){for(var r=t.shape.length,o=r>1?t.shape[r-1]:1,i=e.length,a=1,s=o;s<i;++s)a*=e[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:ee(t.shape)/u,sliceSize:a,strides:er(e.slice(0,o)).concat([1]),outputSize:ee(e)}}function dD(n,t,e){C(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+t+" must match the rank of the array ("+n.rank+")."}),C(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of size "+e+" must match the rank of the array ("+n.rank+")."});for(var r=function(i){C(t[i]+e[i]<=n.shape[i],function(){return"Error in slice"+n.rank+"D: begin["+i+"] + size["+i+"] ("+(t[i]+e[i])+") would overflow input.shape["+i+"] ("+n.shape[i]+")"})},o=0;o<n.rank;++o)r(o)}function Zp(n){for(var t=[],e=0;n>0;)1&n&&t.push(e),n/=2,e++;return t}function ol(n,t,e){for(var r=[],o=0;o<n.length;o++)r[o]=Math.ceil((t[o]-n[o])/e[o]);return r}function fD(n,t,e,r,o){var i=t[o];(n&1<<o||null==i)&&(i=(e[o]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),Hc(0,i,s-1)}function hD(n,t,e,r,o){var i=t[o],a=e[o]||1;(n&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?Hc(0,i,s):Hc(-1,i,s-1)}function ev(n,t,e){for(var r=e.length,o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(o=r+1;o<e.length;o++)if(t[o]>0||e[o]!==n[o])return!1;return!0}function tv(n,t){for(var e=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)e+=n[r]*t[r];return e}function il(n){return M.customGrad(n)}Object.freeze({prepareAndValidate:Qp}),Object.freeze({validateUpdateShape:cD,validateInput:lD,calculateShapes:Ws}),Object.freeze({assertParamsValid:dD,maskToAxes:Zp,computeOutShape:ol,startForAxis:fD,stopForAxis:hD,isSliceContinous:ev,computeFlatOffset:tv});var Jr=A({softmax_:function(n,t){void 0===t&&(t=-1);var e=D(n,"logits","softmax","float32");if(-1===t&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return M.runKernelFunc(function(r,o){var i=r.softmax(e,t);return o([i]),i},{logits:e},function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([t],!0).mul(i))}}},"Softmax",{dim:t},[],[!0])}}),_B=A({logSoftmax_:function(n,t){void 0===t&&(t=-1);var e=D(n,"logits","logSoftmax");if(-1===t&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return il(function(r,o){var i=r.max(t,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(t,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(t,!0).mul(l))}}})(e)}}),pD=function(){function n(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},n.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},n.prototype.has=function(t){return this.data.has(t)},n.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),vD=function(){function n(){}return n.prototype.time=function(t){return F("time")},n.prototype.read=function(t){return F("read")},n.prototype.readSync=function(t){return F("readSync")},n.prototype.numDataIds=function(){return F("numDataIds")},n.prototype.disposeData=function(t){return F("disposeData")},n.prototype.write=function(t,e,r){return F("write")},n.prototype.move=function(t,e,r,o){return F("move")},n.prototype.memory=function(){return F("memory")},n.prototype.floatPrecision=function(){return F("floatPrecision")},n.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},n.prototype.batchMatMul=function(t,e,r,o){return F("batchMatMul")},n.prototype.fusedBatchMatMul=function(t){return F("fusedBatchMatMul")},n.prototype.slice=function(t,e,r){return F("slice")},n.prototype.stridedSlice=function(t,e,r,o){return F("stridedSlice")},n.prototype.unstack=function(t,e){return F("unstack")},n.prototype.reverse=function(t,e){return F("reverse")},n.prototype.concat=function(t,e){return F("concat")},n.prototype.neg=function(t){return F("neg")},n.prototype.add=function(t,e){return F("add")},n.prototype.addN=function(t){return F("addN")},n.prototype.subtract=function(t,e){return F("subtract")},n.prototype.multiply=function(t,e){return F("multiply")},n.prototype.realDivide=function(t,e){return F("realDivide")},n.prototype.floorDiv=function(t,e){return F("floorDiv")},n.prototype.sum=function(t,e){return F("sum")},n.prototype.prod=function(t,e){return F("prod")},n.prototype.unsortedSegmentSum=function(t,e,r){return F("unsortedSegmentSum")},n.prototype.argMin=function(t,e){return F("argMin")},n.prototype.argMax=function(t,e){return F("argMax")},n.prototype.equal=function(t,e){return F("equal")},n.prototype.notEqual=function(t,e){return F("notEqual")},n.prototype.less=function(t,e){return F("less")},n.prototype.lessEqual=function(t,e){return F("lessEqual")},n.prototype.greater=function(t,e){return F("greater")},n.prototype.greaterEqual=function(t,e){return F("greaterEqual")},n.prototype.logicalNot=function(t){return F("logicalNot")},n.prototype.logicalAnd=function(t,e){return F("logicalAnd")},n.prototype.logicalOr=function(t,e){return F("logicalOr")},n.prototype.where=function(t){return F("where")},n.prototype.select=function(t,e,r){return F("select")},n.prototype.topk=function(t,e,r){return F("topk")},n.prototype.min=function(t,e){return F("min")},n.prototype.minimum=function(t,e){return F("minimum")},n.prototype.mod=function(t,e){return F("mod")},n.prototype.max=function(t,e){return F("max")},n.prototype.maximum=function(t,e){return F("maximum")},n.prototype.all=function(t,e){return F("all")},n.prototype.any=function(t,e){return F("any")},n.prototype.squaredDifference=function(t,e){return F("squaredDifference")},n.prototype.ceil=function(t){return F("ceil")},n.prototype.floor=function(t){return F("floor")},n.prototype.round=function(t){return F("round")},n.prototype.sign=function(t){return F("sign")},n.prototype.isNaN=function(t){return F("isNaN")},n.prototype.isInf=function(t){return F("isInf")},n.prototype.isFinite=function(t){return F("isFinite")},n.prototype.pow=function(t,e){return F("pow")},n.prototype.exp=function(t){return F("exp")},n.prototype.expm1=function(t){return F("expm1")},n.prototype.softmax=function(t,e){return F("softmax")},n.prototype.log=function(t){return F("log")},n.prototype.log1p=function(t){return F("log1p")},n.prototype.sqrt=function(t){return F("sqrt")},n.prototype.rsqrt=function(t){return F("rsqrt")},n.prototype.square=function(t){return F("square")},n.prototype.reciprocal=function(t){return F("reciprocal")},n.prototype.relu=function(t){return F("relu")},n.prototype.relu6=function(t){return F("relu6")},n.prototype.prelu=function(t,e){return F("prelu")},n.prototype.elu=function(t){return F("elu")},n.prototype.eluDer=function(t,e){return F("eluDer")},n.prototype.selu=function(t){return F("selu")},n.prototype.int=function(t){return F("int")},n.prototype.clip=function(t,e,r){return F("clip")},n.prototype.abs=function(t){return F("abs")},n.prototype.complexAbs=function(t){return F("complexAbs")},n.prototype.sigmoid=function(t){return F("sigmoid")},n.prototype.softplus=function(t){return F("softplus")},n.prototype.sin=function(t){return F("sin")},n.prototype.cos=function(t){return F("cos")},n.prototype.tan=function(t){return F("tan")},n.prototype.asin=function(t){return F("asin")},n.prototype.acos=function(t){return F("acos")},n.prototype.atan=function(t){return F("atan")},n.prototype.atan2=function(t,e){return F("atan2")},n.prototype.sinh=function(t){return F("sinh")},n.prototype.cosh=function(t){return F("cosh")},n.prototype.tanh=function(t){return F("tanh")},n.prototype.asinh=function(t){return F("asinh")},n.prototype.acosh=function(t){return F("acosh")},n.prototype.atanh=function(t){return F("atanh")},n.prototype.erf=function(t){return F("erf")},n.prototype.step=function(t,e){return F("step")},n.prototype.fusedConv2d=function(t){return F("fusedConv2d")},n.prototype.conv2d=function(t,e,r){return F("conv2d")},n.prototype.conv2dDerInput=function(t,e,r){return F("conv2dDerInput")},n.prototype.conv2dDerFilter=function(t,e,r){return F("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(t){return F("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(t,e,r){return F("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(t,e,r){return F("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(t,e,r){return F("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(t,e,r){return F("conv3d")},n.prototype.conv3dDerInput=function(t,e,r){return F("conv3dDerInput")},n.prototype.conv3dDerFilter=function(t,e,r){return F("conv3dDerFilter")},n.prototype.maxPool=function(t,e){return F("maxPool")},n.prototype.maxPoolBackprop=function(t,e,r,o){return F("maxPoolBackprop")},n.prototype.avgPool=function(t,e){return F("avgPool")},n.prototype.avgPoolBackprop=function(t,e,r){return F("avgPoolBackprop")},n.prototype.avgPool3d=function(t,e){return F("avgPool3d")},n.prototype.avgPool3dBackprop=function(t,e,r){return F("avgPool3dBackprop")},n.prototype.maxPool3d=function(t,e){return F("maxPool3d")},n.prototype.maxPool3dBackprop=function(t,e,r,o){return F("maxPool3dBackprop")},n.prototype.reshape=function(t,e){return F("reshape")},n.prototype.cast=function(t,e){return F("cast")},n.prototype.tile=function(t,e){return F("tile")},n.prototype.pad=function(t,e,r){return F("pad")},n.prototype.transpose=function(t,e){return F("transpose")},n.prototype.gather=function(t,e,r){return F("gather")},n.prototype.gatherND=function(t,e){return F("gatherND")},n.prototype.scatterND=function(t,e,r){return F("scatterND")},n.prototype.batchToSpaceND=function(t,e,r){return F("batchToSpaceND")},n.prototype.spaceToBatchND=function(t,e,r){return F("spaceToBatchND")},n.prototype.resizeBilinear=function(t,e,r,o){return F("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(t,e,r){return F("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(t,e,r,o){return F("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(t,e,r){return F("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(t,e,r,o,i,a){return F("batchNormalization")},n.prototype.localResponseNormalization4D=function(t,e,r,o,i){return F("localResponseNormalization4D")},n.prototype.LRNGrad=function(t,e,r,o,i,a,s){return F("LRNGrad")},n.prototype.multinomial=function(t,e,r,o){return F("multinomial")},n.prototype.oneHot=function(t,e,r,o){return F("oneHot")},n.prototype.cumsum=function(t,e,r,o){return F("cumsum")},n.prototype.nonMaxSuppression=function(t,e,r,o,i){return F("nonMaxSuppression")},n.prototype.fft=function(t){return F("fft")},n.prototype.ifft=function(t){return F("ifft")},n.prototype.complex=function(t,e){return F("complex")},n.prototype.real=function(t){return F("real")},n.prototype.imag=function(t){return F("imag")},n.prototype.cropAndResize=function(t,e,r,o,i,a){return F("cropAndResize")},n.prototype.depthToSpace=function(t,e,r){return F("depthToSpace")},n.prototype.split=function(t,e,r){return F("split")},n.prototype.sparseToDense=function(t,e,r,o){return F("sparseToDense")},n.prototype.diag=function(t){return F("diag")},n.prototype.fill=function(t,e,r){return F("fill")},n.prototype.onesLike=function(t){return F("onesLike")},n.prototype.zerosLike=function(t){return F("zerosLike")},n.prototype.linspace=function(t,e,r){return F("linspace")},n.prototype.dispose=function(){return F("dispose")},n}();function F(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Zr(n,t){for(var e=n.length,r=[],o=0;o<e;o++){var i=e-1-o;(t[t.length-1-o]||1)>1&&1===(n[i]||1)&&r.unshift(i)}return r}function _t(n,t){for(var e=[],r=0;r<t.length;r++){var o=n[n.length-r-1],i=t.length-r-1;(null==o||1===o&&t[i]>1)&&e.unshift(i)}return e}function Ee(n,t){for(var e=[],r=Math.max(n.length,t.length),o=0;o<r;o++){var i=n[n.length-o-1];null==i&&(i=1);var a=t[t.length-o-1];if(null==a&&(a=1),1===i)e.unshift(a);else if(1===a)e.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+n+" and "+t+".");e.unshift(i)}}return e}function ha(n,t,e,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=sl(t),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,n[3],n[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,n[1],n[1]]}return Mo(n,s,e,r,o,i,!1,a)}function Us(n,t,e,r,o,i,a){void 0===a&&(a="NDHWC");var s,u,c=rv(t),l=c[0],d=c[1],f=c[2];if("NDHWC"===a)u="channelsLast",s=[l,d,f,n[4],n[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,d,f,n[1],n[1]]}return zs(n,s,e,r,o,!1,u,i)}function Mo(n,t,e,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3];if("channelsLast"===s)c=n[0],l=n[1],d=n[2],f=n[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=n[0],f=n[1],l=n[2],d=n[3]}var h,p=t[0],v=t[1],g=t[3],m=sl(e),w=m[0],y=m[1],b=sl(r),x=b[0],_=b[1],T=pa(p,x),S=pa(v,_),E=function(O,L,H,j,V,z,G,X){var re,oe,_e;if("number"==typeof O){re={top:O,bottom:O,left:O,right:O,type:0===O?"VALID":"NUMBER"};var De=function(Re,Ge,Ve,dt,it){null==dt&&(dt=nv(Re,Ge,Ve));var Nr=Re[1],Fr=Gs((Re[0]-Ge+2*dt)/Ve+1,it);C(rt(Fr),function(){return"The output # of rows ("+Fr+") must be an integer. Change the stride and/or zero pad parameters"});var Mn=Gs((Nr-Ge+2*dt)/Ve+1,it);return C(rt(Mn),function(){return"The output # of columns ("+Mn+") must be an integer. Change the stride and/or zero pad parameters"}),[Fr,Mn]}([L,H],z,j,O,X);oe=De[0],_e=De[1]}else if("same"===O){oe=Math.ceil(L/j),_e=Math.ceil(H/V);var Te=Math.max(0,(oe-1)*j+z-L),Pe=Math.max(0,(_e-1)*V+G-H),Ae=Math.floor(Te/2),Oe=Te-Ae,ht=Math.floor(Pe/2);re={top:Ae,bottom:Oe,left:ht,right:Pe-ht,type:"SAME"}}else{if("valid"!==O)throw Error("Unknown padding parameter: "+O);re={top:0,bottom:0,left:0,right:0,type:"VALID"},oe=Math.ceil((L-z+1)/j),_e=Math.ceil((H-G+1)/V)}return{padInfo:re,outHeight:oe,outWidth:_e}}(o,l,d,w,y,T,S,i),N=E.outHeight,R=E.outWidth,B=a?g*f:g;return"channelsFirst"===s?h=[c,B,N,R]:"channelsLast"===s&&(h=[c,N,R,B]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:d,inChannels:f,outHeight:N,outWidth:R,outChannels:B,padInfo:E.padInfo,strideHeight:w,strideWidth:y,filterHeight:p,filterWidth:v,effectiveFilterHeight:T,effectiveFilterWidth:S,dilationHeight:x,dilationWidth:_,inShape:n,outShape:h,filterShape:t}}function zs(n,t,e,r,o,i,a,s){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],d=u[2],f=u[3],h=u[4];if("channelsLast"===a)c=n[0],l=n[1],d=n[2],f=n[3],h=n[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=n[0],h=n[1],l=n[2],d=n[3],f=n[4]}var p,v=t[0],g=t[1],m=t[2],w=t[4],y=rv(e),b=y[0],x=y[1],_=y[2],T=rv(r),S=T[0],E=T[1],I=T[2],N=pa(v,S),R=pa(g,E),B=pa(m,I),O=function(G,X,re,oe,_e,De,Te,Pe,Ae,Oe,ht){var Re,Ge,Ve,dt;if("number"==typeof G){Re={top:G,bottom:G,left:G,right:G,front:G,back:G,type:0===G?"VALID":"NUMBER"};var it=function(Ma,uo,kg,Aa,kr,Pg){null==kr&&(kr=nv(Ma,uo,Aa));var ZW=Ma[1],eU=Ma[2],Og=Gs((Ma[0]-uo+2*kr)/Aa+1,Pg);C(rt(Og),function(){return"The output # of depths ("+Og+") must be an integer. Change the stride and/or zero pad parameters"});var Lg=Gs((ZW-uo+2*kr)/Aa+1,Pg);C(rt(Lg),function(){return"The output # of rows ("+Lg+") must be an integer. Change the stride and/or zero pad parameters"});var Bg=Gs((eU-uo+2*kr)/Aa+1,Pg);return C(rt(Bg),function(){return"The output # of columns ("+Bg+") must be an integer. Change the stride and/or zero pad parameters"}),[Og,Lg,Bg,1]}([X,re,oe,1],Pe,0,_e,G,ht);Ge=it[0],Ve=it[1],dt=it[2]}else if("same"===G){var at=((Ge=Math.ceil(X/_e))-1)*_e+Pe-X,Nr=((Ve=Math.ceil(re/De))-1)*De+Ae-re,Fr=((dt=Math.ceil(oe/Te))-1)*Te+Oe-oe,Mn=Math.floor(at/2),Ta=at-Mn,ao=Math.floor(Nr/2),Bo=Nr-ao,so=Math.floor(Fr/2);Re={top:ao,bottom:Bo,left:so,right:Fr-so,front:Mn,back:Ta,type:"SAME"}}else{if("valid"!==G)throw Error("Unknown padding parameter: "+G);Re={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Ge=Math.ceil((X-Pe+1)/_e),Ve=Math.ceil((re-Ae+1)/De),dt=Math.ceil((oe-Oe+1)/Te)}return{padInfo:Re,outDepth:Ge,outHeight:Ve,outWidth:dt}}(o,l,d,f,b,x,_,N,R,B,s),H=O.outDepth,j=O.outHeight,V=O.outWidth,z=i?w*h:w;return"channelsFirst"===a?p=[c,z,H,j,V]:"channelsLast"===a&&(p=[c,H,j,V,z]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:d,inWidth:f,inChannels:h,outDepth:H,outHeight:j,outWidth:V,outChannels:z,padInfo:O.padInfo,strideDepth:b,strideHeight:x,strideWidth:_,filterDepth:v,filterHeight:g,filterWidth:m,effectiveFilterDepth:N,effectiveFilterHeight:R,effectiveFilterWidth:B,dilationDepth:S,dilationHeight:E,dilationWidth:I,inShape:n,outShape:p,filterShape:t}}function nv(n,t,e,r){void 0===r&&(r=1);var o=pa(t,r);return Math.floor((n[0]*(e-1)-e+o)/2)}function sl(n){return"number"==typeof n?[n,n,n]:2===n.length?[n[0],n[1],1]:n}function rv(n){return"number"==typeof n?[n,n,n]:n}function pa(n,t){return t<=1?n:n+(n-1)*(t-1)}function Gs(n,t){if(!t)return n;switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+t)}}function ui(n){var t=sl(n);return 1===t[0]&&1===t[1]&&1===t[2]}function on(n,t){return ui(n)||ui(t)}function ul(n){if("NHWC"===n)return"channelsLast";if("NCHW"===n)return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function ov(n,t,e){if("complex64"===t){if("complex64"===n.dtype)return n.clone();var r=Ze(n.shape),o=n.toFloat(),i=e.complex(o,r);return r.dispose(),o.dispose(),i}if(!h_(n.dtype,t))return M.makeTensorFromDataId(n.dataId,n.shape,t);if("complex64"===n.dtype){var a=e.real(n);return i=a.cast(t),a.dispose(),i}if("int32"===t)return e.int(n);if("bool"===t){var s=q(0,n.dtype);return i=e.notEqual(n,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+t)}function cl(n,t){return M.makeTensorFromDataId(n.dataId,t,n.dtype)}function iv(n,t,e){var r=(t-n)/(e-1),o=ca(e,"float32");o[0]=n;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return xt(o,"float32")}function av(n,t){if(n.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+t.length+".");for(var e=new Float32Array(2*n.length),r=0;r<e.length;r+=2)e[r]=n[r/2],e[r+1]=t[r/2];return e}function gD(n,t){return{real:n[2*t],imag:n[2*t+1]}}function DB(n,t,e,r){n[2*r]=t,n[2*r+1]=e}function CB(n,t,e){var r=(e?2:-2)*Math.PI*(n/t);return{real:Math.cos(r),imag:Math.sin(r)}}function EB(n,t,e){var r=function(u,c,l){for(var d=0,f=u.length,h=0,p=!1;d<f;){var v=l(c,u[h=d+(f-d>>>1)]);v>0?d=h+1:(f=h,p=!v)}return p?d:-d-1}(n,t,e||IB);n.splice(r<0?-(r+1):r,0,t)}function IB(n,t){return n>t?1:n<t?-1:0}function sv(n,t,e,r,o){return mD(n,t,e,r,o,0).selectedIndices}function uv(n,t,e,r,o,i){var a=mD(n,t,e,r,o,i,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function mD(n,t,e,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map(function(b,x){return{score:b,boxIndex:x,suppressBeginIndex:0}}).filter(function(b){return b.score>o}).sort(yD),c=i>0?-.5/i:0,l=[],d=[];l.length<e&&u.length>0;){var f=u.pop(),h=f.score,p=f.boxIndex,v=f.suppressBeginIndex;if(h<o)break;for(var g=!1,m=l.length-1;m>=v;--m){var w=SB(n,p,l[m]);if(w>=r){g=!0;break}if(f.score=f.score*TB(r,c,w),f.score<=o)break}f.suppressBeginIndex=l.length,g||(f.score===h?(l.push(p),d.push(f.score)):f.score>o&&EB(u,f,yD))}var y=l.length;return s&&(l.fill(0,y),d.fill(0,y)),{selectedIndices:xt(l,"int32"),selectedScores:xt(d,"float32"),numValidOutputs:q(y,"int32")}}function SB(n,t,e){var r=n.subarray(4*t,4*t+4),o=n.subarray(4*e,4*e+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(d-c)*(f-l);if(h<=0||p<=0)return 0;var v=Math.max(i,c),g=Math.max(a,l),m=Math.min(s,d),w=Math.min(u,f),y=Math.max(m-v,0)*Math.max(w-g,0);return y/(h+p-y)}function TB(n,t,e){var r=Math.exp(t*e*e);return e<=n?r:0}function yD(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}function bD(n,t,e){var r=new Array(n.rank).fill(0),o=n.shape.slice();return t.map(function(i){o[e]=i;var a=n.slice(r,o);return r[e]+=i,a})}function wD(n,t){for(var e=new Array(n.rank),r=0;r<e.length;r++)e[r]=n.shape[r]*t[r];var o=ve(e,n.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(n.rank),s=0;s<a.length;s++)a[s]=i[s]%n.shape[s];var u=n.locToIndex(a);o.values[r]=n.values[u]}return o.toTensor()}function xD(n,t,e,r,o){for(var i=t[t.length-1],a=[n.length/i,i],s=a[0],u=a[1],c=sa(e,s*r),l=sa("int32",s*r),d=0;d<s;d++){for(var f=d*u,h=n.subarray(f,f+u),p=[],v=0;v<h.length;v++)p.push({value:h[v],index:v});p.sort(function(b,x){return x.value-b.value});var g=d*r,m=c.subarray(g,g+r),w=l.subarray(g,g+r);for(v=0;v<r;v++)m[v]=p[v].value,w[v]=p[v].index}var y=t.slice();return y[y.length-1]=r,[Ht(c,y,e),Ht(l,y,"int32")]}function cv(n,t){for(var e=[],r=0;r<t.length;r++)t[r]&&e.push(r);var o=ve(n,"int32"),i=ve([e.length,n.length],"int32");for(r=0;r<e.length;r++){var a=o.indexToLoc(e[r]);i.values.set(a,r*n.length)}return i.toTensor()}Object.freeze({castTensor:ov,reshapeTensor:cl,linspaceImpl:iv,upcastType:Nt,axesAreInnerMostDims:qp,combineLocations:Z_,computeOutAndReduceShapes:Bt,expandShapeToKeepDim:rn,assertAxesAreInnerMostDims:dn,getAxesPermutation:nr,getUndoAxesPermutation:Qc,getInnerMostAxes:rr,getBroadcastDims:Zr,getReductionAxes:_t,assertAndGetBroadcastShape:Ee,assertParamsConsistent:eD,computeOutShape:oi,computePool2DInfo:ha,computePool3DInfo:Us,computeConv2DInfo:Mo,computeConv3DInfo:zs,computeDefaultPad:nv,tupleValuesAreOne:ui,eitherStridesOrDilationsAreOne:on,convertConv2DDataFormat:ul,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:rl});var MB=function(n,t){this.outputShape=[],this.outputShape=n,this.variableNames=t.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("float v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},AB=function(n,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=t.map(function(o,i){return"T"+i});var e=[];this.variableNames.forEach(function(o){e.push("vec4 v"+o+" = get"+o+"AtOutCoords();")});var r=this.variableNames.map(function(o){return"v"+o}).join(" + ");this.userCode="\n      void main() {\n        "+e.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},RB=function(n,t,e){this.variableNames=["A"];var r=n.windowSize,o=n.batchSize,a=Math.ceil(n.inSize/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===t?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function _D(n,t){return["x","y","z","w","u","v"].slice(0,t).map(function(e){return n+"."+e})}function hn(n,t){return 1===t?[n]:_D(n,t)}function Gt(){var n,t,e,r,o,i,a,s,u,c;return 2===P().getNumber("WEBGL_VERSION")?(n="#version 300 es",t="in",e="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(n="",t="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:n,attribute:t,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function ci(n,t,e){void 0===e&&(e="index");var r=er(t);return r.map(function(o,i){return"int "+n[i]+" = "+e+" / "+o+"; "+(i===r.length-1?"int "+n[i+1]+" = "+e+" - "+n[i]+" * "+o:"index -= "+n[i]+" * "+o)+";"}).join("")}function lv(n){var t=er(n).map(function(e){return e.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var DD="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function NB(n,t,e,r){var o=[];n.forEach(function(h){var p=ee(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))});var i,a,h,s=o.join("\n"),u=n.map(function(h){return function(p,v,g){void 0===g&&(g=!1);var m="";return m+=g?CD(p):va(p),p.shapeInfo.logicalShape.length<=v.logicalShape.length&&(m+=g?function(b,x){var _,H,T=b.name,S=T.charAt(0).toUpperCase()+T.slice(1),E="get"+S+"AtOutCoords",I=b.shapeInfo.logicalShape.length,N=x.logicalShape.length,R=Zr(b.shapeInfo.logicalShape,x.logicalShape),B=Je(N),O=N-I,L=["x","y","z","w","u","v"];_=0===I?"":N<2&&R.length>=1?"coords = 0;":R.map(function(re){return"coords."+L[re+O]+" = 0;"}).join("\n"),H=N<2&&I>0?"coords":b.shapeInfo.logicalShape.map(function(re,oe){return"coords."+L[oe+O]}).join(", ");var j="return outputValue;",V=1===ee(b.shapeInfo.logicalShape),z=1===ee(x.logicalShape);if(1!==I||V||z){if(V&&!z)j=1===N?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(R.length){var G=I-2,X=I-1;R.indexOf(G)>-1&&R.indexOf(X)>-1?j="return vec4(outputValue.x);":R.indexOf(G)>-1?j="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":R.indexOf(X)>-1&&(j="return vec4(outputValue.xx, outputValue.zz);")}}else j="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+E+"() {\n      "+B+" coords = getOutputCoords();\n      "+_+"\n      vec4 outputValue = get"+S+"("+H+");\n      "+j+"\n    }\n  "}(p,v):function(b,x){var _=b.name,T=_.charAt(0).toUpperCase()+_.slice(1),S="get"+T+"AtOutCoords",N=b.shapeInfo.logicalShape.length,R=x.logicalShape.length;if(!b.shapeInfo.isUniform&&N===R&&null==b.shapeInfo.flatOffset&&bt(b.shapeInfo.texShape,x.texShape))return"\n      float "+S+"() {\n        return sampleTexture("+_+", resultUV);\n      }\n    ";var O=Je(R),L=Zr(b.shapeInfo.logicalShape,x.logicalShape),H=R-N,j=["x","y","z","w","u","v"];return"\n    float "+S+"() {\n      "+O+" coords = getOutputCoords();\n      "+(0===N?"":R<2&&L.length>=1?"coords = 0;":L.map(function(z){return"coords."+j[z+H]+" = 0;"}).join("\n"))+"\n      return get"+T+"("+(R<2&&N>0?"coords":b.shapeInfo.logicalShape.map(function(z,G){return"coords."+j[G+H]}).join(", "))+");\n    }\n  "}(p,v)),m}(h,t,r)}).join("\n"),c=t.texShape,l=Gt(),d="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",f=(h=l).version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+h.varyingFs+" vec2 resultUV;\n    "+h.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+h.defineSpecialNaN+"\n    "+h.defineSpecialInf+"\n    "+h.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+FB+"\n    "+kB+"\n    "+PB+"\n  ";return t.isPacked?(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return x=p,1===(_=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+_[1]+".0);\n      }\n    ":1===_[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+_[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n      return 2 * (resTexRC.x * "+_[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(b,x){var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];if(bt(b,x))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+_[0]+", "+_[1]+"));\n      }\n    ";var T=Math.ceil(b[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n\n      int index = resTexRC.x * "+_[1]+" + resTexRC.y;\n      int r = 2 * (index / "+T+");\n      int c = imod(index, "+T+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return v=h,g=p,m=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],y=(w=Math.ceil(v[2]/2))*Math.ceil(v[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+m[0]+", "+m[1]+"));\n      int index = resTexRC.x * "+m[1]+" + resTexRC.y;\n\n      int b = index / "+y+";\n      index -= b * "+y+";\n\n      int r = 2 * (index / "+w+");\n      int c = imod(index, "+w+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(b,x){for(var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],T=Math.ceil(b[b.length-1]/2),S=T*Math.ceil(b[b.length-2]/2),E=S,I="",N="b, r, c",R=2;R<b.length-1;R++)I="\n      int b"+R+" = index / "+(E*=b[b.length-R-1])+";\n      index -= b"+R+" * "+E+";\n    "+I,N="b"+R+", "+N;return"\n    ivec"+b.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+_[0]+", "+_[1]+"));\n      int index = resTexRC.x * "+_[1]+" + resTexRC.y;\n\n      "+I+"\n\n      int b = index / "+S+";\n      index -= b * "+S+";\n\n      int r = 2 * (index / "+T+");\n      int c = imod(index, "+T+") * 2;\n\n      return ivec"+b.length+"("+N+");\n    }\n  "}(h,p)}var x,_,v,g,m,w,y}(t.logicalShape,c),a=function(h){return"\n    void setOutput(vec4 val) {\n      "+h.output+" = val;\n    }\n  "}(l)):(i=function(h,p){switch(h.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(w=p)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+w[1]+".0);\n      }\n    ":1===w[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+w[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+w[0]+", "+w[1]+"));\n      return resTexRC.x * "+w[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(m,w){return bt(m,w)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+w[0]+", "+w[1]+"));\n      }\n    ":1===m[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+w[0]+", "+w[1]+"));\n        int index = resTexRC.x * "+w[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===m[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+w[0]+", "+w[1]+"));\n        int index = resTexRC.x * "+w[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+w[0]+", "+w[1]+"));\n      int index = resTexRC.x * "+w[1]+" + resTexRC.y;\n      int r = index / "+m[1]+";\n      int c = index - r * "+m[1]+";\n      return ivec2(r, c);\n    }\n  "}(h,p);case 3:return v=p,g=ci(["r","c","d"],h),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+v[0]+", "+v[1]+"));\n      int index = resTexRC.x * "+v[1]+" + resTexRC.y;\n      "+g+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(m,w){var y=ci(["r","c","d","d2"],m);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+w[0]+", "+w[1]+"));\n      int index = resTexRC.x * "+w[1]+" + resTexRC.y;\n      "+y+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(h,p);case 5:return function(m,w){var y=ci(["r","c","d","d2","d3"],m);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+w[0]+",\n                             "+w[1]+"));\n\n      int index = resTexRC.x * "+w[1]+" + resTexRC.y;\n\n      "+y+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(h,p);case 6:return function(m,w){var y=ci(["r","c","d","d2","d3","d4"],m);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+w[0]+", "+w[1]+"));\n      int index = resTexRC.x * "+w[1]+" + resTexRC.y;\n\n      "+y+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var w,v,g}(t.logicalShape,c),a=function(h){return"\n    void setOutput(float val) {\n      "+h.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(f+=OB),[f,d,a,s,i,u,e].join("\n")}function va(n){var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=e.shapeInfo.texShape;if(1===i[0]&&1===i[1])return"\n      float "+o+"() {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=e.shapeInfo.texShape;return"\n    float "+o+"() {\n      vec2 uv = uvFromFlat("+u[0]+", "+u[1]+", "+li(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 1:return function(e){var r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+o+"(int index) {\n        "+ga(e)+"\n      }\n    ";var i=e.shapeInfo.texShape,a=i[0],s=i[1];if(1===s&&1===a)return"\n      float "+o+"(int index) {\n        return sampleTexture("+r+", halfCR);\n      }\n    ";var u=li(r);return 1===s?"\n      float "+o+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+u+") + 0.5) / "+a+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":1===a?"\n      float "+o+"(int index) {\n        vec2 uv = vec2((float(index + "+u+") + 0.5) / "+s+".0, 0.5);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int index) {\n      vec2 uv = uvFromFlat("+a+", "+s+", index + "+u+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(n);case 2:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=e.shapeInfo.texShape;if(null!=a&&bt(r,a))return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a[1]+".0, "+a[0]+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ";var c=Co(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+va(ma(e,l))+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+ya(["row","col"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+r[1]+", 1)));\n        "+ga(e)+"\n      }\n    ";var p=a[0],v=a[1],g=li(o);return 1===v?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+g+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":1===p?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+g+"), vec3("+r[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+v+".0, 0.5);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+r[1]+" + col + "+g+";\n    vec2 uv = uvFromFlat("+p+", "+v+", index);\n    return sampleTexture("+o+", uv);\n  }\n"}(n);case 3:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=Co(r),c=u.newShape,l=u.keptDims;if(c.length<r.length)return"\n        "+va(ma(e,c))+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+ya(["row","col","depth"],l)+");\n        }\n      ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+a+", "+s+", 1)));\n        "+ga(e)+"\n      }\n    ";var h=e.shapeInfo.texShape,p=h[0],v=h[1],g=e.shapeInfo.flatOffset;return v===a&&null==g?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+s+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+v+".0, "+p+".0);\n          return sampleTexture("+o+", uv);\n        }\n      ":v===s&&null==g?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+r[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+v+".0, "+p+".0);\n      return sampleTexture("+o+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+a+" + col * "+s+" + depth + "+li(o)+";\n        vec2 uv = uvFromFlat("+p+", "+v+", index);\n        return sampleTexture("+o+", uv);\n      }\n  "}(n);case 4:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,c=Co(r),l=c.newShape,d=c.keptDims;if(l.length<r.length)return"\n      "+va(ma(e,l))+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+ya(["row","col","depth","depth2"],d)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+u+", "+s+", "+a+", 1)));\n        "+ga(e)+"\n      }\n    ";var h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],g=p[1];return g===u&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":g===a&&null==h?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+r[1]*r[2]+", "+r[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+v+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" +\n          depth * "+a+" + depth2;\n      vec2 uv = uvFromFlat("+v+", "+g+", index + "+li(o)+");\n      return sampleTexture("+o+", uv);\n    }\n  "}(n);case 5:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,c=r[1]*u,l=Co(r),d=l.newShape,f=l.keptDims;if(d.length<r.length)return"\n      "+va(ma(e,d))+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+ya(["row","col","depth","depth2","depth3"],f)+");\n      }\n    ";if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+c+", "+u+", "+s+", "+a+")) +\n          depth3;\n        "+ga(e)+"\n      }\n    ";var p=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,g=v[0],m=v[1];return m===c&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+u+", "+s+", "+a+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":m===a&&null==p?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]+",\n               "+r[2]*r[3]+", "+r[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+g+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+c+" + col * "+u+" + depth * "+s+" +\n          depth2 * "+a+" + depth3 + "+li(o)+";\n      vec2 uv = uvFromFlat("+g+", "+m+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(n);case 6:return function(e){var r=e.shapeInfo.logicalShape,o=e.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=Co(r),s=a.newShape,u=a.keptDims;if(s.length<r.length)return"\n      "+va(ma(e,s))+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+ya(["row","col","depth","depth2","depth3","depth4"],u)+");\n      }\n    ";var l=r[5],d=r[4]*l,f=r[3]*d,h=r[2]*f,p=r[1]*h;if(e.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+p+", "+h+", "+f+", "+d+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+l+", 1)));\n        "+ga(e)+"\n      }\n    ";var v=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,m=g[0],w=g[1];return w===p&&null==v?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+h+", "+f+", "+d+", "+l+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+w+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":w===l&&null==v?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+r[1]*r[2]*r[3]*r[4]+",\n               "+r[2]*r[3]*r[4]+",\n               "+r[3]*r[4]+",\n               "+r[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+w+".0, "+m+".0);\n        return sampleTexture("+o+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+p+" + col * "+h+" + depth * "+f+" +\n          depth2 * "+d+" + depth3 * "+l+" + depth4 + "+li(o)+";\n      vec2 uv = uvFromFlat("+m+", "+w+", index);\n      return sampleTexture("+o+", uv);\n    }\n  "}(n);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function CD(n){var t,o,i,a,s,u,c;switch(n.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(t=n.name).charAt(0).toUpperCase()+t.slice(1)+"() {\n      return "+Gt().texture2D+"("+t+", halfCR);\n    }\n  ";case 1:return a="get"+(i=(o=n).name).charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Gt(),"\n    vec4 "+a+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+u[0]+", "+u[1]+", index);\n      return "+c.texture2D+"("+i+", uv);\n    }\n  ";case 2:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=u[0],l=u[1],d=Gt();if(null!=u&&bt(i,u))return"\n      vec4 "+s+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+l+".0, "+c+".0);\n\n        return "+d.texture2D+"("+a+", uv);\n      }\n    ";var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];return"\n    vec4 "+s+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(i[1]/2)+", "+f[0]+", "+f[1]+", row, col);\n      return "+d.texture2D+"("+a+", uv);\n    }\n  "}(n);case 3:return function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(1===i[0])return"\n        "+CD(ma(o,i.slice(1)))+"\n        vec4 "+s+"(int b, int row, int col) {\n          return "+s+"("+ya(["b","row","col"],[1,2])+");\n        }\n      ";var f=c[0],h=c[1],p=Math.ceil(i[2]/2);return"\n    vec4 "+s+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+f+", "+h+", "+p*Math.ceil(i[1]/2)+", "+p+", b, row, col);\n      return "+Gt().texture2D+"("+a+", uv);\n    }\n  "}(n);default:return function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],d=l[0],f=l[1],h=Math.ceil(i[a-1]/2),p=h*Math.ceil(i[a-2]/2),v="int b, int row, int col",g="b * "+p+" + (row / 2) * "+h+" + (col / 2)",m=2;m<a-1;m++)v="int b"+m+", "+v,g="b"+m+" * "+(p*=i[a-m-1])+" + "+g;return"\n    vec4 "+u+"("+v+") {\n      int index = "+g+";\n      int texR = index / "+f+";\n      int texC = index - texR * "+f+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+", "+d+");\n      return "+Gt().texture2D+"("+s+", uv);\n    }\n  "}(n)}}var FB="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",kB="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",PB="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",OB="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function li(n){return"offset"+n}function ga(n){var t=n.name,e=ee(n.shapeInfo.logicalShape);return e<2?"return "+t+";":"\n    for (int i = 0; i < "+e+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function Je(n){if(n<=1)return"int";if(2===n)return"ivec2";if(3===n)return"ivec3";if(4===n)return"ivec4";if(5===n)return"ivec5";if(6===n)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function ma(n,t){var e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function ya(n,t){return t.map(function(e){return n[e]}).join(", ")}var LB=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,C(n.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var i=Math.ceil(n[n.length-1]/t);this.outputShape=n.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=Je(c),d=hn("coords",c);if(1===i){var f=Je(s=c+1);a="\n        "+f+" sourceLocR = "+f+"("+d.join()+", 0);\n        ++"+d[c-1]+";\n        "+f+" sourceLocG = "+f+"("+d.join()+", 0);\n        ++"+d[c-2]+";\n        "+f+" sourceLocA = "+f+"("+d.join()+", 0);\n        --"+d[c-1]+";\n        "+f+" sourceLocB = "+f+"("+d.join()+", 0);\n        --"+d[c-2]+";"}else s=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+d[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+d[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+d[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+d[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],v=h.map(function(S){return"int "+S}),g=hn("sourceLocR",s-1).concat("inIdx.r"),m=hn("sourceLocG",s-1).concat("inIdx.g"),w=hn("sourceLocB",s-1).concat("inIdx.b"),y=hn("sourceLocA",s-1).concat("inIdx.a"),b="max"===e?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+w.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",_="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+m.join()+") : 0.,\n            hasNextRow ? getAChannel("+w.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",T=r?"":"\n      float getBestIndicesAChannel("+v.join()+") {\n        return getChannel(getBestIndicesA("+h.join()+"),\n                                          vec2("+h.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+v.join()+") {\n        return getChannel(getA("+h.join()+"),\n                               vec2("+h.slice(-2).join()+"));\n      }\n      "+T+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+d[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+d[c-2]+" < "+(u[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+x+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},BB=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var s=n.effectiveFilterHeight,u=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(s-1-n.padInfo.top)+", "+(u-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+n.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},VB=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var l=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(l-1-n.padInfo.front)+", "+(d-1-n.padInfo.top)+", "+(f-1-n.padInfo.left)+");\n      const float avgMultiplier = float("+1/(n.filterDepth*n.filterHeight*n.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+d+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+f+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},HB=function(n,t,e,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ee(n,t),Ee(n,e);var a="0.0";null!=r&&(Ee(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(Ee(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},jB=function(n,t,e,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ee(n,t),Ee(n,e);var a="vec4(0.0)";null!=r&&(Ee(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(Ee(n,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},ED=function(n,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ee(t,e),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+n+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},dv="return a + b;",fv="return a - b;",ID="return a * b;",SD="return (a < 0.) ? b * a : a;",lt=function(n,t,e){this.variableNames=["A","B"],this.outputShape=Ee(t,e),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+n+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},TD="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",eo=function(n,t,e,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ee(t,e);var o=this.outputShape.length,i="";if(r)if(0===o||1===ee(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+Je(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=hn("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+n+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},zB=function(){function n(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,e)}},n}(),GB=function(){function n(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(o,i){null==r.minLoc&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,t),o.gl.uniform1f(r.maxLoc,e)}},n}(),qB=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},$B=function(n){this.outputShape=[],this.outputShape=oi(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var t=new Array(n.length-1);t[0]=n[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+n[e][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++)r.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+t[e-1]+"));");r.push("else setOutput(getT"+t.length+"(yR, yC-"+t[t.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},KB=function(n,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=oi(n,t);var e=this.outputShape,r=e.length,o=Je(r),i=hn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(g,m){return"T"+m});var s=new Array(n.length-1);s[0]=n[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][t];var c=a[t],l=a.slice(-2),d=a.join(),f="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+d+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var h=s[u-1];f+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+ll(a,c,h)+"),\n            vec2("+ll(l,c,h)+"));\n        }"}var v=s[s.length-1];f+="\n        return getChannel(\n          getT"+s.length+"("+ll(a,c,v)+"),\n          vec2("+ll(l,c,v)+"));",this.userCode="\n      float getValue("+a.map(function(g){return"int "+g})+") {\n        "+f+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+e[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+e[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+e[r-2]+" &&\n            "+i[r-1]+" < "+e[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function ll(n,t,e){var r=n.indexOf(t);return n.map(function(o,i){return i===r?o+" - "+e:o}).join()}var XB=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===n.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},YB=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,i="channelsLast"===n.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-n.padInfo.top)+", "+(e-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(i?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(i?1:2)+"], coords["+(i?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},QB=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yF = 0; yF < "+n.outDepth+"; yF++) {\n            int xF = wF + yF * "+n.strideDepth+" - "+n.padInfo.front+";\n\n            if (xF < 0 || xF >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n              int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n                int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},JB=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterDepth,e=n.filterHeight,r=n.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-n.padInfo.front)+", "+(e-1-n.padInfo.top)+", "+(r-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+n.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+n.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+e+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+e+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+n.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ZB=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+n.outChannels/n.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+n.batchSize+"; b++) {\n          for (int yR = 0; yR < "+n.outHeight+"; yR++) {\n            int xR = wR + yR * "+n.strideHeight+" - "+n.padInfo.top+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+n.outWidth+"; yC++) {\n              int xC = wC + yC * "+n.strideWidth+" - "+n.padInfo.left+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},e3=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,s=n.outChannels/n.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-n.padInfo.top)+", "+(e-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+e+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+e+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},MD=function(n,t,e,r){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.padInfo.top,i=n.padInfo.left,a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,c=n.dilationWidth,l=n.filterHeight,d=n.filterWidth,f=4*Math.floor(n.inChannels/4),h=n.inChannels%4,p="channelsLast"===n.dataFormat,v=p?1:2,g=p?2:3,m=p?3:1,w="",y="";e&&(w=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",y="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+m+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+v+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+n.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===h)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(2===h)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===h)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+b+"\n        "+y+"\n        setOutput(result);\n      }\n    "},t3=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.padInfo.front,e=n.padInfo.top,r=n.padInfo.left,o=n.strideDepth,i=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,c=n.dilationWidth,l=n.filterDepth,d=n.filterHeight,f=n.filterWidth,h=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+t+", "+e+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+h+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+h+") *\n                  getW(wF, wR, wC, "+h+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+h+"),\n                  getX(batch, xF, xR, xC, "+h+" + 1),\n                  getX(batch, xF, xR, xC, "+h+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+h+", d2),\n                  getW(wF, wR, wC, "+h+" + 1, d2),\n                  getW(wF, wR, wC, "+h+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},AD=function(n,t,e,r){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var o=n.inHeight,i=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,c=n.strideWidth,l=n.dilationHeight,d=n.dilationWidth,f=n.filterHeight,h=n.filterWidth,p=n.outChannels/n.inChannels,v="",g="";e&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"\n          float activation(float x) {\n            "+e+"\n          }\n        ",g="result = activation(result);");var m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+d+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+m+"\n        "+g+"\n        setOutput(result);\n      }\n    "},RD=function(n,t,e,r){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var o=n.inHeight,i=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,c=n.strideWidth,l=n.dilationHeight,d=n.dilationWidth,f=n.filterHeight,h=n.filterWidth,p=h,v="int xR; int xC; int xCOffset;",g=0;g<f;g++)for(var m=0;m<h;m++)v+="\n          vec4 xTexelR"+g+"C"+2*m+" = vec4(0.);\n          vec4 wR"+g+"C"+m+" = vec4(0.);\n          vec4 xR"+g+"C"+m+" = vec4(0.);";for(g=0;g<f;g++)for(var w=0;w<p;w++){if(v+="\n          xR = xRCorner + "+g*l+";\n          xC = xCCorner + "+(m=2*w)*d+";\n        ",1===c){if(m<h&&(v+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+m+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+g+"C"+m+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+m+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+m+" = vec4(previous.zw, xTexelR"+g+"C"+m+".xy);\n                } else {\n                  xR"+g+"C"+m+" = vec4(0, 0, xTexelR"+g+"C"+m+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+g+"C"+m+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+m+" = vec4(0.);\n                }\n\n                xR"+g+"C"+m+" = xTexelR"+g+"C"+m+";\n              ",m+1<h)){var y=s%2==0?Cp(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(v+="\n                  xCOffset = xC + "+s%2+" + "+y+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+g+"C"+(m+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",d>1&&(v+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+g+"C"+m+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+m+" = vec4(0.);\n                    }\n                  "),v+="\n                  xR"+g+"C"+(m+1)+" = vec4(\n                    xTexelR"+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+".xy);\n                "):v+="\n                  xCOffset = xC + "+y+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+g+"C"+(m+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(m+1)+" = xTexelR"+g+"C"+(m+2)+";\n                "}}else m<h&&(v+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(v+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+m+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+m+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+g+"C"+(m+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(m+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+m+" = vec4(\n                  xTexelR"+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+".zw);\n              ",m+1<h&&(v+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(m+1)+" = vec4(xTexelR"+g+"C"+(m+2)+".xy, final.xy);\n                ")):(v+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+g+"C"+m+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+m+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+g+"C"+(m+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(m+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+m+" = vec4(\n                  xTexelR"+g+"C"+m+".xy, xTexelR"+g+"C"+(m+2)+".xy);\n              ",m+1<h&&(v+="\n                  xR"+g+"C"+(m+1)+" = vec4(\n                    xTexelR"+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+".zw);\n                ")),v+="}");m<h&&(v+="\n            vec4 wTexelR"+g+"C"+m+" = getW("+g+", "+m+", d1, q);\n            wR"+g+"C"+m+" = vec4(wTexelR"+g+"C"+m+".xz, wTexelR"+g+"C"+m+".xz);\n          ",m+1<h&&(v+="\n              vec4 wTexelR"+g+"C"+(m+1)+" = getW("+g+", "+(m+1)+", d1, q);\n              wR"+g+"C"+(m+1)+" =\n                vec4(wTexelR"+g+"C"+(m+1)+".xz, wTexelR"+g+"C"+(m+1)+".xz);"))}for(g=0;g<f;g++)for(m=0;m<h;m++)v+="dotProd += xR"+g+"C"+m+" * wR"+g+"C"+m+";";var b="",x="";e&&(b=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+e+"\n        }":"vec4 activation(vec4 x) {\n          "+e+"\n        }",x="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+v+"\n\n        vec4 result = dotProd;\n        "+_+"\n        "+x+"\n        setOutput(result);\n      }\n    "},n3=function(n,t,e,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=n[0],a=n[1],s=n[2],l=e[0],d=e[1];this.outputShape=[t[0],l,d,n[3]];var h=[a-1+".0",s-1+".0"],p=h[0],v=h[1],g=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],b=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v];this.userCode="\n      const float height_ratio = float("+g[0]+");\n      const float width_ratio = float("+b[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+g[1]+";\n        float width_scale = "+b[1]+";\n\n        float in_y = "+g[2]+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+b[2]+";\n        if( in_x < 0.0 || in_x > "+v+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},r3=function(n,t,e){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=n[n.length-1],i=e?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(e?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Je(r)+" coords = getOutputCoords();\n        int end = "+ND(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+ND(r,"coords")+" = idx;\n          val += getX("+function(a,s){if(1===a)return""+s;if(2===a)return s+".x, "+s+".y";if(3===a)return s+".x, "+s+".y, "+s+".z";if(4===a)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function ND(n,t){if(1===n)return""+t;if(2===n)return t+".y";if(3===n)return t+".z";if(4===n)return t+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var o3=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Fs.DENSE;var t=ks(n),e=Gt();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+ci(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+e.output+" = result;\n      }\n    "},i3=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Fs.DENSE;var t=ks(n),e=Gt();this.outputShape=n,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+ci(["r","c","d"],n)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+e.output+" = result;\n      }\n    "},a3=function(){function n(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return n.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),s3=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},u3=function(n){this.variableNames=["A"],this.outTexUsage=_n.DOWNLOAD;var t=Gt();this.outputShape=n,this.userCode="\n      "+DD+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},c3=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=_n.DOWNLOAD;var t=Gt();this.outputShape=n,this.userCode="\n      "+DD+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},l3=function(n,t,e){void 0===e&&(e=!1),this.variableNames=["A"];var r=Gt(),o=t[0],i=t[1];this.outputShape=n;var a="result";e&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+lv(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},d3=function(n,t,e){void 0===e&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Gt(),o=t[0],i=t[1];this.outputShape=n;var a="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+n[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+n[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+lv(n)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},FD=function(n,t,e){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var o=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+n+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(e?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},p3=function(){function n(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,o){null==e.valueLoc&&(e.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(e.valueLoc,t)}},n}(),v3=function(n,t,e){this.variableNames=["A","indices"];var r=n.slice();r[e]=t,this.outputShape=r,this.rank=r.length;var o=Je(this.rank),i=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(1===u)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<a.length;d++)l.push(d===s?"int(getIndices("+c[d]+"))":""+c[d]);return l.join()}(n,e);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},g3=function(n,t,e){this.sliceDim=n,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var r=Je(t.length),o=Je(e.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function kD(n,t){var e=Gt();return M_(n,t,e.version+"\n    precision highp float;\n    "+e.attribute+" vec3 clipSpacePos;\n    "+e.attribute+" vec2 uv;\n    "+e.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function PD(n,t){return F_(n,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function OD(n,t){return k_(n,t,new Uint16Array([0,1,2,2,1,3]))}function qs(n,t,e,r,o,i,a){O_(e,r);var s=P_(n,t),u=n.TEXTURE_2D;return Q(n,t,function(){return n.bindTexture(u,s)}),Q(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Q(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Q(n,t,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Q(n,t,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),Q(n,t,function(){return n.texImage2D(u,0,o,e,r,0,i,a,null)}),Q(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function LD(n,t,e,r,o){var i=Uc(e,r);return qs(n,t,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,n.FLOAT)}function BD(n,t,e,r,o){var i=Uc(e,r);return qs(n,t,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function VD(n,t,e,r,o){var i=Uc(e,r);return qs(n,t,i[0],i[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function HD(n,t,e,r,o){var i=Ps(e,r);return qs(n,t,i[0],i[1],o.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function jD(n,t,e,r,o){var i=Ps(e,r);return qs(n,t,i[0],i[1],o.internalFormatPackedHalfFloat,n.RGBA,o.textureTypeHalfFloat)}function WD(n,t,e,r){return Q(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Wp(n,t,e,"clipSpacePos",r,3,20,0)&&Wp(n,t,e,"uv",r,2,20,12)}function UD(n,t,e,r,o,i,a){var s,u,c;Q(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=n.UNSIGNED_BYTE,c=n.RGBA):(s=new Float32Array(r*o*4),u=n.FLOAT,c=a.internalFormatPackedFloat),s.set(i),Q(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,c,r,o,0,n.RGBA,u,s)}),Q(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function zD(n,t,e,r){Q(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),r.data instanceof Uint8Array?Q(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):Q(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),Q(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function GD(n,t,e,r,o){var i=n.createBuffer();Q(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,i)});var a=16*e*r;return Q(n,t,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)}),Q(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,0)}),Q(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),i}function qD(n,t,e){var r=n,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function $D(n,t,e,r,o){var i=Uc(e,r),a=i[0],s=i[1],u=new Uint8Array(e*r*4);return Q(n,t,function(){return n.readPixels(0,0,a,s,o.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function KD(n,t,e,r,o,i,a,s){var f,u=n,c=new Float32Array((f=Ps(i,a))[0]*f[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function XD(n,t,e,r){var o=new Float32Array(e*r*4);return Q(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,o)}),o}var m3=Object.freeze({createVertexShader:kD,createVertexBuffer:PD,createIndexBuffer:OD,createFloat32MatrixTexture:LD,createFloat16MatrixTexture:BD,createUnsignedBytesMatrixTexture:VD,createPackedMatrixTexture:HD,createFloat16PackedMatrixTexture:jD,bindVertexProgramAttributeStreams:WD,uploadDenseMatrixToTexture:UD,uploadPixelDataToTexture:zD,createBufferFromOutputTexture:GD,downloadFloat32MatrixFromBuffer:qD,downloadByteEncodedFloatMatrixFromOutputTexture:$D,downloadPackedMatrixFromBuffer:KD,downloadMatrixFromPackedOutputTexture:XD}),YD=function(){function n(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=P().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,I_(e,t)):this.gl=xr(e);var r="WEBGL_color_buffer_float";if(1===P().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=Os(this.gl,this.debug,"OES_texture_float"),Cn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Os(this.gl,this.debug,"OES_texture_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Cn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Os(this.gl,this.debug,"EXT_color_buffer_half_float");else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(Cn(this.gl,r="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Cn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=PD(this.gl,this.debug),this.indexBuffer=OD(this.gl,this.debug),this.framebuffer=L_(this.gl,this.debug),this.textureConfig=jp(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return P().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;Q(e,this.debug,function(){return e.finish()}),Q(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Q(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),Q(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Q(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Q(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),LD(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),BD(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),VD(this.gl,this.debug,t,e)},n.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),zD(this.gl,this.debug,t,e)},n.prototype.uploadDenseMatrixToTexture=function(t,e,r,o){this.throwIfDisposed(),UD(this.gl,this.debug,t,e,r,o,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),jD(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),HD(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(Up(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Q(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,r){var o=this;return this.downloadMatrixDriver(t,function(){return $D(o.gl,o.debug,e,r,o.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(t,e,r,o,i,a){return KD(this.gl,t,0,0,0,i,a)},n.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return qD(this.gl,t,e)},n.prototype.createBufferFromTexture=function(t,e,r){this.bindTextureToFrameBuffer(t);var o=GD(this.gl,this.debug,e,r);return this.unbindTextureToFrameBuffer(),o},n.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},n.prototype.createFence=function(t){var e,r,o=this;if(P().getBool("WEBGL_FENCE_API_ENABLED")){var i=t,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},e=a}else P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(e,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var o=this;return this.downloadMatrixDriver(t,function(){return XD(o.gl,o.debug,e,r)})},n.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=A_(e,this.debug,t),o=kD(e,this.debug),i=R_(e,this.debug);return Q(e,this.debug,function(){return e.attachShader(i,o)}),Q(e,this.debug,function(){return e.attachShader(i,r)}),N_(e,this.debug,i),this.debug&&qc(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=WD(e,this.debug,this.program,this.vertexBuffer)),i},n.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&Q(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},n.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&qc(this.gl,this.debug,this.program),Q(this.gl,this.debug,function(){return e.gl.useProgram(t)})},n.prototype.getUniformLocation=function(t,e,r){return void 0===r&&(r=!0),this.throwIfDisposed(),r?V_(this.gl,this.debug,t,e):H_(this.gl,t,e)},n.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),Q(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,e)})},n.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},n.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),j_(this.gl,this.debug,0,t,e,r)},n.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},n.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var o=Ps(e,r);this.setOutputMatrixTextureDriver(t,o[0],o[1])},n.prototype.setOutputMatrixWriteRegion=function(t,e,r,o){this.setOutputMatrixWriteRegionDriver(r,t,o,e)},n.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){null!=this.program&&qc(this.gl,this.debug,this.program),Ls(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),Q(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Q(this.gl,this.debug,function(){return t.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Os(this.gl,this.debug,2===P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(2===P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},n.prototype.endQuery=function(){if(2!==P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(t){return J(this,void 0,void 0,function(){var e=this;return Z(this,function(r){switch(r.label){case 0:return[4,Ep(function(){return e.disposed||e.isQueryAvailable(t,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,o.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},n.prototype.pollFence=function(t){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var t=function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},n.prototype.addItemToPoll=function(t,e){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||Ep(function(){return r.pollItems(),0===r.itemsToPoll.length})},n.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),$c(this.gl,this.debug,t,this.framebuffer),this.debug&&Ls(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?($c(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ls(this.gl)):Up(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var r=e();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var o=this.gl;$c(o,this.debug,t,this.framebuffer),this.debug&&Ls(o),this.outputTexture=t,Q(o,this.debug,function(){return o.viewport(0,0,e,r)}),Q(o,this.debug,function(){return o.scissor(0,0,e,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,o){var i=this;this.throwIfDisposed(),Q(this.gl,this.debug,function(){return i.gl.scissor(t,e,r,o)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},n}();function QD(n,t){if(n.length!==t.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+t.length+" inputs");n.forEach(function(e,r){var o=e.logicalShape,i=t[r],a=i.shape;if(!bt(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!bt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var y3=function(n,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var o=e.inChannels,i=e.strideWidth,a=e.strideHeight,s=e.padInfo,u=e.outWidth,c=e.dilationWidth,l=e.dilationHeight,d=e.dataFormat,f=s.left,h=s.top,p=o*e.filterWidth,v=Gt(),g="channelsLast"===d,m=g?0:1,w=g?1:2,y="",b=0;b<=1;b++)for(var x=0;x<=1;x++)y+="\n          blockIndex = rc.y + "+x+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+n[1]+" && pos < "+n[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+a+" - "+h+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+t[m]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+f+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+t[w]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+x)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+x)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+v.output+" = result;\n      }\n    "},b3=function(n,t,e,r,o){this.variableNames=["x"],this.outputShape=[];var a=t,s=n[3]-1;this.outputShape=n;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(val);\n      }\n    "},w3=function(n,t,e,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=t,this.bias=e,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+e+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},x3=function(n,t,e,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a=t,s=n[3]-1;this.outputShape=n;var u="float("+e+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));")+";\n        setOutput(result);\n      }\n    "},_3=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var o=n.effectiveFilterHeight,i=n.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(o-1-n.padInfo.top)+", "+(i-1-n.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+n.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+n.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(o*i-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},D3=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var s=n.effectiveFilterDepth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(s-1-n.padInfo.front)+", "+(u-1-n.padInfo.top)+", "+(c-1-n.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+n.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+n.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+n.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+n.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+n.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+n.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+n.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+n.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+n.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(s*u*c-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},hv=function(n,t,e,r,o,i,a){void 0===e&&(e=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var u=Math.ceil((e?n[1]:n[2])/2),c=e?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",p="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+h+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+d[0]+" * "+f[0]+");\n          result += ("+d[1]+" * "+f[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+v+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},C3=function(){function n(t,e,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,o){null==e.seedLoc&&(e.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(e.seedLoc,t)}},n}(),E3=function(n,t,e,r){this.variableNames=["indices"],this.outputShape=[n,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+e+"),\n                      float(index == coords.y)));\n      }\n    "},I3=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var s,c,l,t=n.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var e=hn("rc",t),r=Je(t),o=function(s,u,c){if(1===s)return"rc > "+u[0];for(var l="",d=s-2;d<s;d++)l+=c[d]+" >= "+u[d],d<s-1&&(l+="||");return l}(t,n,e),i=function(s,u,c,l){if(1===s)return"";var d=l.slice(-2);return"\n    int r = "+d[0]+";\n    int c = "+d[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+u+";\n    bool rEdge = rp1 >= "+c+";\n  "}(t,n[n.length-1],n[n.length-2],e),a=(l=function(d,f){for(var h=[],p=0;p<=1;p++)for(var v=0;v<=1;v++){for(var g=(0===p?"r":"rp1")+", "+(0===v?"c":"cp1"),m=2;m<d;m++)g=f[f.length-1-m]+","+g;h.push(g)}return h}(c=(s=n).length,e),1===c?"getA(rc),\n            rc + 1 >= "+s[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+l[0]+"),\n          cEdge ? 0. : getA("+l[1]+"),\n          rEdge ? 0. : getA("+l[2]+"),\n          rEdge || cEdge ? 0. : getA("+l[3]+")");this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},S3=function(n,t,e){this.variableNames=["x"],this.outputShape=t.map(function(u,c){return u[0]+n[c]+u[1]});var r=n.length,o=Je(r),i=t.map(function(u){return u[0]}).join(","),a=t.map(function(u,c){return u[0]+n[c]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+e+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+e+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},T3=function(n,t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(g,m){return g[0]+n[m]+g[1]});for(var r=n.length,o=Je(r),i=t.map(function(g){return g[0]}).join(","),a=t.map(function(g,m){return g[0]+n[m]}).join(","),s=hn("rc",r),u=hn("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",d=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],f=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,v=1===r?2:4;p<v;p++)h+="\n        "+d[p]+"\n        if ("+f+") {\n          result["+p+"] = float("+e+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(h+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},pv=function(n,t,e){if(this.variableNames=["x"],"avg"===t&&e)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,a=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,l=n.padInfo.top,d=n.padInfo.left;this.outputShape=n.outShape;var f="avg"===t,h="0.0";if(f||(h="-1.0 / 1e-20"),e)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+d+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+n.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var v=4*Math.floor(r/4),g=r%4,m="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+d+");\n      const float initializationValue = "+h+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+h+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+n.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+m+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+m+"\n          } else if ("+(2===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+m+"\n          } else if ("+(3===g)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+m+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},vv=function(n,t,e){if(this.variableNames=["x"],"avg"===t&&e)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,o=n.strideDepth,i=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,c=n.dilationWidth,l=n.effectiveFilterDepth,d=n.effectiveFilterHeight,f=n.effectiveFilterWidth,h=n.padInfo.front,p=n.padInfo.top,v=n.padInfo.left;this.outputShape=n.outShape;var g="avg"===t,m="0.0";if(g||(m="-1.0 / 1e-20"),e)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+i+", "+a+");\n        const ivec3 pads = ivec3("+h+", "+p+", "+v+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+n.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+d+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+n.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+f+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+n.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+d+" * "+f+" +\n                      wR * "+f+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var w=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(w="avgValue / count");var y=4*Math.floor(r/4),b=r%4,x="\n      if ("+g+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+h+", "+p+", "+v+");\n      const float initializationValue = "+m+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+n.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+m+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+n.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+d+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+n.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+y+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+y+";\n            if ("+(1===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+w+");\n        }\n      }\n    "}},M3=function(n,t){this.variableNames=["x"];var e=n.windowSize,r=n.batchSize,o=n.inSize,i=Math.ceil(o/e);this.outputShape=[r,i];var a="0.0",s="";"prod"===t?a="1.0":"min"===t?(a="1.0 / 1e-20",s="min"):"max"===t&&(a="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var c=4*Math.floor(e/4),l=e%4,d="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===t?(a="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===t&&(a="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var h="";o%e>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+e+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+d+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(2===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+d+"\n        } else if ("+(3===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+d+"\n        }\n        setOutput("+u+");\n      }\n    "},A3=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var e="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),e+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+ci(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+lv(n)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+n[1]+";\n        int cols = "+n[2]+";\n\n        "+e+"\n\n        setOutput(result);\n      }\n    "},R3=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=n.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,v=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},N3=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var i=n[1],a=n[2];this.outputShape=[n[0],t,e,n[3]];var u=[r&&t>1?i-1:i,r&&e>1?a-1:a],c=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},F3=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[1],a=n[2],s=n[3];this.outputShape=[n[0],t,e,s];var u=[r&&t>1?i-1:i,r&&e>1?a-1:a],c=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(e-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},k3=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,o=r[1],i=r[2],a=n.shape,s=a[1],u=a[2],c=[e&&s>1?o-1:o,e&&u>1?i-1:i],l=[e&&s>1?s-1:s,e&&u>1?u-1:u],d=c[0]/l[0],f=c[1]/l[1],h=1/d,p=1/f,v=2*Math.ceil(h)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+d+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+h+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+e+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+e+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},P3=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var i=n[1],a=n[2];this.outputShape=[n[0],t,e,n[3]];var u=[r&&t>1?i-1:i,r&&e>1?a-1:a],c=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},O3=function(n,t){this.variableNames=["x"];var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=n,1!==e){var r=n.map(function(i,a){return-1!==t.indexOf(s=a)&&1!==n[s]?n[s]+" - coords["+s+"] - 1":"coords["+s+"]";var s}).join(","),o=Je(e);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+n[0]+" - coord - 1));\n        }\n      "},L3=function(n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=n;var u,r=hn("rc",e),o=r[e-1]+" + 1 < "+this.outputShape[e-1],i=r[e-2]+" + 1 < "+this.outputShape[e-2],a=Je(e);function s(u){var c=n.map(function(l,d){return h=u,-1!==t.indexOf(f=d)&&1!==n[f]?n[f]+" - "+h[f]+" - 1":""+h[f];var f,h});return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=1===e?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+n[0]+" - rc - 1),\n            "+n[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+n[0]+" - (rc  + 1) - 1),\n                "+n[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+s(r.slice())+";\n          if("+o+"){\n            result.g = "+((u=r.slice())[e-1]="("+u[e-1]+" + 1)",s(u)+";\n          }\n          if(")+i+") {\n            result.b = "+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},JD=function(n,t,e,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Je(o.length),u=Je(i.length),c="";1===e?c="i":2===e&&(c="i, j");var d="";1===r?d="i":2===r&&(d="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+n+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(t>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+d+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},B3=function(n,t){this.variableNames=["x","segmentIds"];var e=n.windowSize,r=n.batchSize,o=n.inSize,i=n.numSegments,a=i*Math.ceil(o/e);this.outputShape=[r,a];var s=4*Math.floor(e/4),u=e%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%e>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var d="";o%e>0&&(d="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+d+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+e+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},V3=function(n,t,e){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(1===e)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<t.length;u++)s.push(""+i[u]),u<n&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=Je(e);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},H3=function(){function n(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,r=Je(this.rank),o="uniform int start["+this.rank+"];",i=function(a){if(1===a)return"sourceLoc";if(a<=6)return gv.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);e="\n        "+r+" sourceLoc;\n        "+r+" coords = getOutputCoords();\n        "+t.map(function(a,s){return"sourceLoc."+gv[s]+" = start["+s+"] + coords."+gv[s]+";"}).join("\n")+"\n      ",this.userCode="\n      "+o+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+i+"));\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,t)}},n}(),gv=["x","y","z","w","u","v"],j3=function(){function n(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=Je(this.rank),r=hn("coords",this.rank),o=hn("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s="\n      result.x = "+a+";\n      if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+o[this.rank-1]+";\n        result.y = "+a+";\n        --"+o[this.rank-1]+";\n      }\n    ",u=1===this.rank?"":"\n      --"+r[this.rank-1]+";\n      if (++"+r[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+o[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+r[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+o[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",c=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map(function(l,d){return"start["+d+"]"}).join()+");":t.map(function(l,d){return o[d]+" = "+r[d]+" + start["+d+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+c+"\n        vec4 result = vec4(0.);\n        "+s+"\n        "+u+"\n        setOutput(result);\n      }\n    "}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,o){null==e.startLoc&&(e.startLoc=r.getUniformLocationNoThrow(o,"start"),null==e.startLoc)||r.gl.uniform1iv(e.startLoc,t)}},n}(),W3=function(n,t,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=Je(e.length),i=Je(e.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=e.map(function(u,c){return s++,1===e.length?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+n+");\n      "+o+" strides = "+o+"("+t+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},U3=function(){function n(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(t,e,r){var o,i=ZD(e,r),a=eC(t,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===Dn.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===Dn.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===Dn.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===Dn.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===Dn.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(o),o},n.prototype.releaseTexture=function(t,e,r,o){if(null!=this.freeTextures){var i=eC(e,ZD(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(t);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},n.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(o){t.gpgpu.deleteMatrixTexture(o)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function ZD(n,t){if(n===_n.UPLOAD)return Dn.PACKED_2X2_FLOAT32;if(n===_n.RENDER||null==n)return e=t,P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Dn.PACKED_2X2_FLOAT32:Dn.UNPACKED_FLOAT32:e?Dn.PACKED_2X2_FLOAT16:Dn.UNPACKED_FLOAT16;var e;if(n===_n.DOWNLOAD||n===_n.PIXELS)return Dn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function eC(n,t,e){return n[0]+"_"+n[1]+"_"+t+"_"+e}var z3=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[r]*t[r];this.outputShape=e,this.rank=e.length;var o=Je(this.rank),i=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(1===s)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()}(n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},G3=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];this.outputShape=e,this.rank=e.length;var o=Je(this.rank),i=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()}(t);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},q3=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Je(this.rank),i=_D("rc",this.rank),a=new Array(this.rank);for(r=0;r<t.length;r++)a[t[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+e[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+e[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},ye=function(n,t){this.variableNames=["A"],this.outputShape=n,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},ir="if (isnan(x)) return x;",tC="return abs(x);",nC=ir+"\n  return (x < 0.0) ? 0.0 : x;\n",rC=ir+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",oC="return (x >= 0.0) ? x : (exp(x) - 1.0);",iC="return -x;",aC="return ceil(x);",sC="return floor(x);",uC="return exp(x);",cC="return exp(x) - 1.0;",dl="return x;",lC="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",dC="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",fC="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",$s=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},o4=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var t=n.length,e=hn("rc",t),r=Je(t),o=function(s,u){if(1===s)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c}(t,e),i=e.slice(-2),a=t<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},fl={};function hl(n,t){if(void 0===t&&(t=!1),"linear"===n)return"return x;";if("relu"===n)return t?lC:nC;if("elu"===n)return t?fC:oC;if("relu6"===n)return t?dC:rC;if("prelu"===n)return t?TD:SD;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var hC=function(n){function t(e){var r,o=n.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!P().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var i=xr(P().getNumber("WEBGL_VERSION"));o.binaryCache=((r=P().getNumber("WEBGL_VERSION"))in fl||(fl[r]={}),fl[r]),o.gpgpu=new YD(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=e,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=e.gl.canvas;return o.textureManager=new U3(o.gpgpu),o.numMBBeforeWarning=null==P().global.screen?1024:P().global.screen.height*P().global.screen.width*window.devicePixelRatio*600/1024/1024,o.texData=new pD(o,M),o}return Zn(t,n),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,r,o){if(P().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===o&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:_n.UPLOAD}),i},t.prototype.move=function(e,r,o,i){if(P().getBool("DEBUG")&&this.checkNumericalProblems(r),"complex64"===i)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:_n.UPLOAD})},t.prototype.readSync=function(e){var r=this.texData.get(e),o=r.values,i=r.dtype,a=r.complexTensors,u=r.shape;if(null!=r.slice){var l;l=r.isPacked?new $s(u,dl):new ye(u,dl);var d=this.runWebGLProgram(l,[{dataId:e,shape:u,dtype:i}],i),f=this.readSync(d.dataId);return this.disposeData(d.dataId),f}if(null!=o)return this.convertAndCacheOnCPU(e);if("string"===i)return o;var h,p,v=null!=this.activeTimers;return v&&(h=tr()),p="complex64"===i?av(a.real.dataSync(),a.imag.dataSync()):this.getValuesFromTexture(e),v&&(this.downloadWaitMs+=tr()-h),this.convertAndCacheOnCPU(e,p)},t.prototype.read=function(e){return J(this,void 0,void 0,function(){var r,o,i,a,u,c,l,d,f,h,p,v,g,m,w,x,_,T,S;return Z(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(I){return r.push(I)})];if(o=this.texData.get(e),i=o.values,a=o.shape,u=o.dtype,c=o.complexTensors,l=o.isPacked,null!=o.slice)return d=l?new $s(a,dl):new ye(a,dl),f=this.runWebGLProgram(d,[{dataId:e,shape:a,dtype:u}],u),h=this.read(f.dataId),this.disposeData(f.dataId),[2,h];if(null!=i)return[2,this.convertAndCacheOnCPU(e)];if(!P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===P().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==u&&P().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(e),g=this.texData.get(v.dataId),p=(S=this.gpgpu).createBufferFromTexture.apply(S,[g.texture].concat(ks(a)))),this.pendingRead.set(e,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return w=E.sent(),m=av(w[0],w[1]),[3,5];case 4:null==p?m=this.getValuesFromTexture(e):(x=ee(a),m=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),E.label=5;case 5:return null!=v&&this.disposeData(v.dataId),_=this.convertAndCacheOnCPU(e,m),T=this.pendingRead.get(e),this.pendingRead.delete(e),T.forEach(function(I){return I(_)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,_]}})})},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var r=0;r<e.length;r++){var o=e[r];if(!S_(o))throw P().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.isPacked,u=ee(i);if(P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(e),l=this.texData.get(c.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(ks(i))).subarray(0,u);return this.disposeData(c.dataId),d}var f=P().getBool("WEBGL_PACK")&&!0===s,h=f?Kc(i):i,p=f?new c3(h):new u3(h),v=this.runWebGLProgram(p,[{shape:h,dtype:a,dataId:e}],"float32"),g=this.texData.get(v.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(v.dataId),m},t.prototype.time=function(e){return J(this,void 0,void 0,function(){var r,o,i,a,s,u,c;return Z(this,function(l){switch(l.label){case 0:return r=this.activeTimers,o=[],i=!1,null==this.programTimersStack?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e(),a=Xr(this.activeTimers.map(function(d){return d.query})).filter(function(d){return null!=d}),s=Xr(this.activeTimers.map(function(d){return d.name})).filter(function(d){return null!=d}),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=u_(c),u.getExtraProfileInfo=function(){return c.map(function(d,f){return{name:s[f],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:tr(),endMs:null}},t.prototype.endTimer=function(e){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=tr(),e)},t.prototype.getQueryTime=function(e){return J(this,void 0,void 0,function(){var r;return Z(this,function(o){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var r=this.texData.get(e),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||e,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),null!=o&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return P().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=M.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,r){var o=this;return void 0===r&&(r=128),null!=this.getCPUBackend()&&e.every(function(i){return null==o.texData.get(i.dataId).texture&&i.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,r){var o=this.makeOutput(e.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:M.keep(e.clone()),imag:M.keep(r.clone())},o},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,o);if(0===ee(o))return Ht([],o,e.dtype);var i=this.texData.get(e.dataId).isPacked,a=ev(e.shape,r,o);if(i||!a){var s=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new j3(o):new H3(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,o)},t.prototype.shallowSlice=function(e,r,o){var i=this.texData.get(e.dataId),a=this.makeOutput(o,e.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=e.dtype;var u=tv(r,e.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||e.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},t.prototype.stridedSlice=function(e,r,o,i){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,o,i);var a=ol(r,o,i);if(a.some(function(u){return 0===u}))return Ht([],a);var s=new W3(r,i,a);return this.compileAndRun(s,[e])},t.prototype.reverse=function(e,r){var o=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new L3(e.shape,r):new O3(e.shape,r);return this.compileAndRun(o,[e])},t.prototype.concat=function(e,r){if("complex64"===e[0].dtype){var o=e.map(function(h){return Ln(h)}),i=e.map(function(h){return Dr(h)});return Vt(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(1===e.length)return e[0];if(e.length>P().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(e.length/2),s=this.concat(e.slice(0,a),r),u=this.concat(e.slice(a),r);return this.concat([s,u],r)}if(P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var c=new KB(e.map(function(h){return h.shape}),r);return this.compileAndRun(c,e)}var l=oi(e.map(function(h){return h.shape}),r),d=e.map(function(h){return h.as2D(-1,ee(h.shape.slice(r)))}),f=new $B(d.map(function(h){return h.shape}));return this.compileAndRun(f,d).reshape(l)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,iC,e.dtype);var r=new ye(e.shape,iC);return this.compileAndRun(r,[e])},t.prototype.batchMatMul=function(e,r,o,i){var a=o?e.shape[2]:e.shape[1],s=i?r.shape[1]:r.shape[2],u=o?e.shape[1]:e.shape[2],c=e.shape[0];if((1===a||1===s)&&u>1e3){o&&(e=e.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var l=1===s?e:e.as3D(c,u,1),d=1===s?2:1,f=1===s?r.as3D(c,1,u):r;return this.multiply(l,f).sum(d,!0)}var h=Nt(e.dtype,r.dtype),p=new hv(e.shape,[c,a,s],o,i);return this.compileAndRun(p,[e,r],h)},t.prototype.fusedBatchMatMul=function(e){var r=e.a,o=e.b,i=e.transposeA,a=e.transposeB,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=i?r.shape[2]:r.shape[1],d=a?o.shape[1]:o.shape[2],f=r.shape[0],h=Nt(r.dtype,o.dtype),p=null!=s,v=null!=c,g=u?hl(u,!0):null,m=new hv(r.shape,[f,l,d],i,a,p,g,v),w=[r,o];return s&&w.push(s),c&&w.push(c),this.compileAndRun(m,w,h)},t.prototype.multiply=function(e,r){if("complex64"===e.dtype){var o=this.texData.get(e.dataId),i=this.texData.get(r.dataId),a=new ED("return areal * breal - aimag * bimag;",e.shape,r.shape),s=new ED("return areal * bimag + aimag * breal;",e.shape,r.shape),u=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),d=this.complex(c,l);return c.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,ID,e.dtype);var f=new lt(ID,e.shape,r.shape);return this.compileAndRun(f,[e,r],e.dtype)},t.prototype.batchNormalization=function(e,r,o,i,a,s){var u=[e,r,o],c=null;null!=s&&(c=s.shape,u.push(s));var l=null;if(null!=a&&(l=a.shape,u.push(a)),P().getBool("WEBGL_PACK_NORMALIZATION")){var d=new jB(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(d,u)}var f=new HB(e.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(f,u)},t.prototype.localResponseNormalization4D=function(e,r,o,i,a){var s=P().getBool("WEBGL_PACK_NORMALIZATION")?new x3(e.shape,r,o,i,a):new b3(e.shape,r,o,i,a);return this.compileAndRun(s,[e])},t.prototype.LRNGrad=function(e,r,o,i,a,s,u){var c=new w3(r.shape,i,a,s,u);return this.compileAndRun(c,[r,o,e])},t.prototype.tile=function(e,r){if("string"===e.dtype){var o=this.readSync(e.dataId).map(function(a){return Ts(a)});return wD(ve(e.shape,e.dtype,o),r)}var i=new z3(e.shape,r);return this.compileAndRun(i,[e])},t.prototype.pad=function(e,r,o){var i=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new T3(e.shape,r,o):new S3(e.shape,r,o);return this.compileAndRun(i,[e])},t.prototype.transpose=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,r);var o=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new q3(e.shape,r):new G3(e.shape,r);return this.compileAndRun(o,[e])},t.prototype.gather=function(e,r,o){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,o);var i=new v3(e.shape,r.size,o);return this.compileAndRun(i,[e,r])},t.prototype.batchToSpaceND=function(e,r,o){C(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(d,f){return d*f}),a=el(e.shape,r,i),s=tl(a.length,r.length),u=nl(e.shape,r,i),c=sD(o,r.length),l=uD(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},t.prototype.spaceToBatchND=function(e,r,o){C(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=el(u.shape,r,i,!1),l=tl(c.length,r.length,!1),d=nl(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},t.prototype.reduce=function(e,r,o){var i=e.shape[0],a=e.shape[1],s=rl(a),u=new M3({windowSize:s,inSize:a,batchSize:i},r),c=this.compileAndRun(u,[e],o);return 1===c.shape[1]?c:this.reduce(c,r,o)},t.prototype.argReduce=function(e,r,o){void 0===o&&(o=null);var i=e.shape[0],a=e.shape[1];null!=o&&(i=o.shape[0],a=o.shape[1]);var s=rl(a),u=new RB({windowSize:s,inSize:a,batchSize:i},r,null==o),c=[e];null!=o&&c.push(o);var l=this.compileAndRun(u,c,"int32");return 1===l.shape[1]?l:this.argReduce(e,r,l)},t.prototype.argReducePacked=function(e,r,o){void 0===o&&(o=null);var i=null!=o?o.shape:e.shape,a=rl(i[i.length-1]),s=new LB(i,a,r,null==o),c=this.compileAndRun(s,null==o?[e]:[e,o],"int32");return c.rank===e.rank?this.argReducePacked(e,r,c):c},t.prototype.sum=function(e,r){dn("sum",r,e.rank);var o=Bt(e.shape,r),i=o[0],a=ee(o[1]),s=e.as2D(-1,a),u=Lp(e.dtype);return this.reduce(s,"sum",u).reshape(i)},t.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var o=Bt(e.shape,r),i=o[0],a=ee(o[1]),s=e.as2D(-1,a),u=Lp(e.dtype);return this.reduce(s,"prod",u).reshape(i)},t.prototype.unsortedSegmentSum=function(e,r,o){var i=0,a=nr([i],e.rank),s=e;null!=a&&(s=e.transpose(a),i=rr(1,e.rank)[0]);var u=function(h,p,v){for(var g=[],m=h.length,w=0;w<m;w++)g.push(w!==p?h[w]:v);return g}(s.shape,i,o),c=ee([s.shape[i]]),l=s.as2D(-1,c),d=Lp(e.dtype),f=this.segOpCompute(l,"unsortedSegmentSum",r,d,o).reshape(u);return null!=a&&(f=f.transpose(Qc(a))),f},t.prototype.segOpCompute=function(e,r,o,i,a){var s=e.shape[0],u=e.shape[1],c=function(f,h){var p,v=!1;for(f<=30?(p=f,v=!0):p=Wc(f,Math.floor(Math.sqrt(f)));!v;)p>h||p===f?v=!0:p=Wc(f,p+1);return p}(u,a),l=new B3({windowSize:c,inSize:u,batchSize:s,numSegments:a},r),d=this.compileAndRun(l,[e,o],i);return d.shape[1]===a?d:(o=Jc(0,a).tile([u/c]),this.segOpCompute(d,r,o,i,a))},t.prototype.argMinMaxReduce=function(e,r,o){var i=[r];if(dn("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,e.rank),!P().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=Bt(e.shape,i),s=a[0],u=ee(a[1]),c=e.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(e,o)},t.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},t.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},t.prototype.cumsum=function(e,r,o,i){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var a=new r3(e.shape,o,i);return this.compileAndRun(a,[e])},t.prototype.equal=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(equal(a, b));\n","bool");var o=new lt("return float(a == b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.notEqual=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(notEqual(a, b));\n","bool");var o=new lt("return float(a != b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThan(a, b));\n","bool");var o=new lt("return float(a < b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.lessEqual=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(lessThanEqual(a, b));\n","bool");var o=new lt("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThan(a, b));\n","bool");var o=new lt("return float(a > b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.greaterEqual=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var o=new lt("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.logicalNot=function(e){var r=new ye(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},t.prototype.logicalAnd=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var o=new lt("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.logicalOr=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var o=new lt("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r],"bool")},t.prototype.select=function(e,r,o){var i=new V3(e.rank,r.shape,r.rank);return this.compileAndRun(i,[e,r,o],Nt(r.dtype,o.dtype))},t.prototype.where=function(e){Yc("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return cv(e.shape,r)},t.prototype.topk=function(e,r,o){return xD(e.dataSync(),e.shape,e.dtype,r)},t.prototype.min=function(e,r){dn("min",r,e.rank);var o=Bt(e.shape,r),i=o[0],a=ee(o[1]),s=e.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},t.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eo("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new lt("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.mod=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eo("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new lt("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);dn("max",r,e.rank);var o=Bt(e.shape,r),i=o[0],a=ee(o[1]),s=e.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},t.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eo("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new lt("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.all=function(e,r){dn("all",r,e.rank);var o=Bt(e.shape,r),i=o[0],a=ee(o[1]),s=e.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},t.prototype.any=function(e,r){dn("any",r,e.rank);var o=Bt(e.shape,r),i=o[0],a=ee(o[1]),s=e.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},t.prototype.realDivide=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var o=new lt("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,r.shape);return this.compileAndRun(o,[e,r],"float32")},t.prototype.floorDiv=function(e,r){if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var o=new lt("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,r.shape);return this.compileAndRun(o,[e,r],"int32")},t.prototype.add=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,dv);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var o=Nt(e.dtype,r.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,dv,o);var i=new lt(dv,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},t.prototype.packedUnaryOp=function(e,r,o){var i=new $s(e.shape,r);return this.compileAndRun(i,[e],o)},t.prototype.packedBinaryOp=function(e,r,o,i,a){void 0===a&&(a=!1);var s=new eo(o,e.shape,r.shape,a);return this.compileAndRun(s,[e,r],i)},t.prototype.complexSeparableBinaryOp=function(e,r,o){var i=this,a=this.texData.get(e.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(f){var h=f[0],p=f[1],v=i.makeComplexComponentTensorInfo(e,h),g=i.makeComplexComponentTensorInfo(r,p),m=new lt(o,e.shape,r.shape);return i.compileAndRun(m,[v,g],Nt(h.dtype,p.dtype))}),c=u[0],l=u[1],d=this.complex(c,l);return c.dispose(),l.dispose(),d},t.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>P().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),o=this.addN(e.slice(0,r)),i=this.addN(e.slice(r));return this.addN([o,i])}var a=e.map(function(c){return c.dtype}).reduce(function(c,l){return Nt(c,l)}),s=e.map(function(c){return c.shape}),u=P().getBool("WEBGL_PACK")?new AB(e[0].shape,s):new MB(e[0].shape,s);return this.compileAndRun(u,e,a)},t.prototype.subtract=function(e,r){if("complex64"===e.dtype&&"complex64"===r.dtype)return this.complexSeparableBinaryOp(e,r,fv);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var o=Nt(e.dtype,r.dtype);if(P().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,fv,e.dtype);var i=new lt(fv,e.shape,r.shape);return this.compileAndRun(i,[e,r],o)},t.prototype.pow=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eo("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new lt("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,r.shape),i=Nt(e.dtype,r.dtype);return this.compileAndRun(o,[e,r],i)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,aC,e.dtype);var r=new ye(e.shape,aC);return this.compileAndRun(r,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,sC,e.dtype);var r=new ye(e.shape,sC);return this.compileAndRun(r,[e])},t.prototype.sign=function(e){var r=new ye(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(r,[e])},t.prototype.isNaN=function(e){var r=new ye(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isInf=function(e){var r=new ye(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isFinite=function(e){var r=new ye(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.round=function(e){var r=new ye(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(r,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,uC,e.dtype);var r=new ye(e.shape,uC);return this.compileAndRun(r,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,cC,e.dtype);var r=new ye(e.shape,cC);return this.compileAndRun(r,[e])},t.prototype.softmax=function(e,r){var o=wt([r],e.shape),i=this.max(e,o),a=rn(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var r=new ye(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(r,[e])},t.prototype.log1p=function(e){var r=new ye(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},t.prototype.sqrt=function(e){var r=new ye(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new ye(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},t.prototype.reciprocal=function(e){var r=new ye(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},t.prototype.relu=function(e){var r;return r=P().getBool("WEBGL_PACK")?new $s(e.shape,lC):new ye(e.shape,nC),this.compileAndRun(r,[e])},t.prototype.relu6=function(e){var r;return r=P().getBool("WEBGL_PACK")?new $s(e.shape,dC):new ye(e.shape,rC),this.compileAndRun(r,[e])},t.prototype.prelu=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eo(TD,e.shape,r.shape):new lt(SD,e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.elu=function(e){if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,fC,e.dtype);var r=new ye(e.shape,oC);return this.compileAndRun(r,[e])},t.prototype.eluDer=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eo("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,r.shape):new lt("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.selu=function(e){var r=new ye(e.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(r,[e])},t.prototype.int=function(e){var r=new ye(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},t.prototype.clip=function(e,r,o){var i,a=(i=P().getBool("WEBGL_PACK_CLIP")?new GB(e.shape):new zB(e.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[e],null,a)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,tC,e.dtype);var r=new ye(e.shape,tC);return this.compileAndRun(r,[e])},t.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),o=new qB(e.shape),i=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(o,i)},t.prototype.sigmoid=function(e){var r=new ye(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},t.prototype.softplus=function(e){var r=new ye(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(r,[e])},t.prototype.sin=function(e){var r=new ye(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(r,[e])},t.prototype.cos=function(e){var r=new ye(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(r,[e])},t.prototype.tan=function(e){var r=new ye(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},t.prototype.asin=function(e){var r=new ye(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(r,[e])},t.prototype.acos=function(e){var r=new ye(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(r,[e])},t.prototype.atan=function(e){var r=new ye(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(r,[e])},t.prototype.atan2=function(e,r){var o=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eo("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,r.shape):new lt("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,r.shape);return this.compileAndRun(o,[e,r])},t.prototype.sinh=function(e){var r=new ye(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},t.prototype.cosh=function(e){var r=new ye(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(r,[e])},t.prototype.tanh=function(e){var r=new ye(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(r,[e])},t.prototype.asinh=function(e){var r=new ye(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(r,[e])},t.prototype.acosh=function(e){var r=new ye(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(r,[e])},t.prototype.atanh=function(e){var r=new ye(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(r,[e])},t.prototype.erf=function(e){var r=new ye(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(r,[e])},t.prototype.step=function(e,r){var i,o=new ye(e.shape,(void 0===(i=r)&&(i=0),ir+"\n    return x > 0.0 ? 1.0 : float("+i+");\n  "));return this.compileAndRun(o,[e])},t.prototype.conv2dByMatMul=function(e,r,o,i,a,s){var u=e.shape,c=this.texData.get(e.dataId),h="channelsLast"===o.dataFormat,v=u[2]%2!=0&&!!c.isPacked;if((1==u[0]*u[1]*u[2]||1===o.outChannels)&&o.inChannels>1e3||!P().getBool("WEBGL_LAZILY_UNPACK")||!P().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var m=this.reshape(e,[1,h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],o.inChannels]),w=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:w,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var b={dataId:e.dataId,shape:[1,h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),o.inChannels],dtype:e.dtype},x=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,C(Hs(c.shape,b.shape),function(){return"packed reshape "+c.shape+" to "+b.shape+" isn't free"});var _=this.reshape(r,[1,o.inChannels,o.outChannels]),T=this.fusedBatchMatMul({a:b,b:_,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),S=this.texData.get(T.dataId);return C(S.isPacked,function(){return"batchMatMul result is expected to be packed"}),c.shape=x,S.shape=o.outShape,M.makeTensorFromDataId(T.dataId,o.outShape,T.dtype)},t.prototype.conv2dWithIm2Row=function(e,r,o,i,a,s){var d=o.outWidth,f=o.outHeight,h="channelsLast"===o.dataFormat,p=o.filterWidth*o.filterHeight*o.inChannels,v=f*d,g=[p,v],m=e.squeeze([0]),w=r.reshape([1,p,-1]),y=new y3(g,m.shape,o),b=this.compileAndRun(y,[m]).reshape([1,g[0],g[1]]),x=null!=i,_=null!=s,T=a?hl(a,!0):null,S=new hv(b.shape,[1,v,o.outChannels],!0,!1,x,T,_),E=[b,w];return i&&E.push(i),_&&E.push(s),this.compileAndRun(S,E).reshape(h?[1,f,d,o.outChannels]:[1,o.outChannels,f,d])},t.prototype.fusedConv2d=function(e){var r=e.input,o=e.filter,i=e.convInfo,a=e.bias,s=e.activation,u=e.preluActivationWeights;if(1===i.filterHeight&&1===i.filterWidth&&1===i.dilationHeight&&1===i.dilationWidth&&1===i.strideHeight&&1===i.strideWidth&&("SAME"===i.padInfo.type||"VALID"===i.padInfo.type))return this.conv2dByMatMul(r,o,i,a,s,u);if(P().getBool("WEBGL_CONV_IM2COL")&&1===r.shape[0])return this.conv2dWithIm2Row(r,o,i,a,s,u);var c=null!=a,l=null!=u,d=s?hl(s,!1):null,f=new MD(i,c,d,l),h=[r,o];return a&&h.push(a),u&&h.push(u),this.compileAndRun(f,h)},t.prototype.conv2d=function(e,r,o){if(1===o.filterHeight&&1===o.filterWidth&&1===o.dilationHeight&&1===o.dilationWidth&&1===o.strideHeight&&1===o.strideWidth&&("SAME"===o.padInfo.type||"VALID"===o.padInfo.type))return this.conv2dByMatMul(e,r,o);if(P().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,r,o);var i=new MD(o);return this.compileAndRun(i,[e,r])},t.prototype.conv2dDerInput=function(e,r,o){var i=new YB(o);return this.compileAndRun(i,[e,r])},t.prototype.conv2dDerFilter=function(e,r,o){var i=new XB(o);return this.compileAndRun(i,[e,r])},t.prototype.fusedDepthwiseConv2D=function(e){var r,o=e.input,i=e.filter,a=e.convInfo,s=e.bias,u=e.activation,c=e.preluActivationWeights,l=P().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,d=u?hl(u,l):null,f=[o,i],h=null!=s,p=null!=c;return h&&f.push(s),p&&f.push(c),l?(r=new RD(a,h,d,p),this.compileAndRun(r,f)):(r=new AD(a,h,d,p),this.compileAndRun(r,f))},t.prototype.depthwiseConv2D=function(e,r,o){var i;return P().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new RD(o),this.compileAndRun(i,[e,r])):(i=new AD(o),this.compileAndRun(i,[e,r]))},t.prototype.depthwiseConv2DDerInput=function(e,r,o){var i=new e3(o);return this.compileAndRun(i,[e,r])},t.prototype.depthwiseConv2DDerFilter=function(e,r,o){var i=new ZB(o);return this.compileAndRun(i,[e,r])},t.prototype.conv3d=function(e,r,o){var i=new t3(o);return this.compileAndRun(i,[e,r])},t.prototype.conv3dDerInput=function(e,r,o){var i=new JB(o);return this.compileAndRun(i,[e,r])},t.prototype.conv3dDerFilter=function(e,r,o){var i=new QB(o);return this.compileAndRun(i,[e,r])},t.prototype.maxPool=function(e,r){var o=new pv(r,"max",!1);return this.compileAndRun(o,[e])},t.prototype.avgPool=function(e,r){var o=new pv(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.maxPoolBackprop=function(e,r,o,i){var a=new pv(i,"max",!0),s=this.compileAndRun(a,[r]),u=new _3(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},t.prototype.avgPoolBackprop=function(e,r,o){var i=new BB(o);return this.compileAndRun(i,[e],r.dtype)},t.prototype.cast=function(e,r){return ov(e,r,this)},t.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},t.prototype.avgPool3d=function(e,r){var o=new vv(r,"avg",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,r,o){var i=new VB(o);return this.compileAndRun(i,[e],r.dtype)},t.prototype.maxPool3d=function(e,r){var o=new vv(r,"max",!1);return this.compileAndRun(o,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,r,o,i){var a=new vv(i,"max",!0),s=this.compileAndRun(a,[r]),u=new D3(i),c=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),c},t.prototype.reshape=function(e,r){var o=this.texData.get(e.dataId);if(o.isPacked&&!Hs(e.shape,r)&&(null===o.texture||!Hs(o.shape,r))){var i=this.packedReshape(e,r);return M.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return cl(e,r)},t.prototype.resizeBilinear=function(e,r,o,i){var a=P().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new F3(e.shape,r,o,i):new N3(e.shape,r,o,i);return this.compileAndRun(a,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,r,o){var i=new R3(e,r,o);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighbor=function(e,r,o,i){var a=new P3(e.shape,r,o,i);return this.compileAndRun(a,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,r,o){var i=new k3(e,r,o);return this.compileAndRun(i,[e])},t.prototype.multinomial=function(e,r,o,i){var a=r?e:Jr(e),c=new C3(a.shape[0],a.shape[1],o),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[a],"int32",l)},t.prototype.oneHot=function(e,r,o,i){var a=new E3(e.size,r,o,i);return this.compileAndRun(a,[e])},t.prototype.diag=function(e){var r=new s3(e.size);return this.compileAndRun(r,[e])},t.prototype.nonMaxSuppression=function(e,r,o,i,a){return Yc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),sv(e.dataSync(),r.dataSync(),o,i,a)},t.prototype.cropAndResize=function(e,r,o,i,a,s){var u=new n3(e.shape,r.shape,i,a,s);return this.compileAndRun(u,[e,r,o],"float32")},t.prototype.depthToSpace=function(e,r,o){C(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var i=e.shape[0],c=("NHWC"===o?e.shape[1]:e.shape[2])*r,l=("NHWC"===o?e.shape[2]:e.shape[3])*r,d=("NHWC"===o?e.shape[3]:e.shape[1])/(r*r),f=new a3("NHWC"===o?[i,c,l,d]:[i,d,c,l],r,o);return this.compileAndRun(f,[e])},t.prototype.split=function(e,r,o){return bD(e,r,o)},t.prototype.scatterND=function(e,r,o){var i=Ws(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=[l/u,u],f=e.reshape([s,a]),h=r.reshape([s,u]);if(0===l)return cl(Ht([]),o);var p=q(0),v=new JD(s,a,f.rank,h.rank,c,d);return this.compileAndRun(v,[h,f,p]).reshape(o)},t.prototype.sparseToDense=function(e,r,o,i){var a=Ws(0,e,o),d=new JD(a.numUpdates,a.sliceRank,e.rank,r.rank,a.strides,[a.outputSize,1],!1);return this.compileAndRun(d,[r,e,i]).reshape(o)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,r){var o=this.texData.get(e.dataId),i=new FD("return real * expR - imag * expI;",e.shape,r),a=new FD("return real * expI + imag * expR;",e.shape,r),s=[this.makeComplexComponentTensorInfo(e,o.complexTensors.real),this.makeComplexComponentTensorInfo(e,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(e.shape[0],e.shape[1]);return u.dispose(),c.dispose(),l},t.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=Qp(e,r),s=a[0],u=a[1],c=a[2],l=a[3],d=r.reshape([u,i]),f=e.reshape([e.size/c,c]),h=new g3(i,l,[u,c]);return this.compileAndRun(h,[f,d]).reshape(s)},t.prototype.fill=function(e,r,o){if("string"===(o=o||ua(r))){var i=Ss(o,ee(e));return i.fill(r),M.makeTensor(i,e,o,this)}var a=new p3(e,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,r,o){return iv(e,r,o)},t.prototype.makeTensorInfo=function(e,r){var o=this.write(null,e,r);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:r}},t.prototype.makeOutput=function(e,r){var o=this.makeTensorInfo(e,r).dataId;return M.makeTensorFromDataId(o,e,r,this)},t.prototype.unpackTensor=function(e){var r=new o4(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},t.prototype.packTensor=function(e){var r=new I3(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,r){var o=[Bs(e.shape)].concat(Vs(e.shape)),i={dtype:e.dtype,shape:o,dataId:e.dataId},a=[Bs(r)].concat(Vs(r)),s=new A3(a,o),u=this.runWebGLProgram(s,[i],e.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},t.prototype.decode=function(e){var r,o=this.texData.get(e),i=o.isPacked,a=o.shape,s=o.dtype,u=Kc(a);return r=i?new i3(u):new o3(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,r,o,i,a){var s=this;void 0===a&&(a=!1);var u=this.makeTensorInfo(e.outputShape,o),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===Fs.DENSE){var l=ks(e.outputShape);c.texShape=l.map(function(y){return 2*y})}if(null!=e.outTexUsage&&(c.usage=e.outTexUsage),0===ee(u.shape))return c.values=sa(u.dtype,0),u;var d=[],f=r.map(function(y){if("complex64"===y.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=s.texData.get(y.dataId);if(null==b.texture){if(!e.packedInputs&&ee(y.shape)<=P().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}else if(!!b.isPacked!=!!e.packedInputs)y=b.isPacked?s.unpackTensor(y):s.packTensor(y),d.push(y),b=s.texData.get(y.dataId);else if(b.isPacked&&!Hs(b.shape,y.shape)){var x=y,_=y.shape;y.shape=b.shape,y=s.packedReshape(y,_),d.push(y),b=s.texData.get(y.dataId),x.shape=_}return s.uploadToGPU(y.dataId),{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(u.dataId);var h,y,_,p={shape:u.shape,texData:c,isUniform:!1},v=(y=e,_="",f.concat(p).forEach(function(E){_+=E.shape+"_"+(E.isUniform?"uniform":E.texData.texShape)+"_"+(null!=E.texData&&null!=E.texData.slice&&E.texData.slice.flatOffset>0)}),y.constructor.name+"_"+_+"_"+y.userCode),g=this.getAndSaveBinary(v,function(){return function(y,b,x,_){var T=b.userCode,S=x.map(function(V,z){var G={logicalShape:V.shape,texShape:V.isUniform?null:V.texData.texShape,isUniform:V.isUniform,isPacked:!V.isUniform&&V.texData.isPacked,flatOffset:null};return null!=V.texData&&null!=V.texData.slice&&V.texData.slice.flatOffset>0&&(G.flatOffset=V.texData.slice.flatOffset),{name:b.variableNames[z],shapeInfo:G}}),E=S.map(function(V){return V.shapeInfo}),I={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},N=NB(S,I,T,b.packedInputs),R=y.createProgram(N),B=null,O=y.getUniformLocation(R,"NAN",!1);1===P().getNumber("WEBGL_VERSION")&&(B=y.getUniformLocation(R,"INFINITY",!1));for(var L={},H=0;H<b.variableNames.length;H++){var j=b.variableNames[H];L[j]=y.getUniformLocation(R,j,!1),L["offset"+j]=y.getUniformLocation(R,"offset"+j,!1)}return{program:b,source:N,webGLProgram:R,uniformLocations:L,inShapeInfos:E,outShapeInfo:I,infLoc:B,nanLoc:O}}(s.gpgpu,e,f,p)}),m=null!=this.activeTimers;if(m&&(h=this.startTimer()),function(y,b,x,_,T){QD(b.inShapeInfos,x),QD([b.outShapeInfo],[_]);var S=_.texData.texture,E=_.texData.texShape;_.texData.isPacked?y.setOutputPackedMatrixTexture(S,E[0],E[1]):y.setOutputMatrixTexture(S,E[0],E[1]),y.setProgram(b.webGLProgram),1===P().getNumber("WEBGL_VERSION")&&null!==b.infLoc&&y.gl.uniform1f(b.infLoc,1/0),null!==b.nanLoc&&y.gl.uniform1f(b.nanLoc,NaN),x.forEach(function(I,N){var R=b.program.variableNames[N],B=b.uniformLocations[R],O=b.uniformLocations["offset"+R];if(null!=B)if(I.isUniform)if(ee(I.shape)<2)y.gl.uniform1f(B,I.uniformValues[0]);else{var L=I.uniformValues;L instanceof Float32Array||(L=new Float32Array(L)),y.gl.uniform1fv(B,L)}else null!=I.texData.slice&&null!=O&&y.gl.uniform1i(O,I.texData.slice.flatOffset),y.setInputMatrixTexture(I.texData.texture,B,N)}),T?.(y,b.webGLProgram),y.executeProgram()}(this.gpgpu,g,f,p,i),d.forEach(function(y){return s.disposeData(y.dataId)}),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!P().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===a){var w=this.unpackTensor(u);return this.disposeData(u.dataId),w}return u},t.prototype.compileAndRun=function(e,r,o,i,a){void 0===a&&(a=!1);var s=this.runWebGLProgram(e,r,o=o||r[0].dtype,i,a);return M.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},t.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(P().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),null!=this.canvas&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Y(function(){if(!P().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=P().getBool("DEBUG");P().set("DEBUG",!1);var o=e.abs(q(1e-8)).dataSync()[0];if(P().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var r,o=this.texData.get(e),i=o.shape,a=o.dtype,s=o.values,c=o.usage,l=o.isPacked;if(null==o.texture){var d,f=null!=this.activeTimers;f&&(d=tr());var h=o.texShape;if(null==h&&(h=z_(i,l),o.texShape=h),null!=s){var p=Kc(i),v=void 0,g=h[1],m=h[0],w=s instanceof Uint8Array;l?(g=(r=Ps(h[0],h[1]))[0],v=new d3(p,[m=r[1],g],w)):v=new l3(p,[m,g],w);var y=this.makeTensorInfo([m,g],a);this.texData.get(y.dataId).usage=w?_n.PIXELS:_n.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),g,m,s);var b=this.runWebGLProgram(v,[y],a,null,!0),x=this.texData.get(b.dataId);o.texture=x.texture,o.texShape=x.texShape,o.isPacked=x.isPacked,o.usage=x.usage,this.disposeData(y.dataId),this.texData.delete(b.dataId),o.values=null,f&&(this.uploadWaitMs+=tr()-d)}else{var _=this.acquireTexture(h,c,a,l);o.texture=_}}},t.prototype.convertAndCacheOnCPU=function(e,r){var o=this.texData.get(e),i=o.dtype;return this.releaseGPUData(e),null!=r&&(o.values=function(a,s){if("float32"===s||"complex64"===s)return a;if("int32"===s||"bool"===s){for(var u="int32"===s?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)}(r,i)),o.values},t.prototype.acquireTexture=function(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,i)},t.prototype.computeBytes=function(e,r){return e[0]*e[1]*Ip(r)},t}(vD);E_()&&M.registerBackend("webgl",function(){return new hC},2);var a4=A({square_:function(n){var t=D(n,"x","square");return M.runKernelFunc(function(r,o){return o([t]),r.square(t)},{x:t},null,"Square",{},[t],[])}}),Ks="SquaredDifference",pC=A({squaredDifference_:function(n,t){var e,r=D(n,"a","squaredDifference"),o=D(t,"b","squaredDifference");return e=tt(r,o),Ee((r=e[0]).shape,(o=e[1]).shape),M.runKernelFunc(function(s,u){var c=s.squaredDifference(r,o);return u([r,o]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],d=q(2);return{a:function(){return s.mul(c.sub(l).mul(d))},b:function(){return s.mul(l.sub(c).mul(d))}}},Ks,{},[r,o],[])}}),s4=A({abs_:function(n){var t=D(n,"x","abs");return"complex64"===t.dtype?M.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):M.runKernelFunc(function(e,r){var o=e.abs(t);return r([t]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return e.mul(o.toFloat().step(-1))}}},"Abs")}}),u4=A({acos_:function(n){var t=D(n,"x","acos");return M.runKernelFunc(function(e,r){var o=e.acos(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(q(1).sub(o.toFloat().square()).sqrt()).neg()}}})}}),c4=A({acosh_:function(n){var t=D(n,"x","acosh");return M.runKernelFunc(function(e,r){var o=e.acosh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(o.toFloat().square().sub(1).sqrt())}}})}}),l4=A({asin_:function(n){var t=D(n,"x","asin");return M.runKernelFunc(function(e,r){var o=e.asin(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(q(1).sub(o.toFloat().square()).sqrt())}}})}}),d4=A({asinh_:function(n){var t=D(n,"x","asinh");return M.runKernelFunc(function(e,r){var o=e.asinh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.divStrict(q(1).add(o.toFloat().square()).sqrt())}}})}}),f4=A({atan_:function(n){var t=D(n,"x","atan");return M.runKernelFunc(function(e,r){var o=e.atan(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().square().add(1))}}})}}),h4=A({atanh_:function(n){var t=D(n,"x","atanh");return M.runKernelFunc(function(e,r){var o=e.atanh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(q(1).sub(o.toFloat().square()))}}})}}),p4=A({ceil_:function(n){var t=D(n,"x","ceil");return M.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return ke(e)}}})}}),bv=A({clipByValue_:function(n,t,e){var r=D(n,"x","clipByValue");return C(t<=e,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."}),M.runKernelFunc(function(a,s){var u=a.clip(r,t,e);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(t).logicalAnd(u.lessEqual(e)),ke(a))}}},"ClipByValue",{min:t,max:e},[r])}}),v4=A({cos_:function(n){var t=D(n,"x","cos");return M.runKernelFunc(function(r,o){var i=r.cos(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}},"Cos",{},[t])}}),g4=A({cosh_:function(n){var t=D(n,"x","cosh");return M.runKernelFunc(function(e,r){var o=e.cosh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(e)}}})}}),m4=A({erf_:function(n){var t=D(n,"x","erf");return C("int32"===t.dtype||"float32"===t.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===t.dtype&&(t=t.toFloat()),M.runKernelFunc(function(e,r){var o=e.erf(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),wv=A({exp_:function(n){var t=D(n,"x","exp");return M.runKernelFunc(function(e,r){var o=e.exp(t);return r([o]),o},{x:t},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),y4=A({expm1_:function(n){var t=D(n,"x","expm1");return M.runKernelFunc(function(e,r){var o=e.expm1(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.exp())}}})}}),b4=A({floor_:function(n){var t=D(n,"x","floor");return M.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return ke(e)}}})}}),w4=A({log_:function(n){var t=D(n,"x","log");return M.runKernelFunc(function(r,o){var i=r.log(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}},"Log",{},[t])}}),x4=A({log1p_:function(n){var t=D(n,"x","log1p");return M.runKernelFunc(function(e,r){var o=e.log1p(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.add(1))}}})}}),_4=A({logSigmoid_:function(n){var t=D(n,"x","logSigmoid");return M.runKernelFunc(function(e,r){var o=e.softplus(t.neg()).neg();return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.neg().sigmoid())}}})}}),pl=A({neg_:function(n){var t=D(n,"x","neg");return M.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},[t])}}),D4=A({reciprocal_:function(n){var t=D(n,"x","reciprocal");return M.runKernelFunc(function(e,r){var o=e.reciprocal(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.square().neg())}}})}}),C4=A({round_:function(n){var t=D(n,"x","round");return M.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return ke(e)}}})}}),vC=A({rsqrt_:function(n){var t=D(n,"x","rsqrt");return M.runKernelFunc(function(r,o){var i=r.rsqrt(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},[t])}}),gC=A({sigmoid_:function(n){var t=D(n,"x","sigmoid");return M.runKernelFunc(function(e,r){var o=e.sigmoid(t);return r([o]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return e.mul(o.mul(q(1).sub(o)))}}},"Sigmoid")}}),E4=A({sign_:function(n){var t=D(n,"x","sign");return M.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return ke(e)}}})}}),I4=A({isNaN_:function(n){var t=D(n,"x","isNaN");return M.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return ke(e)}}})}}),S4=A({isInf_:function(n){var t=D(n,"x","isInf");return M.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return ke(e)}}})}}),T4=A({isFinite_:function(n){var t=D(n,"x","isFinite");return M.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return ke(e)}}})}}),M4=A({sin_:function(n){var t=D(n,"x","sin");return M.runKernelFunc(function(r,o){var i=r.sin(t);return o([t]),i},{x:t},function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}},"Sin",{},[t])}}),A4=A({sinh_:function(n){var t=D(n,"x","sinh");return M.runKernelFunc(function(e,r){var o=e.sinh(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(e)}}})}}),R4=A({softplus_:function(n){var t=D(n,"x","softplus");return M.runKernelFunc(function(e,r){var o=e.softplus(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.mul(o.sigmoid())}}})}}),N4=A({sqrt_:function(n){var t=D(n,"x","sqrt");return M.runKernelFunc(function(e,r){var o=e.sqrt(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.toFloat().sqrt().mul(2))}}})}}),F4=A({step_:function(n,t){void 0===t&&(t=0);var e=D(n,"x","step");return M.runKernelFunc(function(r){return r.step(e,t)},{$x:e},function(r){return{$x:function(){return ke(r)}}})}}),k4=A({tan_:function(n){var t=D(n,"x","tan");return M.runKernelFunc(function(e,r){var o=e.tan(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return e.div(o.cos().square())}}})}}),P4=A({tanh_:function(n){var t=D(n,"x","tanh");return M.runKernelFunc(function(e,r){var o=e.tanh(t);return r([o]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return q(1).sub(o.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function mC(n,t,e,r,o,i){var a,s,u=D(n,"x","batchNorm"),c=D(t,"mean","batchNorm"),l=D(e,"variance","batchNorm");return null!=o&&(a=D(o,"scale","batchNorm")),null!=r&&(s=D(r,"offset","batchNorm")),C(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),C(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),C(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&C(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&C(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Xs(u,c,l,s,a,i)}function yC(n,t,e,r,o,i){var a,s,u=D(n,"x","batchNorm"),c=D(t,"mean","batchNorm"),l=D(e,"variance","batchNorm");return null!=o&&(a=D(o,"scale","batchNorm")),null!=r&&(s=D(r,"offset","batchNorm")),C(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),C(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),C(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&C(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&C(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Xs(u,c,l,s,a,i)}function bC(n,t,e,r,o,i){var a,s,u=D(n,"x","batchNorm"),c=D(t,"mean","batchNorm"),l=D(e,"variance","batchNorm");return null!=o&&(a=D(o,"scale","batchNorm")),null!=r&&(s=D(r,"offset","batchNorm")),C(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),C(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),C(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&C(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&C(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Xs(u,c,l,s,a,i)}function Xs(n,t,e,r,o,i){null==i&&(i=.001);var a,s,u,c=D(n,"x","batchNorm"),l=D(t,"mean","batchNorm"),d=D(e,"variance","batchNorm");return null!=o&&(a=D(o,"scale","batchNorm")),null!=r&&(s=D(r,"offset","batchNorm")),C(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),C(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),C(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,M.runKernelFunc(function(h,p){var v=h.batchNormalization(u,vl(l),vl(d),i,vl(a),vl(s));return p([c,l,d,a]),v},{x:c,mean:l,variance:d,scale:a,offset:s},function(h,p){var g=p[0],m=p[1],w=p[2],b=p[3]??q(1),x=_t(m.shape,u.shape),_=[];if(1===m.rank){for(var T=0;T<u.shape.length-1;++T)_.push(u.shape[T]);_.push(1)}var S=g.sub(m),E=h.mul(b),I=vC(w.add(q(i))),N=I.mul(I).mul(I).mul(q(-.5));return{x:function(){return 1===m.rank?h.mul(fa(I.as4D(1,1,1,m.shape[0]),_)).mul(b).reshape(g.shape):h.mul(I).mul(b).reshape(g.shape)},mean:function(){var R=I.mul(q(-1)).mul(E);return 1===m.rank&&(R=R.sum(x)),R.reshape(m.shape)},variance:function(){var R=N.mul(S).mul(E);return 1===m.rank&&(R=R.sum(x)),R.reshape(m.shape)},scale:function(){var R=S.mul(I),B=h.mul(R);return 1===m.rank&&(B=B.sum(x)),B.reshape(m.shape)},offset:function(){var R=h;return 1===m.rank&&(R=R.sum(x)),R.reshape(m.shape)}}},"BatchNormalization",{varianceEpsilon:i},[c,l,d,a]).reshape(c.shape)}function vl(n){return null==n?null:0===n.rank?n.as1D():1===n.rank?n:2===n.rank?n.as4D(1,1,n.shape[0],n.shape[1]):3===n.rank?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function gl(){Q_("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var O4=A({batchNormalization2d_:function(n,t,e,r,o,i){return void 0===r&&(r=.001),gl(),mC(n,t,e,i,o,r)}}),L4=A({batchNormalization3d_:function(n,t,e,r,o,i){return void 0===r&&(r=.001),gl(),yC(n,t,e,i,o,r)}}),B4=A({batchNormalization4d_:function(n,t,e,r,o,i){return void 0===r&&(r=.001),gl(),bC(n,t,e,i,o,r)}}),V4=A({batchNormalization_:function(n,t,e,r,o,i){return void 0===r&&(r=.001),gl(),Xs(n,t,e,i,o,r)}}),wC=A({batchNorm_:Xs}),H4=A({batchNorm2d_:mC}),j4=A({batchNorm3d_:yC}),W4=A({batchNorm4d_:bC}),ml=A({logicalAnd_:function(n,t){var e=D(n,"a","logicalAnd","bool"),r=D(t,"b","logicalAnd","bool");return Ee(e.shape,r.shape),M.runKernelFunc(function(o){return o.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),U4=A({logicalNot_:function(n){var t=D(n,"x","logicalNot","bool");return M.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),xC=A({logicalOr_:function(n,t){var e=D(n,"a","logicalOr","bool"),r=D(t,"b","logicalOr","bool");return Ee(e.shape,r.shape),M.runKernelFunc(function(o){return o.logicalOr(e,r)},{$a:e,$b:r})}}),z4=A({logicalXor_:function(n,t){var e=D(n,"a","logicalXor","bool"),r=D(t,"b","logicalXor","bool");return Ee(e.shape,r.shape),xC(n,t).logicalAnd(ml(n,t).logicalNot())}}),di=A({where_:function(n,t,e){var r=D(t,"a","where"),o=D(e,"b","where"),i=D(n,"condition","where","bool");return Fe(r.shape,o.shape,"Error in where: "),1===i.rank?C(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Fe(i.shape,o.shape,"Error in where: "),M.runKernelFunc(function(a,s){var u=a.select(i,r,o);return s([i]),u},{$condition:i,$a:r,$b:o},function(a,s){var u=s[0];return{$condition:function(){return ke(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),_C=function(n){return J(this,void 0,void 0,function(){var t,e,r;return Z(this,function(o){switch(o.label){case 0:return[4,(t=D(n,"condition","whereAsync","bool")).data()];case 1:return e=o.sent(),r=cv(t.shape,e),n!==t&&t.dispose(),[2,r]}})})},Ie=A({add_:function(n,t){var e,r=D(n,"a","add"),o=D(t,"b","add");e=tt(r,o);var i=Ee((r=e[0]).shape,(o=e[1]).shape);return M.runKernelFunc(function(a){return a.add(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=_t(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=_t(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}},"Add")}}),G4=A({addN_:function(n){C(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),C(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var t=n.map(function(o,i){return D(o,"tensors"+i,"addN")}),e=t[0];return t.forEach(function(o){if(o.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(o){if(!bt(o.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}),M.runKernelFunc(function(o){return o.addN(t)},t,function(o){var i={};return t.forEach(function(a,s){i[s]=function(){return o.clone()}}),i},"AddN")}}),q4=A({addStrict_:function(n,t){var e=D(n,"a","addStrict"),r=D(t,"b","addStrict");return Fe(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),$4=A({atan2_:function(n,t){var e,r=D(n,"a","atan2"),o=D(t,"b","atan2");e=tt(r,o);var i=Ee((r=e[0]).shape,(o=e[1]).shape);return M.runKernelFunc(function(a,s){var u=a.atan2(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Ie(u.square(),c.square()),d=a.mul(c.div(l)),f=_t(u.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(u.shape)},$b:function(){var l=Ie(u.square(),c.square()),d=pl(a.mul(u.div(l))),f=_t(c.shape,i);return f.length>0&&(d=d.sum(f)),d.reshape(c.shape)}}})}}),ar=A({div_:function(n,t){var e,r=D(n,"a","div"),o=D(t,"b","div");if(e=tt(r,o),o=e[1],"int32"===(r=e[0]).dtype&&"int32"===o.dtype)return DC(r,o);var i=Ee(r.shape,o.shape);return M.runKernelFunc(function(a,s){var u=a.realDivide(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=_t(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=_t(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"Div")}}),K4=A({divNoNan_:function(n,t){var e,r=D(n,"a","div"),o=D(t,"b","div");r=(e=tt(r,o))[0];var i=ar(r,o=e[1]),a=ke(i),s=o.equal(a);return di(s,a,i)}}),X4=A({divStrict_:function(n,t){var e=D(n,"a","div"),r=D(t,"b","div");return Fe(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),DC=A({floorDiv_:function(n,t){var e,r=D(n,"a","floorDiv"),o=D(t,"b","floorDiv");e=tt(r,o);var i=Ee((r=e[0]).shape,(o=e[1]).shape);return M.runKernelFunc(function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),d=_t(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=_t(c.shape,i);d.length>0&&(l=l.sum(d).reshape(c.shape));var f=c.square();return l.div(f.toFloat()).neg()}}},"FloorDiv")}}),xv=A({maximum_:function(n,t){var e,r=D(n,"a","maximum"),o=D(t,"b","maximum");return e=tt(r,o),o=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),o=o.toInt()),Ee(r.shape,o.shape),M.runKernelFunc(function(i,a){var s=i.maximum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}},"Maximum")}}),Y4=A({maximumStrict_:function(n,t){var e=D(n,"a","maximumStrict"),r=D(t,"b","maximumStrict");return Fe(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),CC=A({minimum_:function(n,t){var e,r=D(n,"a","minimum"),o=D(t,"b","minimum");return e=tt(r,o),o=e[1],"bool"===(r=e[0]).dtype&&(r=r.toInt(),o=o.toInt()),Ee(r.shape,o.shape),M.runKernelFunc(function(i,a){var s=i.minimum(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}},"Minimum")}}),Q4=A({minimumStrict_:function(n,t){var e=D(n,"a","minimumStrict"),r=D(t,"b","minimumStrict");return Fe(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),J4=A({mod_:function(n,t){var e,r=D(n,"a","mod"),o=D(t,"b","mod");e=tt(r,o);var i=Ee((r=e[0]).shape,(o=e[1]).shape);return M.runKernelFunc(function(a,s){var u=a.mod(r,o);return s([r,o]),u},{$a:r,$b:o},function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=_t(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),d=_t(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}})}}),Z4=A({modStrict_:function(n,t){var e=D(n,"a","modStrict"),r=D(t,"b","modStrict");return Fe(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),qt=A({mul_:function(n,t){var e,r=D(n,"a","mul"),o=D(t,"b","mul");e=tt(r,o);var i=Ee((r=e[0]).shape,(o=e[1]).shape);return M.runKernelFunc(function(a,s){var u=a.multiply(r,o);return s([r,o]),u},{a:r,b:o},function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),d=_t(u.shape,i);return d.length>0?l.sum(d).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),d=_t(c.shape,i);return d.length>0?l.sum(d).reshape(c.shape):l}}},"Mul")}}),eV=A({mulStrict_:function(n,t){var e=D(n,"a","mul"),r=D(t,"b","mul");return Fe(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),yl=A({pow_:function(n,t){var e,r=D(n,"base","pow"),o=D(t,"exp","pow");e=tt(r,o);var i=Ee((r=e[0]).shape,(o=e[1]).shape);return M.runKernelFunc(function(s,u){var c=s.pow(r,o);return u([r,o,c]),c},{a:r,b:o},function(s,u){var c=u[0],l=u[1],d=u[2];return{a:function(){var f=l.toFloat(),h=s.mul(f.mul(c.pow(f.sub(q(1))))),p=_t(c.shape,i);return p.length>0&&(h=h.sum(p)),h.reshape(c.shape)},b:function(){var f=c.greater(0),h=c.log().where(f,ke(c)),p=s.mul(d.mul(h)),v=_t(l.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(l.shape)}}},"Pow",{},[r,o],[!0])}}),tV=A({powStrict_:function(n,t){return Fe(n.shape,t.shape,"Error in powStrict: "),n.pow(t)}}),nV=A({squaredDifferenceStrict_:function(n,t){var e=D(n,"a","squaredDifferenceStrict"),r=D(t,"b","squaredDifferenceStrict");return Fe(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),Mt=A({sub_:function(n,t){var e,r=D(n,"a","sub"),o=D(t,"b","sub");e=tt(r,o);var i=Ee((r=e[0]).shape,(o=e[1]).shape);return M.runKernelFunc(function(a){return a.subtract(r,o)},{a:r,b:o},function(a){return{a:function(){var s=a,u=_t(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=_t(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}},"Sub")}}),rV=A({subStrict_:function(n,t){var e=D(n,"a","subStrict"),r=D(t,"b","subStrict");return Fe(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),EC=A({equal_:function(n,t){var e,r=D(n,"a","equal"),o=D(t,"b","equal");return e=tt(r,o),Ee((r=e[0]).shape,(o=e[1]).shape),M.runKernelFunc(function(i){return i.equal(r,o)},{$a:r,$b:o})}}),oV=A({equalStrict_:function(n,t){var e=D(n,"a","equalStrict"),r=D(t,"b","equalStrict");return Fe(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),iV=A({greater_:function(n,t){var e,r=D(n,"a","greater"),o=D(t,"b","greater");return e=tt(r,o),Ee((r=e[0]).shape,(o=e[1]).shape),M.runKernelFunc(function(i){return i.greater(r,o)},{a:r,b:o},null,"Greater")}}),IC=A({greaterEqual_:function(n,t){var e,r=D(n,"a","greaterEqual"),o=D(t,"b","greaterEqual");return e=tt(r,o),Ee((r=e[0]).shape,(o=e[1]).shape),M.runKernelFunc(function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s},{a:r,b:o},function(i,a){var s=a[0],u=a[1];return{a:function(){return ke(s)},b:function(){return ke(u)}}},"GreaterEqual")}}),aV=A({greaterEqualStrict_:function(n,t){var e=D(n,"a","greaterEqualStrict"),r=D(t,"b","greaterEqualStrict");return Fe(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),sV=A({greaterStrict_:function(n,t){var e=D(n,"a","greaterStrict"),r=D(t,"b","greaterStrict");return Fe(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),uV=A({less_:function(n,t){var e,r=D(n,"a","less"),o=D(t,"b","less");return e=tt(r,o),Ee((r=e[0]).shape,(o=e[1]).shape),M.runKernelFunc(function(i){return i.less(r,o)},{a:r,b:o},null,"Less")}}),cV=A({lessEqual_:function(n,t){var e,r=D(n,"a","lessEqual"),o=D(t,"b","lessEqual");return e=tt(r,o),Ee((r=e[0]).shape,(o=e[1]).shape),M.runKernelFunc(function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s},{a:r,b:o},null,"LessEqual")}}),lV=A({lessEqualStrict_:function(n,t){var e=D(n,"a","lessEqualStrict"),r=D(t,"b","lessEqualStrict");return Fe(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),dV=A({lessStrict_:function(n,t){var e=D(n,"a","lessStrict"),r=D(t,"b","lessStrict");return Fe(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),fV=A({notEqual_:function(n,t){var e,r=D(n,"a","notEqual"),o=D(t,"b","notEqual");return e=tt(r,o),Ee((r=e[0]).shape,(o=e[1]).shape),M.runKernelFunc(function(i){return i.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),hV=A({notEqualStrict_:function(n,t){var e=D(n,"a","notEqualStrict"),r=D(t,"b","notEqualStrict");return Fe(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function SC(n,t){for(var e=[],r=n;r<t;++r)e.push(r);return e}function TC(n){for(var t=[],e=0;e<n.length;++e)for(var r=0;r<n[e].length;++r)t.push(n[e][r]);return t}var _v=A({gather_:function(n,t,e){void 0===e&&(e=0);var r=D(n,"x","gather"),o=D(t,"indices","gather","int32");e=wt(e,r.shape)[0];var i=function(a,s,u){for(var c=a.shape[u],l=[],d=1,f=1,h=0;h<u;h++)l.push(a.shape[h]),d*=a.shape[h];for(h=0;h<s.rank;h++)l.push(s.shape[h]);for(h=u+1;h<a.rank;h++)l.push(a.shape[h]),f*=a.shape[h];return{batchSize:d,sliceSize:f,dimSize:c,outputShape:l}}(r,o,e);return M.runKernelFunc(function(a,s){var u=a.gather(r,o.flatten(),e);return s([o]),u},{x:r,indices:o},function(a,s){var u=s[0];return{x:function(){var c=r.shape,l=u.size,d=c.slice(0,e),f=d.length,h=c.slice(e,c.length).slice(1),p=h.length,v=SC(0,f),g=SC(f+1,f+1+p),m=TC([d,[l],h]),w=a.reshape(m),y=u.reshape([l]),b=TC([[f],v,g]),x=w.transpose(b),_=MC(x,y,r.shape[e]),T=Qc(b);return _.transpose(T)},indices:function(){return u}}},"Gather",{axis:e}).reshape(i.outputShape)}}),MC=A({unsortedSegmentSum_:function(n,t,e){var r=D(n,"x","unsortedSegmentSum"),o=D(t,"segmentIds","unsortedSegmentSum","int32");return C(rt(e),function(){return"numSegments must be of dtype int"}),M.runKernelFunc(function(i,a){var s=i.unsortedSegmentSum(r,o,e);return a([o]),s},{$x:r},function(i,a){var s=a[0];return{$x:function(){return function(u,c){for(var l=xv(c,ke(c)),d=_v(u,l),f=IC(c,q(0,"int32")),h=d.rank-f.rank,p=0;p<h;++p)f=Bn(f,p+1);f=ml(f,da(d.shape,"bool"));var v=ke(d);return di(f,d,v)}(i,s)}}})}});function AC(n,t,e,r,o,i,a){void 0===i&&(i="NHWC"),C(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var s=n,u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,n[0],n[1],n[2]]),C(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),C(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),C(4===e.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var l="NHWC"===i?s[3]:s[1],d="NHWC"===i?u.shape[3]:u.shape[1];C(l===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+e.shape[2]+"."}),C(d===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+e.shape[3]+"."}),null!=a&&C(rt(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var f=ul(i),h=Mo(s,e.shape,r,1,o,a,!1,f),p=M.runKernelFunc(function(v,g){var m=v.conv2dDerInput(u,e,h);return g([e,u]),m},{dy4D:u,filter:e},function(v,g){var m=g[0],w=g[1];return{dy4D:function(){return Vn(v,m,r,o,i,1,a)},filter:function(){return Cv(v,w,m.shape,r,o,i,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Dv(n){var i,t="number"==typeof(i=n)?[i,i,i]:2===i.length?[i[0],i[1],1]:i;return 1===t[0]&&1===t[1]&&1===t[2]}function RC(n,t,e,r,o){C(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var i=n,a=t,s=!1;4===t.rank&&(s=!0,a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=a.shape[4];C(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),C(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),C(5===e.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),C(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),C(c===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+e.shape[4]+"."});var l=zs(i,e.shape,r,1,o),d=M.runKernelFunc(function(f){return f.conv3dDerInput(a,e,l)},{dy5D:a});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var vV=A({conv1d_:function(n,t,e,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=D(n,"x","conv1d"),u=D(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),C(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),C(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&C(rt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),C(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),C(on(e,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+i+"'"}),C("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Vn(f,d,[1,e],r,"NHWC",[1,i],a);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Vn=A({conv2d_:function(n,t,e,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=D(n,"x","conv2d"),u=D(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),C(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),C(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&C(rt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d="NHWC"===o?c.shape[3]:c.shape[1];C(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),C(on(e,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"});var f=ul(o),h=Mo(c.shape,u.shape,e,i,r,a,!1,f),v=M.runKernelFunc(function(g,m){var w=g.conv2d(c,u,h);return m([u,c]),w},{x:c,filter:u},function(g,m){var y=m[0],b=m[1];return C(ui(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return NC(b.shape,g,y,e,r,o)},filter:function(){return Cv(b,g,y.shape,e,r,o)}}},"Conv2D",h,[u,c]);return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),gV=A({conv3d_:function(n,t,e,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var h,a=D(n,"x","conv3d"),s=D(t,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),C(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),C(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),C(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),C((h=i,Dv(e)||Dv(h)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),C("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var l=zs(u.shape,s.shape,e,i,r),d=M.runKernelFunc(function(f,h){var p=f.conv3d(u,s,l);return h([u,s]),p},{x:u,$filter:s},function(f,h){C(Dv(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var p=h[0],v=h[1];return{x:function(){return RC(p.shape,f,v,e,r)},$filter:function(){return function(g,m,w,y,b){var x=g;4===g.rank&&(x=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var _=m;4===_.rank&&(_=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3])),C(5===x.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+x.shape+"."}),C(5===_.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."}),C(5===w.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+w+"."}),C(x.shape[4]===w[3],function(){return"Error in conv3dDerFilter: depth of input "+x.shape[4]+") must match input depth in filter ("+w[3]+"."}),C(_.shape[4]===w[4],function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+w[4]+")."});var T=zs(x.shape,w,y,1,b);return M.runKernelFunc(function(S){return S.conv3dDerFilter(x,_,T)},{x5D:x,dy5D:_})}(p,f,v.shape,e,r)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Cv=A({conv2dDerFilter_:function(n,t,e,r,o,i,a){void 0===i&&(i="NHWC");var s=n;3===n.rank&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),C(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),C(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),C(4===e.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];C(c===e[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+e[2]+"."}),C(l===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+e[3]+")."}),null!=a&&C(rt(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=ul(i),f=Mo(s.shape,e,r,1,o,a,!1,d);return M.runKernelFunc(function(h){return h.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),NC=A({conv2dDerInput_:AC}),bl=A({depthwiseConv2d_:function(n,t,e,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=D(n,"x","depthwiseConv2d"),u=D(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),C(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),C(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),C(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),C(on(e,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),null!=a&&C(rt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=Mo(c.shape,u.shape,e,i,r,a,!0),h=M.runKernelFunc(function(p,v){var g=p.depthwiseConv2D(c,u,d);return v([c,u]),g},{x:c,filter:u},function(p,v){C(ui(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var g=v[0],m=v[1];return{x:function(){return FC(g.shape,p,m,d)},filter:function(){return kC(g,p,m.shape,d)}}},"DepthwiseConv2dNative",d,[c,u]);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),FC=A({depthwiseConv2dDerInput_:function(n,t,e,r){var o=t,i=!1;3===t.rank&&(i=!0,o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=M.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(o,e,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),kC=A({depthwiseConv2dDerFilter_:function(n,t,e,r){var o=n;3===n.rank&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var i=t;return 3===i.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),M.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),Ev=A({separableConv2d_:function(n,t,e,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=D(n,"x","separableConv2d"),u=D(t,"depthwiseFilter","separableConv2d"),c=D(e,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(3===s.rank&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");C(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),C(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),C(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),C(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),C(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var f=u.shape[2],h=u.shape[3];C(c.shape[2]===f*h,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*h+", but got "+c.shape[2]+"."});var p=bl(l,u,r,o,a,i),v=Vn(p,c,1,"valid",a);return d?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),mV=A({conv2dTranspose_:function(n,t,e,r,o,i){return AC(e,D(n,"x","conv2dTranspose"),D(t,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),yV=A({conv3dTranspose_:function(n,t,e,r,o){return RC(e,D(n,"x","conv3dTranspose"),D(t,"filter","conv3dTranspose"),r,o)}}),wl=A({matMul_:function(n,t,e,r){var o;void 0===e&&(e=!1),void 0===r&&(r=!1);var i=D(n,"a","matMul"),a=D(t,"b","matMul");o=tt(i,a),i=o[0],a=o[1];var s=e?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=e?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],d=i.shape.slice(0,-2),f=a.shape.slice(0,-2),h=ee(d),p=ee(f);C(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),C(bt(d,f),function(){return"Error in matMul: outer dimensions ("+d+") and ("+f+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),C(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var v=i.shape.slice(0,-2).concat([c,l]),g=e?i.as3D(h,s,c):i.as3D(h,c,s),m=r?a.as3D(p,l,u):a.as3D(p,u,l);return M.runKernelFunc(function(y,b){var x=y.batchMatMul(g,m,e,r);return b([g,m]),x},{a:g,b:m},function(y,b){var _=b[0],T=b[1];return e||r?!e&&r?{a:function(){return y.matMul(T,!1,!1)},b:function(){return y.matMul(_,!0,!1)}}:e&&!r?{a:function(){return T.matMul(y,!1,!0)},b:function(){return _.matMul(y,!1,!1)}}:{a:function(){return T.matMul(y,!0,!0)},b:function(){return y.matMul(_,!0,!0)}}:{a:function(){return y.matMul(T,!1,!0)},b:function(){return _.matMul(y,!0,!1)}}},"BatchMatMul",{transposeA:e,transposeB:r}).reshape(v)}}),bV=A({dot_:function(n,t){var e=D(n,"t1","dot"),r=D(t,"t2","dot");C(!(1!==e.rank&&2!==e.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var o=1===e.rank?e.size:e.shape[1],i=1===r.rank?r.size:r.shape[0];return C(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===e.rank&&1===r.rank?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===e.rank&&2===r.rank?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===e.rank&&1===r.rank?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),wV=A({outerProduct_:function(n,t){var e=D(n,"v1","outerProduct"),r=D(t,"v2","outerProduct");return C(1===e.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),Ys=A({reverse_:function(n,t){var e=D(n,"x","reverse");if(0===e.rank)return e.clone();var r=wt(t,e.shape);return M.runKernelFunc(function(o){return o.reverse(e,r)},{$x:e},function(o){return{$x:function(){return o.reverse(r)}}}).reshapeAs(e)}}),xV=A({reverse1d_:function(n){var t=D(n,"x","reverse");return C(1===t.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),Ys(t,0)}}),_V=A({reverse2d_:function(n,t){var e=D(n,"x","reverse");return C(2===e.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),Ys(e,t)}}),DV=A({reverse3d_:function(n,t){var e=D(n,"x","reverse");return C(3===e.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),Ys(e,t)}}),CV=A({reverse4d_:function(n,t){var e=D(n,"x","reverse");return C(4===e.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),Ys(e,t)}});function PC(n,t,e,r,o,i){var a=D(n,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),C(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),C(on(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),null!=i&&C(rt(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=ha(s.shape,t,e,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&bt(c.inShape,c.outShape))return a.clone();var d=M.runKernelFunc(function(f,h){var p=f.maxPool(s,c);return h([s,p]),p},{x:s},function(f,h){var p=h[0],v=h[1];return{x:function(){return function(g,m,w,y,b,x,_,T){var S=D(g,"dy","maxPoolBackprop"),E=D(m,"input","maxPoolBackprop"),I=D(w,"output","maxPoolBackprop");C(E.rank===S.rank,function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+S.rank+")"}),null==x&&(x=[1,1]),C(on(b,x),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+x+"'"}),C(4===S.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."}),C(4===E.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+E.rank+"."});var N=ha(E.shape,y,b,x,_,void 0);return M.runKernelFunc(function(R){return R.maxPoolBackprop(S,E,I,N)},{$dy:S,$input:E})}(f,p,v,t,e,r,o)}}},"MaxPool",c,[s]);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function OC(n,t,e,r,o,i){var a=D(n,"x","avgPool","float32");null==r&&(r=[1,1]),C(on(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),C(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&C(rt(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=ha(s.shape,t,e,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&bt(c.inShape,c.outShape))return a.clone();var l=M.runKernelFunc(function(d){return d.avgPool(s,c)},{x:s},function(d){return{x:function(){return function(f,h,p,v,g,m){var w=D(f,"dy","avgPoolBackprop"),y=D(h,"input","avgPoolBackprop");C(y.rank===w.rank,function(){return"Rank of input ("+y.rank+") does not match rank of dy ("+w.rank+")"}),null==g&&(g=[1,1]),C(on(v,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+g+"'"});var b=y,x=w,_=!1;3===y.rank&&(_=!0,b=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]),x=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),C(4===x.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+x.rank+"."}),C(4===b.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var T=ha(b.shape,p,v,g,m),S=M.runKernelFunc(function(E){return E.avgPoolBackprop(x,b,T)},{dy4D:x,input4D:b});return _?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}(d,s,t,e,r,o)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Ft=A({maxPool_:function(n,t,e,r,o){return PC(n,t,e,1,r,o)}}),Qs=A({avgPool_:function(n,t,e,r,o){return OC(n,t,e,1,r,o)}}),EV=A({pool_:function(n,t,e,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=D(n,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),C(on(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,x,_,T,S,l=ha(s.shape,t,i,o,r),d=[l.dilationHeight,l.dilationWidth];c="same"===r?(x=d,_=[l.filterHeight,l.filterWidth].map(function(E,I){return E+(E-1)*(x[I]-1)}).map(function(E){return E-1}),T=_.map(function(E){return Math.floor(E/2)}),S=_.map(function(E,I){return E-T[I]}),_.map(function(E,I){return[T[I],S[I]]})):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],h=function(b,x,_){var T=_.map(function(O){return O[0]}),S=_.map(function(O){return O[1]}),E=b.concat(T,S),I=x.map(function(O,L){return(O-E[L]%O)%O}),N=S.map(function(O,L){return O+I[L]});return[x.map(function(O,L){return[T[L],N[L]]}),x.map(function(O,L){return[0,I[L]]})]}([l.inHeight,l.inWidth],d,c),v=h[1],g=f?r:"valid",m=f?s:iD(s,d,h[0]),w=("avg"===e?function(){return OC(m,t,i,1,g)}:function(){return PC(m,t,i,1,g)})(),y=f?w:nD(w,d,v);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),IV=A({maxPool3d_:function(n,t,e,r,o,i,a){void 0===i&&(i="NDHWC");var s=D(n,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),C(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),C("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),C(on(e,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=o&&C(rt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Us(u.shape,t,e,a,r,o,i),d=M.runKernelFunc(function(f,h){var p=f.maxPool3d(u,l);return h([u,p]),p},{x:u},function(f,h){var p=h[0],v=h[1];return{x:function(){return function(g,m,w,y,b,x,_,T){var S=D(g,"dy","maxPool3dBackprop"),E=D(m,"input","maxPool3dBackprop"),I=D(w,"output","maxPool3dBackprop"),N=S,R=E,B=I,O=!1;4===E.rank&&(O=!0,N=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),R=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),B=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3])),C(5===N.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),C(5===R.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+R.rank+"."}),C(5===B.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+B.rank+"."}),null==x&&(x=[1,1,1]),C(on(b,x),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+x+"'"}),null!=T&&C(rt(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+T+" but got pad "+_+"."});var L=Us(R.shape,y,b,x,_,T),H=M.runKernelFunc(function(j){return j.maxPool3dBackprop(N,R,B,L)},{dy5D:N,input5D:R});return O?H.as4D(H.shape[1],H.shape[2],H.shape[3],H.shape[4]):H}(f,p,v,t,e,a,r,o)}}});return c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),SV=A({avgPool3d_:function(n,t,e,r,o,i,a){void 0===i&&(i="NDHWC");var s=D(n,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),C(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),C("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),C(on(e,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+a+"'"}),null!=o&&C(rt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=Us(u.shape,t,e,a,r,o,i),d=M.runKernelFunc(function(f){return f.avgPool3d(u,l)},{x:u},function(f){return{x:function(){return function(h,p,v,g,m,w,y){var b=D(h,"dy","avgPool3dBackprop"),x=D(p,"input","avgPool3dBackprop"),_=b,T=x,S=!1;4===x.rank&&(S=!0,_=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),T=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3])),C(5===_.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."}),C(5===T.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),null==m&&(m=[1,1,1]),C(on(g,m),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+m+"'"}),null!=y&&C(rt(w),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+w+"."});var E=Us(T.shape,v,g,m,w,y),I=M.runKernelFunc(function(N){return N.avgPool3dBackprop(_,T,E)},{dy5D:_,input5D:T});return S?I.as4D(I.shape[1],I.shape[2],I.shape[3],I.shape[4]):I}(f,u,t,e,a,r,o)}}});return d=d.cast(u.dtype),c?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Er=A({slice_:function(n,t,e){var r,o,i=D(n,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(i.rank-1).fill(0)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach(function(u){C(-1!==u,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==e?new Array(i.rank).fill(-1):"number"==typeof e?[e].concat(new Array(i.rank-1).fill(-1)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(-1)):e).map(function(u,c){return u>=0?u:(C(-1===u,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."}),i.shape[c]-r[c])}),dD(i,r,o);var a=i.shape;return M.runKernelFunc(function(u){return u.slice(i,r,o)},{x:i},function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],a[l]-r[l]-o[l]]);return{x:function(){return u.pad(c)}}},"Slice",{begin:r,size:o})}}),TV=A({slice1d_:function(n,t,e){var r=D(n,"x","slice1d");return C(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Er(r,[t],[e])}}),MV=A({slice2d_:function(n,t,e){var r=D(n,"x","slice2d");return C(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Er(r,t,e)}}),LC=A({slice3d_:function(n,t,e){var r=D(n,"x","slice3d");return C(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Er(r,t,e)}}),AV=A({slice4d_:function(n,t,e){var r=D(n,"x","slice4d");return C(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Er(r,t,e)}});function BC(n,t,e,r,o){return t.rank<e.rank&&(t=t.reshape(rn(t.shape,r))),n.rank<e.rank&&(n=n.reshape(rn(n.shape,r))),{x:function(){var i=n.mul(e.equal(t).cast(n.dtype));return null==o?i:i.transpose(o)}}}var RV=A({all_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=D(n,"x","all","bool"),o=wt(t,r.shape),i=o,a=nr(i,r.rank);null!=a&&(r=r.transpose(a),i=rr(i.length,r.rank));var s=M.runKernelFunc(function(c){return c.all(r,i)},{$x:r});if(e){var u=rn(s.shape,o);return s.reshape(u)}return s}}),NV=A({any_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=D(n,"x","any","bool"),o=wt(t,r.shape),i=o,a=nr(i,r.rank);null!=a&&(r=r.transpose(a),i=rr(i.length,r.rank));var s=M.runKernelFunc(function(c){return c.any(r,i)},{$x:r});if(e){var u=rn(s.shape,o);return s.reshape(u)}return s}}),FV=A({argMax_:function(n,t){void 0===t&&(t=0);var e=D(n,"x","argMax");null==t&&(t=0);var r=wt(t,e.shape),o=nr(r,e.rank);return null!=o&&(e=e.transpose(o),r=rr(r.length,e.rank)),M.runKernelFunc(function(s,u){var c=s.argMax(e,r[0]);return u([e]),c},{x:e},function(s,u){var c=u[0];return{x:function(){return ke(c)}}},"ArgMax",{axis:r[0]},[e])}}),kV=A({argMin_:function(n,t){void 0===t&&(t=0);var e=D(n,"x","argMin");null==t&&(t=0);var r=wt(t,e.shape),o=nr(r,e.rank);return null!=o&&(e=e.transpose(o),r=rr(r.length,e.rank)),M.runKernelFunc(function(i,a){var s=i.argMin(e,r[0]);return a([e]),s},{$x:e},function(i,a){var s=a[0];return{$x:function(){return ke(s)}}})}}),PV=A({logSumExp_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=D(n,"x","logSumExp"),o=wt(t,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(e){var u=rn(s.shape,o);return s.reshape(u)}return s}}),xl=A({max_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=D(n,"x","max"),o=r,i=wt(t,r.shape),a=i,s=nr(a,r.rank);null!=s&&(r=r.transpose(s),a=rr(a.length,r.rank));var c=M.runKernelFunc(function(d,f){var h=d.max(r,a);return f([o,h]),h},{x:r},function(d,f){return BC(d,f[1],f[0],i,s)},"Max",{axes:a},[r],[!0]);if(e){var l=rn(c.shape,i);c=c.reshape(l)}return c}}),OV=A({mean_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=D(n,"x","mean"),o=wt(t,r.shape),i=ee(Bt(r.shape,o)[1]);return il(function(a){var s=q(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(t,e),gradFunc:function(u){var c=a.shape.slice();return o.forEach(function(l){c[l]=1}),u.reshape(c).mul(da(a.shape,"float32")).div(i)}}})(r)}}),LV=A({min_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=D(n,"x","min"),o=r,i=wt(t,r.shape),a=i,s=nr(a,r.rank);null!=s&&(r=r.transpose(s),a=rr(a.length,r.rank));var c=M.runKernelFunc(function(d,f){var h=d.min(r,a);return f([o,h]),h},{x:r},function(d,f){return BC(d,f[1],f[0],i,s)},"Min",{axes:a},[r],[!0]);if(e){var l=rn(c.shape,i);c=c.reshape(l)}return c}}),BV=A({moments_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=wt(t,(n=D(n,"x","moments")).shape),o=n.mean(r,e),i=o.shape;e||(i=rn(o.shape,r));var a=n.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,e)}}}),VC=A({sum_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=D(n,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=wt(t,r.shape);return il(function(i){var a=nr(o,i.rank),s=o,u=i;null!=a&&(u=i.transpose(a),s=rr(s.length,i.rank));var c=function(h){var p=i.shape.slice();return o.forEach(function(v){p[v]=1}),h.reshape(p).mul(da(i.shape,"float32"))},d=M.runKernelFunc(function(h){return h.sum(u,s)},{x:u},function(h){return{x:function(){return c(h)}}},"Sum",{axes:s});if(e){var f=rn(d.shape,o);d=d.reshape(f)}return{value:d,gradFunc:c}})(r)}}),VV=A({prod_:function(n,t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var r=D(n,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=wt(t,r.shape),i=nr(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=rr(a.length,r.rank));var u=M.runKernelFunc(function(l){return l.prod(s,a)},{permutedX:s});if(e){var c=rn(u.shape,o);u=u.reshape(c)}return u}}),HC=A({elu_:function(n){var t=D(n,"x","elu");return M.runKernelFunc(function(e,r){var o=e.elu(t);return r([o]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){return M.runKernelFunc(function(i){return i.eluDer(e,o)},{dy:e,y:o})}}})}}),HV=A({leakyRelu_:function(n,t){void 0===t&&(t=.2);var e=D(n,"x","leakyRelu");return xv(q(t).mul(e),e)}}),jC=A({prelu_:function(n,t){var e=D(n,"x","prelu"),r=D(t,"alpha","prelu");return M.runKernelFunc(function(o,i){var a=o.prelu(e,r);return i([e,r]),a},{x:e,alpha:r},function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return di(u,o,o.mul(s))},alpha:function(){var c=di(u,ke(o),o.mul(a)),l=_t(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}},"Prelu")}}),ot=A({relu_:function(n){var t=D(n,"x","relu");return"bool"===t.dtype?t.toInt():M.runKernelFunc(function(e,r){var o=e.relu(t);return r([t]),o},{x:t},function(e,r){var o=r[0];return{x:function(){return e.mulStrict(o.step().toFloat())}}},"Relu")}}),WC=A({relu6_:function(n){var t=D(n,"x","relu6");return"bool"===t.dtype?t.toInt():M.runKernelFunc(function(e,r){var o=e.relu6(t);return r([t]),o},{x:t},function(e,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return e.mulStrict(i.toFloat())}}},"Relu6")}}),jV=A({selu_:function(n){var t=D(n,"x","selu");return M.runKernelFunc(function(e,r){var o=e.selu(t);return r([t]),o},{$x:t},function(e,r){var o=r[0];return{$x:function(){var i=o.greater(q(0)),a=q(1.7580993408473768),s=q(1.0507009873554805),u=e.mul(s),c=e.mul(a).mul(o.toFloat().exp());return di(i,u,c)}}})}}),Ao=A({transpose_:function(n,t){var e=D(n,"x","transpose");return null==t&&(t=e.shape.map(function(o,i){return i}).reverse()),C(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."}),t.forEach(function(o){C(o>=0&&o<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t})}),e.rank<=1?e.clone():M.runKernelFunc(function(o){return o.transpose(e,t)},{x:e},function(o){var i=Qc(t);return{x:function(){return o.transpose(i)}}},"Transpose",{perm:t})}}),WV=A({localResponseNormalization_:function(n,t,e,r,o){void 0===t&&(t=5),void 0===e&&(e=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=D(n,"x","localResponseNormalization");C(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),C(rt(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=M.runKernelFunc(function(c,l){var d=c.localResponseNormalization4D(a,t,e,r,o);return l([a,d]),d},{x4D:a},function(c,l){var d=l[0],f=l[1];return{x4D:function(){return M.runKernelFunc(function(h){return h.LRNGrad(c,d,f,t,e,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),UC=A({norm_:function(n,t,e,r){void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===r&&(r=!1);var o=function s(u,c,l){if(void 0===l&&(l=null),0===u.rank)return u.abs();if(1!==u.rank&&null===l)return s(u.reshape([-1]),c,l);if(1===u.rank||"number"==typeof l||Array.isArray(l)&&1===l.length){if(1===c)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if("euclidean"===c||2===c)return u.abs().pow(q(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&2===l.length){if(1===c)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if("fro"===c||"euclidean"===c)return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)}(n=D(n,"x","norm"),t,e),i=o.shape;if(r){var a=wt(e,n.shape);i=rn(o.shape,a)}return o.reshape(i)}}),UV=A({basicLSTMCell_:function(n,t,e,r,o,i){var a=D(n,"forgetBias","basicLSTMCell"),s=D(t,"lstmKernel","basicLSTMCell"),u=D(e,"lstmBias","basicLSTMCell"),c=D(r,"data","basicLSTMCell"),l=D(o,"c","basicLSTMCell"),d=D(i,"h","basicLSTMCell"),f=c.concat(d,1).matMul(s).add(u),p=f.shape[1]/4,v=[f.shape[0],p],g=f.slice([0,0],v),m=f.slice([0,p],v),w=f.slice([0,2*p],v),y=f.slice([0,3*p],v),b=g.sigmoid().mulStrict(m.tanh()).addStrict(l.mulStrict(a.add(w).sigmoid())),x=b.tanh().mulStrict(y.sigmoid());return[b,x]}}),zV=A({multiRNNCell_:function(n,t,e,r){for(var o=D(t,"data","multiRNNCell"),i=js(e,"c","multiRNNCell"),a=js(r,"h","multiRNNCell"),s=o,u=[],c=0;c<n.length;c++){var l=n[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var d=[],f=[];for(c=0;c<u.length;c+=2)d.push(u[c]),f.push(u[c+1]);return[d,f]}}),GV=A({movingAverage_:function(n,t,e,r,o){void 0===o&&(o=!0);var i=D(n,"v","movingAverage"),a=D(t,"x","movingAverage"),s=D(e,"decay","movingAverage");D_(i,a),C(bt(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=q(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){C(null!=r,function(){return"When using zeroDebias: true, step is required."});var d=D(r,"step","movingAverage");l=l.div(u.sub(yl(s,d)))}return i.add(l)}}),qV=A({stridedSlice_:function(n,t,e,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=D(n,"x","stridedSlice"),l=Zp(s),d=c.shape.slice();l.forEach(function(g){t[g]=0,e[g]=1,d.splice(g,0,1)}),c=c.reshape(d);for(var f=0;f<c.rank;f++)t[f]=fD(o,t,r,c.shape,f),e[f]=hD(i,e,r,c.shape,f),r[f]=r[f]||1;var h=Zp(u);h.forEach(function(g){e[g]=t[g]+1,r[g]=1});var p=ol(t,e,r),v=p.filter(function(g,m){return-1===h.indexOf(m)});return r.every(function(g){return 1===g})?Er(c,t,p).reshape(v):M.runKernelFunc(function(g){return g.stridedSlice(c,t,e,r)},{$x:c}).reshape(v)}}),$V=A({topk_:function(n,t,e){void 0===t&&(t=1),void 0===e&&(e=!0);var r=D(n,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(t>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+t);var i=M.runKernelFunc(function(a){return a.topk(r,t,e)},{$x:r});return{values:i[0],indices:i[1]}}}),KV=A({scatterND_:function(n,t,e){var r=D(n,"indices","scatterND","int32"),o=D(t,"updates","scatterND");return lD(o,r,e),M.runKernelFunc(function(i){return i.scatterND(r,o,e)},{indices:r,updates:o},null,"ScatterNd",{shape:e})}}),Iv=A({fft_:function(n){C("complex64"===n.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],r=n.as2D(n.size/t,t);return M.runKernelFunc(function(o){return o.fft(r)},{input:n}).reshape(n.shape)}}),_l=A({ifft_:function(n){C("complex64"===n.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],r=n.as2D(n.size/t,t);return M.runKernelFunc(function(o){return o.ifft(r)},{input:n}).reshape(n.shape)}}),Sv=A({rfft_:function(n,t){C("float32"===n.dtype,function(){return"The dtype for rfft() must be real value but got "+n.dtype});var e,r=n.shape[n.shape.length-1],o=n.size/r;if(null!=t&&t<r){var i=n.shape.map(function(m){return 0}),a=n.shape.map(function(m){return m});a[n.shape.length-1]=t,e=n.slice(i,a),r=t}else if(null!=t&&t>r){var s=n.shape.map(function(m){return m});s[n.shape.length-1]=t-r,e=n.concat(Ze(s),n.shape.length-1),r=t}else e=n;var u=e.zerosLike(),c=Vt(e,u).as2D(o,r),l=Iv(c),d=Math.floor(r/2)+1,f=Ln(l),h=Dr(l),p=f.split([d,r-d],f.shape.length-1),v=h.split([d,r-d],h.shape.length-1),g=e.shape.slice();return g[e.shape.length-1]=d,Vt(p[0],v[0]).reshape(g)}}),zC=A({irfft_:function(n){var t=n.shape[n.shape.length-1],e=n.size/t;if(t<=2){var r=n.as2D(e,t),o=_l(r);return Ln(o)}var i=[e,2*(t-1)],a=Ln(n).as2D(e,t),s=Dr(n).as2D(e,t),u=a.slice([0,1],[e,t-2]).reverse(1),c=s.slice([0,1],[e,t-2]).reverse(1).mul(q(-1)),l=a.concat(u,1),d=s.concat(c,1);return r=Vt(l,d).as2D(i[0],i[1]),o=_l(r),Ln(o)}}),XV=Object.freeze({fft:Iv,ifft:_l,rfft:Sv,irfft:zC}),YV=A({sparseToDense_:function(n,t,e,r){void 0===r&&(r=0);var o=D(n,"sparseIndices","sparseToDense","int32"),i=D(t,"sparseValues","sparseToDense"),a=D(r,"defaultValue","sparseToDense",i.dtype);return function(s,u,c,l){if("int32"!==s.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(c.length!==f)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+f+".");if(0!==u.rank&&(1!==u.rank||u.size!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,e,a),M.runKernelFunc(function(s){return s.sparseToDense(o,i,e,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),QV=A({gatherND_:function(n,t){var e=D(t,"indices","gatherND","int32"),r=D(n,"x","gatherND");return M.runKernelFunc(function(o){return o.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),JV=A({diag_:function(n){var t=D(n,"x","diag").flatten(),e=n.shape.concat(n.shape);return M.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(e)}}),ZV=A({dropout_:function(n,t,e,r){var o=D(n,"x","dropout");if(C("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),C(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),0===t)return n instanceof Ke?o.clone():o;var i=function(u,c){if(null==c)return u.shape.slice();if(bt(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],d=0;d<u.shape.length;d++)l.push(null==c[d]&&null!=u.shape[d]?u.shape[d]:c[d]);return l}return c}(o,e),a=1-t,s=oD(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function GC(n,t,e){for(var r=1-n%2,o=new Float32Array(n),i=0;i<n;++i){var a=2*Math.PI*i/(n+r-1);o[i]=t-e*Math.cos(a)}return xt(o,"float32")}var $t,Tv=A({hannWindow_:function(n){return GC(n,.5,.5)}}),qC=A({hammingWindow_:function(n){return GC(n,.54,.46)}}),Mv=A({frame_:function(n,t,e,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+t<=n.size;)a.push(Er(n,i,t)),i+=e;if(r)for(;i<n.size;){var s=i+t-n.size,u=St([Er(n,i,t-s),Cr([s],o)]);a.push(u),i+=e}return 0===a.length?To([],[0,t]):St(a).as2D(a.length,t)}}),$C=A({stft_:function(n,t,e,r,o){void 0===o&&(o=Tv),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))));for(var a=Mv(n,t,e),s=qt(a,o(t)),u=[],c=0;c<a.shape[0];c++)u.push(Sv(s.slice([c,0],[1,t]),r));return St(u)}}),eH=Object.freeze({hannWindow:Tv,hammingWindow:qC,frame:Mv,stft:$C});!function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}($t||($t={}));var nH=A({absoluteDifference_:function(n,t,e,r){void 0===r&&(r=$t.SUM_BY_NONZERO_WEIGHTS);var o=D(n,"labels","absoluteDifference"),i=D(t,"predictions","absoluteDifference"),a=null;null!=e&&(a=D(e,"weights","absoluteDifference")),Fe(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return to(s,a,r)}}),to=A({computeWeightedLoss_:function(n,t,e){void 0===e&&(e=$t.SUM_BY_NONZERO_WEIGHTS);var r=D(n,"losses","computeWeightedLoss"),o=null;null!=t&&(o=D(t,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(e===$t.NONE)return i;if(e===$t.SUM)return i.sum();if(e===$t.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(q(a)):s}if(e===$t.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(q(r.size));var u=o.mul(da(r.shape)).notEqual(q(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+e)}}),rH=A({cosineDistance_:function(n,t,e,r,o){void 0===o&&(o=$t.SUM_BY_NONZERO_WEIGHTS);var i=D(n,"labels","cosineDistance"),a=D(t,"predictions","cosineDistance"),s=null;null!=r&&(s=D(r,"weights","cosineDistance")),Fe(i.shape,a.shape,"Error in cosineDistance: ");var u=q(1).sub(i.mul(a).sum(e,!0));return to(u,s,o)}}),oH=A({hingeLoss_:function(n,t,e,r){void 0===r&&(r=$t.SUM_BY_NONZERO_WEIGHTS);var o=D(n,"labels","hingeLoss"),i=D(t,"predictions","hingeLoss"),a=null;null!=e&&(a=D(e,"weights","hingeLoss")),Fe(o.shape,i.shape,"Error in hingeLoss: ");var s=q(1);o=q(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return to(u,a,r)}}),iH=A({huberLoss_:function(n,t,e,r,o){void 0===r&&(r=1),void 0===o&&(o=$t.SUM_BY_NONZERO_WEIGHTS);var i=D(n,"labels","huberLoss"),a=D(t,"predictions","huberLoss"),s=null;null!=e&&(s=D(e,"weights","huberLoss")),Fe(i.shape,a.shape,"Error in huberLoss: ");var u=q(r),c=a.sub(i).abs(),l=CC(c,u),d=c.sub(l),f=q(.5).mul(l.square()).add(u.mul(d));return to(f,s,o)}}),aH=A({logLoss_:function(n,t,e,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=$t.SUM_BY_NONZERO_WEIGHTS);var i=D(n,"labels","logLoss"),a=D(t,"predictions","logLoss"),s=null;null!=e&&(s=D(e,"weights","logLoss")),Fe(i.shape,a.shape,"Error in logLoss: ");var u=q(1),c=q(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return to(l,s,o)}}),sH=A({meanSquaredError_:function(n,t,e,r){void 0===r&&(r=$t.SUM_BY_NONZERO_WEIGHTS);var o=D(n,"labels","meanSquaredError"),i=D(t,"predictions","meanSquaredError"),a=null;null!=e&&(a=D(e,"weights","meanSquaredError")),Fe(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return to(s,a,r)}}),uH=A({sigmoidCrossEntropy_:function(n,t,e,r,o){void 0===r&&(r=0),void 0===o&&(o=$t.SUM_BY_NONZERO_WEIGHTS);var i=D(n,"multiClassLabels","sigmoidCrossEntropy"),a=D(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=e&&(s=D(e,"weights","sigmoidCrossEntropy")),Fe(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=q(r),c=q(1),l=q(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var d=function(f,h){var p=D(f,"labels","sigmoidCrossEntropyWithLogits"),v=D(h,"logits","sigmoidCrossEntropyWithLogits");Fe(p.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=v.relu(),m=v.mul(p),w=v.abs().neg().exp().log1p();return g.sub(m).add(w)}(i,a);return to(d,s,o)}}),cH=A({softmaxCrossEntropy_:function(n,t,e,r,o){void 0===r&&(r=0),void 0===o&&(o=$t.SUM_BY_NONZERO_WEIGHTS);var i=D(n,"onehotLabels","softmaxCrossEntropy"),a=D(t,"logits","softmaxCrossEntropy"),s=null;if(null!=e&&(s=D(e,"weights","softmaxCrossEntropy")),Fe(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=q(r),c=q(1),l=q(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var d=function(f,h,p){if(void 0===p&&(p=-1),-1===p&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return il(function(v,g,m){var w=g.logSumExp([p],!0),y=g.toFloat().sub(w);return m([v,y]),{value:y.mul(v).neg().sum([p]),gradFunc:function(b,x){var _=x[0],T=x[1],S=rn(b.shape,[p]);return[b.reshape(S).mul(_.toFloat().sub(T.exp())),b.reshape(S).mul(T.exp().sub(_.toFloat()))]}}})(f,h)}(i,a);return to(d,s,o)}}),lH=Object.freeze({get Reduction(){return $t},absoluteDifference:nH,computeWeightedLoss:to,cosineDistance:rH,hingeLoss:oH,huberLoss:iH,logLoss:aH,meanSquaredError:sH,sigmoidCrossEntropy:uH,softmaxCrossEntropy:cH});function KC(n,t){return void 0===t&&(t=!1),M.tidy(function(){if(2!==n.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var e=n.shape[0],r=n.shape[1],o=rD(e),i=n.clone(),a=To([[1]],[1,1]),s=a.clone(),u=e>=r?r:e,c=function(d){var f,h=i,p=s,v=o;f=M.tidy(function(){var g=i.slice([d,d],[e-d,1]),m=g.norm(),w=i.slice([d,d],[1,1]),y=To([[-1]]).where(w.greater(0),To([[1]])),b=w.sub(y.mul(m)),x=g.div(b);s=1===x.shape[0]?a.clone():a.concat(x.slice([1,0],[x.shape[0]-1,x.shape[1]]),0);var _=y.matMul(b).div(m).neg(),T=i.slice([d,0],[e-d,r]),S=_.mul(s);if(0===d)i=T.sub(S.matMul(s.transpose().matMul(T)));else{var E=T.sub(S.matMul(s.transpose().matMul(T)));i=i.slice([0,0],[d,r]).concat(E,0)}var I=o.slice([0,d],[e,o.shape[1]-d]);if(0===d)o=I.sub(I.matMul(s).matMul(S.transpose()));else{var N=I.sub(I.matMul(s).matMul(S.transpose()));o=o.slice([0,0],[e,d]).concat(N,1)}return[s,i,o]}),s=f[0],i=f[1],o=f[2],ln([h,p,v])},l=0;l<u;++l)c(l);return!t&&e>r&&(o=o.slice([0,0],[e,r]),i=i.slice([0,0],[r,r])),[o,i]})}var dH=A({bandPart_:function(n,t,e){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=D(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(t<=a))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+a+").");if(!(e<=s))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+s+").");t<0&&(t=a),e<0&&(e=s);var u=Jc(0,a,1,"int32").reshape([-1,1]),c=Jc(0,s,1,"int32"),l=Mt(u,c),d=ml(l.lessEqual(q(+t,"int32")),l.greaterEqual(q(-e,"int32"))),f=Ze([a,s],r.dtype);return En(Tt(r.reshape([-1,a,s])).map(function(h){return di(d,h,f)})).reshape(o)}}),fH=A({gramSchmidt_:function(n){var t;if(Array.isArray(n)){t=!1,C(null!=n&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=n[0].shape[0],r=function(u){C(n[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+e+")"})},o=1;o<n.length;++o)r(o)}else t=!0,n=Kp(n,n.shape[0],0).map(function(u){return aD(u,[0])});C(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var i=[],a=n,s=function(u){i.push(M.tidy(function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var d=VC(i[l].mulStrict(c)).mul(i[l]);c=c.sub(d)}return c.div(UC(c,"euclidean"))}))};for(o=0;o<n.length;++o)s(o);return t?En(i,0):i}}),hH=A({qr_:function(n,t){if(void 0===t&&(t=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(2===n.rank)return KC(n,t);var e=n.shape.slice(0,n.shape.length-2).reduce(function(a,s){return a*s}),r=Tt(n.reshape([e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),o=[],i=[];return r.forEach(function(a){var s=KC(a,t),c=s[1];o.push(s[0]),i.push(c)}),[En(o,0).reshape(n.shape),En(i,0).reshape(n.shape)]}}),pH=Object.freeze({bandPart:dH,gramSchmidt:fH,qr:hH});function Dl(n,t,e,r,o,i){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==i&&(i=0);var a=n.shape[0];return e=Math.min(e,a),C(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),C(2===n.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),C(4===n.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),C(1===t.rank,function(){return"scores must be a 1D tensor"}),C(t.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]}),C(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var vH=A({resizeBilinear_:function(n,t,e){void 0===e&&(e=!1);var r=D(n,"images","resizeBilinear");C(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),C(2===t.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=M.runKernelFunc(function(c,l){return l([o]),c.resizeBilinear(o,a,s,e)},{x:o},function(c,l){return{x:function(){return M.runKernelFunc(function(d){return d.resizeBilinearBackprop(c,l[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),gH=A({resizeNearestNeighbor_:function(n,t,e){void 0===e&&(e=!1);var r=D(n,"images","resizeNearestNeighbor");C(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),C(2===t.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),C("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=M.runKernelFunc(function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,e)},{batchImages:o},function(c,l){return{batchImages:function(){return M.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(c,l[0],e)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),mH=A({nonMaxSuppression_:function(n,t,e,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=D(n,"boxes","nonMaxSuppression"),a=D(t,"scores","nonMaxSuppression"),s=Dl(i,a,e,r,o);return M.runKernelFunc(function(c){return c.nonMaxSuppression(i,a,e,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",{maxOutputSize:e=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:o=s.scoreThreshold})}}),bH=A({nonMaxSuppressionWithScore_:function(n,t,e,r,o,i){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var a=D(n,"boxes","nonMaxSuppression"),s=D(t,"scores","nonMaxSuppression"),u=Dl(a,s,e,r,o,i),c={maxOutputSize:e=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=M.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),xH=A({cropAndResize_:function(n,t,e,r,o,i){var a=D(n,"image","cropAndResize"),s=D(t,"boxes","cropAndResize","float32"),u=D(e,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return C(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),C(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),C(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),C(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),C(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),C("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),M.runKernelFunc(function(l,d){return l.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),Av=Object.freeze({resizeBilinear:vH,resizeNearestNeighbor:gH,nonMaxSuppression:mH,nonMaxSuppressionAsync:function(n,t,e,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),J(this,void 0,void 0,function(){var i,a,s,u,d;return Z(this,function(f){switch(f.label){case 0:return i=D(n,"boxes","nonMaxSuppressionAsync"),a=D(t,"scores","nonMaxSuppressionAsync"),s=Dl(i,a,e,r,o),e=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=f.sent(),d=sv(u[0],u[1],e,r,o),i!==n&&i.dispose(),a!==t&&a.dispose(),[2,d]}})})},nonMaxSuppressionWithScore:bH,nonMaxSuppressionWithScoreAsync:function(n,t,e,r,o,i){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),J(this,void 0,void 0,function(){var a,s,u,c,f;return Z(this,function(h){switch(h.label){case 0:return a=D(n,"boxes","nonMaxSuppressionAsync"),s=D(t,"scores","nonMaxSuppressionAsync"),u=Dl(a,s,e,r,o,i),e=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=h.sent(),f=uv(c[0],c[1],e,r,o,i),a!==n&&a.dispose(),s!==t&&s.dispose(),[2,f]}})})},cropAndResize:xH}),Rv=function(n,t){return!(n>0)||"linear"===t},Nv=function(n,t,e){if(null==e||"linear"===e)return n;if("relu"===e)return n.mul(t.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},Fv=function(n,t){var e=t,r=_t(n.shape,t.shape);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},kv=function(n,t,e){if("linear"===t)return n;if("relu"===t)return ot(n);if("elu"===t)return HC(n);if("relu6"===t)return WC(n);if("prelu"===t)return jC(n,e);throw new Error("Unknown fused activation "+t+".")},_H=A({fusedMatMul_:function(n){var t,e=n.a,r=n.b,o=n.transposeA,i=void 0!==o&&o,a=n.transposeB,s=void 0!==a&&a,u=n.bias,c=n.activation,l=void 0===c?"linear":c,d=n.preluActivationWeights;if(!1===Rv(M.state.gradientDepth,l)){var f=wl(e,r,i,s);return null!=u&&(f=Ie(f,u)),kv(f,l,d)}var h=D(e,"a","fused matMul"),p=D(r,"b","fused matMul");t=tt(h,p),h=t[0],p=t[1];var v=i?h.shape[h.rank-2]:h.shape[h.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],m=i?h.shape[h.rank-1]:h.shape[h.rank-2],w=s?p.shape[p.rank-2]:p.shape[p.rank-1],y=h.shape.slice(0,-2),b=p.shape.slice(0,-2),x=ee(y),_=ee(b);C(h.rank>=2&&p.rank>=2&&h.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."}),C(bt(y,b),function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+b+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."}),C(v===g,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+g+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var T,S,E=h.shape.slice(0,-2).concat([m,w]),I=i?h.as3D(x,v,m):h.as3D(x,m,v),N=s?p.as3D(_,w,g):p.as3D(_,g,w);null!=u&&Ee(E,(T=tt(T=D(u,"bias","fused matMul"),h)[0]).shape),null!=d&&(S=D(d,"prelu weights","fused matMul"));var R={a:I,b:N};return null!=u&&(R.bias=T),null!=d&&(R.preluActivationWeights=S),M.runKernelFunc(function(O,L){var H=O.fusedBatchMatMul({a:I,b:N,transposeA:i,transposeB:s,bias:T,activation:l,preluActivationWeights:S});return L([I,N,H]),H},R,function(O,L){var H=L[0],j=L[1],z=Nv(O,L[2],l),G={};return null!=u&&(G={bias:function(){return Fv(T,z)}}),Object.assign(i||s?!i&&s?{a:function(){return z.matMul(j,!1,!1)},b:function(){return z.matMul(H,!0,!1)}}:i&&!s?{a:function(){return j.matMul(z,!1,!0)},b:function(){return H.matMul(z,!1,!1)}}:{a:function(){return j.matMul(z,!0,!0)},b:function(){return z.matMul(H,!0,!0)}}:{a:function(){return z.matMul(j,!1,!0)},b:function(){return H.matMul(z,!0,!1)}},G)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},[I,N],[!0]).reshape(E)}}),DH=A({fusedConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,o=n.pad,i=n.dataFormat,a=void 0===i?"NHWC":i,s=n.dilations,u=void 0===s?[1,1]:s,c=n.dimRoundingMode,l=n.bias,d=n.activation,f=void 0===d?"linear":d,h=n.preluActivationWeights;if(!1===Rv(M.state.gradientDepth,f=f||"linear")){var p=Vn(t,e,r,o,a,u,c);return null!=l&&(p=Ie(p,l)),kv(p,f,h)}var v=D(t,"x","conv2d"),g=D(e,"filter","conv2d"),m=v,w=!1;3===v.rank&&(w=!0,m=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),C(4===m.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+m.rank+"."}),C(4===g.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),null!=c&&C(rt(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),C(m.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+m.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),C(on(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),C("NHWC"===a,function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var y,b,x=Mo(m.shape,g.shape,r,u,o,c);null!=l&&(y=tt(y=D(l,"bias","fused conv2d"),v)[0],Ee(x.outShape,y.shape)),null!=h&&(b=D(h,"prelu weights","fused conv2d"));var _={x:m,filter:g};null!=l&&(_.bias=y),null!=h&&(_.preluActivationWeights=b);var S=M.runKernelFunc(function(E,I){var N=E.fusedConv2d({input:m,filter:g,convInfo:x,bias:y,activation:f,preluActivationWeights:b});return I([g,m,N]),N},_,function(E,I){var R=I[0],B=I[1],L=Nv(E,I[2],f);C(ui(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var H={};return null!=l&&(H={bias:function(){return Fv(y,L)}}),Object.assign({x:function(){return NC(B.shape,L,R,r,o)},filter:function(){return Cv(B,L,R.shape,r,o)}},H)},"FusedConv2D",{convInfo:x,activation:f},[g,m],[!0]);return w?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),CH=A({fusedDepthwiseConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,o=n.pad,i=n.dataFormat,a=void 0===i?"NHWC":i,s=n.dilations,u=void 0===s?[1,1]:s,c=n.dimRoundingMode,l=n.bias,d=n.activation,f=void 0===d?"linear":d,h=n.preluActivationWeights;if(!1===Rv(M.state.gradientDepth,f)){var p=bl(t,e,r,o,a,u,c);return null!=l&&(p=Ie(p,l)),kv(p,f,h)}var v=D(t,"x","depthwiseConv2d"),g=D(e,"filter","depthwiseConv2d"),m=v,w=!1;3===v.rank&&(w=!0,m=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),C(4===m.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),C(4===g.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),C(m.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),null==u&&(u=[1,1]),C(on(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&C(rt(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var y,b,x=Mo(m.shape,g.shape,r,u,o,c,!0);null!=l&&(y=tt(y=D(l,"bias","fused conv2d"),v)[0],Ee(x.outShape,y.shape)),null!=h&&(b=D(h,"prelu weights","fused depthwiseConv2d"));var _={x:m,filter:g};null!=l&&(_.bias=y),null!=h&&(_.preluActivationWeights=b);var S=M.runKernelFunc(function(E,I){var N=E.fusedDepthwiseConv2D({input:m,filter:g,convInfo:x,bias:y,activation:f,preluActivationWeights:b});return I([g,m,N]),N},_,function(E,I){C(ui(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var N=I[0],R=I[1],O=Nv(E,I[2],f),L={};return null!=l&&(L={bias:function(){return Fv(y,O)}}),Object.assign({x:function(){return FC(R.shape,O,N,x)},filter:function(){return kC(R,O,N.shape,x)}},L)},"FusedDepthwiseConv2D",{convInfo:x,activation:f},[g,m],[!0]);return w?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),EH=Object.freeze({matMul:_H,conv2d:DH,depthwiseConv2d:CH}),IH=Object.freeze({image:Av,linalg:pH,losses:lH,spectral:XV,fused:EH,signal:eH,square:a4,squaredDifference:pC,conv1d:vV,conv2d:Vn,conv3d:gV,depthwiseConv2d:bl,separableConv2d:Ev,conv2dTranspose:mV,conv3dTranspose:yV,op:A,batchNormalization2d:O4,batchNormalization3d:L4,batchNormalization4d:B4,batchNormalization:V4,batchNorm:wC,batchNorm2d:H4,batchNorm3d:j4,batchNorm4d:W4,booleanMaskAsync:function(n,t,e){return J(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,v;return Z(this,function(g){switch(g.label){case 0:for(r=D(n,"tensor","boolMask"),o=D(t,"mask","boolMask","bool"),i=e??0,s=r.shape,C((a=o.rank)>0,function(){return"mask cannot be scalar"}),Fe(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),d=r.reshape(l),f=o.reshape([-1]),[4,_C(f)];case 1:return h=g.sent(),p=h.squeeze([1]),v=_v(d,p,i),n!==r&&r.dispose(),t!==o&&o.dispose(),p.dispose(),d.dispose(),f.dispose(),h.dispose(),[2,v]}})})},complex:Vt,real:Ln,imag:Dr,concat:St,concat1d:$L,concat2d:KL,concat3d:XL,concat4d:YL,split:Kp,matMul:wl,dot:bV,outerProduct:wV,reverse:Ys,reverse1d:xV,reverse2d:_V,reverse3d:DV,reverse4d:CV,maxPool:Ft,avgPool:Qs,pool:EV,maxPool3d:IV,avgPool3d:SV,slice:Er,slice1d:TV,slice2d:MV,slice3d:LC,slice4d:AV,abs:s4,acos:u4,acosh:c4,asin:l4,asinh:d4,atan:f4,atanh:h4,ceil:p4,clipByValue:bv,cos:v4,cosh:g4,erf:m4,exp:wv,expm1:y4,floor:b4,log:w4,log1p:x4,logSigmoid:_4,neg:pl,reciprocal:D4,round:C4,rsqrt:vC,sigmoid:gC,sign:E4,isNaN:I4,isInf:S4,isFinite:T4,sin:M4,sinh:A4,softplus:R4,sqrt:N4,step:F4,tan:k4,tanh:P4,all:RV,any:NV,argMax:FV,argMin:kV,logSumExp:PV,max:xl,mean:OV,min:LV,moments:BV,sum:VC,prod:VV,equal:EC,equalStrict:oV,greater:iV,greaterEqual:IC,greaterEqualStrict:aV,greaterStrict:sV,less:uV,lessEqual:cV,lessEqualStrict:lV,lessStrict:dV,notEqual:fV,notEqualStrict:hV,add:Ie,addN:G4,addStrict:q4,atan2:$4,div:ar,divNoNan:K4,divStrict:X4,floorDiv:DC,maximum:xv,maximumStrict:Y4,minimum:CC,minimumStrict:Q4,mod:J4,modStrict:Z4,mul:qt,mulStrict:eV,pow:yl,powStrict:tV,squaredDifferenceStrict:nV,sub:Mt,subStrict:rV,elu:HC,leakyRelu:HV,prelu:jC,relu:ot,relu6:WC,selu:jV,logicalAnd:ml,logicalNot:U4,logicalOr:xC,logicalXor:z4,where:di,whereAsync:_C,buffer:ve,print:function iB(n,t){void 0===t&&(t=!1),console.log(n.toString(t))},batchToSpaceND:nD,broadcastTo:aB,cast:sB,clone:uB,cumsum:cB,depthToSpace:lB,expandDims:Bn,eye:rD,multinomial:dB,oneHot:Yp,pad:si,pad1d:fB,pad2d:hB,pad3d:pB,pad4d:vB,rand:gB,randomNormal:mB,randomGamma:yB,randomUniform:oD,reshape:or,spaceToBatchND:iD,squeeze:aD,stack:En,tile:fa,truncatedNormal:bB,unstack:Tt,setdiff1dAsync:function(n,t){return J(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,d;return Z(this,function(f){switch(f.label){case 0:return e=D(n,"x","setdiff1d"),r=D(t,"y","setdiff1d"),C(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),C(1===e.rank,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),C(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return o=f.sent(),[4,r.data()];case 2:for(i=f.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new Ns([s],e.dtype),c=new Ns([s],"int32"),l=0,d=0;l<o.length;l++)a.has(o[l])||(u.values[d]=o[l],c.values[d]=l,d++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:Cr,linspace:function qL(n,t,e){if(e<=0)throw new Error("The number of values should be positive.");return M.runKernelFunc(function(r){return r.linspace(n,t,e)},{})},ones:da,range:Jc,scalar:q,tensor:Ht,tensor1d:xt,tensor2d:To,tensor3d:$p,tensor4d:fn,tensor5d:function UL(n,t,e){if(ti(n),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=_r(n,e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return So(n,t,r,e)},tensor6d:function zL(n,t,e){if(ti(n),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=_r(n,e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return So(n,t=t||r,r,e)},variable:function GL(n,t,e,r){return void 0===t&&(t=!0),M.makeVariable(n,t,e,r)},zeros:Ze,onesLike:tD,zerosLike:ke,transpose:Ao,softmax:Jr,logSoftmax:_B,localResponseNormalization:WV,norm:UC,gather:_v,unsortedSegmentSum:MC,basicLSTMCell:UV,multiRNNCell:zV,movingAverage:GV,stridedSlice:qV,topk:$V,scatterND:KV,fft:Iv,ifft:_l,rfft:Sv,irfft:zC,sparseToDense:YV,gatherND:QV,diag:JV,dropout:ZV,hannWindow:Tv,hammingWindow:qC,frame:Mv,stft:$C,inTopKAsync:function(n,t,e){return void 0===e&&(e=1),J(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d,f,h,p,v,g;return Z(this,function(m){switch(m.label){case 0:return r=D(n,"predictions","inTopK"),o=D(t,"targets","inTopK"),C(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),C(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Fe(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],C(e>0&&e<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+e}),[4,r.data()];case 1:return a=m.sent(),[4,o.data()];case 2:for(s=m.sent(),l=(u=[a.length/i,i])[1],d=sa("bool",c=u[0]),f=0;f<c;f++){for(p=a.subarray(h=f*l,h+l),v=[],g=0;g<p.length;g++)v.push({value:p[g],index:g});for(v.sort(function(w,y){return y.value-w.value}),d[f]=0,g=0;g<e;g++)if(v[g].index===s[f]){d[f]=1;break}}return n!==r&&r.dispose(),t!==o&&o.dispose(),[2,Ht(d,o.shape,"bool")]}})})}});function W(n,t){Array.isArray(n)||(n=[n]),n.forEach(function(e){null!=e&&C("complex64"!==e.dtype,function(){return t+" does not support complex64 tensors."})})}function Pv(n,t,e,r){if("linear"===e)return n.linear(t);if("relu"===e)return n.relu(t);if("elu"===e)return n.elu(t);if("relu6"===e)return n.relu6(t);if("prelu"===e)return n.prelu(t,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var SH=function(n){function t(){var e=n.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new pD(e,M),e}return Zn(t,n),t.prototype.write=function(e,r,o){this.firstUse&&(this.firstUse=!1,P().get("IS_NODE")&&Yc("\n============================\nHi there \u{1f44b}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var i={};return this.data.set(i,{values:e,dtype:o}),i},t.prototype.move=function(e,r,o,i){this.data.set(e,{values:r,dtype:i})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return J(this,void 0,void 0,function(){return Z(this,function(r){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var r=this.data.get(e),i=r.complexTensors;return"complex64"===r.dtype?av(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),o=r;if("string"===e.dtype)try{o=r.map(function(i){return Ts(i)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ve(e.shape,e.dtype,o)},t.prototype.makeOutput=function(e,r,o){var i=this.write(e,r,o);return M.makeTensorFromDataId(i,r,o,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;null!=r&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return J(this,void 0,void 0,function(){var r;return Z(this,function(o){return r=tr(),e(),[2,{kernelMs:tr()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,r){var o=this.makeOutput(null,e.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:M.keep(e.clone()),imag:M.keep(r.clone())},o},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,o){if(W(e,"slice"),ev(e.shape,r,o)){var i=tv(r,e.strides),a=ee(o);return Ht(this.readSync(e.dataId).subarray(i,i+a),o,e.dtype)}for(var s=ve(o,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c).map(function(d,f){return d+r[f]});s.values[c]=u.get.apply(u,l)}return s.toTensor()},t.prototype.stridedSlice=function(e,r,o,i){W(e,"stridedSlice");var a=ol(r,o,i);if(a.some(function(h){return 0===h}))return Ht([],a);for(var s=ve(a,e.dtype),u=this.bufferSync(e),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),d=new Array(l.length),f=0;f<d.length;f++)d[f]=l[f]*i[f]+r[f];s.set.apply(s,[u.get.apply(u,d)].concat(l))}return s.toTensor()},t.prototype.diag=function(e){for(var r=this.readSync(e.dataId),o=ve([e.size,e.size],e.dtype),i=o.values,a=0;a<r.length;a++)i[a*e.size+a]=r[a];return o.toTensor()},t.prototype.unstack=function(e,r){for(var o=e.shape[r],i=new Array(e.rank-1),a=0,s=0;s<e.rank;s++)s!==r&&(i[a++]=e.shape[s]);var u=new Array(e.rank).fill(0),c=e.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(e,u,c).reshape(i);return l},t.prototype.reverse=function(e,r){W(e,"reverse");for(var o=ve(e.shape,e.dtype),i=this.bufferSync(e),a=function(u){var c=o.indexToLoc(u),l=c.slice();r.forEach(function(d){return l[d]=e.shape[d]-1-l[d]}),o.set.apply(o,[i.get.apply(i,l)].concat(c))},s=0;s<o.size;s++)a(s);return o.toTensor()},t.prototype.concat=function(e,r){var o=this;if("complex64"===e[0].dtype){var i=e.map(function(h){return Ln(h)}),a=e.map(function(h){return Dr(h)});return Vt(this.concat(i,r),this.concat(a,r))}var s=e.map(function(h){var p=ee(h.shape.slice(r));return h.as2D(-1,p)}),u=oi(s.map(function(h){return h.shape}),1),c=ve(u,e[0].dtype).values;if(1===s[0].shape[0]){var l=0;s.forEach(function(h){c.set(o.readSync(h.dataId),l),l+=h.size})}else{var d=0;s.forEach(function(h){for(var p=o.readSync(h.dataId),v=0,g=0;g<h.shape[0];++g)for(var m=g*u[1]+d,w=0;w<h.shape[1];++w)c[m+w]=p[v++];d+=h.shape[1]})}var f=oi(e.map(function(h){return h.shape}),r);return Ht(c,f,e[0].dtype)},t.prototype.neg=function(e){return W(e,"neg"),this.multiply(q(-1),e)},t.prototype.add=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o+a,imag:i+s}}):this.broadcastedBinaryOp(e,r,Nt(e.dtype,r.dtype),function(o,i){return o+i})},t.prototype.addN=function(e){var r=this;W(e,"addN");for(var o=e.map(function(l){return r.readSync(l.dataId)}),i=ve(e[0].shape,e[0].dtype),a=i.values,s=0;s<e.length;s++)for(var u=o[s],c=0;c<a.length;c++)a[c]+=u[c];return i.toTensor()},t.prototype.softmax=function(e,r){var o=wt([r],e.shape),i=this.max(e,o),a=rn(i.shape,o),s=this.subtract(e,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},t.prototype.subtract=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o-a,imag:i-s}}):this.broadcastedBinaryOp(e,r,Nt(e.dtype,r.dtype),function(o,i){return o-i})},t.prototype.pow=function(e,r){return W([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.pow(o,i)})},t.prototype.batchMatMul=function(e,r,o,i){W([e,r],"matMul");for(var a=o?e.shape[1]:e.shape[2],s=o?e.shape[2]:e.shape[1],u=i?r.shape[1]:r.shape[2],c=e.shape[0],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=o?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=f[0],p=f[1],v=f[2],g=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],m=g[0],w=g[1],y=g[2],b=s*u,x=ve([c,s,u],e.dtype),_=x.values,T=this.blockSize,S=0;S<c;S++)for(var E=0;E<s;E+=T)for(var I=0;I<u;I+=T)for(var N=0;N<a;N+=T)for(var R=Math.min(E+T,s),B=Math.min(I+T,u),O=Math.min(N+T,a),L=E;L<R;L++)for(var H=I;H<B;H++){for(var j=0,V=N;V<O;V++)j+=l[S*h+L*p+V*v]*d[V*m+H*w+S*y];_[S*b+(L*u+H)]+=j}return x.toTensor()},t.prototype.fusedBatchMatMul=function(e){var s=e.bias,u=e.activation,c=e.preluActivationWeights,l=this.batchMatMul(e.a,e.b,e.transposeA,e.transposeB);return s&&(l=this.add(l,s)),u&&(l=Pv(this,l,u,c)),l},t.prototype.multiply=function(e,r){return"complex64"===e.dtype||"complex64"===r.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}}):this.broadcastedBinaryOp(e,r,Nt(e.dtype,r.dtype),function(o,i){return o*i})},t.prototype.realDivide=function(e,r){return W([e,r],"realDivide"),this.broadcastedBinaryOp(e,r,"float32",function(o,i){return o/i})},t.prototype.floorDiv=function(e,r){return W([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(o,i){return Math.floor(o/i)})},t.prototype.sum=function(e,r){W(e,"sum"),dn("sum",r,e.rank);for(var o=Bt(e.shape,r),a=o[1],s=Ze(o[0],Nt(e.dtype,"int32")),u=ee(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=0,p=0;p<u;++p)h+=l[f+p];c[d]=h}return s},t.prototype.prod=function(e,r){W(e,"sum");for(var o=Bt(e.shape,r),a=o[1],s=Ze(o[0],Nt(e.dtype,"int32")),u=ee(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=1,p=0;p<u;++p)h*=l[f+p];c[d]=h}return s},t.prototype.unsortedSegmentSum=function(e,r,o){W(e,"unsortedSegmentSum");for(var i=[],a=e.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=q(s,"int32"),c=EC(u,r).asType("float32").mul(e).sum(0);i.push(c)}return En(i)},t.prototype.argMin=function(e,r){W(e,"argMin");var o=[r];dn("argMin",o,e.rank);for(var i=Bt(e.shape,o),s=i[1],u=Ze(i[0],"int32"),c=ee(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],v=0,g=0;g<c;++g){var m=d[h+g];m<p&&(p=m,v=g)}l[f]=v}return u},t.prototype.argMax=function(e,r){W(e,"argMax");var o=[r];dn("argMax",o,e.rank);for(var i=Bt(e.shape,o),s=i[1],u=Ze(i[0],"int32"),c=ee(s),l=this.readSync(u.dataId),d=this.readSync(e.dataId),f=0;f<l.length;++f){for(var h=f*c,p=d[h],v=0,g=0;g<c;++g){var m=d[h+g];m>p&&(p=m,v=g)}l[f]=v}return u},t.prototype.cumsum=function(e,r,o,i){if(W(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var a=Nt(e.dtype,"int32"),s=Ze(e.shape,a),u=this.readSync(s.dataId),c=this.readSync(e.dataId),l=e.shape[e.rank-1],d=i?function(g,m){return g+l-m-1}:function(g,m){return g+m},f=0;f<c.length;f+=l)for(var h=0;h<l;h++){var p=d(f,h);if(0===h)u[p]=o?0:c[p];else{var v=d(f,h-1);u[p]=o?c[v]+u[v]:c[p]+u[v]}}return s},t.prototype.equal=function(e,r){return W([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o===i?1:0})},t.prototype.notEqual=function(e,r){return W([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o!==i?1:0})},t.prototype.less=function(e,r){return W([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<i?1:0})},t.prototype.lessEqual=function(e,r){return W([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o<=i?1:0})},t.prototype.greater=function(e,r){return W([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>i?1:0})},t.prototype.greaterEqual=function(e,r){return W([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o>=i?1:0})},t.prototype.logicalNot=function(e){W(e,"logicalNot");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,e.shape,"bool")},t.prototype.logicalAnd=function(e,r){return W([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o&&i})},t.prototype.logicalOr=function(e,r){return W([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(o,i){return o||i})},t.prototype.select=function(e,r,o){W([e,r,o],"select");for(var i=this.readSync(e.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=Ze(r.shape,Nt(r.dtype,o.dtype)),c=this.readSync(u.dataId),l=0,d=0===e.rank||e.rank>1||1===r.rank?1:ee(r.shape.slice(1)),f=0;f<i.length;f++)for(var h=0;h<d;h++)c[l++]=1===i[f]?a[f]:s[f];return u},t.prototype.where=function(e){W([e],"where");var r=this.readSync(e.dataId);return cv(e.shape,r)},t.prototype.topk=function(e,r,o){return W(e,"topk"),xD(this.readSync(e.dataId),e.shape,e.dtype,r)},t.prototype.min=function(e,r){W(e,"min"),dn("min",r,e.rank);for(var o=Bt(e.shape,r),a=o[1],s=Ze(o[0],e.dtype),u=ee(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var v=l[f+p];v<h&&(h=v)}c[d]=h}return s},t.prototype.minimum=function(e,r){return W([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.min(o,i)})},t.prototype.mod=function(e,r){return W([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i})},t.prototype.max=function(e,r){W(e,"max"),dn("max",r,e.rank);for(var o=Bt(e.shape,r),a=o[1],s=Ze(o[0],e.dtype),u=ee(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p){var v=l[f+p];v>h&&(h=v)}c[d]=h}return s},t.prototype.maximum=function(e,r){return W([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.max(o,i)})},t.prototype.all=function(e,r){W(e,"all"),dn("all",r,e.rank);for(var o=Bt(e.shape,r),a=o[1],s=Ze(o[0],e.dtype),u=ee(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h&&l[f+p];c[d]=h}return s},t.prototype.any=function(e,r){W(e,"any"),dn("any",r,e.rank);for(var o=Bt(e.shape,r),a=o[1],s=Ze(o[0],e.dtype),u=ee(a),c=this.readSync(s.dataId),l=this.readSync(e.dataId),d=0;d<c.length;++d){for(var f=d*u,h=l[f],p=0;p<u;++p)h=h||l[f+p];c[d]=h}return s},t.prototype.squaredDifference=function(e,r){return W([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){var a=o-i;return a*a})},t.prototype.ceil=function(e){W(e,"ceil");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.floor=function(e){W(e,"floor");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.sign=function(e){W(e,"x");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=r[i]<0?-1:r[i]>0?1:0;return this.makeOutput(o,e.shape,"float32")},t.prototype.isNaN=function(e){W(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.isInf=function(e){W(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.isFinite=function(e){W(e,"x");for(var r=this.readSync(e.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,e.shape,"bool")},t.prototype.round=function(e){W(e,"round");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);o[i]=r[i]-a<.5?Math.floor(r[i]):r[i]-a>.5?Math.ceil(r[i]):a%2==0?a:a+1}return this.makeOutput(o,e.shape,"float32")},t.prototype.exp=function(e){W(e,"exp");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.expm1=function(e){W(e,"expm1");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.log=function(e){W(e,"log");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.log1p=function(e){W(e,"log1p");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.log1p(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.sqrt=function(e){W(e,"sqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.sqrt(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.rsqrt=function(e){W(e,"rsqrt");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/Math.sqrt(r[i]);return this.makeOutput(o,e.shape,"float32")},t.prototype.reciprocal=function(e){W(e,"reciprocal");for(var r=this.readSync(e.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){W(e,"relu");for(var r=Ze(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},t.prototype.relu6=function(e){W(e,"relu");for(var r=Ze(e.shape,e.dtype),o=this.readSync(r.dataId),i=this.readSync(e.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},t.prototype.prelu=function(e,r){return W([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return o<0?i*o:o})},t.prototype.elu=function(e){W(e,"elu");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,e.shape,"float32")},t.prototype.eluDer=function(e,r){W([e,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},t.prototype.selu=function(e){W(e,"selu");for(var i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?1.0507009873554805*u:1.7580993408473768*(Math.exp(u)-1)}return this.makeOutput(i,e.shape,"float32")},t.prototype.clip=function(e,r,o){W(e,"clip");for(var i=new Float32Array(e.size),a=this.readSync(e.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,e.shape,"float32")},t.prototype.abs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<e.size;++i)r[i]=Math.hypot(o[2*i],o[2*i+1]);return this.makeOutput(r,e.shape,"float32")},t.prototype.int=function(e){W(e,"int");for(var r=new Int32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,e.shape,"int32")},t.prototype.sigmoid=function(e){W(e,"sigmoid");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,e.shape,"float32")},t.prototype.softplus=function(e){W(e,"softplus");for(var r=Math.log(1.1920928955078125e-7)+2,o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var l,s=i[a]>-r,u=i[a]<r,c=Math.exp(i[a]);l=u?c:s?i[a]:Math.log(1+c),o[a]=l}return this.makeOutput(o,e.shape,"float32")},t.prototype.sin=function(e){W(e,"sin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cos=function(e){W(e,"cos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tan=function(e){W(e,"tan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asin=function(e){W(e,"asin");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acos=function(e){W(e,"acos");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan=function(e){W(e,"atan");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan2=function(e,r){return W([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(o,i){return Math.atan2(o,i)})},t.prototype.sinh=function(e){W(e,"sinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cosh=function(e){W(e,"cosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tanh=function(e){W(e,"tanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=c_(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asinh=function(e){W(e,"asinh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acosh=function(e){W(e,"acosh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atanh=function(e){W(e,"atanh");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,e.shape,"float32")},t.prototype.erf=function(e){W(e,"erf");for(var r=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,e.shape,"float32")},t.prototype.step=function(e,r){void 0===r&&(r=0),W(e,"step");for(var o=new Float32Array(e.size),i=this.readSync(e.dataId),a=0;a<i.length;++a){var s=i[a];o[a]=isNaN(s)?NaN:s>0?1:r}return this.makeOutput(o,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.conv2d(e.input,e.filter,e.convInfo);return a&&(c=this.add(c,a)),s&&(c=Pv(this,c,s,u)),c},t.prototype.conv2d=function(e,r,o){W([e,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d="channelsLast"===o.dataFormat,f=ve(o.outShape,e.dtype),h=e.strides[0],p=d?e.strides[1]:e.strides[2],v=d?e.strides[2]:1,g=d?1:e.strides[1],m=f.strides[0],w=d?f.strides[1]:f.strides[2],y=d?f.strides[2]:1,b=d?1:f.strides[1],x=this.readSync(e.dataId),_=this.readSync(r.dataId),T=f.values,S=0;S<o.batchSize;++S)for(var E=S*h,I=S*m,N=0;N<o.outHeight;++N)for(var R=I+N*w,B=N*o.strideHeight-l,O=0;O<i;O++){var L=B+O*s;if(!(L<0||L>=o.inHeight))for(var H=O*r.strides[0],j=E+L*p,V=0;V<o.outWidth;++V)for(var z=R+V*y,G=V*o.strideWidth-c,X=0;X<a;X++){var re=G+X*u;if(!(re<0||re>=o.inWidth))for(var oe=j+re*v,_e=H+X*r.strides[1],De=0;De<o.inChannels;++De){for(var Te=x[oe+De*g],Pe=0;Pe<o.outChannels;++Pe)T[z+Pe*b]+=Te*_[_e+Pe];_e+=o.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(e,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,l=o.dilationWidth,d=o.padInfo.front,f=o.padInfo.left,h=o.padInfo.top,p=ve(o.outShape,e.dtype),v=this.readSync(e.dataId),g=this.readSync(r.dataId),m=p.values,w=0;w<o.batchSize;++w)for(var y=w*e.strides[0],b=w*p.strides[0],x=0;x<o.outDepth;++x)for(var _=b+x*p.strides[1],T=x*o.strideDepth-d,S=0;S<i;S++){var E=T+S*u;if(!(E<0||E>=o.inDepth))for(var I=S*r.strides[0],N=y+E*e.strides[1],R=0;R<o.outHeight;++R)for(var B=_+R*p.strides[2],O=R*o.strideHeight-h,L=0;L<a;L++){var H=O+L*c;if(!(H<0||H>=o.inHeight))for(var j=I+L*r.strides[1],V=N+H*e.strides[2],z=0;z<o.outWidth;++z)for(var G=B+z*o.outChannels,X=z*o.strideWidth-f,re=0;re<s;re++){var oe=X+re*l;if(!(oe<0||oe>=o.inWidth))for(var De=V+oe*o.inChannels,Te=j+re*r.strides[2],Pe=0;Pe<o.inChannels;++Pe){for(var Ae=v[De+Pe],Oe=0;Oe<o.outChannels;++Oe)m[G+Oe]+=Ae*g[Te+Oe];Te+=o.outChannels}}}}return p.toTensor()},t.prototype.conv2dDerInput=function(e,r,o){W([e,r],"conv2dDerInput");for(var i=ve(o.inShape,"float32"),a=i.values,s=this.readSync(e.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],d=c[1],f=c[2],h=o.batchSize,p=o.filterHeight,v=o.filterWidth,g=o.inChannels,m=o.inHeight,w=o.inWidth,y=o.outChannels,b=o.outHeight,x=o.outWidth,_=o.strideHeight,T=o.strideWidth,E=p-1-o.padInfo.top,I=v-1-o.padInfo.left,N="channelsLast"===o.dataFormat,R=i.strides[0],B=N?i.strides[1]:i.strides[2],O=N?i.strides[2]:1,L=N?1:i.strides[1],H=e.strides[0],j=N?e.strides[1]:e.strides[2],V=N?e.strides[2]:1,z=N?1:e.strides[1],G=0;G<h;++G)for(var X=0;X<g;++X)for(var re=0;re<m;++re)for(var oe=re-E,_e=Math.max(0,Math.ceil(oe/_)),De=Math.min(b,(p+oe)/_),Te=0;Te<w;++Te){for(var Pe=Te-I,Ae=Math.max(0,Math.ceil(Pe/T)),Oe=Math.min(x,(v+Pe)/T),ht=0,Re=_e;Re<De;++Re)for(var Ge=Re*_-oe,Ve=Ae;Ve<Oe;++Ve)for(var dt=H*G+j*Re+V*Ve,it=l*(p-1-Ge)+d*(v-1-(Ve*T-Pe))+f*X,at=0;at<y;++at)ht+=s[dt+z*at]*u[it+at];a[R*G+B*re+O*Te+L*X]=ht}return i.toTensor()},t.prototype.conv3dDerInput=function(e,r,o){for(var i=ve(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=s[3],f=this.readSync(e.dataId),h=e.strides,p=h[0],v=h[1],g=h[2],m=h[3],w=this.readSync(r.dataId),y=r.strides,b=y[0],x=y[1],_=y[2],T=y[3],S=o.batchSize,E=o.filterDepth,I=o.filterHeight,N=o.filterWidth,R=o.inChannels,B=o.inDepth,O=o.inHeight,L=o.inWidth,H=o.outChannels,j=o.outDepth,V=o.outHeight,z=o.outWidth,G=o.strideDepth,X=o.strideHeight,re=o.strideWidth,oe=E-1-o.padInfo.front,_e=I-1-o.padInfo.top,De=N-1-o.padInfo.left,Te=0;Te<S;++Te)for(var Pe=0;Pe<R;++Pe)for(var Ae=0;Ae<B;++Ae)for(var Oe=Ae-oe,ht=Math.max(0,Math.ceil(Oe/G)),Re=Math.min(j,(E+Oe)/G),Ge=0;Ge<O;++Ge)for(var Ve=Ge-_e,dt=Math.max(0,Math.ceil(Ve/X)),it=Math.min(V,(I+Ve)/X),at=0;at<L;++at){for(var Nr=at-De,Fr=Math.max(0,Math.ceil(Nr/re)),Mn=Math.min(z,(N+Nr)/re),Ta=0,ao=ht;ao<Re;++ao)for(var Bo=ao*G-Oe,so=dt;so<it;++so)for(var Ma=so*X-Ve,uo=Fr;uo<Mn;++uo)for(var kg=p*Te+v*ao+g*so+m*uo,Aa=b*(E-1-Bo)+x*(I-1-Ma)+_*(N-1-(uo*re-Nr))+T*Pe,kr=0;kr<H;++kr)Ta+=f[kg+kr]*w[Aa+kr];a[u*Te+c*Ae+l*Ge+d*at+Pe]=Ta}return i.toTensor()},t.prototype.conv2dDerFilter=function(e,r,o){W([e,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c="channelsLast"===o.dataFormat,l=ve(o.filterShape,"float32"),d=o.padInfo.left,f=o.padInfo.top,h=this.bufferSync(e),p=this.bufferSync(r),v=0;v<s;++v)for(var g=Math.max(0,Math.ceil((f-v)/i)),m=Math.min(o.outHeight,(o.inHeight+f-v)/i),w=0;w<u;++w)for(var y=Math.max(0,Math.ceil((d-w)/a)),b=Math.min(o.outWidth,(o.inWidth+d-w)/a),x=0;x<o.inChannels;++x)for(var _=0;_<o.outChannels;++_){for(var T=0,S=0;S<o.batchSize;++S)for(var E=g;E<m;++E)for(var I=v+E*i-f,N=y;N<b;++N){var R=w+N*a-d;T+=c?h.get(S,I,R,x)*p.get(S,E,N,_):h.get(S,x,I,R)*p.get(S,_,E,N)}l.set(T,v,w,x,_)}return l.toTensor()},t.prototype.conv3dDerFilter=function(e,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=ve(o.filterShape,"float32"),f=d.values,h=d.strides,p=h[0],v=h[1],g=h[2],m=h[3],w=this.readSync(r.dataId),y=r.strides,b=y[0],x=y[1],_=y[2],T=y[3],S=this.readSync(e.dataId),E=e.strides,I=E[0],N=E[1],R=E[2],B=E[3],O=o.padInfo.front,L=o.padInfo.left,H=o.padInfo.top,j=0;j<u;++j)for(var V=Math.max(0,Math.ceil((O-j)/i)),z=Math.min(o.outDepth,(o.inDepth+O-j)/i),G=j*p,X=0;X<c;++X)for(var re=Math.max(0,Math.ceil((H-X)/a)),oe=Math.min(o.outHeight,(o.inHeight+H-X)/a),_e=X*v+G,De=0;De<l;++De)for(var Te=Math.max(0,Math.ceil((L-De)/s)),Pe=Math.min(o.outWidth,(o.inWidth+L-De)/s),Ae=De*g+_e,Oe=0;Oe<o.inChannels;++Oe)for(var ht=Oe*m+Ae,Re=0;Re<o.outChannels;++Re){for(var Ge=0,Ve=0;Ve<o.batchSize;++Ve)for(var dt=Ve*I,it=Ve*b,at=V;at<z;++at)for(var Nr=(j+at*i-O)*N+dt,Fr=at*x+it,Mn=re;Mn<oe;++Mn)for(var Ta=(X+Mn*a-H)*R+Nr,ao=Mn*_+Fr,Bo=Te;Bo<Pe;++Bo)Ge+=S[(De+Bo*s-L)*B+Ta+Oe]*w[Bo*T+ao+Re];f[ht+Re]=Ge}return d.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var a=e.bias,s=e.activation,u=e.preluActivationWeights,c=this.depthwiseConv2D(e.input,e.filter,e.convInfo);return a&&(c=this.add(c,a)),s&&(c=Pv(this,c,s,u)),c},t.prototype.depthwiseConv2D=function(e,r,o){W([e,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,d=o.outChannels/o.inChannels,f=ve(o.outShape,e.dtype),h=this.readSync(e.dataId),p=this.readSync(r.dataId),v=f.values,g=0;g<o.batchSize;++g)for(var m=g*e.strides[0],w=g*f.strides[0],y=0;y<o.outHeight;++y)for(var b=w+y*f.strides[1],x=y*o.strideHeight-c,_=0;_<i;++_){var T=x+_*s;if(!(T<0||T>=o.inHeight))for(var S=_*r.strides[0],E=m+T*e.strides[1],I=0;I<o.outWidth;++I)for(var N=b+I*f.strides[2],R=I*o.strideWidth-l,B=0;B<a;++B){var O=R+B*u;if(!(O<0||O>=o.inWidth))for(var H=E+O*o.inChannels,j=N,V=S+B*r.strides[1],z=0;z<o.inChannels;++z){for(var G=h[H+z],X=0;X<d;++X)v[j+X]+=G*p[V+X];j+=d,V+=d}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,r,o){W([e,r],"depthwiseConv2DDerInput");for(var i=ve(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],d=this.readSync(e.dataId),f=e.strides,h=f[0],p=f[1],v=f[2],g=this.readSync(r.dataId),m=r.strides,w=m[0],y=m[1],b=m[2],x=o.batchSize,_=o.filterHeight,T=o.filterWidth,S=o.inChannels,E=o.inHeight,I=o.inWidth,R=o.outHeight,B=o.outWidth,O=o.strideHeight,L=o.strideWidth,H=_-1-o.padInfo.top,j=T-1-o.padInfo.left,V=o.outChannels/S,z=0;z<x;++z)for(var G=0;G<S;++G)for(var X=0;X<E;++X)for(var re=X-H,oe=Math.max(0,Math.ceil(re/O)),_e=Math.min(R,(_+re)/O),De=0;De<I;++De){for(var Te=De-j,Pe=Math.max(0,Math.ceil(Te/L)),Ae=Math.min(B,(T+Te)/L),Oe=0,ht=oe;ht<_e;++ht)for(var Re=ht*O-re,Ge=Pe;Ge<Ae;++Ge)for(var Ve=h*z+p*ht+v*Ge,dt=w*(_-1-Re)+y*(T-1-(Ge*L-Te))+b*G,it=0;it<V;++it)Oe+=d[Ve+(G*V+it)]*g[dt+it];a[u*z+c*X+l*De+G]=Oe}return i.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,r,o){W([e,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=ve(o.filterShape,"float32"),l=o.padInfo.left,d=o.padInfo.top,f=o.outChannels/o.inChannels,h=this.bufferSync(e),p=this.bufferSync(r),v=0;v<s;++v)for(var g=Math.max(0,Math.ceil((d-v)/i)),m=Math.min(o.outHeight,(o.inHeight+d-v)/i),w=0;w<u;++w)for(var y=Math.max(0,Math.ceil((l-w)/a)),b=Math.min(o.outWidth,(o.inWidth+l-w)/a),x=0;x<o.outChannels;++x){for(var _=Math.trunc(x/f),T=x%f,S=0,E=0;E<o.batchSize;++E)for(var I=g;I<m;++I)for(var N=v+I*i-d,R=y;R<b;++R)S+=h.get(E,N,w+R*a-l,_)*p.get(E,I,R,x);c.set(S,v,w,_,T)}return c.toTensor()},t.prototype.tile=function(e,r){return W(e,"tile"),wD(this.bufferSync(e),r)},t.prototype.pad=function(e,r,o){W(e,"pad");var i=r.map(function(f,h){return f[0]+e.shape[h]+f[1]}),a=r.map(function(f){return f[0]}),s=this.bufferSync(e),u=ve(i,e.dtype);0!==o&&u.values.fill(o);for(var c=0;c<e.size;c++){var l=s.indexToLoc(c),d=l.map(function(f,h){return f+a[h]});u.set.apply(u,[s.get.apply(s,l)].concat(d))}return u.toTensor()},t.prototype.transpose=function(e,r){W(e,"transpose");for(var o=new Array(e.rank),i=0;i<o.length;i++)o[i]=e.shape[r[i]];var a=this.readSync(e.dataId),s=ve(o,e.dtype),u=this.bufferSync(e);for(i=0;i<e.size;++i){for(var c=u.indexToLoc(i),l=new Array(c.length),d=0;d<l.length;d++)l[d]=c[r[d]];var f=s.locToIndex(l);s.values[f]=a[i]}return s.toTensor()},t.prototype.gather=function(e,r,o){W([e,r],"gather");var i=e.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=ve(i,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c),d=l.slice();d[o]=a[l[o]];var f=u.locToIndex(d);s.values[c]=u.values[f]}return s.toTensor()},t.prototype.batchToSpaceND=function(e,r,o){W([e],"batchToSpaceND");var i=r.reduce(function(d,f){return d*f}),a=el(e.shape,r,i),s=tl(a.length,r.length),u=nl(e.shape,r,i),c=sD(o,r.length),l=uD(u,o,r.length);return e.reshape(a).transpose(s).reshape(u).slice(c,l)},t.prototype.spaceToBatchND=function(e,r,o){W([e],"spaceToBatchND");var i=r.reduce(function(f,h){return f*h}),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<e.shape.length;++s)a.push([0,0]);var u=e.pad(a),c=el(u.shape,r,i,!1),l=tl(c.length,r.length,!1),d=nl(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(d)},t.prototype.pool=function(e,r,o){W(e,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(e.dataId),v=ve(r.outShape,e.dtype),g=v.values,m=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],y=r.outShape[3],b=0;b<r.batchSize;++b)for(var x=b*m,_=b*e.strides[0],T=0;T<r.inChannels;++T)for(var S=0;S<r.outHeight;++S)for(var E=S*i-d,I=Math.max(0,E),N=Math.min(r.inHeight,c+E),R=x+S*w,B=0;B<r.outWidth;++B){for(var O=B*a-f,L=Math.max(0,O),H=Math.min(r.inWidth,l+O),j=h,V=0,z=0,G=I;G<N;G+=s){for(var X=_+G*e.strides[1],re=L;re<H;re+=u){var oe=p[X+re*e.strides[2]+T];"max"===o&&oe>j?j=oe:"avg"===o&&(V+=oe,z++)}if(isNaN(j))break}g[R+B*y+T]="avg"===o?V/z:j}return v.toTensor()},t.prototype.maxPool=function(e,r){return this.pool(e,r,"max")},t.prototype.maxPoolPositions=function(e,r){for(var o=ve(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,h=this.bufferSync(e),p=0;p<r.batchSize;++p)for(var v=0;v<r.inChannels;++v)for(var g=0;g<r.outHeight;++g){for(var m=g*i-d,w=m;w<0;)w+=s;for(var y=Math.min(r.inHeight,c+m),b=0;b<r.outWidth;++b){for(var x=b*a-f,_=x;_<0;)_+=u;for(var T=Math.min(r.inWidth,l+x),S=Number.NEGATIVE_INFINITY,E=-1,I=w;I<y;I+=s)for(var N=I-m,R=_;R<T;R+=u){var B=R-x,O=h.get(p,I,R,v);O>S&&(S=O,E=N*l+B)}o.set(E,p,g,b,v)}}return o.toTensor()},t.prototype.maxPoolBackprop=function(e,r,o,i){W([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=f-1-i.padInfo.left,p=d-1-i.padInfo.top,v=ve(r.shape,"float32"),g=this.bufferSync(a),m=this.bufferSync(e),w=0;w<i.batchSize;++w)for(var y=0;y<i.inChannels;++y)for(var b=0;b<i.inHeight;++b)for(var x=0;x<i.inWidth;++x){for(var _=b-p,T=x-h,S=0,E=0;E<d;E+=c){var I=(_+E)/s;if(!(I<0||I>=i.outHeight||Math.floor(I)!==I))for(var N=0;N<f;N+=l){var R=(T+N)/u;if(!(R<0||R>=i.outWidth||Math.floor(R)!==R)){var B=d*f-1-g.get(w,I,R,y)===E*f+N?1:0;0!==B&&(S+=m.get(w,I,R,y)*B)}}}v.set(S,w,b,x,y)}return v.toTensor()},t.prototype.avgPoolBackprop=function(e,r,o){W([e,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,l=o.dilationWidth,d=o.effectiveFilterHeight,f=o.effectiveFilterWidth,h=f-1-o.padInfo.left,p=d-1-o.padInfo.top,v=ve(r.shape,"float32"),g=1/(s*u),m=this.bufferSync(e),w=0;w<o.batchSize;++w)for(var y=0;y<o.inChannels;++y)for(var b=0;b<o.inHeight;++b)for(var x=0;x<o.inWidth;++x){for(var _=b-p,T=x-h,S=0,E=0;E<d;E+=c){var I=(_+E)/i;if(!(I<0||I>=o.outHeight||Math.floor(I)!==I))for(var N=0;N<f;N+=l){var R=(T+N)/a;R<0||R>=o.outWidth||Math.floor(R)!==R||(S+=m.get(w,I,R,y))}}v.set(S*g,w,b,x,y)}return v.toTensor()},t.prototype.pool3d=function(e,r,o){W(e,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,g=r.padInfo.left,m="max"===o?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=this.readSync(e.dataId),y=ve(r.outShape,e.dtype),b=y.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],T=r.outShape[3]*r.outShape[4],S=r.outShape[4],E=0;E<r.batchSize;++E)for(var I=E*x,N=E*e.strides[0],R=0;R<r.inChannels;++R)for(var B=0;B<r.outDepth;++B){for(var O=B*i-p,L=O;L<0;)L+=u;for(var H=Math.min(r.inDepth,d+O),j=I+B*_,V=0;V<r.outHeight;++V){for(var z=V*a-v,G=z;G<0;)G+=c;for(var X=Math.min(r.inHeight,f+z),re=j+V*T,oe=0;oe<r.outWidth;++oe){for(var _e=oe*s-g,De=_e;De<0;)De+=l;for(var Te=Math.min(r.inWidth,h+_e),Pe=re+oe*S,Ae=m,Oe=0,ht=0,Re=L;Re<H;Re+=u){for(var Ge=N+Re*e.strides[1],Ve=G;Ve<X;Ve+=c){for(var dt=Ge+Ve*e.strides[2],it=De;it<Te;it+=l){var at=w[dt+it*e.strides[3]+R];if("max"===o&&at>Ae?Ae=at:"avg"===o&&(Oe+=at,ht++),isNaN(Ae))break}if(isNaN(Ae))break}if(isNaN(Ae))break}b[Pe+R]="avg"===o?Oe/ht:Ae}}}return y.toTensor()},t.prototype.avgPool3d=function(e,r){return W(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,r,o){W([e,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,d=o.dilationDepth,f=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,v=o.effectiveFilterHeight,g=o.effectiveFilterWidth,m=p-1-o.padInfo.front,w=g-1-o.padInfo.left,y=v-1-o.padInfo.top,b=ve(r.shape,"float32"),x=1/(u*c*l),_=this.bufferSync(e),T=0;T<o.batchSize;++T)for(var S=0;S<o.inChannels;++S)for(var E=0;E<o.inDepth;++E)for(var I=0;I<o.inHeight;++I)for(var N=0;N<o.inWidth;++N){for(var R=E-m,B=I-y,O=N-w,L=0,H=0;H<p;H+=d){var j=(R+H)/i;if(!(j<0||j>=o.outDepth||Math.floor(j)!==j))for(var V=0;V<v;V+=f){var z=(B+V)/a;if(!(z<0||z>=o.outHeight||Math.floor(z)!==z))for(var G=0;G<g;G+=h){var X=(O+G)/s;X<0||X>=o.outWidth||Math.floor(X)!==X||(L+=_.get(T,j,z,X,S))}}}b.set(L*x,T,E,I,N,S)}return b.toTensor()},t.prototype.maxPool3d=function(e,r){return W(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,r){for(var o=ve(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,g=r.padInfo.left,m=this.bufferSync(e),w=0;w<r.batchSize;++w)for(var y=0;y<r.inChannels;++y)for(var b=0;b<r.outDepth;++b){for(var x=b*i-p,_=x;_<0;)_+=u;for(var T=Math.min(r.inDepth,d+x),S=0;S<r.outHeight;++S){for(var E=S*a-v,I=E;I<0;)I+=c;for(var N=Math.min(r.inHeight,f+E),R=0;R<r.outWidth;++R){for(var B=R*s-g,O=B;O<0;)O+=l;for(var L=Math.min(r.inWidth,h+B),H=Number.NEGATIVE_INFINITY,j=-1,V=_;V<T;V+=u)for(var z=V-x,G=I;G<N;G+=c)for(var X=G-E,re=O;re<L;re+=l){var oe=re-B,_e=m.get(w,V,G,re,y);_e>=H&&(H=_e,j=z*f*h+X*f+oe)}o.set(j,w,b,S,R,y)}}}return o.toTensor()},t.prototype.maxPool3dBackprop=function(e,r,o,i){W([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,d=i.dilationHeight,f=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,v=i.effectiveFilterWidth,g=h-1-i.padInfo.front,m=v-1-i.padInfo.left,w=p-1-i.padInfo.top,y=ve(r.shape,"float32"),b=this.bufferSync(a),x=this.bufferSync(e),_=0;_<i.batchSize;++_)for(var T=0;T<i.inChannels;++T)for(var S=0;S<i.inDepth;++S)for(var E=0;E<i.inHeight;++E)for(var I=0;I<i.inWidth;++I){for(var N=S-g,R=E-w,B=I-m,O=0,L=0;L<h;L+=l){var H=(N+L)/s;if(!(H<0||H>=i.outDepth||Math.floor(H)!==H))for(var j=0;j<p;j+=d){var V=(R+j)/u;if(!(V<0||V>=i.outHeight||Math.floor(V)!==V))for(var z=0;z<v;z+=f){var G=(B+z)/c;if(!(G<0||G>=i.outWidth||Math.floor(G)!==G)){var X=h*p*v-1-b.get(_,H,V,G,T)===L*p*v+j*v+z?1:0;0!==X&&(O+=x.get(_,H,V,G,T)*X)}}}}y.set(O,_,S,E,I,T)}return y.toTensor()},t.prototype.cast=function(e,r){return ov(e,r,this)},t.prototype.reshape=function(e,r){return cl(e,r)},t.prototype.avgPool=function(e,r){return W(e,"avgPool"),this.pool(e,r,"avg").toFloat()},t.prototype.resizeBilinear=function(e,r,o,i){W(e,"resizeBilinear");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array(ee([s,r,o,l])),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],v=0,g=h[0]/p[0],m=h[1]/p[1],w=0;w<s;w++)for(var y=0;y<r;y++)for(var b=g*y,x=Math.floor(b),_=b-x,T=Math.min(u-1,Math.ceil(b)),S=w*e.strides[0]+x*e.strides[1],E=w*e.strides[0]+T*e.strides[1],I=0;I<o;I++)for(var N=m*I,R=Math.floor(N),B=N-R,O=Math.min(c-1,Math.ceil(N)),L=S+R*e.strides[2],H=E+R*e.strides[2],j=S+O*e.strides[2],V=E+O*e.strides[2],z=0;z<l;z++){var G=d[L+z],X=d[H+z],re=G+(d[j+z]-G)*B;f[v++]=re+(X+(d[V+z]-X)*B-re)*_}return Ht(f,[s,r,o,l])},t.prototype.resizeBilinearBackprop=function(e,r,o){W([e,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=[o&&d>1?s-1:s,o&&f>1?u-1:u],v=[o&&d>1?d-1:d,o&&f>1?f-1:f],g=p[0]/v[0],m=p[1]/v[1],w=this.readSync(e.dataId),y=0,b=0;b<a;b++)for(var x=b*r.strides[0],_=0;_<d;_++)for(var T=_*g,S=Math.floor(T),E=Math.min(Math.ceil(T),s-1),I=x+S*r.strides[1],N=x+E*r.strides[1],R=T-S,B=1-R,O=0;O<f;O++)for(var L=O*m,H=Math.floor(L),j=Math.min(Math.ceil(L),u-1),V=L-H,z=1-V,G=I+H*r.strides[2],X=I+j*r.strides[2],re=N+H*r.strides[2],oe=N+j*r.strides[2],_e=B*z,De=B*V,Te=R*z,Pe=R*V,Ae=0;Ae<c;Ae++){var Oe=w[y++];h[G+Ae]+=Oe*_e,h[X+Ae]+=Oe*De,h[re+Ae]+=Oe*Te,h[oe+Ae]+=Oe*Pe}return fn(h,[a,u,s,c],r.dtype)},t.prototype.resizeNearestNeighbor=function(e,r,o,i){W(e,"resizeNearestNeighbor");for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],d=this.readSync(e.dataId),f=new Float32Array(s*r*o*l),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],v=h[0]/p[0],g=h[1]/p[1],m=0,w=0;w<s;w++)for(var y=w*e.strides[0],b=0;b<r;b++)for(var x=v*b,_=y+Math.min(u-1,i?Math.round(x):Math.floor(x))*e.strides[1],T=0;T<o;T++)for(var S=g*T,E=_+Math.min(c-1,i?Math.round(S):Math.floor(S))*e.strides[2],I=0;I<l;I++)f[m++]=d[E+I];return Ht(f,[s,r,o,l],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,r,o){W([e,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=e.shape,d=l[1],f=l[2],h=new Float32Array(a*s*u*c),p=this.readSync(e.dataId),v=[o&&d>1?s-1:s,o&&f>1?u-1:u],g=[o&&d>1?d-1:d,o&&f>1?f-1:f],m=v[0]/g[0],w=v[1]/g[1],y=1/m,b=1/w,x=2*Math.ceil(y)+2,_=2*Math.ceil(b)+2,T=0;T<a;T++)for(var S=T*r.strides[0],E=0;E<s;E++)for(var I=S+E*r.strides[1],N=Math.floor(E*y),R=Math.floor(N-x/2),B=0;B<u;B++)for(var O=I+B*r.strides[2],L=Math.floor(B*b),H=Math.floor(L-_/2),j=0;j<c;j++){for(var V=0,z=0;z<x;z++){var G=z+R;if(!(G<0||G>=d)){var X=S+G*e.strides[1],re=G*m;if(E===Math.min(s-1,o?Math.round(re):Math.floor(re)))for(var oe=0;oe<_;oe++){var _e=oe+H;if(!(_e<0||_e>=f)){var De=X+_e*e.strides[2],Te=_e*w;B===Math.min(u-1,o?Math.round(Te):Math.floor(Te))&&(V+=p[De+j])}}}}h[O+j]=V}return fn(h,r.shape,r.dtype)},t.prototype.batchNormalization=function(e,r,o,i,a,s){W([e,r,o,a,s],"batchNorm");for(var u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=this.readSync(o.dataId),d=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=f.length,v=d.length,g=l.length,m=c.length,w=0,y=0,b=0,x=0,_=0;_<u.length;++_)h[_]=f[w++]+(u[_]-c[y++])*d[b++]/Math.sqrt(l[x++]+i),w>=p&&(w=0),y>=m&&(y=0),b>=v&&(b=0),x>=g&&(x=0);return fn(h,e.shape)},t.prototype.localResponseNormalization4D=function(e,r,o,i,a){W(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,c=this.readSync(e.dataId),l=e.size,d=new Float32Array(l);function f(g){for(var m=g%s,w=g-m+Math.max(0,m-r),y=g-m+Math.min(m+r,u),b=0;w<=y;w++){var x=c[w];b+=x*x}return b}for(var h=0;h<l;h++){var p=f(h),v=c[h]*Math.pow(o+i*p,-a);d[h]=v}return fn(d,e.shape)},t.prototype.LRNGrad=function(e,r,o,i,a,s,u){W(e,"LRNGrad");for(var c=e.shape[3],l=this.readSync(e.dataId),d=this.readSync(r.dataId),f=this.readSync(o.dataId),h=new Float32Array(e.size),p=e.size,v=0;v<p;v++){for(var g=v%c,m=v-g+Math.max(0,g-i),w=v-g+Math.min(c,g+i+1),y=0,b=m;b<w;b++)y+=Math.pow(d[b],2);for(y=s*y+a,b=m;b<w;b++){var x=-2*s*u*d[b]*f[v]/y;v===b&&(x+=Math.pow(y,-u)),h[b]+=x*=l[v]}}return fn(h,e.shape)},t.prototype.multinomial=function(e,r,o,i){W(e,"multinomial");for(var a=r?e:Jr(e),s=a.shape[0],u=a.shape[1],c=Ze([s,o],"int32"),l=this.readSync(c.dataId),d=this.readSync(a.dataId),f=0;f<s;++f){var h=f*u,p=new Float32Array(u-1);p[0]=d[h];for(var v=1;v<p.length;++v)p[v]=p[v-1]+d[h+v];for(var g=Zc(i.toString()),m=f*o,w=0;w<o;++w){var y=g();l[m+w]=p.length;for(var b=0;b<p.length;b++)if(y<p[b]){l[m+w]=b;break}}}return c},t.prototype.oneHot=function(e,r,o,i){W(e,"oneHot");var a=new Float32Array(e.size*r);a.fill(i);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return To(a,[e.size,r],"int32")},t.prototype.nonMaxSuppression=function(e,r,o,i,a){return W(e,"nonMaxSuppression"),sv(this.readSync(e.dataId),this.readSync(r.dataId),o,i,a)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,r){for(var o=e.shape[0],i=e.shape[1],a=ve(e.shape,"float32"),s=ve(e.shape,"float32"),u=Ln(e).as2D(o,i),c=Dr(e).as2D(o,i),l=0;l<o;l++)for(var d=u.slice([l,0],[1,i]),f=c.slice([l,0],[1,i]),h=Vt(d,f),p=this.readSync(this.fftImpl(h,r).dataId),v=0;v<i;v++){var g=gD(p,v);a.values[l*i+v]=g.real,s.values[l*i+v]=g.imag}return Vt(a.toTensor(),s.toTensor()).as2D(o,i)},t.prototype.fftImpl=function(e,r){var o=e.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(e.shape[0],e.shape[1]);return r&&(a=Vt(Ln(a).div(q(i)),Dr(a).div(q(i)))),a}var s=this.readSync(e.dataId),u=function(c){for(var l=new Float32Array(c.length/2),d=new Float32Array(c.length/2),f=0;f<c.length;f+=2)l[f/2]=c[f],d[f/2]=c[f+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(s,i,r));return Vt(u.real,u.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,r,o){if(1===r)return e;var i=this.readSync(e.dataId),a=r/2,s=function(m){for(var w=Math.ceil(m.length/4),y=new Float32Array(w),b=new Float32Array(w),x=0;x<m.length;x+=4)y[Math.floor(x/4)]=m[x],b[Math.floor(x/4)]=m[x+1];return{real:y,imag:b}}(i),u=Vt(s.real,s.imag).as1D(),c=function(m){for(var w=Math.floor(m.length/4),y=new Float32Array(w),b=new Float32Array(w),x=2;x<m.length;x+=4)y[Math.floor(x/4)]=m[x],b[Math.floor(x/4)]=m[x+1];return{real:y,imag:b}}(i),l=Vt(c.real,c.imag).as1D();u=this.fftRadix2(u,a,o),l=this.fftRadix2(l,a,o);var d=function(m,w){for(var y=new Float32Array(m/2),b=new Float32Array(m/2),x=0;x<Math.ceil(m/2);x++){var _=(w?2:-2)*Math.PI*(x/m);y[x]=Math.cos(_),b[x]=Math.sin(_)}return{real:y,imag:b}}(r,o),f=Vt(d.real,d.imag).mul(l),h=u.add(f),p=u.sub(f),v=Ln(h).concat(Ln(p)),g=Dr(h).concat(Dr(p));return Vt(v,g).as1D()},t.prototype.fourierTransformByMatmul=function(e,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,c=0;c<r;c++){var l=CB(a*c,r,o),d=gD(e,c);s+=d.real*l.real-d.imag*l.imag,u+=d.real*l.imag+d.imag*l.real}o&&(s/=r,u/=r),DB(i,s,u,a)}return i},t.prototype.depthToSpace=function(e,r,o){C("NHWC"===o,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o}),C(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var i=e.shape[0],a=e.shape[1],s=e.shape[2],u=e.shape[3],c=a*r,l=s*r,d=u/(r*r),f=this.readSync(e.dataId),h=new Float32Array(i*c*l*d),p=0,v=0;v<i;++v)for(var g=0;g<c;++g)for(var m=Math.floor(g/r),w=g%r,y=0;y<l;++y)for(var b=Math.floor(y/r),x=(w*r+y%r)*d,_=0;_<d;++_)h[p++]=f[_+x+u*(b+s*(m+a*v))];return fn(h,[i,c,l,d])},t.prototype.broadcastedBinaryOp=function(e,r,o,i){var a=Ee(e.shape,r.shape),s=ve(a,o),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Zr(e.shape,a),d=Zr(r.shape,a),f=s.values;if(l.length+d.length===0)for(var h=0;h<f.length;++h)f[h]=i(u[h%u.length],c[h%c.length]);else{var p=this.bufferSync(e),v=this.bufferSync(r),g=function(m){var w=s.indexToLoc(m),y=w.slice(-e.rank);l.forEach(function(T){return y[T]=0});var b=p.locToIndex(y),x=w.slice(-r.rank);d.forEach(function(T){return x[T]=0});var _=v.locToIndex(x);f[m]=i(u[b],c[_])};for(h=0;h<f.length;++h)g(h)}return s.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,r,o){var i=Ee(e.shape,r.shape),a=ve(i,"float32"),s=ve(i,"float32"),u=this.readSync(e.dataId),c=this.readSync(r.dataId),l=Zr(e.shape,i),d=Zr(r.shape,i),f=a.values,h=s.values;if(l.length+d.length===0)for(var p=0;p<f.length;p++){var v=p%u.length,g=p%c.length,m=o(u[2*v],u[2*v+1],c[2*g],c[2*g+1]);f[p]=m.real,h[p]=m.imag}else{var w=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=this.bufferSync(this.data.get(r.dataId).complexTensors.real),b=function(x){var _=a.indexToLoc(x),T=_.slice(-e.rank);l.forEach(function(R){return T[R]=0});var S=w.locToIndex(T),E=_.slice(-r.rank);d.forEach(function(R){return E[R]=0});var I=y.locToIndex(E),N=o(u[2*S],u[2*S+1],c[2*I],c[2*I+1]);f[x]=N.real,h[x]=N.imag};for(p=0;p<f.length;p++)b(p)}return this.complex(a.toTensor(),s.toTensor())},t.prototype.split=function(e,r,o){return bD(e,r,o)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,r,o,i,a,s){for(var u=e.shape,c=u[0],l=u[1],d=u[2],f=u[3],h=r.shape[0],p=i[0],v=i[1],g=ve([h,p,v,f],"float32"),m=this.readSync(r.dataId),w=this.readSync(o.dataId),y=this.readSync(e.dataId),b=e.strides,x=g.strides,_=0;_<h;_++){var T=4*_,S=m[T],E=m[T+1],I=m[T+2],N=m[T+3],R=w[_];if(!(R>=c))for(var B=p>1?(I-S)*(l-1)/(p-1):0,O=v>1?(N-E)*(d-1)/(v-1):0,L=0;L<p;L++){var H=p>1?S*(l-1)+L*B:.5*(S+I)*(l-1);if(H<0||H>l-1)for(var j=0;j<v;j++)for(var V=0;V<f;V++){var z=V+j*x[2]+L*x[1]+_*x[0];g.values[z]=s}else if("bilinear"===a){var G=Math.floor(H),X=Math.ceil(H),re=H-G;for(j=0;j<v;j++)if((Re=v>1?E*(d-1)+j*O:.5*(E+N)*(d-1))<0||Re>d-1)for(V=0;V<f;V++)g.values[z=V+j*x[2]+L*x[1]+_*x[0]]=s;else{var oe=Math.floor(Re),_e=Math.ceil(Re),De=Re-oe;for(V=0;V<f;V++){var Te=y[z=V+oe*b[2]+G*b[1]+R*b[0]],Pe=y[z=V+_e*b[2]+G*b[1]+R*b[0]],Ae=y[z=V+oe*b[2]+X*b[1]+R*b[0]],Oe=Te+(Pe-Te)*De,ht=Ae+(y[z=V+_e*b[2]+X*b[1]+R*b[0]]-Ae)*De;g.values[z=V+j*x[2]+L*x[1]+_*x[0]]=Oe+(ht-Oe)*re}}}else for(j=0;j<v;++j){var Re;if((Re=v>1?E*(d-1)+j*O:.5*(E+N)*(d-1))<0||Re>d-1)for(V=0;V<f;V++)g.values[z=V+j*x[2]+L*x[1]+_*x[0]]=s;else{var Ge=Math.round(Re),Ve=Math.round(H);for(V=0;V<f;V++)g.values[V+j*x[2]+L*x[1]+_*x[0]]=y[V+Ge*b[2]+Ve*b[1]+R*b[0]]}}}}return g.toTensor()},t.prototype.sparseToDense=function(e,r,o,i){var a=Ws(0,e,o);return this.scatter(e,r,o,a.outputSize,a.sliceSize,a.numUpdates,a.sliceRank,a.strides,i,!1)},t.prototype.gatherND=function(e,r){var o=r.shape,i=o[o.length-1],a=Qp(e,r),s=a[0],u=a[1],c=a[2],l=a[3];if(0===u)return Ht([],s,e.dtype);for(var d=new Ns([u,c],e.dtype),f=this.readSync(r.dataId),h=this.readSync(e.dataId),p=0;p<u;p++){for(var v=[],g=0,m=0;m<i;m++){var w=f[p*i+m];g+=w*l[m],v.push(w)}if(g<0||g>=e.size/c)throw new Error("Invalid indices: "+v+" does not index into "+e.shape);for(var y=0;y<c;y++)d.values[p*c+y]=h[g*c+y]}return d.toTensor().reshape(s)},t.prototype.scatterND=function(e,r,o){var i=Ws(0,e,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,d=q(0);return this.scatter(e,r,o,l,u,s,a,c,d,!0)},t.prototype.fill=function(e,r,o){var i=Ss(o=o||ua(r),ee(e));return i.fill(r),M.makeTensor(i,e,o,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var r=Ss(e.dtype,ee(e.shape));return this.makeOutput(r,e.shape,e.dtype)},t.prototype.linspace=function(e,r,o){return iv(e,r,o)},t.prototype.scatter=function(e,r,o,i,a,s,u,c,l,d){var f=[i/a,a],h=this.readSync(e.dataId),p=this.readSync(r.dataId);if(0===i)return Ht([],o,r.dtype);var v=new Ns(f,r.dtype);v.values.fill(this.readSync(l.dataId)[0]);for(var g=0;g<s;g++){for(var m=[],w=0,y=0;y<u;y++){var b=h[g*u+y];m.push(b),w+=b*c[y]}if(w<0||w>=i/a)throw new Error("Invalid indices: "+m+" does not index into "+o);for(var x=0;x<a;x++)d?v.values[w*a+x]+=p[g*a+x]:v.values[w*a+x]=0===r.rank?p[0]:p[g*a+x]}return v.toTensor().reshape(o)},t}(vD);M.registerBackend("cpu",function(){return new SH},1);for(var Ov=0,XC=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,r=n.attrs,i=t.boxes,a=t.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=n.backend;W(i,"NonMaxSuppressionWithScore");var h=uv(f.data.get(i.dataId).values,f.data.get(a.dataId).values,u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var r=n.inputs.x,o=n.backend;W(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Ks,backendName:"cpu",kernelFunc:function(n){var t=n.inputs,o=t.a,i=t.b,a=n.backend;W([o,i],Ks);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=function(f,h,p,v,g,m){var w=Ee(f,h),y=w.length,b=er(w),x=sa(g,ee(w)),_=f.length,T=h.length,S=er(f),E=er(h),I=Zr(f,w),N=Zr(h,w);if(I.length+N.length===0)for(var R=0;R<x.length;++R)x[R]=m(p[R%p.length],v[R%v.length]);else{var B=function(O){var L=y_(O,y,b),H=L.slice(-_);I.forEach(function(G){return H[G]=0});var j=Rp(H,_,S),V=L.slice(-T);N.forEach(function(G){return V[G]=0});var z=Rp(V,T,E);x[O]=m(p[j],v[z])};for(R=0;R<x.length;++R)B(R)}return[x,w]}(o.shape,i.shape,s,u,o.dtype,function(f,h){var p=f-h;return p*p}),d=c[1];return{dataId:a.write(c[0],d,o.dtype),shape:d,dtype:o.dtype}}}];Ov<XC.length;Ov++)a_(XC[Ov]);for(var ba,TH=function(n){this.variableNames=["A"];var t=Gt(),e=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+e+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},MH=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Gt(),e=n[0],r=n[1];this.outputShape=n,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+e+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},Lv=0,YC=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.backend,o=n.inputs.pixels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],d=[l,c],f=[l,c,n.attrs.numChannels];(s||a)&&(null==ba&&(ba=document.createElement("canvas").getContext("2d")),ba.canvas.width=c,ba.canvas.height=l,ba.drawImage(o,0,0,c,l),o=ba.canvas);var h=e.makeTensorInfo(d,"int32");e.texData.get(h.dataId).usage=_n.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(h.dataId),o);var p=P().getBool("WEBGL_PACK")?new MH(f):new TH(f),v=e.runWebGLProgram(p,[h],"int32");return e.disposeData(h.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs;Yc("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t.scores,u=r.maxOutputSize,c=r.iouThreshold,l=r.scoreThreshold,d=r.softNmsSigma,f=e,h=uv(f.readSync(t.boxes.dataId),f.readSync(a.dataId),u,c,l,d);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var r=n.inputs.x,o=n.backend,i=new ye(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:Ks,backendName:"webgl",kernelFunc:function(n){var t=n.inputs,o=t.a,i=t.b,a=n.backend,s=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eo("return (a - b) * (a - b);",o.shape,i.shape):new lt("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];Lv<YC.length;Lv++)a_(YC[Lv]);for(var Bv=0,QC=[{kernelName:"Square",gradFunc:function(n,t){var e=t[0];return{x:function(){return n.mul(e.toFloat().mul(2))}}}},{kernelName:Ks,gradFunc:function(n,t){var e=t[0],r=t[1],o=q(2);return{a:function(){return qt(n,qt(o,Mt(e,r)))},b:function(){return qt(n,qt(o,Mt(r,e)))}}}}];Bv<QC.length;Bv++)NL(QC[Bv]);var AH=function(){function n(){}return n.prototype.fetch=function(t,e){return fetch(t,e)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},n}();P().get("IS_BROWSER")&&P().setPlatform("browser",new AH);var Vv,NH=function(){function n(){this.util=Ra(753),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(t,e){return null!=P().global.fetch?P().global.fetch(t,e):(null==Vv&&(Vv=Ra(522)),Vv(t,e))},n.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},n.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},n}();P().get("IS_NODE")&&P().setPlatform("node",new NH);var Hv={float32:4,int32:4,uint16:2,uint8:1,bool:1};function JC(n,t){for(var e={},r=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,d=ee(l),f=void 0;if("quantization"in s){var h=s.quantization;if("uint8"!==h.dtype&&"uint16"!==h.dtype)throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=Hv[h.dtype],v=n.slice(r,r+d*p),g="uint8"===h.dtype?new Uint8Array(v):new Uint16Array(v);if("float32"===c)f=Float32Array.from(g,function(_){return _*h.scale+h.min});else{if("int32"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=Int32Array.from(g,function(_){return Math.round(_*h.scale+h.min)})}r+=d*p}else if("string"===c){var m=ee(s.shape);f=[];for(var w=0;w<m;w++){var y=new Uint32Array(n.slice(r,r+4))[0];r+=4;var b=new Uint8Array(n.slice(r,r+y));f.push(b),r+=y}}else{var x=Hv[c];if(v=n.slice(r,r+d*x),"float32"===c)f=new Float32Array(v);else if("int32"===c)f=new Int32Array(v);else{if("bool"!==c)throw new Error("Unsupported dtype in weight '"+u+"': "+c);f=new Uint8Array(v)}r+=d*x}e[u]=Ht(f,l,c)},i=0,a=t;i<a.length;i++)o(a[i]);return e}function FH(n){if(null===n)throw new Error("Invalid input value: "+JSON.stringify(n));var t=0,e=[];n.forEach(function(i){if(t+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var r=new Uint8Array(t),o=0;return e.forEach(function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var jv=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function ZC(n){return jv?Buffer.byteLength(n):new Blob([n]).size}function Wv(n){var t=0;n.forEach(function(o){t+=o.byteLength});var e=new Uint8Array(t),r=0;return n.forEach(function(o){e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function eE(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var t=n.split("/");return t[t.length-1]}function Js(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==n.modelTopology?0:ZC(JSON.stringify(n.modelTopology)),weightSpecsBytes:null==n.weightSpecs?0:ZC(JSON.stringify(n.weightSpecs)),weightDataBytes:null==n.weightData?0:n.weightData.byteLength}}var In=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerSaveRouter=function(t){n.getInstance().saveRouters.push(t)},n.registerLoadRouter=function(t){n.getInstance().loadRouters.push(t)},n.getSaveHandlers=function(t){return n.getHandlers(t,"save")},n.getLoadHandlers=function(t,e){return n.getHandlers(t,"load",e)},n.getHandlers=function(t,e,r){var o=[];return("load"===e?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(i){var a=i(t,r);null!==a&&o.push(a)}),o},n}(),wa="://",Ro=function(){function n(){this.managers={}}return n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},n.registerManager=function(t,e){C(null!=t,function(){return"scheme must not be undefined or null."}),t.endsWith(wa)&&(t=t.slice(0,t.indexOf(wa))),C(t.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();C(null==r.managers[t],function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=e},n.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function El(n){if(-1===n.indexOf(wa))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Ro.getSchemes().join(","));return{scheme:n.split(wa)[0],path:n.split(wa)[1]}}function tE(n,t,e){return void 0===e&&(e=!1),J(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,d;return Z(this,function(f){switch(f.label){case 0:return C(n!==t,function(){return"Old path and new path are the same: '"+n+"'"}),C((r=In.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),C(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),o=r[0],C((i=In.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),C(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),a=i[0],s=El(n).scheme,u=El(n).path,c=s===El(n).scheme,[4,o.load()];case 1:return l=f.sent(),e&&c?[4,Ro.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(l)];case 4:return d=f.sent(),!e||c?[3,6]:[4,Ro.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var fi="models_store",No="model_info_store";function nE(){if(!P().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Uv(n){var t=n.result;t.createObjectStore(fi,{keyPath:"modelPath"}),t.createObjectStore(No,{keyPath:"modelPath"})}var xa=function(){function n(t){if(this.indexedDB=nE(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return n.prototype.save=function(t){return J(this,void 0,void 0,function(){return Z(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},n.prototype.load=function(){return J(this,void 0,void 0,function(){return Z(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(t,e){var r=this;return new Promise(function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Uv(a)},a.onsuccess=function(){var s=a.result;if(null==e){var u=s.transaction(fi,"readonly"),c=u.objectStore(fi).get(r.modelPath);c.onsuccess=function(){if(null==c.result)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(v){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,d=Js(e),f=s.transaction(No,"readwrite"),h=f.objectStore(No),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:d});p.onsuccess=function(){var v=(l=s.transaction(fi,"readwrite")).objectStore(fi).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:d});v.onsuccess=function(){return o({modelArtifactsInfo:d})},v.onerror=function(g){var m=(h=f.objectStore(No)).delete(r.modelPath);m.onsuccess=function(){return s.close(),i(v.error)},m.onerror=function(w){return s.close(),i(v.error)}}},p.onerror=function(v){return s.close(),i(p.error)},f.oncomplete=function(){null==l?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}})},n.URL_SCHEME="indexeddb://",n}(),rE=function(n){return P().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(xa.URL_SCHEME)?(t=n.slice(xa.URL_SCHEME.length),new xa(t)):null;var t};In.registerSaveRouter(rE),In.registerLoadRouter(rE);var kH=function(){function n(){this.indexedDB=nE()}return n.prototype.listModels=function(){return J(this,void 0,void 0,function(){var t=this;return Z(this,function(e){return[2,new Promise(function(r,o){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Uv(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(No,"readonly"),u=s.objectStore(No).getAll();u.onsuccess=function(){for(var c={},l=0,d=u.result;l<d.length;l++){var f=d[l];c[f.modelPath]=f.modelArtifactsInfo}r(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}})]})})},n.prototype.removeModel=function(t){return J(this,void 0,void 0,function(){var e=this;return Z(this,function(r){var o;return t=(o=t).startsWith(xa.URL_SCHEME)?o.slice(xa.URL_SCHEME.length):o,[2,new Promise(function(i,a){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Uv(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(No,"readwrite"),d=l.objectStore(No),f=d.get(t);f.onsuccess=function(){if(null==f.result)return c.close(),a(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var h=d.delete(t),p=function(){var v=(u=c.transaction(fi,"readwrite")).objectStore(fi).delete(t);v.onsuccess=function(){return i(f.result.modelArtifactsInfo)},v.onerror=function(g){return a(f.error)}};h.onsuccess=p,h.onerror=function(v){return p(),c.close(),a(f.error)}},f.onerror=function(h){return c.close(),a(f.error)},l.oncomplete=function(){null==u?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}})]})})},n}();if(P().getBool("IS_BROWSER"))try{Ro.registerManager(xa.URL_SCHEME,new kH)}catch{}var no="/",_a="tensorflowjs_models",oE="info",PH="model_topology",OH="weight_specs",LH="weight_data",BH="model_metadata";function iE(n){return{info:[_a,n,oE].join(no),topology:[_a,n,PH].join(no),weightSpecs:[_a,n,OH].join(no),weightData:[_a,n,LH].join(no),modelMetadata:[_a,n,BH].join(no)}}function VH(n){var t=n.split(no);if(t.length<3)throw new Error("Invalid key format: "+n);return t.slice(1,t.length-1).join(no)}var Da=function(){function n(t){if(!P().getBool("IS_BROWSER")||typeof window>"u"||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=iE(this.modelPath)}return n.prototype.save=function(t){return J(this,void 0,void 0,function(){var e,r,o;return Z(this,function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),o=Js(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(jv)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return J(this,void 0,void 0,function(){var t,e,r,o,i,a,s;return Z(this,function(u){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,null==(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=o,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(a=JSON.parse(i),e.format=a.format,e.generatedBy=a.generatedBy,e.convertedBy=a.convertedBy,e.userDefinedMetadata=a.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(c){if(jv){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(c),f=new Uint8Array(d.length),h=0;h<d.length;++h)f.set([d.charCodeAt(h)],h);return f.buffer}(s),[2,e]})})},n.URL_SCHEME="localstorage://",n}(),aE=function(n){return P().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Da.URL_SCHEME)?(t=n.slice(Da.URL_SCHEME.length),new Da(t)):null;var t};In.registerSaveRouter(aE),In.registerLoadRouter(aE);var HH=function(){function n(){C(P().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),C(typeof window>"u"||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return J(this,void 0,void 0,function(){var t,e,r,o,i,a;return Z(this,function(s){for(t={},e=_a+no,r=no+oE,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(e)&&i.endsWith(r)&&(a=VH(i),t[a]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},n.prototype.removeModel=function(t){return J(this,void 0,void 0,function(){var e,r;return Z(this,function(o){var i;if(t=(i=t).startsWith(Da.URL_SCHEME)?i.slice(Da.URL_SCHEME.length):i,e=iE(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},n}();if(P().getBool("IS_BROWSER"))try{Ro.registerManager(Da.URL_SCHEME,new HH)}catch{}function sE(n){return new Promise(function(t){return setTimeout(t)}).then(n)}var zv=function(){function n(t){if(!P().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(n.URL_SCHEME)&&(t=t.slice(n.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return n.prototype.save=function(t){return J(this,void 0,void 0,function(){var e,i,a,s;return Z(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return i=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(a=this.jsonAnchor??document.createElement("a")).download=this.modelTopologyFileName,a.href=i,[4,sE(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),null==t.weightData?[3,4]:((s=this.weightDataAnchor??document.createElement("a")).download=this.weightDataFileName,s.href=e,[4,sE(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Js(t)}]}})})},n.URL_SCHEME="downloads://",n}(),zH=function(){function n(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return n.prototype.load=function(){return J(this,void 0,void 0,function(){var t,e,r=this;return Z(this,function(o){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(null!=l){0===e.length&&i({modelTopology:l});var d=c.weightsManifest;if(null!=d){var f;try{f=r.checkManifestAndWeightFiles(d,e)}catch(g){return void a(g)}var h=[],p=[],v=[];d.forEach(function(g){g.paths.forEach(function(m){p.push(m),v.push(null)}),h.push.apply(h,g.weights)}),d.forEach(function(g){g.paths.forEach(function(m){var w=new FileReader;w.onload=function(y){var b=y.target.result,x=p.indexOf(m);v[x]=b,-1===v.indexOf(null)&&i({modelTopology:l,weightSpecs:h,weightData:Wv(v),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},w.onerror=function(y){return a("Failed to weights data from file of path '"+m+"'.")},w.readAsArrayBuffer(f[m])})})}else a(new Error("weightManifest field is missing from file "+t.name))}else a(new Error("modelTopology field is missing from file "+t.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(t)})]})})},n.prototype.checkManifestAndWeightFiles=function(t,e){for(var r=[],o=e.map(function(u){return eE(u.name)}),i={},a=0,s=t;a<s.length;a++)s[a].paths.forEach(function(u){var c=eE(u);if(-1!==r.indexOf(c))throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),-1===o.indexOf(c))throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=e[o.indexOf(c)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return i},n}();function uE(n,t,e,r){var i;C(null!=(i=n)&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"}),function(i,a){C(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i}),C(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),C(a>=i,function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a})}(e=e??0,r=r??1);var o=0;return Promise.all(n.map(function(i){return i.then(function(a){var s=e+ ++o/n.length*(r-e);return t(s),a}),i}))}function cE(n,t){return J(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l;return Z(this,function(d){switch(d.label){case 0:return null==t&&(t={}),e=t.fetchFunc??P().platform.fetch,r=n.map(function(f){return e(f,t.requestInit,{isBinary:!0})}),o=0,i=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=d.sent(),[3,4];case 2:return[4,uE(r,t.onProgress,o,i)];case 3:a=d.sent(),d.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,c=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,uE(s,t.onProgress,u,c)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function lE(n){var t=this;return function(e,r,o){return void 0===r&&(r=""),J(t,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p;return Z(this,function(v){switch(v.label){case 0:if(i=e.map(function(){return!1}),a={},s=null!=o?o.map(function(){return!1}):[],u=[],e.forEach(function(g,m){var w=0;g.weights.forEach(function(y){var x=Hv["quantization"in y?y.quantization.dtype:y.dtype]*ee(y.shape),_=function(){i[m]=!0,null==a[m]&&(a[m]=[]),a[m].push({manifestEntry:y,groupOffset:w,sizeBytes:x})};null!=o?o.forEach(function(T,S){T===y.name&&(_(),s[S]=!0)}):_(),u.push(y.name),w+=x})}),!s.every(function(g){return g}))throw c=o.filter(function(g,m){return!s[m]}),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return l=i.reduce(function(g,m,w){return m&&g.push(w),g},[]),d=[],l.forEach(function(g){e[g].paths.forEach(function(m){var w=r+(r.endsWith("/")?"":"/")+m;d.push(w)})}),[4,n(d)];case 1:return f=v.sent(),h={},p=0,l.forEach(function(g){for(var m=e[g].paths.length,w=0,y=0;y<m;y++)w+=f[p+y].byteLength;for(var b=new ArrayBuffer(w),x=new Uint8Array(b),_=0,T=0;T<m;T++){var S=new Uint8Array(f[p+T]);x.set(S,_),_+=S.byteLength}a[g].forEach(function(E){var I=JC(b.slice(E.groupOffset,E.groupOffset+E.sizeBytes),[E.manifestEntry]);for(var N in I)h[N]=I[N]}),p+=m}),[2,h]}})})}}In.registerSaveRouter(function(n){return P().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(zv.URL_SCHEME)?(void 0===(t=n.slice(zv.URL_SCHEME.length))&&(t="model"),new zv(t)):null;var t});var dE=function(){function n(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(C("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=P().platform.fetch,C(null!=t&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&C(2===t.length,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return n.prototype.save=function(t){return J(this,void 0,void 0,function(){var e,i;return Z(this,function(a){switch(a.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,e.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:Js(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},n.prototype.load=function(){return J(this,void 0,void 0,function(){var t,e,r,o,i,a,s,u,c,l,d,f;return Z(this,function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,t.json()];case 3:return e=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=e.weightsManifest,a=e.generatedBy,s=e.convertedBy,u=e.format,c=e.userDefinedMetadata,null==(o=e.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:f=h.sent(),l=f[0],d=f[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:l,weightData:d,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}})})},n.prototype.loadWeights=function(t){return J(this,void 0,void 0,function(){var r,o,i,a,s,u,c,d,f;return Z(this,function(h){switch(h.label){case 0:for(void 0,void 0,v=(p=Array.isArray(this.path)?this.path[1]:this.path).lastIndexOf("/"),g=p.lastIndexOf("?"),r=[p.substring(0,v)+"/",g>v?p.substring(g):""],o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,c=t;u<c.length;u++)s.push.apply(s,c[u].weights);return d=[],t.forEach(function(p){p.paths.forEach(function(v){d.push(a+v+i)})}),[4,cE(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=h.sent(),[2,[s,Wv(f)]]}var p,v,g})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function Gv(n){return null!=n.match(dE.URL_SCHEME_REGEX)}var fE=function(n,t){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(e){return Gv(e)}):Gv(n))?qv(n,{onProgress:t}):null};function qv(n,t){return new dE(n,t)}In.registerSaveRouter(fE),In.registerLoadRouter(fE);var Ca,$v=function(){function n(t){this.modelArtifacts=t}return n.prototype.load=function(){return J(this,void 0,void 0,function(){return Z(this,function(t){return[2,this.modelArtifacts]})})},n}(),GH=function(){function n(t){this.saveHandler=t}return n.prototype.save=function(t){return J(this,void 0,void 0,function(){return Z(this,function(e){return[2,this.saveHandler(t)]})})},n}(),hE=Object.freeze({browserFiles:function(n){return new zH(n)},browserHTTPRequest:function(n,t){return qv(n,t)},concatenateArrayBuffers:Wv,decodeWeights:JC,encodeWeights:function(n,t){return J(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return Z(this,function(u){switch(u.label){case 0:for(e=[],r=[],o=Array.isArray(n)?n.map(function(c){return c.name}):Object.keys(n),i=function(c){var l=o[c],d=Array.isArray(n)?n[c].tensor:n[l];if("float32"!==d.dtype&&"int32"!==d.dtype&&"bool"!==d.dtype&&"string"!==d.dtype)throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var f={name:l,shape:d.shape,dtype:d.dtype};if("string"===d.dtype){var h=new Promise(function(p){return J(s,void 0,void 0,function(){var v,g,m,w,y,b,x;return Z(this,function(_){switch(_.label){case 0:return[4,d.bytes()];case 1:for(v=_.sent(),g=v.reduce(function(T,S){return T+S.length},0)+4*v.length,m=new Uint8Array(g),w=0,y=0;y<v.length;y++)b=v[y],x=new Uint8Array(new Uint32Array([b.length]).buffer),m.set(x,w),m.set(b,w+=4),w+=b.length;return p(m),[2]}})})});r.push(h)}else r.push(d.data());null!=t&&(f.group=t),e.push(f)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:FH(u.sent()),specs:e}]}})})},fromMemory:function(n,t,e,r){return 1===arguments.length?null!=n.modelTopology||null!=n.weightSpecs?new $v(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new $v({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new $v({modelTopology:n,weightSpecs:t,weightData:e,trainingConfig:r}))},getLoadHandlers:function(n,t){return In.getLoadHandlers(n,t)},getModelArtifactsInfoForJSON:Js,getSaveHandlers:function(n){return In.getSaveHandlers(n)},http:qv,isHTTPScheme:Gv,loadWeights:function(n,t,e,r){return void 0===t&&(t=""),J(this,void 0,void 0,function(){return Z(this,function(o){return[2,lE(function(i){return cE(i,{requestInit:r})})(n,t,e)]})})},registerLoadRouter:function(n){return In.registerLoadRouter(n)},registerSaveRouter:function(n){return In.registerSaveRouter(n)},weightsLoaderFactory:lE,withSaveHandler:function(n){return new GH(n)},copyModel:function(n,t){return J(this,void 0,void 0,function(){return Z(this,function(e){return[2,tE(n,t,!1)]})})},listModels:function(){return J(this,void 0,void 0,function(){var n,t,e,r,o,i,a;return Z(this,function(s){switch(s.label){case 0:n=Ro.getSchemes(),t={},e=0,r=n,s.label=1;case 1:return e<r.length?[4,Ro.getManager(o=r[e]).listModels()]:[3,4];case 2:for(a in i=s.sent())t[o+wa+a]=i[a];s.label=3;case 3:return e++,[3,1];case 4:return[2,t]}})})},moveModel:function(n,t){return J(this,void 0,void 0,function(){return Z(this,function(e){return[2,tE(n,t,!0)]})})},removeModel:function(n){return J(this,void 0,void 0,function(){var t;return Z(this,function(e){return t=El(n),[2,Ro.getManager(t.scheme).removeModel(t.path)]})})}}),qH=A({confusionMatrix_:function(n,t,e){var r=D(n,"labels","confusionMatrix"),o=D(t,"predictions","confusionMatrix");C(null==e||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),C(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),C(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),C(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),C(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var i=Yp(r.asType("int32"),e),a=Yp(o.asType("int32"),e);return i.transpose().matMul(a).asType("int32")}}),$H=(Object.freeze({confusionMatrix:qH}),A({fromPixels_:function(n,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==n)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,o=!1,i=!1,a=!1;if(n.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else{if(null==n.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);a=!0}if(o&&o&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=o_("FromPixels",M.backendName))return M.runKernel("FromPixels",{pixels:n},{numChannels:t});var s,u,c=o?[n.videoWidth,n.videoHeight]:[n.width,n.height],l=c[0],d=c[1];if(a?s=n.getContext("2d").getImageData(0,0,l,d).data:r||e?s=n.data:(i||o)&&(null==Ca&&(Ca=document.createElement("canvas").getContext("2d")),Ca.canvas.width=l,Ca.canvas.height=d,Ca.drawImage(n,0,0,l,d),s=Ca.getImageData(0,0,l,d).data),4===t)u=new Int32Array(s);else{var f=l*d;u=new Int32Array(f*t);for(var h=0;h<f;h++)for(var p=0;p<t;++p)u[h*t+p]=s[4*h+p]}return $p(u,[d,l,t],"int32")}})),Kv=Object.freeze({toPixels:function(n,t){return J(this,void 0,void 0,function(){var e,r,o,i,a,s,u,c,l,h,p,v,g,m,w,y,b,x,_,T,S;return Z(this,function(E){switch(E.label){case 0:if(e=D(n,"img","toPixels"),n instanceof Ke||(e=e.toInt()),2!==e.rank&&3!==e.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),o=r[0],i=r[1],(a=2===e.rank?1:e.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,e.data()];case 1:return s=E.sent(),u=e.min(),c=e.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=E.sent(),h=l[0][0],p=l[1][0],u.dispose(),c.dispose(),"float32"===e.dtype){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if("int32"!==e.dtype)throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(v="float32"===e.dtype?255:1,g=new Uint8ClampedArray(i*o*4),m=0;m<o*i;++m)w=void 0,y=void 0,b=void 0,x=void 0,1===a?(w=s[m]*v,y=s[m]*v,b=s[m]*v,x=255):3===a?(w=s[3*m]*v,y=s[3*m+1]*v,b=s[3*m+2]*v,x=255):4===a&&(w=s[4*m]*v,y=s[4*m+1]*v,b=s[4*m+2]*v,x=s[4*m+3]*v),g[0+(_=4*m)]=Math.round(w),g[_+1]=Math.round(y),g[_+2]=Math.round(b),g[_+3]=Math.round(x);return null!=t&&(t.width=i,t.height=o,T=t.getContext("2d"),S=new ImageData(g,i,o),T.putImageData(S,0,0)),e!==n&&e.dispose(),[2,g]}})})},fromPixels:$H}),pE=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(t,e){return new t(e)},n}(),vE=function(){function n(){this.classNameMap={}}return n.getMap=function(){return null==n.instance&&(n.instance=new n),n.instance},n.register=function(t){n.getMap().classNameMap[t.className]=[t,t.fromConfig]},n}();function Fo(n){C(null!=n.className,function(){return"Class being registered does not have the static className property defined."}),C("string"==typeof n.className,function(){return"className is required to be a string, but got type "+typeof n.className}),C(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),vE.register(n)}function Xv(){return 32===M.backend.floatPrecision()?.001:.1}function Yv(n,t,e){var r=!0;if((Lt(n)||Lt(t))&&(r=!1),Lt(n)&&Lt(t)&&(r=!0),r){var o=n.constructor.name,i=t.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(n)&&Array.isArray(t)){var a=_r(n),s=_r(t);if(!bt(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=Lt(n)?n:Xr(n),c=Lt(t)?t:Xr(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var d=u[l],f=c[l];if(!e(d,f))throw new Error("Arrays differ: actual["+l+"] = "+d+", expected["+l+"] = "+f+".\nActual:   "+u+".\nExpected: "+c+".")}}function Qv(n,t,e){return!isFinite(n)&&!isFinite(t)||!(isNaN(n)||isNaN(t)||Math.abs(n-t)>e)}Object.freeze({Serializable:pE,SerializationMap:vE,registerClass:Fo}),Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(n,t,e){return null==e&&(e=Xv()),Yv(n,t,function(r,o){return Qv(r,o,e)})},testEpsilon:Xv,expectPromiseToFail:function(n,t){n().then(function(){return t.fail()},function(){return t()})},expectArraysEqual:function(n,t){var e="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Eo(n)||Eo(n[0])||Eo(t)||Eo(t[0])?Yv(n,e,function(r,o){return r==o}):Yv(n,t,function(r,o){return Qv(r,o,0)})},expectNumbersClose:function(n,t,e){if(null==e&&(e=Xv()),!Qv(n,t,e))throw new Error("Numbers differ: actual === "+n+", expected === "+t)},expectValuesInRange:function(n,t,e){for(var r=0;r<n.length;r++)if(n[r]<t||n[r]>e)throw new Error("Value out of range:"+n[r]+" low: "+t+", high: "+e)},expectArrayBuffersEqual:function(n,t){expect(new Float32Array(n)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:m3,webgl_util:jL,forceHalfFloat:function(){P().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:hC,setWebGLContext:I_,GPGPUContext:YD});var hi=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return Zn(t,n),t.prototype.minimize=function(e,r,o){void 0===r&&(r=!1);var i=this.computeGradients(e,o),a=i.value,s=i.grads;if(null!=o){var u=o.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return ln(s),r?a:(a.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,r){return function xB(n,t){C(Io(n),function(){return"The f passed in variableGrads(f) must be a function"}),C(null==t||Array.isArray(t)&&t.every(function(l){return l instanceof la}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=null!=t;if(!e)for(var r in t=[],M.registeredVariables)t.push(M.registeredVariables[r]);var o=e?t.filter(function(l){return!l.trainable}):null,i=t.length;C((t=t.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=M.gradients(n,t,null,!0),s=a.value,u=a.grads;C(u.some(function(l){return null!=l}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),C(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return t.forEach(function(l,d){null!=u[d]&&(c[l.name]=u[d])}),o?.forEach(function(l){return c[l.name]=null}),{value:s,grads:c}}(e,r)},t.prototype.dispose=function(){null!=this.iterations_&&ln(this.iterations_)},t.prototype.saveIterations=function(){return J(this,void 0,void 0,function(){return Z(this,function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:q(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return Z(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return Z(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return J(this,void 0,void 0,function(){var r;return Z(this,function(o){switch(o.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,e.slice(1)]}})})},t}(pE);Object.defineProperty(hi,Symbol.hasInstance,{value:function(n){return null!=n.minimize&&null!=n.computeGradients&&null!=n.applyGradients}});var mE=function(n){function t(e,r,o){void 0===o&&(o=null);var i=n.call(this)||this;return i.learningRate=e,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==o&&(i.epsilon=M.backend.epsilon()),i}return Zn(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=M.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:Y(function(){return ke(a).variable(!1)})}),null==r.accumulatedUpdates[i]&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:Y(function(){return ke(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedGrads[i].variable,c=r.accumulatedUpdates[i].variable;Y(function(){var l=u.mul(r.rho).add(s.square().mul(1-r.rho)),d=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=c.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(l),c.assign(f);var h=d.mul(-r.learningRate).add(a);a.assign(h)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(ln(this.accumulatedGrads.map(function(e){return e.variable})),ln(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return J(this,void 0,void 0,function(){var e;return Z(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){var r;return Z(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedGrads=e.slice(0,r=e.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(hi);Fo(mE);var yE=function(n){function t(e,r){void 0===r&&(r=.1);var o=n.call(this)||this;return o.learningRate=e,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return Zn(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=M.registeredVariables[o];null==r.accumulatedGrads[i]&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:Y(function(){return Cr(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedGrads[i].variable;Y(function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(M.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(l)})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&ln(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return Z(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return Z(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(hi);Fo(yE);var bE=function(n){function t(e,r,o,i){void 0===i&&(i=null);var a=n.call(this)||this;return a.learningRate=e,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Y(function(){a.accBeta1=q(r).variable(),a.accBeta2=q(o).variable()}),null==i&&(a.epsilon=M.backend.epsilon()),a}return Zn(t,n),t.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);Y(function(){var i=Mt(1,r.accBeta1),a=Mt(1,r.accBeta2);o.forEach(function(s,u){var c=M.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Y(function(){return ke(c).variable(!1)})}),null==r.accumulatedSecondMoment[u]&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Y(function(){return ke(c).variable(!1)})});var l=Array.isArray(e)?e[u].tensor:e[s];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2).add(l.square().mul(1-r.beta2)),v=h.div(i),g=p.div(a);d.assign(h),f.assign(p);var m=v.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(m)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&ln(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedSecondMoment&&ln(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return J(this,void 0,void 0,function(){var e;return Z(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){var r,o=this;return Z(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(e)];case 1:return e=i.sent(),Y(function(){o.accBeta1.assign(yl(o.beta1,o.iterations_+1)),o.accBeta2.assign(yl(o.beta2,o.iterations_+1))}),this.accumulatedFirstMoment=e.slice(0,r=e.length/2).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(hi);Fo(bE);var wE=function(n){function t(e,r,o,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var s=n.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Y(function(){s.iteration=q(0).variable(),s.accBeta1=q(r).variable()}),null==i&&(s.epsilon=M.backend.epsilon()),s}return Zn(t,n),t.prototype.applyGradients=function(e){var r=this,o=Array.isArray(e)?e.map(function(i){return i.name}):Object.keys(e);Y(function(){var i=Mt(1,r.accBeta1),a=ar(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach(function(s,u){var c=M.registeredVariables[s];null==r.accumulatedFirstMoment[u]&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ke(c).variable(!1)}),null==r.accumulatedWeightedInfNorm[u]&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:ke(c).variable(!1)});var l=Array.isArray(e)?e[u].tensor:e[s];if(null!=l){var d=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,h=d.mul(r.beta1).add(l.mul(1-r.beta1)),p=f.mul(r.beta2),v=l.abs(),g=p.maximum(v);d.assign(h),f.assign(g);var m=a.div(i).mul(h.div(g.add(r.epsilon))).add(c);c.assign(m)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&ln(this.accumulatedFirstMoment.map(function(e){return e.variable})),null!=this.accumulatedWeightedInfNorm&&ln(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return Z(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return Z(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(hi);Fo(wE);var Jv=function(n){function t(e){var r=n.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return Zn(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=Array.isArray(e)?e[i].tensor:e[o];if(null!=a){var s=M.registeredVariables[o];Y(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function WL(n){return M.keep(n)}(q(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return Z(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return Z(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=r.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,r){return new e(r.learningRate)},t.className="SGD",t}(hi);Fo(Jv);var xE=function(n){function t(e,r,o){void 0===o&&(o=!1);var i=n.call(this,e)||this;return i.learningRate=e,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=q(i.momentum),i}return Zn(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=M.registeredVariables[o];null==r.accumulations[i]&&(r.accumulations[i]={originalName:o+"/momentum",variable:Y(function(){return ke(a).variable(!1)})});var s=r.accumulations[i].variable,u=Array.isArray(e)?e[i].tensor:e[o];null!=u&&Y(function(){var c,l=r.m.mul(s).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(a):r.c.mul(l).add(a),s.assign(l),a.assign(c)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&ln(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return J(this,void 0,void 0,function(){return Z(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){return Z(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(Jv);Fo(xE);var _E=function(n){function t(e,r,o,i,a){void 0===r&&(r=.9),void 0===o&&(o=0),void 0===i&&(i=null),void 0===a&&(a=!1);var s=n.call(this)||this;if(s.learningRate=e,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,null==i&&(s.epsilon=M.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Zn(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e)).forEach(function(o,i){var a=M.registeredVariables[o];null==r.accumulatedMeanSquares[i]&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:Y(function(){return ke(a).variable(!1)})}),null==r.accumulatedMoments[i]&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:Y(function(){return ke(a).variable(!1)})}),null==r.accumulatedMeanGrads[i]&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:Y(function(){return ke(a).variable(!1)})});var s=Array.isArray(e)?e[i].tensor:e[o];if(null!=s){var u=r.accumulatedMeanSquares[i].variable,c=r.accumulatedMoments[i].variable;Y(function(){var l=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[i].variable,f=d.mul(r.decay).add(s.mul(1-r.decay)),h=c.mul(r.momentum).add(s.mul(r.learningRate).div(l.sub(f.square().add(r.epsilon)).sqrt()));u.assign(l),d.assign(f),c.assign(h);var p=a.sub(h);a.assign(p)}else{var v=u.mul(r.decay).add(s.square().mul(1-r.decay));h=c.mul(r.momentum).add(s.mul(r.learningRate).div(v.add(r.epsilon).sqrt())),u.assign(v),c.assign(h),p=a.sub(h),a.assign(p)}})}}),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&ln(this.accumulatedMeanSquares.map(function(e){return e.variable})),null!=this.accumulatedMeanGrads&&this.centered&&ln(this.accumulatedMeanGrads.map(function(e){return e.variable})),null!=this.accumulatedMoments&&ln(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return J(this,void 0,void 0,function(){var e;return Z(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(o){return{name:o.originalName,tensor:o.variable}}))]}})})},t.prototype.setWeights=function(e){return J(this,void 0,void 0,function(){var r;return Z(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),this.accumulatedMeanSquares=e.slice(0,r=this.centered?e.length/3:e.length/2).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(hi);function vi(n,t,e){if(void 0===e&&(e=!1),n.beginPath(),t.slice(1).forEach(function(i,a){var s=i.x,u=i.y,c=t[a];n.moveTo(c.x,c.y),n.lineTo(s,u)}),e){var r=t[t.length-1],o=t[0];if(!r||!o)return;n.moveTo(r.x,r.y),n.lineTo(o.x,o.y)}n.stroke()}Fo(_E),function(){function n(){}n.sgd=function(t){return new Jv(t)},n.momentum=function(t,e,r){return void 0===r&&(r=!1),new xE(t,e,r)},n.rmsprop=function(t,e,r,o,i){return void 0===e&&(e=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1),new _E(t,e,r,o,i)},n.adam=function(t,e,r,o){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===o&&(o=null),new bE(t,e,r,o)},n.adadelta=function(t,e,r){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===r&&(r=null),new mE(t,e,r)},n.adamax=function(t,e,r,o,i){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===r&&(r=.999),void 0===o&&(o=null),void 0===i&&(i=0),new wE(t,e,r,o,i)},n.adagrad=function(t,e){return void 0===e&&(e=.1),new yE(t,e)}}(),typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"&&setImmediate,Ke.prototype.squaredDifference=function(n){return pC(this,n)},k=IH;var Zv=function(n,t){return(Zv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o])})(n,t)};function fe(n,t){function e(){this.constructor=n}Zv(n,t),n.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}var Kt=function(){return Kt=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},Kt.apply(this,arguments)};function te(n,t,e,r){return new(e||(e=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?i(l.value):function o(i){return i instanceof e?i:new e(function(a){a(i)})}(l.value).then(s,u)}c((r=r.apply(n,t||[])).next())})}function ne(n,t){var r,o,i,a,e={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return function u(c){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,o=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(!(i=(i=e.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){e=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){e.label=c[1];break}if(6===c[0]&&e.label<i[1]){e.label=i[1],i=c;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(c);break}i[2]&&e.ops.pop(),e.trys.pop();continue}c=t.call(n,e)}catch(l){c=[6,l],o=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}function Zs(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),o=0;for(t=0;t<e;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var gi=function(){function n(t,e){if(!mi(t)||!mi(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function eu(n,t){return n instanceof Ke&&n.shape.length===t}function Sl(n){return eu(n,3)}function ko(n){return eu(n,4)}function CE(n){return n%2==0}function Tl(n,t){void 0===t&&(t=2);var e=Math.pow(10,t);return Math.floor(n*e)/e}function EE(n){return n&&n.width&&n.height}function eg(n){return n.reduce(function(t,e){return t.add(e)},new Me(0,0)).div(new Me(n.length,n.length))}function tu(n,t,e){return Array(n).fill(0).map(function(r,o){return t+o*e})}function mi(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||0===n}function IE(n){return mi(n)&&0<=n&&n<=1}var Me=function(){function n(t,e){this._x=t,this._y=e}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.sub=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.mul=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.div=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),Ir=function(){function n(t,e){void 0===e&&(e=!0);var r=t||{},o=[r.left,r.top,r.right,r.bottom].every(mi),i=[r.x,r.y,r.width,r.height].every(mi);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];n.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",e),this._x=s,this._y=u,this._width=c,this._height=l}return n.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(mi)},n.assertIsValidBox=function(t,e,r){if(void 0===r&&(r=!1),!n.isRect(t))throw new Error(e+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(e+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Me(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Me(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Me(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Me(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)});return new n({x:t[0],y:t[1],width:t[2],height:t[3]})},n.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)});return new n({x:t[0],y:t[1],width:t[2],height:t[3]})},n.prototype.toSquare=function(){var t=this,e=t.x,r=t.y,o=t.width,i=t.height,a=Math.abs(o-i);return o<i&&(e-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new n({x:e,y:r,width:o,height:i})},n.prototype.rescale=function(t){var e=EE(t)?t.width:t,r=EE(t)?t.height:t;return new n({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},n.prototype.pad=function(t,e){var r=[this.x-t/2,this.y-e/2,this.width+t,this.height+e];return new n({x:r[0],y:r[1],width:r[2],height:r[3]})},n.prototype.clipAtImageBorders=function(t,e){var r=this,i=r.y,a=r.right,s=r.bottom,u=Math.max(r.x,0),c=Math.max(i,0),d=s-c;return new n({x:u,y:c,width:Math.min(a-u,t-u),height:Math.min(d,e-c)}).floor()},n.prototype.shift=function(t,e){return new n({x:this.x+t,y:this.y+e,width:this.width,height:this.height})},n.prototype.padAtBorders=function(t,e){var r=this.width+1,o=this.height+1,s=r,u=o,c=this.left,l=this.top,d=this.right,f=this.bottom;return d>e&&(s=-d+e+r,d=e),f>t&&(u=-f+t+o,f=t),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:1,edy:u,dx:1,edx:s,y:l,ey:f,x:c,ex:d,w:r,h:o}},n.prototype.calibrate=function(t){return new n({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},n}(),Ml=function(n){function t(e,r,o,i,a){return void 0===a&&(a=!1),n.call(this,{left:e,top:r,right:o,bottom:i},a)||this}return fe(t,n),t}(Ir),SE=function(){function n(t,e,r,o,i){this._imageDims=new gi(i.width,i.height),this._score=t,this._classScore=e,this._className=r,this._box=new Ir(o).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new Ir(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:e})},n}(),Sn=function(n){function t(e,r,o){return n.call(this,e,e,"",r,o)||this}return fe(t,n),t.prototype.forSize=function(e,r){var o=n.prototype.forSize.call(this,e,r);return new t(o.score,o.relativeBox,o.imageDims)},t}(SE);function tj(n,t,e){void 0===e&&(e=!0);var i=Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left))*Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top));return e?i/(n.area+t.area-i):i/Math.min(n.area,t.area)}function nu(n,t,e,r){void 0===r&&(r=!0);for(var o=t.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,c=[],l=0;l<u.length;l++)c.push(tj(n[s],n[u[l]],r));o=o.filter(function(p,v){return c[v]<=e})};o.length>0;)a();return i}function ru(n,t){return Y(function(){var e=t[0],r=t[1],o=t[2],i=Cr(Zs(n.shape.slice(0,3),[1]),e),a=Cr(Zs(n.shape.slice(0,3),[1]),r),s=Cr(Zs(n.shape.slice(0,3),[1]),o),u=St([i,a,s],3);return Mt(n,u)})}function tg(n){return 1/(1+Math.exp(-n))}var At,ng=function(n){function t(e,r,o,i,a){return void 0===a&&(a=!1),n.call(this,{x:e,y:r,width:o,height:i},a)||this}return fe(t,n),t}(Ir),Ea=function(){function n(t,e,r){void 0===r&&(r=new Me(0,0));var o=e.width,i=e.height;this._imgDims=new gi(o,i),this._shift=r,this._positions=t.map(function(a){return a.mul(new Me(o,i)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Me(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new Me(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},n.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new Me(t,e))},n.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},n.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var r=t instanceof Sn?t.box.floor():new Ir(t);return this.shiftBy(r.x,r.y).align(null,e)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),a=o.minBoxPadding;return o.useDlibAlignment?this.alignDlib():this.alignMinBbox(a)},n.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),r=t[1],o=t[2],i=function(d){return o.sub(d).magnitude()},a=(i(t[0])+i(r))/2,s=Math.floor(a/.45),u=eg(t),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new ng(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},n.prototype.alignMinBbox=function(t){var e=function ej(n){var t=n.map(function(s){return s.x}),e=n.map(function(s){return s.y}),r=t.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return u<s?u:s},1/0),i=t.reduce(function(s,u){return s<u?u:s},0),a=e.reduce(function(s,u){return s<u?u:s},0);return new Ml(r,o,i,a)}(this.positions);return e.pad(e.width*t,e.height*t)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),aj=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],eg([e[3],e[4]])]},t}(Ea),TE=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(eg)},t}(Ea),ME=function(){function n(t,e){this._label=t,this._distance=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(t){return void 0===t&&(t=!0),this.label+(t?" ("+Tl(this.distance)+")":"")},n}(),AE=function(n){function t(e,r){var o=n.call(this,e)||this;return o._label=r,o}return fe(t,n),t.assertIsValidLabeledBox=function(e,r){if(Ir.assertIsValidBox(e,r),!mi(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Ir),ou=function(){function n(t,e){if("string"!=typeof t)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},n.fromJSON=function(t){var e=t.descriptors.map(function(r){return new Float32Array(r)});return new n(t.label,e)},n}();function iu(n){return n.detection instanceof Sn}function au(n,t){return Object.assign({},n,{detection:t})}function RE(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function NE(n){var t="";if(!n)try{n=Ra(Object(function(){var o=new Error("Cannot find module 'fs'");throw o.code="MODULE_NOT_FOUND",o}()))}catch(r){t=r.toString()}return{readFile:n?function(r){return new Promise(function(o,i){n.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function FE(){var n=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=NE();return Kt({Canvas:n||function a(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function a(){},Image:t||function a(){},ImageData:global.ImageData||function a(){},Video:global.HTMLVideoElement||function a(){},createCanvasElement:function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},i)}function kE(){return"object"==typeof window&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function PE(){return"object"==typeof global&&typeof process<"u"&&!!process.version}function rg(n){At=n}function og(){kE()&&rg(RE()),PE()&&rg(FE())}!function(n){function t(e,r,o,i){var a=n.call(this,e,r)||this;return a._score=o,a._classScore=i,a}fe(t,n),t.assertIsValidPredictedBox=function(e,r){if(AE.assertIsValidLabeledBox(e,r),!IE(e.score)||!IE(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(AE);var Xt={getEnv:function sj(){if(!At)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return At},setEnv:rg,initialize:og,createBrowserEnv:RE,createFileSystem:NE,createNodejsEnv:FE,monkeyPatch:function uj(n){if(At||og(),!At)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=n.Canvas,e=void 0===t?At.Canvas:t,r=n.Image,o=void 0===r?At.Image:r;At.Canvas=e,At.Image=o,At.createCanvasElement=n.createCanvasElement||function(){return new e},At.createImageElement=n.createImageElement||function(){return new o},At.ImageData=n.ImageData||At.ImageData,At.Video=n.Video||At.Video,At.fetch=n.fetch||At.fetch,At.readFile=n.readFile||At.readFile},isBrowser:kE,isNodejs:PE};function ig(n){return Xt.isNodejs()||"string"!=typeof n?n:document.getElementById(n)}function Sr(n){var t=Xt.getEnv(),e=t.Canvas;if(n instanceof t.CanvasRenderingContext2D)return n;var o=ig(n);if(!(o instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}og();var Tr=(()=>(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Tr||(Tr={})),Tr))(),OE=function n(t){void 0===t&&(t={});var r=t.backgroundColor,o=t.fontColor,i=t.fontSize,a=t.fontStyle,s=t.padding;this.anchorPosition=t.anchorPosition||Tr.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=o||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4},Al=function(){function n(t,e,r){void 0===r&&(r={}),this.text="string"==typeof t?[t]:t instanceof n?t.text:t,this.anchor=e,this.options=new OE(r)}return n.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(r){return t.measureText(r).width}).reduce(function(r,o){return r<o?o:r},0)+2*e},n.prototype.measureHeight=function(){var t=this.options;return this.text.length*t.fontSize+2*t.padding},n.prototype.getUpperLeft=function(t,e){var r=this.options.anchorPosition,o=r===Tr.BOTTOM_RIGHT||r===Tr.TOP_RIGHT,i=r===Tr.BOTTOM_LEFT||r===Tr.BOTTOM_RIGHT,a=this.measureWidth(t),s=this.measureHeight(),u=o?this.anchor.x-a:this.anchor.x,c=i?this.anchor.y-s:this.anchor.y;if(e){var d=e.height;return{x:Math.max(Math.min(u,e.width-a),0),y:Math.max(Math.min(c,d-s),0)}}return{x:u,y:c}},n.prototype.draw=function(t){var e=ig(t),r=Sr(e),o=this.options,i=o.backgroundColor,a=o.fontColor,s=o.fontSize,c=o.padding;r.font=s+"px "+o.fontStyle;var l=this.measureWidth(r),d=this.measureHeight();r.fillStyle=i;var f=this.getUpperLeft(r,e);r.fillRect(f.x,f.y,l,d),r.fillStyle=a,this.text.forEach(function(h,p){r.fillText(h,c+f.x,c+f.y+(p+1)*s)})},n}();function LE(n){var t=Xt.getEnv();return n instanceof t.Image&&n.complete||n instanceof t.Video&&n.readyState>=3}function ag(n){var t=Xt.getEnv(),r=t.Video;return n instanceof t.Image?new gi(n.naturalWidth,n.naturalHeight):n instanceof r?new gi(n.videoWidth,n.videoHeight):new gi(n.width,n.height)}function Rl(n){var t=n.width,e=n.height,o=(0,Xt.getEnv().createCanvasElement)();return o.width=t,o.height=e,o}function sg(n,t){var e=Xt.getEnv().ImageData;if(!(n instanceof e||LE(n)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||ag(n),o=r.width,i=r.height,a=Rl({width:o,height:i});return n instanceof e?Sr(a).putImageData(n,0,0):Sr(a).drawImage(n,0,0,o,i),a}function fj(n,t){return te(this,void 0,void 0,function(){var e,r,o,i,a,s;return ne(this,function(u){switch(u.label){case 0:return e=t||Xt.getEnv().createCanvasElement(),r=n.shape.slice(ko(n)?1:0),o=r[0],i=r[1],a=r[2],s=Y(function(){return n.as3D(o,i,a).toInt()}),[4,Kv.toPixels(s,e)];case 1:return u.sent(),s.dispose(),[2,e]}})})}function BE(n){var t=Xt.getEnv();return n instanceof t.Image||n instanceof t.Canvas||n instanceof t.Video}var Nl=function(){function n(t,e){var r=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(o,i){if(Sl(o))return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape);if(ko(o)){var a=o.shape[0];if(1!==a)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");return r._imageTensors[i]=o,void(r._inputDimensions[i]=o.shape.slice(1))}var s=o instanceof Xt.getEnv().Canvas?o:sg(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var t=this;return tu(this.batchSize,0,1).map(function(e,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},n.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},n.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},n.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},n.prototype.getReshapedInputDimensions=function(t){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function ZH(n,t){var e=n.width,r=n.height,o=t/Math.max(r,e);return new gi(Math.round(e*o),Math.round(r*o))}({width:this.getInputWidth(t),height:this.getInputHeight(t)},this.inputSize)},n.prototype.toBatchTensor=function(t,e){var r=this;return void 0===e&&(e=!0),this._inputSize=t,Y(function(){var o=tu(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof Ke){var u=ko(s)?s:s.expandDims();return u=function nj(n,t){return void 0===t&&(t=!1),Y(function(){var e=n.shape.slice(1),r=e[0],o=e[1];if(r===o)return n;var i=Math.abs(r-o),a=Math.round(i*(t?.5:1)),s=r>o?2:1,u=function(h){var p=n.shape.slice();return p[s]=h,Cr(p,0)},c=u(a),l=i-c.shape[s],f=[t&&l?u(l):null,n,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return St(f,s)})}(u,e),(u.shape[1]!==t||u.shape[2]!==t)&&(u=Av.resizeBilinear(u,[t,t])),u.as3D(t,t,3)}if(s instanceof Xt.getEnv().Canvas)return Kv.fromPixels(function hj(n,t,e){void 0===e&&(e=!1);var r=Xt.getEnv(),i=r.Canvas;if(!(n instanceof r.Image||n instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=ag(n),s=t/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=Rl({width:t,height:t}),d=n instanceof i?n:sg(n),f=Math.abs(u-c)/2,h=e&&u<c?f:0,p=e&&c<u?f:0;return Sr(l).drawImage(d,h,p,u,c),l}(s,t,e));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)});return En(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,t,t,3)})},n}();function kt(n){return te(this,void 0,void 0,function(){var t,e,r;return ne(this,function(o){switch(o.label){case 0:if(n instanceof Nl)return[2,n];if(!(t=Array.isArray(n)?n:[n]).length)throw new Error("toNetInput - empty array passed as input");return e=function(i){return Array.isArray(n)?" at input index "+i+":":""},(r=t.map(ig)).forEach(function(i,a){if(!BE(i)&&!Sl(i)&&!ko(i))throw"string"==typeof t[a]?new Error("toNetInput -"+e(a)+" string passed, but could not resolve HTMLElement for element id "+t[a]):new Error("toNetInput -"+e(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ko(i)){var s=i.shape[0];if(1!==s)throw new Error("toNetInput -"+e(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return BE(i)&&function dj(n){return new Promise(function(t,e){if(n instanceof Xt.getEnv().Canvas||LE(n))return t();function r(i){!i.currentTarget||(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),t(i))}function o(i){!i.currentTarget||(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),e(i))}n.addEventListener("load",r),n.addEventListener("error",o)})}(i)}))];case 1:return o.sent(),[2,new Nl(r,Array.isArray(n))]}})})}function ug(n,t){return te(this,void 0,void 0,function(){var e,r,o,i,a,s;return ne(this,function(c){switch(c.label){case 0:return e=Xt.getEnv().Canvas,r=n,n instanceof e?[3,5]:[4,kt(n)];case 1:if((o=c.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof e?(a=i,[3,4]):[3,2];case 2:return[4,fj(i)];case 3:a=c.sent(),c.label=4;case 4:r=a,c.label=5;case 5:return s=Sr(r),[2,t.map(function(l){return l instanceof Sn?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}).map(function(l){var d=l.x,f=l.y,h=l.width,p=l.height,v=Rl({width:h,height:p});return Sr(v).putImageData(s.getImageData(d,f,h,p),0,0),v})]}})})}function cg(n,t){return te(this,void 0,void 0,function(){return ne(this,function(e){if(!Sl(n)&&!ko(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ko(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Y(function(){var r=n.shape.slice(ko(n)?1:0),o=r[0],i=r[1],a=r[2];return t.map(function(c){return c instanceof Sn?c.forSize(i,o).box:c}).map(function(c){return c.clipAtImageBorders(i,o)}).map(function(c){var l=c.x,d=c.y,f=c.width,h=c.height;return LC(n.as3D(o,i,a),[d,l,0],[h,f,a])})})]})})}function pj(n,t){return te(this,void 0,void 0,function(){var r;return ne(this,function(o){switch(o.label){case 0:return[4,(0,Xt.getEnv().fetch)(n,t)];case 1:if(!((r=o.sent()).status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function vj(n){return te(this,void 0,void 0,function(){return ne(this,function(t){switch(t.label){case 0:return[4,pj(n)];case 1:return[2,t.sent().json()]}})})}function VE(n,t){var e=t+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:e};if("/"===n)return{modelBaseUri:"/",manifestUri:"/"+e};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"",o=(n=n.replace(r,"")).split("/").filter(function(s){return s}),i=n.endsWith(".json")?o[o.length-1]:e,a=r+(n.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=n.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function gj(n,t){return te(this,void 0,void 0,function(){var e,o,i;return ne(this,function(a){switch(a.label){case 0:return e=VE(n,t),o=e.modelBaseUri,[4,vj(e.manifestUri)];case 1:return i=a.sent(),[2,hE.loadWeights(i,o)]}})})}var ro=function(){function n(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},n.prototype.reassignParamFromPath=function(t,e){var r=this.traversePropertyPath(t),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=e},n.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof la})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof la)})},n.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){t.reassignParamFromPath(e.path,e.tensor.variable())})},n.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var r=e.path,o=e.tensor,i=Ht(o.dataSync());o.dispose(),t.reassignParamFromPath(r,i)})},n.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){return Array.from(t.tensor.dataSync())}).reduce(function(t,e){return t.concat(e)}))},n.prototype.load=function(t){return te(this,void 0,void 0,function(){return ne(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},n.prototype.loadFromUri=function(t){return te(this,void 0,void 0,function(){var e;return ne(this,function(r){switch(r.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromUri - expected model uri");return[4,gj(t,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},n.prototype.loadFromDisk=function(t){return te(this,void 0,void 0,function(){var e,r,o,i,s,u,c,l,d;return ne(this,function(f){switch(f.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromDisk - expected model file path");return e=Xt.getEnv().readFile,r=VE(t,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,s=hE.weightsLoaderFactory(function(h){return Promise.all(h.map(function(p){return e(p).then(function(v){return v.buffer})}))}),l=(c=JSON).parse,[4,e(o)];case 1:return u=l.apply(c,[f.sent().toString()]),[4,s(u,i)];case 2:return d=f.sent(),this.loadFromWeightMap(d),[2]}})})},n.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),o=e.params;this._paramMappings=e.paramMappings,this._params=o},n.prototype.extractWeights=function(t){var e=this.extractParams(t),o=e.params;this._paramMappings=e.paramMappings,this._params=o},n.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+t);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=e.obj,o=e.objProp;if(!(r&&o&&r[o]instanceof Ke))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:o}},n}();function Tn(n,t,e){return Y(function(){var r=Ev(n,t.depthwise_filter,t.pointwise_filter,e,"same");return Ie(r,t.bias)})}function lg(n,t,e){return void 0===e&&(e=!1),Y(function(){var r=ot(e?Ie(Vn(n,t.conv0.filters,[2,2],"same"),t.conv0.bias):Tn(n,t.conv0,[2,2])),o=Tn(r,t.conv1,[1,1]),a=Tn(ot(Ie(r,o)),t.conv2,[1,1]);return ot(Ie(r,Ie(o,a)))})}function Fl(n,t,e,r){return void 0===e&&(e=!1),void 0===r&&(r=!0),Y(function(){var o=ot(e?Ie(Vn(n,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Tn(n,t.conv0,r?[2,2]:[1,1])),i=Tn(o,t.conv1,[1,1]),s=Tn(ot(Ie(o,i)),t.conv2,[1,1]),c=Tn(ot(Ie(o,Ie(i,s))),t.conv3,[1,1]);return ot(Ie(o,Ie(i,Ie(s,c))))})}function sr(n,t,e,r){return void 0===e&&(e="same"),void 0===r&&(r=!1),Y(function(){var o=Ie(Vn(n,t.filters,[1,1],e),t.bias);return r?ot(o):o})}function oo(n,t){Object.keys(n).forEach(function(e){t.some(function(r){return r.originalPath===e})||n[e].dispose()})}function kl(n,t){return function(e,r,o,i){var a=fn(n(e*r*o*o),[o,o,e,r]),s=xt(n(r));return t.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function dg(n,t){return function(e,r,o){var i=To(n(e*r),[e,r]),a=xt(n(r));return t.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var HE=function n(t,e,r){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=r};function fg(n,t){return function(e,r,o){var i=fn(n(9*e),[3,3,e,1]),a=fn(n(e*r),[1,1,e,r]),s=xt(n(r));return t.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new HE(i,a,s)}}function hg(n){return function(t){var e=n(t+"/depthwise_filter",4),r=n(t+"/pointwise_filter",4),o=n(t+"/bias",1);return new HE(e,r,o)}}function Po(n,t){return function(e,r,o){var i=n[e];if(!eu(i,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+i);return t.push({originalPath:e,paramPath:o||e}),i}}function io(n){var t=n;return{extractWeights:function e(o){var i=t.slice(0,o);return t=t.slice(o),i},getRemainingWeights:function r(){return t}}}function jE(n,t){var e=kl(n,t),r=fg(n,t);function o(a,s,u,c){return void 0===c&&(c=!1),{conv0:c?e(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),conv1:r(s,s,u+"/conv1"),conv2:r(s,s,u+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function i(a,s,u,c){void 0===c&&(c=!1);var l=o(a,s,u,c);return{conv0:l.conv0,conv1:l.conv1,conv2:l.conv2,conv3:r(s,s,u+"/conv3")}}}}function WE(n){return function(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}}function UE(n,t){var e=Po(n,t),r=WE(e),o=hg(e);return{extractDenseBlock3Params:function i(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2")}},extractDenseBlock4Params:function a(s,u){return void 0===u&&(u=!1),{conv0:u?r(s+"/conv0"):o(s+"/conv0"),conv1:o(s+"/conv1"),conv2:o(s+"/conv2"),conv3:o(s+"/conv3")}}}}var zE=function(n){function t(){return n.call(this,"FaceFeatureExtractor")||this}return fe(t,n),t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Y(function(){var s=Fl(ru(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(q(255)),r.dense0,!0);return s=Fl(s,r.dense1),s=Fl(s,r.dense2),s=Fl(s,r.dense3),Qs(s,[7,7],[2,2],"valid")})},t.prototype.forward=function(e){return te(this,void 0,void 0,function(){var r;return ne(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function bj(n){var t=[],e=UE(n,t).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return oo(n,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function yj(n){var t=[],e=io(n),o=e.getRemainingWeights,i=jE(e.extractWeights,t).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}(e)},t}(ro);function Mr(n,t){return Y(function(){return Ie(wl(n,t.weights),t.bias)})}function GE(n){var t={},e={};return Object.keys(n).forEach(function(r){(r.startsWith("fc")?e:t)[r]=n[r]}),{featureExtractorMap:t,classifierMap:e}}var qE=function(n){function t(e,r){var o=n.call(this,e)||this;return o._faceFeatureExtractor=r,o}return fe(t,n),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return Y(function(){var i=e instanceof Nl?r.faceFeatureExtractor.forwardInput(e):e;return Mr(i.as2D(i.shape[0],-1),o.fc)})},t.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),i=r.paramMappings;this._params=r.params,this._paramMappings=i},t.prototype.extractClassifierParams=function(e){return function wj(n,t,e){var r=[],o=io(n),a=o.getRemainingWeights,u=dg(o.extractWeights,r)(t,e,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var r=GE(e),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function xj(n){var t=[],e=Po(n,t),o={fc:function r(i){return{weights:e(i+"/weights",2),bias:e(i+"/bias",1)}}("fc")};return oo(n,t),{params:o,paramMappings:t}}(i)},t.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=e.slice(0,e.length-i),s=e.slice(e.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},t}(ro),$E=["neutral","happy","sad","angry","fearful","disgusted","surprised"],pg=function(){function n(t){var e=this;if(7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);$E.forEach(function(r,o){e[r]=t[o]})}return n.prototype.asSortedArray=function(){var t=this;return $E.map(function(e){return{expression:e,probability:t[e]}}).sort(function(e,r){return r.probability-e.probability})},n}(),_j=function(n){function t(e){return void 0===e&&(e=new zE),n.call(this,"FaceExpressionNet",e)||this}return fe(t,n),t.prototype.forwardInput=function(e){var r=this;return Y(function(){return Jr(r.runNet(e))})},t.prototype.forward=function(e){return te(this,void 0,void 0,function(){var r;return ne(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictExpressions=function(e){return te(this,void 0,void 0,function(){var r,o,i,a,s=this;return ne(this,function(u){switch(u.label){case 0:return[4,kt(e)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(Tt(o).map(function(c){return te(s,void 0,void 0,function(){var l;return ne(this,function(d){switch(d.label){case 0:return[4,c.data()];case 1:return l=d.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(c){return new pg(c)}),[2,r.isBatchInput?a:a[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(qE);function KE(n,t){return Object.assign({},n,{expressions:t})}function vg(n){return iu(n)&&n.landmarks instanceof Ea&&n.unshiftedLandmarks instanceof Ea&&n.alignedRect instanceof Sn}function Pl(n,t){var e=n.detection.box,r=t.shiftBy(e.x,e.y),o=r.align(),i=n.detection.imageDims,a=new Sn(n.detection.score,o.rescale(i.reverse()),i);return Object.assign({},n,{landmarks:r,unshiftedLandmarks:t,alignedRect:a})}var Cj=function n(t){void 0===t&&(t={});var e=t.drawLines,o=t.drawPoints,i=void 0===o||o,a=t.lineWidth,s=t.lineColor,u=t.pointSize,c=t.pointColor;this.drawLines=void 0===e||e,this.drawPoints=i,this.lineWidth=a||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"},Ej=function(){function n(t,e){void 0===e&&(e={}),this.faceLandmarks=t,this.options=new Cj(e)}return n.prototype.draw=function(t){var e=Sr(t),r=this.options,i=r.drawPoints,a=r.lineWidth,u=r.pointSize,c=r.pointColor;r.drawLines&&this.faceLandmarks instanceof TE&&(e.strokeStyle=r.lineColor,e.lineWidth=a,vi(e,this.faceLandmarks.getJawOutline()),vi(e,this.faceLandmarks.getLeftEyeBrow()),vi(e,this.faceLandmarks.getRightEyeBrow()),vi(e,this.faceLandmarks.getNose()),vi(e,this.faceLandmarks.getLeftEye(),!0),vi(e,this.faceLandmarks.getRightEye(),!0),vi(e,this.faceLandmarks.getMouth(),!0)),i&&(e.strokeStyle=c,e.fillStyle=c,this.faceLandmarks.positions.forEach(function(d){e.beginPath(),e.arc(d.x,d.y,u,0,2*Math.PI),e.fill()}))},n}();function XE(n,t,e){return Ie(Vn(n,t.filters,e,"same"),t.bias)}function gg(n,t,e){void 0===e&&(e=!0);var r=e?ot(n):n;return r=Tn(r,t.separable_conv0,[1,1]),r=Tn(ot(r),t.separable_conv1,[1,1]),r=Ft(r,[3,3],[2,2],"same"),Ie(r,XE(n,t.expansion_conv,[2,2]))}var Nj=function(n){function t(e){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return fe(t,n),t.prototype.forwardInput=function(e){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return Y(function(){var s=ru(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(q(256)),u=ot(XE(s,o.entry_flow.conv_in,[2,2]));return u=gg(u,o.entry_flow.reduction_block_0,!1),u=gg(u,o.entry_flow.reduction_block_1),tu(r._numMainBlocks,0,1).forEach(function(c){u=function Rj(n,t){var e=Tn(ot(n),t.separable_conv0,[1,1]);return e=Tn(ot(e),t.separable_conv1,[1,1]),e=Tn(ot(e),t.separable_conv2,[1,1]),Ie(e,n)}(u,o.middle_flow["main_block_"+c])}),u=gg(u,o.exit_flow.reduction_block),u=ot(Tn(u,o.exit_flow.separable_conv,[1,1]))})},t.prototype.forward=function(e){return te(this,void 0,void 0,function(){var r;return ne(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function Aj(n,t){var e=[],r=function Mj(n,t){var e=Po(n,t),r=WE(e),o=hg(e);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function i(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),expansion_conv:r(s+"/expansion_conv")}},extractMainBlockParams:function a(s){return{separable_conv0:o(s+"/separable_conv0"),separable_conv1:o(s+"/separable_conv1"),separable_conv2:o(s+"/separable_conv2")}}}}(n,e),i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,d={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},f={};tu(t,0,1).forEach(function(g){f["main_block_"+g]=s("middle_flow/main_block_"+g)});var v={reduction_block:a("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return oo(n,e),{params:{entry_flow:d,middle_flow:f,exit_flow:v},paramMappings:e}}(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return function Tj(n,t){var e=[],r=io(n),i=r.getRemainingWeights,a=function Sj(n,t){var e=kl(n,t),r=fg(n,t);return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:function o(a,s,u){return{separable_conv0:r(a,s,u+"/separable_conv0"),separable_conv1:r(s,s,u+"/separable_conv1"),expansion_conv:e(a,s,1,u+"/expansion_conv")}},extractMainBlockParams:function i(a,s){return{separable_conv0:r(a,a,s+"/separable_conv0"),separable_conv1:r(a,a,s+"/separable_conv1"),separable_conv2:r(a,a,s+"/separable_conv2")}}}}(r.extractWeights,e),u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,p={conv_in:(0,a.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},v={};tu(t,0,1).forEach(function(y){v["main_block_"+y]=l(128,"middle_flow/main_block_"+y)});var w={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{entry_flow:p,middle_flow:v,exit_flow:w}}}(e,this._numMainBlocks)},t}(ro),su=(()=>(function(n){n.FEMALE="female",n.MALE="male"}(su||(su={})),su))(),Pj=function(n){function t(e){void 0===e&&(e=new Nj(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return fe(t,n),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return Y(function(){var i=e instanceof Nl?r.faceFeatureExtractor.forwardInput(e):e,a=Qs(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1);return{age:Mr(a,o.fc.age).as1D(),gender:Mr(a,o.fc.gender)}})},t.prototype.forwardInput=function(e){var r=this;return Y(function(){var o=r.runNet(e);return{age:o.age,gender:Jr(o.gender)}})},t.prototype.forward=function(e){return te(this,void 0,void 0,function(){var r;return ne(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return te(this,void 0,void 0,function(){var r,o,i,a,s,u,c=this;return ne(this,function(l){switch(l.label){case 0:return[4,kt(e)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return o=l.sent(),i=Tt(o.age),a=Tt(o.gender),s=i.map(function(d,f){return{ageTensor:d,genderTensor:a[f]}}),[4,Promise.all(s.map(function(d){var f=d.ageTensor,h=d.genderTensor;return te(c,void 0,void 0,function(){var p,v,g,m,w;return ne(this,function(y){switch(y.label){case 0:return[4,f.data()];case 1:return p=y.sent()[0],[4,h.data()];case 2:return v=y.sent()[0],m=(g=v>.5)?su.MALE:su.FEMALE,w=g?v:1-v,f.dispose(),h.dispose(),[2,{age:p,gender:m,genderProbability:w}]}})})}))];case 3:return u=l.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),i=r.paramMappings;this._params=r.params,this._paramMappings=i},t.prototype.extractClassifierParams=function(e){return function Fj(n){var t=[],e=io(n),o=e.getRemainingWeights,i=dg(e.extractWeights,t),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{fc:{age:a,gender:s}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var r=GE(e),i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(r.featureExtractorMap),function kj(n){var t=[],e=Po(n,t);function r(i){return{weights:e(i+"/weights",2),bias:e(i+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return oo(n,t),{params:o,paramMappings:t}}(i)},t.prototype.extractParams=function(e){var o=e.slice(0,e.length-1539),i=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},t}(ro),YE=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.postProcess=function(e,r,o){var i=o.map(function(s){var u=s.width,c=s.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),a=i.length;return Y(function(){var s=function(f,h){return En([Cr([68],f),Cr([68],h)],1).as2D(1,136).as1D()},u=function(f,h){var p=i[f],v=p.width,g=p.height;return h(v,g)?Math.abs(v-g)/2:0};return e.mul(Cr([a,136],r)).sub(En(Array.from(Array(a),function(f,h){return s(function(f){return u(f,function(h,p){return h<p})}(h),function(f){return u(f,function(h,p){return p<h})}(h))}))).div(En(Array.from(Array(a),function(f,h){return s(i[h].width,i[h].height)})))})},t.prototype.forwardInput=function(e){var r=this;return Y(function(){var o=r.runNet(e);return r.postProcess(o,e.inputSize,e.inputDimensions.map(function(i){return{height:i[0],width:i[1]}}))})},t.prototype.forward=function(e){return te(this,void 0,void 0,function(){var r;return ne(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.detectLandmarks=function(e){return te(this,void 0,void 0,function(){var r,o,i,a=this;return ne(this,function(s){switch(s.label){case 0:return[4,kt(e)];case 1:return r=s.sent(),o=Y(function(){return Tt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,c){return te(a,void 0,void 0,function(){var l,d,f,h,p;return ne(this,function(v){switch(v.label){case 0:return f=(d=Array).from,[4,u.data()];case 1:return l=f.apply(d,[v.sent()]),h=l.filter(function(g,m){return CE(m)}),p=l.filter(function(g,m){return!CE(m)}),[2,new TE(Array(68).fill(0).map(function(g,m){return new Me(h[m],p[m])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(qE),QE=function(n){function t(e){return void 0===e&&(e=new zE),n.call(this,"FaceLandmark68Net",e)||this}return fe(t,n),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(YE),Bj=function(n){function t(){return n.call(this,"TinyFaceFeatureExtractor")||this}return fe(t,n),t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Y(function(){var s=lg(ru(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(q(255)),r.dense0,!0);return s=lg(s,r.dense1),s=lg(s,r.dense2),Qs(s,[14,14],[2,2],"valid")})},t.prototype.forward=function(e){return te(this,void 0,void 0,function(){var r;return ne(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function Oj(n){var t=[],e=UE(n,t).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return oo(n,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function Lj(n){var t=[],e=io(n),o=e.getRemainingWeights,i=jE(e.extractWeights,t).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{dense0:a,dense1:s,dense2:u}}}(e)},t}(ro),Vj=function(n){function t(e){return void 0===e&&(e=new Bj),n.call(this,"FaceLandmark68TinyNet",e)||this}return fe(t,n),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(YE);function mg(n,t,e,r,o){void 0===o&&(o="same");var i=t.conv,s=i.bias,u=Vn(n,i.filters,e,o);return u=function Hj(n,t){return Ie(qt(n,t.weights),t.biases)}(u=Ie(u,s),t.scale),r?ot(u):u}function JE(n,t){return mg(n,t,[1,1],!1)}function ZE(n,t){return mg(n,t,[2,2],!0,"valid")}function Wj(n,t){function i(s,u,c,l){var d=function r(s,u,c,l){var d=function e(s,u,c){var l=n(s),d=l.length/(u*c*c);if(function JH(n){return n%1!=0}(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return Y(function(){return Ao(fn(l,[u,d,c,c]),[2,3,1,0])})}(s,u,c),f=xt(n(u));return t.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:f}}(s,u,c,l+"/conv"),f=function o(s,u){var c=xt(n(s)),l=xt(n(s));return t.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}(u,l+"/scale");return{conv:d,scale:f}}return{extractConvLayerParams:i,extractResidualLayerParams:function a(s,u,c,l,d){return void 0===d&&(d=!1),{conv1:i((d?.5:1)*s,u,c,l+"/conv1"),conv2:i(s,u,c,l+"/conv2")}}}}function Gj(n){var t=[],e=function zj(n,t){var e=Po(n,t);function o(a){var s=e(a+"/conv/filters",4),u=e(a+"/conv/bias",1),c=function r(a){return{weights:e(a+"/scale/weights",1),biases:e(a+"/scale/biases",1)}}(a);return{conv:{filters:s,bias:u},scale:c}}return{extractConvLayerParams:o,extractResidualLayerParams:function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}}}(n,t),o=e.extractResidualLayerParams,i=(0,e.extractConvLayerParams)("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),d=o("conv64_2"),f=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),v=o("conv128_2"),g=o("conv256_down"),m=o("conv256_1"),w=o("conv256_2"),y=o("conv256_down_out"),b=n.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!function QH(n){return eu(n,2)}(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var x={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:d,conv64_3:f,conv128_down:h,conv128_1:p,conv128_2:v,conv256_down:g,conv256_1:m,conv256_2:w,conv256_down_out:y,fc:b};return oo(n,t),{params:x,paramMappings:t}}function Ar(n,t){var e=function jj(n,t){return mg(n,t,[1,1],!0)}(n,t.conv1);return e=JE(e,t.conv2),e=Ie(e,n),ot(e)}function Ol(n,t){var e=ZE(n,t.conv1);e=JE(e,t.conv2);var r=Qs(n,2,2,"valid"),o=Ze(r.shape),i=r.shape[3]!==e.shape[3];if(r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2]){var s=Zs(e.shape);s[1]=1;var u=Ze(s),c=Zs((e=St([e,u],1)).shape);c[2]=1;var l=Ze(c);e=St([e,l],2)}return r=i?St([r,o],3):r,e=Ie(r,e),ot(e)}!function(n){fe(function t(){return null!==n&&n.apply(this,arguments)||this},n)}(QE);var qj=function(n){function t(){return n.call(this,"FaceRecognitionNet")||this}return fe(t,n),t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Y(function(){var s=ZE(ru(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(q(256)),r.conv32_down);s=Ar(s=Ft(s,3,2,"valid"),r.conv32_1),s=Ar(s,r.conv32_2),s=Ar(s,r.conv32_3),s=Ar(s=Ol(s,r.conv64_down),r.conv64_1),s=Ar(s,r.conv64_2),s=Ar(s,r.conv64_3),s=Ar(s=Ol(s,r.conv128_down),r.conv128_1),s=Ar(s,r.conv128_2),s=Ar(s=Ol(s,r.conv256_down),r.conv256_1);var u=(s=Ol(s=Ar(s,r.conv256_2),r.conv256_down_out)).mean([1,2]);return wl(u,r.fc)})},t.prototype.forward=function(e){return te(this,void 0,void 0,function(){var r;return ne(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return te(this,void 0,void 0,function(){var r,o,i,a=this;return ne(this,function(s){switch(s.label){case 0:return[4,kt(e)];case 1:return r=s.sent(),o=Y(function(){return Tt(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return Gj(e)},t.prototype.extractParams=function(e){return function Uj(n){var t=io(n),e=t.extractWeights,r=t.getRemainingWeights,o=[],i=Wj(e,o),s=i.extractResidualLayerParams,u=(0,i.extractConvLayerParams)(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),m=s(147456,128,3,"conv128_1"),w=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),T=Y(function(){return Ao(To(e(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:d,conv64_down:f,conv64_1:h,conv64_2:p,conv64_3:v,conv128_down:g,conv128_1:m,conv128_2:w,conv256_down:y,conv256_1:b,conv256_2:x,conv256_down_out:_,fc:T},paramMappings:o}}(e)},t}(ro);function eI(n,t,e){return Object.assign({},n,{gender:t,genderProbability:e})}var tI=function(){function n(t){var e=void 0===t?{}:t,r=e.minFaceSize,o=e.scaleFactor,i=e.maxNumScales,a=e.scoreThresholds,s=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(u){return"number"!=typeof u}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return"number"!=typeof u})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function Rr(n,t,e){return Y(function(){var r=Vn(n,t.filters,e,"same");return r=Ie(r,t.batch_norm_offset),bv(r,0,6)})}function nW(n,t,e){var r=n.arraySync(),o=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),a=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[e][0],r[e][2]),c=Math.min(r[e][1],r[e][3]),l=Math.max(r[e][0],r[e][2]),d=Math.max(r[e][1],r[e][3]),f=(a-o)*(s-i),h=(l-u)*(d-c);if(f<=0||h<=0)return 0;var p=Math.max(o,u),v=Math.max(i,c),g=Math.min(a,l),m=Math.min(s,d),w=Math.max(g-p,0)*Math.max(m-v,0);return w/(f+h-w)}function Ia(n,t){return Y(function(){var e=n.shape[0];return{boxPredictionEncoding:or(sr(n,t.box_encoding_predictor),[e,-1,1,4]),classPrediction:or(sr(n,t.class_predictor),[e,-1,3])}})}var Ll=function(){function n(t){var e=void 0===t?{}:t,r=e.minConfidence,o=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),nI=function(n){function t(){return n.call(this,"SsdMobilenetv1")||this}return fe(t,n),t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Y(function(){var o=e.toBatchTensor(512,!1).toFloat(),a=function eW(n,t){return Y(function(){var e=null,r=Rr(n,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach(function(i,a){var s=a+1,u=function Zj(n){return[2,4,6,12].some(function(t){return t===n})?[2,2]:[1,1]}(s);r=function Jj(n,t,e){return Y(function(){var r=bl(n,t.filters,e,"same");return r=wC(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),bv(r,0,6)})}(r,i.depthwise_conv,u),r=Rr(r,i.pointwise_conv,[1,1]),11===s&&(e=r)}),null===e)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}(Mt(qt(o,q(.007843137718737125)),q(1)),r.mobilenetv1),s=function aW(n,t,e){return Y(function(){var r=Rr(n,e.conv_0,[1,1]),o=Rr(r,e.conv_1,[2,2]),i=Rr(o,e.conv_2,[1,1]),a=Rr(i,e.conv_3,[2,2]),s=Rr(a,e.conv_4,[1,1]),u=Rr(s,e.conv_5,[2,2]),c=Rr(u,e.conv_6,[1,1]),l=Rr(c,e.conv_7,[2,2]),d=Ia(t,e.box_predictor_0),f=Ia(n,e.box_predictor_1),h=Ia(o,e.box_predictor_2),p=Ia(a,e.box_predictor_3),v=Ia(u,e.box_predictor_4),g=Ia(l,e.box_predictor_5);return{boxPredictions:St([d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:St([d.classPrediction,f.classPrediction,h.classPrediction,p.classPrediction,v.classPrediction,g.classPrediction],1)}})}(a.out,a.conv11,r.prediction_layer);return function iW(n,t,e){return Y(function(){var r=n.shape[0],o=function oW(n,t){var e=function rW(n){var t=Tt(Ao(n,[1,0])),e=[Mt(t[2],t[0]),Mt(t[3],t[1])];return{sizes:e,centers:[Ie(t[0],ar(e[0],q(2))),Ie(t[1],ar(e[1],q(2)))]}}(n),r=e.sizes,o=e.centers,i=Tt(Ao(t,[1,0])),a=ar(qt(wv(ar(i[2],q(5))),r[0]),q(2)),s=Ie(qt(ar(i[0],q(10)),r[0]),o[0]),u=ar(qt(wv(ar(i[3],q(5))),r[1]),q(2)),c=Ie(qt(ar(i[1],q(10)),r[1]),o[1]);return Ao(En([Mt(s,a),Mt(c,u),Ie(s,a),Ie(c,u)]),[1,0])}(or(fa(e.extra_dim,[r,1,1]),[-1,4]),or(n,[-1,4]));o=or(o,[r,o.shape[0]/r,4]);var i=gC(Er(t,[0,0,1],[-1,-1,-1])),a=Er(i,[0,0,0],[-1,-1,1]);return a=or(a,[r,a.shape[1]]),{boxes:Tt(o),scores:Tt(a)}})}(s.boxPredictions,s.classPredictions,r.output_layer)})},t.prototype.forward=function(e){return te(this,void 0,void 0,function(){var r;return ne(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,kt(e)];case 1:return[2,r.apply(this,[o.sent()])]}})})},t.prototype.locateFaces=function(e,r){return void 0===r&&(r={}),te(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,v,g,w,y,b,x,_,T,S;return ne(this,function(E){switch(E.label){case 0:return o=new Ll(r),i=o.maxResults,a=o.minConfidence,[4,kt(e)];case 1:for(s=E.sent(),u=this.forwardInput(s),d=(c=u.boxes)[0],f=(l=u.scores)[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return g=(v=Array).from,[4,f.data()];case 2:return p=g.apply(v,[E.sent()]),w=function tW(n,t,e,r,o){var a=Math.min(e,n.shape[0]),s=t.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>o}).sort(function(l,d){return d.score-l.score}),u=function(l){return l<=r?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var d=l.score,f=c.length-1;f>=0;--f){var h=nW(n,l.boxIndex,c[f]);if(0!==h&&(l.score*=u(h),l.score<=o))break}d===l.score&&c.push(l.boxIndex)}}),c}(d,p,i,.5,a),y=s.getReshapedInputDimensions(0),x=(b=s.inputSize)/y.width,_=b/y.height,T=d.arraySync(),S=w.map(function(I){var N=[Math.max(0,T[I][0]),Math.min(1,T[I][2])].map(function(j){return j*_}),R=N[0],B=N[1],O=[Math.max(0,T[I][1]),Math.min(1,T[I][3])].map(function(j){return j*x}),L=O[0];return new Sn(p[I],new ng(L,R,O[1]-L,B-R),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),f.dispose(),[2,S]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function Yj(n){var t=[],e=function Xj(n,t){var e=Po(n,t);function r(c,l,d){return{filters:e(c+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),batch_norm_offset:e(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset")}}function o(c){var l="mobilenetv1/conv_"+c,d="MobilenetV1/Conv2d_"+c+"_depthwise",f=l+"/depthwise_conv",h=l+"/pointwise_conv";return{depthwise_conv:{filters:e(d+"/depthwise_weights",4,f+"/filters"),batch_norm_scale:e(d+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),batch_norm_offset:e(d+"/BatchNorm/beta",1,f+"/batch_norm_offset"),batch_norm_mean:e(d+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),batch_norm_variance:e(d+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",c,h)}}function a(c,l){return{filters:e(c+"/weights",4,l+"/filters"),bias:e(c+"/biases",1,l+"/bias")}}function s(c){return{box_encoding_predictor:a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),class_predictor:a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor")}}return{extractMobilenetV1Params:function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}}}(n,t),r=e.extractMobilenetV1Params,o=e.extractPredictionLayerParams,i=n["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Sl(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return oo(n,t),{params:a,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function Kj(n){var t=[],e=io(n),r=e.extractWeights,o=e.getRemainingWeights,i=function $j(n,t){function r(u,c,l,d,f){var h=fn(n(u*c*l*l),[l,l,u,c]),p=xt(n(c));return t.push({paramPath:d+"/filters"},{paramPath:d+"/"+(f?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function o(u,c,l,d){var f=r(u,c,l,d,!0);return{filters:f.filters,batch_norm_offset:f.bias}}function i(u,c,l){var d=function e(u,c){var l=fn(n(9*u),[3,3,u,1]),d=xt(n(u)),f=xt(n(u)),h=xt(n(u)),p=xt(n(u));return t.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}}(u,l+"/depthwise_conv");return{depthwise_conv:d,pointwise_conv:o(u,c,1,l+"/pointwise_conv")}}return{extractMobilenetV1Params:function a(){return{conv_0:o(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function s(){return{conv_0:o(1024,256,1,"prediction_layer/conv_0"),conv_1:o(256,512,3,"prediction_layer/conv_1"),conv_2:o(512,128,1,"prediction_layer/conv_2"),conv_3:o(128,256,3,"prediction_layer/conv_3"),conv_4:o(256,128,1,"prediction_layer/conv_4"),conv_5:o(128,256,3,"prediction_layer/conv_5"),conv_6:o(256,64,1,"prediction_layer/conv_6"),conv_7:o(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,t),s=i.extractPredictionLayerParams,u=(0,i.extractMobilenetV1Params)(),c=s(),d={extra_dim:$p(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:d},paramMappings:t}}(e)},t}(ro);!function(n){fe(function t(){return null!==n&&n.apply(this,arguments)||this},n)}(nI);var cW=[new Me(.738768,.874946),new Me(2.42204,2.65704),new Me(4.30971,7.04493),new Me(10.246,4.59428),new Me(12.6868,11.8741)],lW=[new Me(1.603231,2.094468),new Me(6.041143,7.080126),new Me(2.882459,3.518061),new Me(4.266906,5.178857),new Me(9.041765,10.66308)],dW=[117.001,114.697,97.404],Bl=function(n){return"number"==typeof n};function yg(n){return Y(function(){var t=qt(n,q(.10000000149011612));return Ie(ot(Mt(n,t)),t)})}function Oo(n,t){return Y(function(){var e=si(n,[[0,0],[1,1],[1,1],[0,0]]);return e=Vn(e,t.conv.filters,[1,1],"valid"),e=Mt(e,t.bn.sub),e=qt(e,t.bn.truediv),yg(e=Ie(e,t.conv.bias))})}function Lo(n,t){return Y(function(){var e=si(n,[[0,0],[1,1],[1,1],[0,0]]);return e=Ev(e,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),yg(e=Ie(e,t.bias))})}var bg=function(){function n(t){var e=void 0===t?{}:t,r=e.inputSize,o=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),rI=function(n){function t(e){var r=n.call(this,"TinyYolov2")||this;return function pW(n){if(!n)throw new Error("invalid config: "+n);if("boolean"!=typeof n.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!Bl(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(t){return"string"==typeof t}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(t){return t||{}}).every(function(t){return Bl(t.x)&&Bl(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||3!==n.meanRgb.length||!n.meanRgb.every(Bl)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}(e),r._config=e,r}return fe(t,n),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,r){var o=Oo(e,r.conv0);return o=Oo(o=Ft(o,[2,2],[2,2],"same"),r.conv1),o=Oo(o=Ft(o,[2,2],[2,2],"same"),r.conv2),o=Oo(o=Ft(o,[2,2],[2,2],"same"),r.conv3),o=Oo(o=Ft(o,[2,2],[2,2],"same"),r.conv4),o=Oo(o=Ft(o,[2,2],[2,2],"same"),r.conv5),o=Oo(o=Ft(o,[2,2],[1,1],"same"),r.conv6),sr(o=Oo(o,r.conv7),r.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,r){var o=this.config.isFirstLayerConv2d?yg(sr(e,r.conv0,"valid",!1)):Lo(e,r.conv0);return o=Lo(o=Ft(o,[2,2],[2,2],"same"),r.conv1),o=Lo(o=Ft(o,[2,2],[2,2],"same"),r.conv2),o=Lo(o=Ft(o,[2,2],[2,2],"same"),r.conv3),o=Lo(o=Ft(o,[2,2],[2,2],"same"),r.conv4),o=Lo(o=Ft(o,[2,2],[2,2],"same"),r.conv5),o=Ft(o,[2,2],[1,1],"same"),o=r.conv6?Lo(o,r.conv6):o,sr(o=r.conv7?Lo(o,r.conv7):o,r.conv8,"valid",!1)},t.prototype.forwardInput=function(e,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return Y(function(){var a=e.toBatchTensor(r,!1).toFloat();return a=(a=o.config.meanRgb?ru(a,o.config.meanRgb):a).div(q(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},t.prototype.forward=function(e,r){return te(this,void 0,void 0,function(){var o;return ne(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,kt(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},t.prototype.detect=function(e,r){return void 0===r&&(r={}),te(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,v,w=this;return ne(this,function(y){switch(y.label){case 0:return o=new bg(r),i=o.inputSize,a=o.scoreThreshold,[4,kt(e)];case 1:return s=y.sent(),[4,this.forwardInput(s,i)];case 2:return u=y.sent(),c=Y(function(){return Tt(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return d=y.sent(),u.dispose(),c.dispose(),f=d.map(function(b){return b.box}),h=d.map(function(b){return b.score}),p=d.map(function(b){return b.classScore}),v=d.map(function(b){return w.config.classes[b.label]}),[2,nu(f.map(function(b){return b.rescale(i)}),h,this.config.iouThreshold,!0).map(function(b){return new SE(h[b],p[b],v[b],f[b],l)})]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function yW(n,t){var s,e=[],r=function mW(n,t){var e=Po(n,t);function o(s){return{filters:e(s+"/filters",4),bias:e(s+"/bias",1)}}return{extractConvParams:o,extractConvWithBatchNormParams:function i(s){var u=o(s+"/conv"),c=function r(s){return{sub:e(s+"/sub",1),truediv:e(s+"/truediv",1)}}(s+"/bn");return{conv:u,bn:c}},extractSeparableConvParams:hg(e)}}(n,e),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;s={conv0:t.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return oo(n,e),{params:s,paramMappings:e}}(e,this.config)},t.prototype.extractParams=function(e){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(7!==o&&8!==o&&9!==o)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return function gW(n,t,e,r){var f,o=io(n),a=o.getRemainingWeights,s=[],u=function vW(n,t){var e=kl(n,t),i=fg(n,t);return{extractConvParams:e,extractConvWithBatchNormParams:function o(a,s,u){var c=e(a,s,3,u+"/conv"),l=function r(a,s){var u=xt(n(a)),c=xt(n(a));return t.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}(s,u+"/bn");return{conv:c,bn:l}},extractSeparableConvParams:i}}(o.extractWeights,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams;if(t.withSeparableConvs){var h=r[0],p=r[1],v=r[2],g=r[3],m=r[4],w=r[5],y=r[6],b=r[7],x=r[8];f={conv0:t.isFirstLayerConv2d?c(h,p,3,"conv0"):d(h,p,"conv0"),conv1:d(p,v,"conv1"),conv2:d(v,g,"conv2"),conv3:d(g,m,"conv3"),conv4:d(m,w,"conv4"),conv5:d(w,y,"conv5"),conv6:b?d(y,b,"conv6"):void 0,conv7:x?d(b,x,"conv7"):void 0,conv8:c(x||b||y,5*e,1,"conv8")}}else v=r[2],g=r[3],m=r[4],w=r[5],y=r[6],b=r[7],x=r[8],f={conv0:l(h=r[0],p=r[1],"conv0"),conv1:l(p,v,"conv1"),conv2:l(v,g,"conv2"),conv3:l(g,m,"conv3"),conv4:l(m,w,"conv4"),conv5:l(w,y,"conv5"),conv6:l(y,b,"conv6"),conv7:l(b,x,"conv7"),conv8:c(x,5*e,1,"conv8")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:f,paramMappings:s}}(e,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(e,r,o){return te(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,v,g,m,w,y,b,x,_,T,S,E,I,N,R,B,O,L,H,j,V=this;return ne(this,function(z){switch(z.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,c=s/a,l=e.shape[1],d=this.config.anchors.length,f=Y(function(){var G=e.reshape([l,l,d,V.boxEncodingSize]);return[G.slice([0,0,0,0],[l,l,d,4]),G.slice([0,0,0,4],[l,l,d,1]),V.withClassScores?Jr(G.slice([0,0,0,5],[l,l,d,V.config.classes.length]),3):q(0)]}),h=f[0],v=f[2],g=[],[4,(p=f[1]).array()];case 1:return m=z.sent(),[4,h.array()];case 2:w=z.sent(),y=0,z.label=3;case 3:if(!(y<l))return[3,12];b=0,z.label=4;case 4:if(!(b<l))return[3,11];x=0,z.label=5;case 5:return x<d?(_=tg(m[y][b][x][0]),!o||_>o?(T=(b+tg(w[y][b][x][0]))/l*u,S=(y+tg(w[y][b][x][1]))/l*c,E=Math.exp(w[y][b][x][2])*this.config.anchors[x].x/l*u,I=Math.exp(w[y][b][x][3])*this.config.anchors[x].y/l*c,N=T-E/2,R=S-I/2,B={row:y,col:b,anchor:x},this.withClassScores?[4,this.extractPredictedClass(v,B)]:[3,7]):[3,9]):[3,10];case 6:return j=z.sent(),[3,8];case 7:j={classScore:1,label:0},z.label=8;case 8:L=(O=j).classScore,H=O.label,g.push(Kt({box:new Ml(N,R,N+E,R+I),score:_,classScore:_*L,label:H},B)),z.label=9;case 9:return x++,[3,5];case 10:return b++,[3,4];case 11:return y++,[3,3];case 12:return h.dispose(),p.dispose(),v.dispose(),[2,g]}})})},t.prototype.extractPredictedClass=function(e,r){return te(this,void 0,void 0,function(){var o,i,a,s;return ne(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,e.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[o][i][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(ro),bW=function(n){function t(e){void 0===e&&(e=!0);var o=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:lW,meanRgb:dW}:{anchors:cW,withClassScores:!0});return n.call(this,o)||this}return fe(t,n),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return te(this,void 0,void 0,function(){return ne(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return[2,i.sent().map(function(a){return new Sn(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}(rI),oI=function(n){function t(){var e=null!==n&&n.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return fe(t,n),t}(bg),uu=function(){function n(){}return n.prototype.then=function(t){return te(this,void 0,void 0,function(){var e;return ne(this,function(r){switch(r.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return te(this,void 0,void 0,function(){return ne(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},n}();function iI(n,t){return Object.assign({},n,{descriptor:t})}function Vl(n,t,e,r,o){return void 0===o&&(o=function(i){return i.alignedRect}),te(this,void 0,void 0,function(){var i,a,s,u,c;return ne(this,function(l){switch(l.label){case 0:return i=n.map(function(d){return vg(d)?o(d):d.detection}),(s=r)?[3,5]:t instanceof Ke?[4,cg(t,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,ug(t,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,e(a=s)];case 6:return c=l.sent(),a.forEach(function(d){return d instanceof Ke&&d.dispose()}),[2,c]}})})}function wg(n,t,e,r,o){return te(this,void 0,void 0,function(){var i=this;return ne(this,function(a){return[2,Vl([n],t,function(s){return te(i,void 0,void 0,function(){return ne(this,function(u){return[2,e(s[0])]})})},r,o)]})})}function xg(n,t){var r=t[1];return{height:Math.floor(t[0]*n),width:Math.floor(r*n)}}var _g=function(n){function t(e,r,o,i){return n.call(this,{left:e,top:r,right:o,bottom:i},!0)||this}return fe(t,n),t}(Ir);function aI(n){return Y(function(){return qt(Mt(n,q(127.5)),q(.0078125))})}function Sa(n,t){return Y(function(){return Ie(ot(n),qt(t,pl(ot(pl(n)))))})}function Dg(n,t,e){return void 0===e&&(e=!1),Y(function(){var r=sr(n,t.conv1,"valid");return r=Sa(r,t.prelu1_alpha),r=Sa(r=sr(r=Ft(r,e?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),Sa(r=sr(r=e?r:Ft(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)})}function MW(n,t,e,r,o){o.stage1=[];var i=t.map(function(f){return Y(function(){var h={scale:f},p=function SW(n,t){return Y(function(){var e=xg(t,n.shape.slice(1)),a=aI(Av.resizeBilinear(n,[e.height,e.width]));return Ao(a,[0,2,1,3])})}(n,f),v=Date.now(),g=function IW(n,t){return Y(function(){var e=Dg(n,t,!0),r=sr(e,t.conv4_1,"valid"),o=Bn(xl(r,3),3);return{prob:Jr(Mt(r,o),3),regions:sr(e,t.conv4_2,"valid")}})}(p,r),m=g.prob,w=g.regions;return h.pnet=Date.now()-v,{scoresTensor:Tt(Tt(m,3)[1])[0],regionsTensor:Tt(w)[0],scale:f,statsForScale:h}})}),a=i.map(function(f){var h=f.scoresTensor,p=f.regionsTensor,g=f.statsForScale,m=function TW(n,t,e,r){for(var o=[],i=n.arraySync(),a=0;a<n.shape[0];a++)for(var s=0;s<n.shape[1];s++)i[a][s]>=r&&o.push(new Me(s,a));return o.map(function(c){var l=new Ml(Math.round((2*c.y+1)/e),Math.round((2*c.x+1)/e),Math.round((2*c.y+12)/e),Math.round((2*c.x+12)/e)),d=i[c.y][c.x],f=t.arraySync();return{cell:l,score:d,region:new _g(f[c.y][c.x][0],f[c.y][c.x][1],f[c.y][c.x][2],f[c.y][c.x][3])}})}(h,p,f.scale,e);if(h.dispose(),p.dispose(),!m.length)return o.stage1.push(g),[];var w=Date.now(),y=nu(m.map(function(b){return b.cell}),m.map(function(b){return b.score}),.5);return g.nms=Date.now()-w,g.numBoxes=y.length,o.stage1.push(g),y.map(function(b){return m[b]})}),s=a.reduce(function(f,h){return f.concat(h)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),d=nu(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);o.stage1_nms=Date.now()-l,c=d.map(function(f){return s[f].score}),u=d.map(function(f){return s[f]}).map(function(f){var h=f.cell,p=f.region;return new Ml(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function sI(n,t,e){var r=e.width,o=e.height;return te(this,void 0,void 0,function(){var i,a,s,u=this;return ne(this,function(c){switch(c.label){case 0:return i=Sr(n),[4,Promise.all(t.map(function(l){return te(u,void 0,void 0,function(){var d,g,m,w;return ne(this,function(y){return d=l.padAtBorders(n.height,n.width),w=i.getImageData(g=d.x-1,m=d.y-1,d.ex-g,d.ey-m),[2,Xt.isNodejs()?sg(w):createImageBitmap(w)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var f=Sr(Rl({width:r,height:o}));f.drawImage(l,0,0,r,o);for(var h=f.getImageData(0,0,r,o).data,p=[],v=0;v<h.length;v+=4)p.push(h[v+2]),p.push(h[v+1]),p.push(h[v]);s.push(p)}),[2,s.map(function(l){return Y(function(){return aI(Ao(fn(l,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function RW(n,t,e,r,o){return te(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,v,g,m,w;return ne(this,function(y){switch(y.label){case 0:return i=Date.now(),[4,sI(n,t,{width:24,height:24})];case 1:return a=y.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(b){var x=function AW(n,t){return Y(function(){var e=Dg(n,t),i=Sa(Mr(or(e,[e.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),a=Mr(i,t.fc2_1),s=Bn(xl(a,1),1),u=Jr(Mt(a,s),1),c=Mr(i,t.fc2_2);return{scores:Tt(u,1)[1],regions:c}})}(b,r);return b.dispose(),x}),o.stage2_rnet=Date.now()-i,u=s.length>1?St(s.map(function(b){return b.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[y.sent()]),u.dispose(),f=c.map(function(b,x){return{score:b,idx:x}}).filter(function(b){return b.score>e}).map(function(b){return b.idx}),h=f.map(function(b){return t[b]}),p=f.map(function(b){return c[b]}),v=[],g=[],h.length>0&&(i=Date.now(),m=nu(h,p,.7),o.stage2_nms=Date.now()-i,w=m.map(function(b){var x=s[f[b]].regions.arraySync();return new _g(x[0][0],x[0][1],x[0][2],x[0][3])}),g=m.map(function(b){return p[b]}),v=m.map(function(b,x){return h[b].calibrate(w[x])})),s.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:v,scores:g}]}})})}function FW(n,t,e,r,o){return te(this,void 0,void 0,function(){var i,a,s,u,c,l,d,f,h,p,v,g,m,w,y;return ne(this,function(b){switch(b.label){case 0:return i=Date.now(),[4,sI(n,t,{width:48,height:48})];case 1:return a=b.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(x){var _=function NW(n,t){return Y(function(){var e=Dg(n,t);e=Sa(e=sr(e=Ft(e,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var i=Sa(Mr(or(e,[e.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),a=Mr(i,t.fc2_1),s=Bn(xl(a,1),1),u=Jr(Mt(a,s),1),c=Mr(i,t.fc2_2),l=Mr(i,t.fc2_3);return{scores:Tt(u,1)[1],regions:c,points:l}})}(x,r);return x.dispose(),_}),o.stage3_onet=Date.now()-i,u=s.length>1?St(s.map(function(x){return x.scores})):s[0].scores,d=(l=Array).from,[4,u.data()];case 2:return c=d.apply(l,[b.sent()]),u.dispose(),f=c.map(function(x,_){return{score:x,idx:_}}).filter(function(x){return x.score>e}).map(function(x){return x.idx}),h=f.map(function(x){var _=s[x].regions.arraySync();return new _g(_[0][0],_[0][1],_[0][2],_[0][3])}),p=f.map(function(x,_){return t[x].calibrate(h[_])}),v=f.map(function(x){return c[x]}),g=[],m=[],w=[],p.length>0&&(i=Date.now(),y=nu(p,v,.7,!1),o.stage3_nms=Date.now()-i,g=y.map(function(x){return p[x]}),m=y.map(function(x){return v[x]}),w=y.map(function(x,_){return Array(5).fill(0).map(function(T,S){var E=s[x].points.arraySync();return new Me(E[0][S]*(g[_].width+1)+g[_].left,E[0][S+5]*(g[_].height+1)+g[_].top)})})),s.forEach(function(x){x.regions.dispose(),x.scores.dispose(),x.points.dispose()}),[2,{boxes:g,scores:m,points:w}]}})})}var kW=function(n){function t(){return n.call(this,"Mtcnn")||this}return fe(t,n),t.prototype.load=function(e){return te(this,void 0,void 0,function(){return ne(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,e)]})})},t.prototype.loadFromDisk=function(e){return te(this,void 0,void 0,function(){return ne(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,e)]})})},t.prototype.forwardInput=function(e,r){return void 0===r&&(r={}),te(this,void 0,void 0,function(){var o,i,a,s,u,c,l,d,f,h,p,v,g,m,y,b,x,_,T,S;return ne(this,function(E){switch(E.label){case 0:if(!(o=this.params))throw new Error("Mtcnn - load model before inference");if(!(i=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=Y(function(){return function wW(n){return Y(function(){return En(Tt(n,3).reverse(),3)})}(Bn(Kv.fromPixels(i)).toFloat())}),c=function(I){return u.dispose(),a.total=Date.now()-s,I},l=u.shape.slice(1),d=l[0],f=l[1],h=new tI(r),p=h.minFaceSize,v=h.scaleFactor,g=h.maxNumScales,m=h.scoreThresholds,y=(h.scaleSteps||function EW(n,t,e){for(var i=12/n,a=[],s=Math.min(e[0],e[1])*i,u=0;s>=12;)a.push(i*Math.pow(t,u)),s*=t,u+=1;return a}(p,v,[d,f])).filter(function(I){var N=xg(I,[d,f]);return Math.min(N.width,N.height)>12}).slice(0,g),a.scales=y,a.pyramid=y.map(function(I){return xg(I,[d,f])}),b=Date.now(),[4,MW(u,y,m[0],o.pnet,a)];case 1:return x=E.sent(),a.total_stage1=Date.now()-b,x.boxes.length?(a.stage2_numInputBoxes=x.boxes.length,b=Date.now(),[4,RW(i,x.boxes,m[1],o.rnet,a)]):[2,c({results:[],stats:a})];case 2:return _=E.sent(),a.total_stage2=Date.now()-b,_.boxes.length?(a.stage3_numInputBoxes=_.boxes.length,b=Date.now(),[4,FW(i,_.boxes,m[2],o.onet,a)]):[2,c({results:[],stats:a})];case 3:return T=E.sent(),a.total_stage3=Date.now()-b,S=T.boxes.map(function(I,N){return Pl(au({},new Sn(T.scores[N],new ng(I.left/f,I.top/d,I.width/f,I.height/d),{height:d,width:f})),new aj(T.points[N].map(function(R){return R.sub(new Me(I.left,I.top)).div(new Me(I.width,I.height))}),{width:I.width,height:I.height}))}),[2,c({results:S,stats:a})]}})})},t.prototype.forward=function(e,r){return void 0===r&&(r={}),te(this,void 0,void 0,function(){var o;return ne(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,kt(e)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},t.prototype.forwardWithStats=function(e,r){return void 0===r&&(r={}),te(this,void 0,void 0,function(){var o;return ne(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,kt(e)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function CW(n){var t=[],e=function DW(n,t){var e=Po(n,t);function r(l){return{filters:e(l+"/weights",4,l+"/filters"),bias:e(l+"/bias",1)}}function o(l){return{weights:e(l+"/weights",2),bias:e(l+"/bias",1)}}function i(l){return e(l,1)}function a(l){return{conv1:r(l+"/conv1"),prelu1_alpha:i(l+"/prelu1_alpha"),conv2:r(l+"/conv2"),prelu2_alpha:i(l+"/prelu2_alpha"),conv3:r(l+"/conv3"),prelu3_alpha:i(l+"/prelu3_alpha")}}return{extractPNetParams:function s(){var l=a("pnet"),d=r("pnet/conv4_1"),f=r("pnet/conv4_2");return Kt(Kt({},l),{conv4_1:d,conv4_2:f})},extractRNetParams:function u(){var l=a("rnet"),d=o("rnet/fc1"),f=i("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),p=o("rnet/fc2_2");return Kt(Kt({},l),{fc1:d,prelu4_alpha:f,fc2_1:h,fc2_2:p})},extractONetParams:function c(){var l=a("onet"),d=r("onet/conv4"),f=i("onet/prelu4_alpha"),h=o("onet/fc1"),p=i("onet/prelu5_alpha"),v=o("onet/fc2_1"),g=o("onet/fc2_2"),m=o("onet/fc2_3");return Kt(Kt({},l),{conv4:d,prelu4_alpha:f,fc1:h,prelu5_alpha:p,fc2_1:v,fc2_2:g,fc2_3:m})}}}(n,t),o=e.extractRNetParams,i=e.extractONetParams,a=(0,e.extractPNetParams)(),s=o(),u=i();return oo(n,t),{params:{pnet:a,rnet:s,onet:u},paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function _W(n){var t=io(n),r=t.getRemainingWeights,o=[],i=function xW(n,t){var e=kl(n,t),r=dg(n,t);function o(c,l){var d=xt(n(c));return t.push({paramPath:l}),d}function i(c,l,d){return void 0===d&&(d=!1),{conv1:e(c[0],c[1],3,l+"/conv1"),prelu1_alpha:o(c[1],l+"/prelu1_alpha"),conv2:e(c[1],c[2],3,l+"/conv2"),prelu2_alpha:o(c[2],l+"/prelu2_alpha"),conv3:e(c[2],c[3],d?2:3,l+"/conv3"),prelu3_alpha:o(c[3],l+"/prelu3_alpha")}}return{extractPNetParams:function a(){var c=i([3,10,16,32],"pnet"),l=e(32,2,1,"pnet/conv4_1"),d=e(32,4,1,"pnet/conv4_2");return Kt(Kt({},c),{conv4_1:l,conv4_2:d})},extractRNetParams:function s(){var c=i([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),d=o(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return Kt(Kt({},c),{fc1:l,prelu4_alpha:d,fc2_1:f,fc2_2:h})},extractONetParams:function u(){var c=i([3,32,64,64],"onet"),l=e(64,128,2,"onet/conv4"),d=o(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),v=r(256,4,"onet/fc2_2"),g=r(256,10,"onet/fc2_3");return Kt(Kt({},c),{conv4:l,prelu4_alpha:d,fc1:f,prelu5_alpha:h,fc2_1:p,fc2_2:v,fc2_3:g})}}}(t.extractWeights,o),s=i.extractRNetParams,u=i.extractONetParams,c=(0,i.extractPNetParams)(),l=s(),d=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:d},paramMappings:o}}(e)},t}(ro),OW=[new Me(1.603231,2.094468),new Me(6.041143,7.080126),new Me(2.882459,3.518061),new Me(4.266906,5.178857),new Me(9.041765,10.66308)],LW=[117.001,114.697,97.404],BW=function(n){function t(){return n.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:OW,meanRgb:LW,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return fe(t,n),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return te(this,void 0,void 0,function(){return ne(this,function(i){switch(i.label){case 0:return[4,this.detect(e,r)];case 1:return[2,i.sent().map(function(a){return new Sn(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}(rI),Ue={ssdMobilenetv1:new nI,tinyFaceDetector:new BW,tinyYolov2:new bW,mtcnn:new kW,faceLandmark68Net:new QE,faceLandmark68TinyNet:new Vj,faceRecognitionNet:new qj,faceExpressionNet:new _j,ageGenderNet:new Pj};function uI(n,t){return Object.assign({},n,{age:t})}var cI=function(n){function t(e,r,o){var i=n.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return fe(t,n),t}(uu),Cg=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e,r,o=this;return ne(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,Vl(e=i.sent(),this.input,function(a){return te(o,void 0,void 0,function(){return ne(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Ue.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){return KE(a,r[s])})]}})})},t.prototype.withAgeAndGender=function(){return new Tg(this,this.input)},t}(cI),Eg=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e,r;return ne(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,wg(e,this.input,function(i){return Ue.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,KE(e,r)]}})})},t.prototype.withAgeAndGender=function(){return new Mg(this,this.input)},t}(cI),Ig=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.withAgeAndGender=function(){return new Ag(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Ng(this,this.input)},t}(Cg),Sg=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.withAgeAndGender=function(){return new Rg(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Fg(this,this.input)},t}(Eg),lI=function(n){function t(e,r,o){var i=n.call(this)||this;return i.parentTask=e,i.input=r,i.extractedFaces=o,i}return fe(t,n),t}(uu),Tg=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e,r,o=this;return ne(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return[4,Vl(e=i.sent(),this.input,function(a){return te(o,void 0,void 0,function(){return ne(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return Ue.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,e.map(function(a,s){var u=r[s],c=u.age;return uI(eI(a,u.gender,u.genderProbability),c)})]}})})},t.prototype.withFaceExpressions=function(){return new Cg(this,this.input)},t}(lI),Mg=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e,r,o;return ne(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?[4,wg(e,this.input,function(u){return Ue.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,[2,uI(eI(e,r.gender,r.genderProbability),o)]}})})},t.prototype.withFaceExpressions=function(){return new Eg(this,this.input)},t}(lI),Ag=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.withFaceExpressions=function(){return new Ig(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Ng(this,this.input)},t}(Tg),Rg=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.withFaceExpressions=function(){return new Sg(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Fg(this,this.input)},t}(Mg),dI=function(n){function t(e,r){var o=n.call(this)||this;return o.parentTask=e,o.input=r,o}return fe(t,n),t}(uu),Ng=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e;return ne(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return[4,Vl(e=o.sent(),this.input,function(i){return Promise.all(i.map(function(a){return Ue.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,o.sent().map(function(i,a){return iI(e[a],i)})]}})})},t.prototype.withFaceExpressions=function(){return new Ig(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ag(this,this.input)},t}(dI),Fg=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e,r;return ne(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(e=o.sent())?[4,wg(e,this.input,function(i){return Ue.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,iI(e,r)]}})})},t.prototype.withFaceExpressions=function(){return new Sg(this,this.input)},t.prototype.withAgeAndGender=function(){return new Rg(this,this.input)},t}(dI),fI=function(n){function t(e,r,o){var i=n.call(this)||this;return i.parentTask=e,i.input=r,i.useTinyLandmarkNet=o,i}return fe(t,n),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Ue.faceLandmark68TinyNet:Ue.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(uu),UW=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e,r,o,i,a,s=this;return ne(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),r=e.map(function(c){return c.detection}),this.input instanceof Ke?[4,cg(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,ug(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),o.forEach(function(c){return c instanceof Ke&&c.dispose()}),[2,e.map(function(c,l){return Pl(c,a[l])})]}})})},t.prototype.withFaceExpressions=function(){return new Ig(this,this.input)},t.prototype.withAgeAndGender=function(){return new Ag(this,this.input)},t.prototype.withFaceDescriptors=function(){return new Ng(this,this.input)},t}(fI),zW=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e,r,o,i,a;return ne(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return(e=s.sent())?(r=e.detection,this.input instanceof Ke?[4,cg(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,ug(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return[4,this.landmarkNet.detectLandmarks((o=i)[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof Ke&&u.dispose()}),[2,Pl(e,a)]}})})},t.prototype.withFaceExpressions=function(){return new Sg(this,this.input)},t.prototype.withAgeAndGender=function(){return new Rg(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Fg(this,this.input)},t}(fI),hI=function(n){function t(e,r){void 0===r&&(r=new Ll);var o=n.call(this)||this;return o.input=e,o.options=r,o}return fe(t,n),t}(uu),pI=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e,r,o,i;return ne(this,function(a){switch(a.label){case 0:return r=(e=this).input,(o=e.options)instanceof tI?[4,Ue.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(!(i=o instanceof oI?function(s){return Ue.tinyFaceDetector.locateFaces(s,o)}:o instanceof Ll?function(s){return Ue.ssdMobilenetv1.locateFaces(s,o)}:o instanceof bg?function(s){return Ue.tinyYolov2.locateFaces(s,o)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return te(e,void 0,void 0,function(){var o;return ne(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return au({},a)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new UW(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Cg(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Tg(this.runAndExtendWithFaceDetections(),this.input)},t}(hI);!function(n){function t(){return null!==n&&n.apply(this,arguments)||this}fe(t,n),t.prototype.run=function(){return te(this,void 0,void 0,function(){var e,r;return ne(this,function(o){switch(o.label){case 0:return[4,new pI(this.input,this.options)];case 1:return e=o.sent(),r=e[0],e.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return te(e,void 0,void 0,function(){var o;return ne(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?au({},o):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new zW(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new Eg(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Mg(this.runAndExtendWithFaceDetection(),this.input)}}(hI);var $W=function(){function n(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof ou)return a;if(a instanceof Float32Array)return new ou(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new ou(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(t,e){return e.map(function(r){return function qW(n,t){if(n.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(n),r=Array.from(t);return Math.sqrt(e.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}(r,t)}).reduce(function(r,o){return r+o},0)/(e.length||1)},n.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(r){return new ME(r.label,e.computeMeanDistance(t,r.descriptors))}).reduce(function(r,o){return r.distance<o.distance?r:o})},n.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new ME("unknown",e.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},n.fromJSON=function(t){return new n(t.labeledDescriptors.map(function(r){return ou.fromJSON(r)}),t.distanceThreshold)},n}();function vI(n,t){var e=new gi(t.width,t.height),r=e.width,o=e.height;if(r<=0||o<=0)throw new Error("resizeResults - invalid dimensions: "+JSON.stringify({width:r,height:o}));if(Array.isArray(n))return n.map(function(s){return vI(s,{width:r,height:o})});if(vg(n)){var i=n.detection.forSize(r,o),a=n.unshiftedLandmarks.forSize(i.box.width,i.box.height);return Pl(au(n,i),a)}return iu(n)?au(n,n.detection.forSize(r,o)):n instanceof Ea||n instanceof Sn?n.forSize(r,o):n}const KW=["inputVideo"],XW=["overlay"];let YW=(()=>{class n{constructor(e){this.http=e,this.descriptors=new mL,this.matcher=null,this.ppl={},e.get("assets/descriptors.json").subscribe(r=>{const o={};r.forEach(i=>{const a=i.label;o[a]||(o[a]=[],o[a].push(Float32Array.from(i.descriptor)))}),this.descriptors.next(Object.keys(o).map(i=>new ou(i,o[i]))),this.descriptors.complete()})}loadModels(){return Es(function*(){yield Ue.tinyFaceDetector.load("assets/models"),yield Ue.faceLandmark68Net.load("assets/models"),yield Ue.faceRecognitionNet.load("assets/models"),yield Ue.ageGenderNet.load("assets/models")})()}ngAfterViewInit(){var e=this;xp(Es(function*(){return e.init()})).subscribe(()=>{console.log("initialized")})}init(){var e=this;return Es(function*(){const r=e.inputVideo.nativeElement,o=e.overlay.nativeElement,i=navigator.mediaDevices.getSupportedConstraints();console.log("SUPPORTED",JSON.stringify(i));const a={};i.facingMode&&(a.facingMode={exact:"environment"}),console.log("CONSTRAINTS",JSON.stringify(i));try{e.videoStream=yield navigator.mediaDevices.getUserMedia({video:a})}catch{e.videoStream=yield navigator.mediaDevices.getUserMedia({video:{}})}console.log("STREAM SIZE",e.videoStream.getVideoTracks()[0].getSettings().width,e.videoStream.getVideoTracks()[0].getSettings().height),r.srcObject=e.videoStream,_p(r,"play").pipe(function SL(n,t,e){const r=He(n)||t||e?{next:n,error:t,complete:e}:n;return r?co((o,i)=>{var a;null===(a=r.subscribe)||void 0===a||a.call(r);let s=!0;o.subscribe(lo(i,u=>{var c;null===(c=r.next)||void 0===c||c.call(r,u),i.next(u)},()=>{var u;s=!1,null===(u=r.complete)||void 0===u||u.call(r),i.complete()},u=>{var c;s=!1,null===(c=r.error)||void 0===c||c.call(r,u),i.error(u)},()=>{var u,c;s&&(null===(u=r.unsubscribe)||void 0===u||u.call(r)),null===(c=r.finalize)||void 0===c||c.call(r)}))}):Yl}(()=>{console.log("SETTING SIZE",r.offsetWidth,r.offsetHeight),o.width=r.clientWidth,o.height=r.clientHeight}),function TL(n,t){return co((e,r)=>{let o=null,i=0,a=!1;const s=()=>a&&!o&&r.complete();e.subscribe(lo(r,u=>{o?.unsubscribe();let c=0;const l=i++;cr(n(u,l)).subscribe(o=lo(r,d=>r.next(t?t(u,d,l,c++):d),()=>{o=null,s()}))},()=>{a=!0,s()}))})}(()=>xp(Es(function*(){return yield e.loadModels()})))).subscribe(()=>{e.faceDetect()}),e.descriptors.subscribe(s=>{e.matcher=new $W(s)})})()}faceDetect(){const e=this.inputVideo.nativeElement,r=this.overlay.nativeElement,o=new oI({inputSize:256}),i={fontSize:30,anchorPosition:Tr.TOP_RIGHT,fontStyle:"Open Sans"};xp(Es(function*(){return yield function GW(n,t){return void 0===t&&(t=new Ll),new pI(n,t)}(e,o).withFaceLandmarks().withAgeAndGender().withFaceDescriptors()})).pipe().subscribe(a=>{if(a.length>0){const s=function mj(n,t,e){void 0===e&&(e=!1);var r=e?ag(t):t,o=r.width,i=r.height;return n.width=o,n.height=i,{width:o,height:i}}(r,e,!0),u=vI(a,s);!function Ij(n,t){(Array.isArray(t)?t:[t]).forEach(function(r){var o=r instanceof Ea?r:vg(r)?r.landmarks:void 0;if(!o)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Ej(o).draw(n)})}(r,u);const c={};for(const l of u){const{age:d,gender:f,genderProbability:h}=l,p="male"===f?"\u05d1\u05df":"\u05d1\u05ea";let v=null;if(this.matcher){v=this.matcher.findBestMatch(l.descriptor);const g=[];v.label&&"unknown"!==v.label?(g.push(v.label),c[v.label]=this.ppl[v.label]||{ages:[],male:[]},c[v.label].ages=[d,...c[v.label].ages.slice(0,30)],c[v.label].male=["male"===f?h:1-h,...c[v.label].male.slice(0,30)]):g.push(`${p} ~${Tl(d,0)}`);let m=l.detection.box.topRight.mul(new Me(2,2));m=m.add(l.detection.box.topLeft).div(new Me(3,3)),m=m.sub(new Me(0,.5*l.detection.box.height)),new Al(g,m,i).draw(r);const w=[];Object.keys(c).sort().forEach(y=>{const b=c[y].ages,x=c[y].male,_=b.reduce((S,E)=>S+E)/b.length,T=x.reduce((S,E)=>S+E)/x.length;w.push(`${y}: ${T>.5?"\u05d1\u05df":"\u05d1\u05ea"} ${_.toFixed(0)}`)}),w.length>0&&new Al(w,new Me(r.width,0),i).draw(r),this.ppl=c}}}else r.getContext("2d")?.clearRect(0,0,r.width,r.height);requestAnimationFrame(()=>this.faceDetect())})}}return n.\u0275fac=function(e){return new(e||n)(xe(K1))},n.\u0275cmp=ld({type:n,selectors:[["app-root"]],viewQuery:function(e,r){if(1&e&&(Th(KW,5),Th(XW,5)),2&e){let o;Sh(o=Mh())&&(r.inputVideo=o.first),Sh(o=Mh())&&(r.overlay=o.first)}},decls:5,vars:3,consts:[[1,"main"],["playsinline","",3,"autoplay","muted","volume"],["inputVideo",""],["overlay",""]],template:function(e,r){1&e&&(ac(0,"div",0),eh(1,"video",1,2)(3,"canvas",null,3),sc()),2&e&&(function r0(n){o0(Ne(),U(),Zt()+n,!1)}(1),Jf("autoplay",!0)("muted",!0)("volume",0))},styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-flow:column;align-items:stretch;justify-content:center}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]{width:100%;position:relative;display:flex;flex-flow:column;align-items:center;justify-content:center}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .main[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}"]}),n})(),QW=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=Wo({type:n,bootstrap:[YW]}),n.\u0275inj=ho({imports:[UO,gL]}),n})();(function Tk(){Kx=!1})(),WO().bootstrapModule(QW).catch(n=>console.error(n))},902:()=>{},522:()=>{},753:()=>{}},Wl=>{Wl(Wl.s=989)}]);